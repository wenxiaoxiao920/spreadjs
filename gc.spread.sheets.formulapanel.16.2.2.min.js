/*!
 * 
 * SpreadJS Library 16.2.2
 *
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 *
 * Licensed under the SpreadJS Commercial License.
 * us.sales@grapecity.com
 * http://www.grapecity.com/en/licensing/grapecity/
 *
 *
 */
!function(t){"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("@grapecity/spread-sheets")):"function"==typeof define&&define.amd?define(["@grapecity/spread-sheets"],t):"object"==typeof exports?exports.Spread=t(require("@grapecity/spread-sheets")):t(GC)}(function(e){!function(){"use strict";var r,i,t;function n(t){var e,e,e=i[t];return void 0!==e||(e=i[t]={exports:{}},r[t].call(e.exports,e,e.exports,n)),e.exports}r={"./dist/plugins/formulaPanel/editor/codemirror/index.js":function(B,t,_){var u,c,F,N,$,_,t,H,U,e,z,p,k,y,d,W,f,t,V,q,G,J,K;_.r(t),_.d(t,{Autocomplete:function(){return q},Commands:function(){return G},Language:function(){return V},Lint:function(){return J},Search:function(){return K},State:function(){return F},View:function(){return W},basicSetup:function(){return jm}});class g{lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length `+this.length);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,r){var i=[];return this.decompose(0,t,i,2),r.length&&r.decompose(0,r.length,i,3),this.decompose(e,this.length,i,1),Q.from(i,this.length-(e-t)+r.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){var r=[];return this.decompose(t,e,r,0),Q.from(r,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;var r=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),n=new tt(this),s=new tt(t);for(let t=r,e=r;;){if(n.next(t),s.next(t),t=0,n.lineBreak!=s.lineBreak||n.done!=s.done||n.value!=s.value)return!1;if(e+=n.value.length,n.done||e>=i)return!0}}iter(t=1){return new tt(this,t)}iterRange(t,e=this.length){return new et(this,t,e)}iterLines(t,e){let r;var t;return r=null==t?this.iter():(null==e&&(e=this.lines+1),t=this.line(t).from,this.iterRange(t,Math.max(t,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))),new rt(r)}toString(){return this.sliceString(0)}toJSON(){var t=[];return this.flatten(t),t}constructor(){}static of(t){if(0==t.length)throw new RangeError("A document must have at least one line");return 1!=t.length||t[0]?t.length<=32?new w(t):Q.from(w.split(t,[])):g.empty}}class w extends g{constructor(t,e=X(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(e,r,i,n){for(let t=0;;t++){var s=this.text[t],o=n+s.length;if(e<=(r?i:o))return new it(n,o,i,s);n=o+1,i++}}decompose(t,e,r,i){var e=t<=0&&e>=this.length?this:new w(Y(this.text,t,e),Math.min(e,this.length)-Math.max(0,t)),t,i,t;1&i?(t=r.pop(),(i=Z(e.text,t.text.slice(),0,e.length)).length<=32?r.push(new w(i,t.length+e.length)):(t=i.length>>1,r.push(new w(i.slice(0,t)),new w(i.slice(t))))):r.push(e)}replace(t,e,r){var i,n;return r instanceof w?(i=Z(this.text,Z(r.text,Y(this.text,0,t)),e),n=this.length+r.length-(e-t),i.length<=32?new w(i,n):Q.from(w.split(i,[]),n)):super.replace(t,e,r)}sliceString(r,i=this.length,n="\n"){let s="";for(let t=0,e=0;t<=i&&e<this.text.length;e++){var o=this.text[e],h=t+o.length;t>r&&e&&(s+=n),r<h&&i>t&&(s+=o.slice(Math.max(0,r-t),i-t)),t=h+1}return s}flatten(t){for(var e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let r=[],i=-1;for(var n of t)r.push(n),i+=n.length+1,32==r.length&&(e.push(new w(r,i)),r=[],i=-1);return-1<i&&e.push(new w(r,i)),e}}class Q extends g{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(var r of t)this.lines+=r.lines}lineInner(e,r,i,n){for(let t=0;;t++){var s=this.children[t],o=n+s.length,h=i+s.lines-1;if(e<=(r?h:o))return s.lineInner(e,r,i,n);n=o+1,i=1+h}}decompose(r,i,n,s){for(let t=0,e=0;e<=i&&t<this.children.length;t++){var o=this.children[t],h=e+o.length,a;r<=h&&i>=e&&(a=s&((e<=r?1:0)|(i<=h?2:0)),e>=r&&h<=i&&!a?n.push(o):o.decompose(r-e,i-e,n,a)),e=h+1}}replace(r,i,n){if(n.lines<this.lines)for(let t=0,e=0;t<this.children.length;t++){var s=this.children[t],o=e+s.length,h,s,s;if(r>=e&&i<=o)return h=s.replace(r-e,i-e,n),s=this.lines-s.lines+h.lines,h.lines<s>>4&&h.lines>s>>6?((s=this.children.slice())[t]=h,new Q(s,this.length-(i-r)+n.length)):super.replace(e,o,h);e=o+1}return super.replace(r,i,n)}sliceString(r,i=this.length,n="\n"){let s="";for(let t=0,e=0;t<this.children.length&&e<=i;t++){var o=this.children[t],h=e+o.length;e>r&&t&&(s+=n),r<h&&i>e&&(s+=o.sliceString(r-e,i-e,n)),e=h+1}return s}flatten(t){for(var e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof Q))return 0;let r=0,[i,n,s,o]=0<e?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;i+=e,n+=e){if(i==s||n==o)return r;var h=this.children[i],a=t.children[n];if(h!=a)return r+h.scanIdentical(a,e);r+=h.length+1}}static from(t,e=t.reduce((t,e)=>t+e.length+1,-1)){let r=0;for(var i of t)r+=i.lines;if(r<32){var n=[],s;for(s of t)s.flatten(n);return new w(n,e)}let o=Math.max(32,r>>5),h=o<<1,a=o>>1,u=[],l=0,c=-1,f=[];function d(t){let e;if(t.lines>h&&t instanceof Q)for(var r of t.children)d(r);else t.lines>a&&(l>a||!l)?(v(),u.push(t)):t instanceof w&&l&&(e=f[f.length-1])instanceof w&&t.lines+e.lines<=32?(l+=t.lines,c+=t.length+1,f[f.length-1]=new w(e.text.concat(t.text),e.length+1+t.length)):(l+t.lines>o&&v(),l+=t.lines,c+=t.length+1,f.push(t))}function v(){0!=l&&(u.push(1==f.length?f[0]:Q.from(f,c)),c=-1,l=f.length=0)}for(var m of t)d(m);return v(),1==u.length?u[0]:new Q(u,e)}}function X(t){let e=-1;for(var r of t)e+=r.length+1;return e}function Z(s,o,h=0,a=1e9){for(let r=0,i=0,n=!0;i<s.length&&r<=a;i++){let t=s[i],e=r+t.length;h<=e&&(a<e&&(t=t.slice(0,a-r)),r<h&&(t=t.slice(h-r)),n?(o[o.length-1]+=t,n=!1):o.push(t)),r=e+1}return o}function Y(t,e,r){return Z(t,[""],e,r)}g.empty=new w([""],0);class tt{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[0<e?1:(t instanceof w?t.text:t.children).length<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){var r=this.nodes.length-1,i=this.nodes[r],n=this.offsets[r],s=n>>1,o=(i instanceof w?i.text:i.children).length;if(s==(0<e?o:0)){if(0==r)return this.done=!0,this.value="",this;0<e&&this.offsets[r-1]++,this.nodes.pop(),this.offsets.pop()}else if((1&n)==(0<e?0:1)){if(this.offsets[r]+=e,0==t)return this.lineBreak=!0,this.value="\n",this;t--}else if(i instanceof w){var o=i.text[s+(e<0?-1:0)];if(this.offsets[r]+=e,o.length>Math.max(0,t))return this.value=0==t?o:0<e?o.slice(t):o.slice(0,o.length-t),this;t-=o.length}else{var n=i.children[s+(e<0?-1:0)];t>n.length?(t-=n.length,this.offsets[r]+=e):(e<0&&this.offsets[r]--,this.nodes.push(n),this.offsets.push(0<e?1:(n instanceof w?n.text:n.children).length<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}}class et{constructor(t,e,r){this.value="",this.done=!1,this.cursor=new tt(t,r<e?-1:1),this.pos=r<e?t.length:0,this.from=Math.min(e,r),this.to=Math.max(e,r)}nextInner(t,e){var r,i;return(e<0?this.pos<=this.from:this.pos>=this.to)?(this.value="",this.done=!0):(t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos),r=e<0?this.pos-this.from:this.to-this.pos,{value:i}=(r-=t=r<t?r:t,this.cursor.next(t)),this.pos+=(i.length+t)*e,this.value=i.length<=r?i:e<0?i.slice(i.length-r):i.slice(0,r),this.done=!this.value),this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):0<t&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&""!=this.value}}class rt{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){var{done:t,lineBreak:e,value:r}=this.inner.next(t);return t?(this.done=!0,this.value=""):e?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=r,this.afterBreak=!1),this}get lineBreak(){return!1}}"undefined"!=typeof Symbol&&(g.prototype[Symbol.iterator]=function(){return this.iter()},tt.prototype[Symbol.iterator]=et.prototype[Symbol.iterator]=rt.prototype[Symbol.iterator]=function(){return this});class it{constructor(t,e,r,i){this.from=t,this.to=e,this.number=r,this.text=i}get length(){return this.to-this.from}}let nt="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(t=>t?parseInt(t,36):1);for(let t=1;t<nt.length;t++)nt[t]+=nt[t-1];function st(e){for(let t=1;t<nt.length;t+=2)if(nt[t]>e)return nt[t-1]<=e}function ot(t){return 127462<=t&&t<=127487}const ht=8205;function at(t,e,r=!0,i=!0){return(r?ut:lt)(t,e,i)}function ut(r,i,e){if(i!=r.length){i&&ct(r.charCodeAt(i))&&ft(r.charCodeAt(i-1))&&i--;let t=x(r,i);for(i+=vt(t);i<r.length;){var n=x(r,i);if(t==ht||n==ht||e&&st(n))i+=vt(n),t=n;else{if(!ot(n))break;{let t=0,e=i-2;for(;0<=e&&ot(x(r,e));)t++,e-=2;if(t%2==0)break;i+=2}}}}return i}function lt(t,e,r){for(;0<e;){var i=ut(t,e-2,r);if(i<e)return i;e--}return 0}function ct(t){return 56320<=t&&t<57344}function ft(t){return 55296<=t&&t<56320}function x(t,e){var r=t.charCodeAt(e),t;return ft(r)&&e+1!=t.length&&ct(t=t.charCodeAt(e+1))?t-56320+(r-55296<<10)+65536:r}function dt(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}function vt(t){return t<65536?1:2}const mt=/\r\n?|\n/;u=function(t){return t[t.Simple=0]="Simple",t[t.TrackDel=1]="TrackDel",t[t.TrackBefore=2]="TrackBefore",t[t.TrackAfter=3]="TrackAfter",t}(u=u||{});class pt{constructor(t){this.sections=t}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){var r=this.sections[t+1];e+=r<0?this.sections[t]:r}return e}get empty(){return 0==this.sections.length||2==this.sections.length&&this.sections[1]<0}iterGaps(i){for(let t=0,e=0,r=0;t<this.sections.length;){var n=this.sections[t++],s=this.sections[t++];s<0?(i(e,r,n),r+=n):r+=s,e+=n}}iterChangedRanges(t,e=!1){bt(this,t,e)}get invertedDesc(){var e=[];for(let t=0;t<this.sections.length;){var r=this.sections[t++],i=this.sections[t++];i<0?e.push(r,i):e.push(i,r)}return new pt(e)}composeDesc(t){return this.empty?t:t.empty?this:yt(this,t)}mapDesc(t,e=!1){return t.empty?this:kt(this,t,e)}mapPos(e,r=-1,i=u.Simple){let n=0,s=0;for(let t=0;t<this.sections.length;){var o=this.sections[t++],h=this.sections[t++],a=n+o;if(h<0){if(e<a)return s+(e-n);s+=o}else{if(i!=u.Simple&&e<=a&&(i==u.TrackDel&&n<e&&e<a||i==u.TrackBefore&&n<e||i==u.TrackAfter&&e<a))return null;if(e<a||a==e&&r<0&&!o)return e==n||r<0?s:s+h;s+=h}n=a}if(e>n)throw new RangeError(`Position ${e} is out of range for changeset of length `+n);return s}touchesRange(r,i=r){for(let t=0,e=0;t<this.sections.length&&e<=i;){var n=this.sections[t++],s=this.sections[t++],n=e+n;if(0<=s&&e<=i&&r<=n)return!(e<r&&i<n)||"cover";e=n}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){var r=this.sections[t++],i=this.sections[t++];e+=(e?" ":"")+r+(0<=i?":"+i:"")}return e}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some(t=>"number"!=typeof t))throw new RangeError("Invalid JSON representation of ChangeDesc");return new pt(t)}static create(t){return new pt(t)}}class v extends pt{constructor(t,e){super(t),this.inserted=e}apply(s){if(this.length!=s.length)throw new RangeError("Applying change set to a document with the wrong length");return bt(this,(t,e,r,i,n)=>s=s.replace(r,r+(e-t),n),!1),s}mapDesc(t,e=!1){return kt(this,t,e,!0)}invert(r){var i=this.sections.slice(),n=[];for(let t=0,e=0;t<i.length;t+=2){var s=i[t],o=i[t+1];if(0<=o){i[t]=o,i[t+1]=s;for(var h=t>>1;n.length<h;)n.push(g.empty);n.push(s?r.slice(e,e+s):g.empty)}e+=s}return new v(i,n)}compose(t){return this.empty?t:t.empty?this:yt(this,t,!0)}map(t,e=!1){return t.empty?this:kt(this,t,e,!0)}iterChanges(t,e=!1){bt(this,t,e)}get desc(){return pt.create(this.sections)}filter(r){var i=[],n=[],s=[],o=new Mt(this);t:for(let t=0,e=0;;){for(var h=t==r.length?1e9:r[t++];e<h||e==h&&0==o.len;){if(o.done)break t;var a=Math.min(o.len,h-e),u=(gt(s,a,-1),-1==o.ins?-1:0==o.off?o.ins:0);gt(i,a,u),0<u&&wt(n,i,o.text),o.forward(a),e+=a}for(var l=r[t++];e<l;){if(o.done)break t;var c=Math.min(o.len,l-e);gt(i,c,-1),gt(s,c,-1==o.ins?-1:0==o.off?o.ins:0),o.forward(c),e+=c}}return{changes:new v(i,n),filtered:pt.create(s)}}toJSON(){var e=[];for(let t=0;t<this.sections.length;t+=2){var r=this.sections[t],i=this.sections[t+1];e.push(i<0?r:0==i?[r]:[r].concat(this.inserted[t>>1].toJSON()))}return e}static of(t,s,o){let h=[],a=[],u=0,l=null;function c(t=!1){var t;(t||h.length)&&(u<s&&gt(h,s-u,-1),t=new v(h,a),l=l?l.compose(t.map(l)):t,h=[],a=[],u=0)}function f(t){if(Array.isArray(t))for(var e of t)f(e);else if(t instanceof v){if(t.length!=s)throw new RangeError(`Mismatched change set length (got ${t.length}, expected ${s})`);c(),l=l?l.compose(t.map(l)):t}else{var{from:t,to:r=t,insert:i}=t;if(r<t||t<0||s<r)throw new RangeError(`Invalid change range ${t} to ${r} (in doc of length ${s})`);var i=i?"string"==typeof i?g.of(i.split(o||mt)):i:g.empty,n=i.length;t==r&&0==n||(t<u&&c(),t>u&&gt(h,t-u,-1),gt(h,r-t,n),wt(a,h,i),u=r)}}return f(t),c(!l),l}static empty(t){return new v(t?[t,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");var r=[],i=[];for(let t=0;t<e.length;t++){var n=e[t];if("number"==typeof n)r.push(n,-1);else{if(!Array.isArray(n)||"number"!=typeof n[0]||n.some((t,e)=>e&&"string"!=typeof t))throw new RangeError("Invalid JSON representation of ChangeSet");if(1==n.length)r.push(n[0],0);else{for(;i.length<t;)i.push(g.empty);i[t]=g.of(n.slice(1)),r.push(n[0],i[t].length)}}}return new v(r,i)}static createSet(t,e){return new v(t,e)}}function gt(t,e,r,i=!1){var n;0==e&&r<=0||(0<=(n=t.length-2)&&r<=0&&r==t[1+n]?t[n]+=e:0==e&&0==t[n]?t[1+n]+=r:i?(t[n]+=e,t[1+n]+=r):t.push(e,r))}function wt(t,e,r){if(0!=r.length){var i=e.length-2>>1;if(i<t.length)t[t.length-1]=t[t.length-1].append(r);else{for(;t.length<i;)t.push(g.empty);t.push(r)}}}function bt(a,u,l){var c=a.inserted;for(let s=0,o=0,h=0;h<a.sections.length;){let i=a.sections[h++],n=a.sections[h++];if(n<0)s+=i,o+=i;else{let t=s,e=o,r=g.empty;for(;t+=i,e+=n,n&&c&&(r=r.append(c[h-2>>1])),!(l||h==a.sections.length||a.sections[h+1]<0);)i=a.sections[h++],n=a.sections[h++];u(s,t,o,e,r),s=t,o=e}}}function kt(t,e,i,r=!1){var n=[],s=r?[]:null,o=new Mt(t),h=new Mt(e);for(let r=-1;;)if(-1==o.ins&&-1==h.ins){var a=Math.min(o.len,h.len);gt(n,a,-1),o.forward(a),h.forward(a)}else if(0<=h.ins&&(o.ins<0||r==o.i||0==o.off&&(h.len<o.len||h.len==o.len&&!i))){let t=h.len;for(gt(n,h.ins,-1);t;){var u=Math.min(o.len,t);0<=o.ins&&r<o.i&&o.len<=u&&(gt(n,0,o.ins),s&&wt(s,n,o.text),r=o.i),o.forward(u),t-=u}h.next()}else{if(!(0<=o.ins)){if(o.done&&h.done)return s?v.createSet(n,s):pt.create(n);throw new Error("Mismatched change set lengths")}{let t=0,e=o.len;for(;e;)if(-1==h.ins){var l=Math.min(e,h.len);t+=l,e-=l,h.forward(l)}else{if(!(0==h.ins&&h.len<e))break;e-=h.len,h.next()}gt(n,t,r<o.i?o.ins:0),s&&r<o.i&&wt(s,n,o.text),r=o.i,o.forward(o.len-e)}}}function yt(t,e,r=!1){var i=[],n=r?[]:null,s=new Mt(t),o=new Mt(e);for(let t=!1;;){if(s.done&&o.done)return n?v.createSet(i,n):pt.create(i);if(0==s.ins)gt(i,s.len,0,t),s.next();else if(0!=o.len||o.done){if(s.done||o.done)throw new Error("Mismatched change set lengths");var h=Math.min(s.len2,o.len),a=i.length,u;-1==s.ins?(gt(i,h,u=-1==o.ins?-1:o.off?0:o.ins,t),n&&u&&wt(n,i,o.text)):-1==o.ins?(gt(i,s.off?0:s.len,h,t),n&&wt(n,i,s.textBit(h))):(gt(i,s.off?0:s.len,o.off?0:o.ins,t),n&&!o.off&&wt(n,i,o.text)),t=(s.ins>h||0<=o.ins&&o.len>h)&&(t||a<i.length),s.forward2(h),o.forward(h)}else gt(i,0,o.ins,t),n&&wt(n,i,o.text),o.next()}}class Mt{constructor(t){this.set=t,this.i=0,this.next()}next(){var{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return-2==this.ins}get len2(){return this.ins<0?this.len:this.ins}get text(){var{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?g.empty:t[e]}textBit(t){var{inserted:e}=this.set,r=this.i-2>>1;return r>=e.length&&!t?g.empty:e[r].slice(this.off,null==t?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){-1==this.ins?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}}class xt{constructor(t,e,r){this.from=t,this.to=e,this.flags=r}get anchor(){return 16&this.flags?this.to:this.from}get head(){return 16&this.flags?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return 4&this.flags?-1:8&this.flags?1:0}get bidiLevel(){var t=3&this.flags;return 3==t?null:t}get goalColumn(){var t=this.flags>>5;return 33554431==t?void 0:t}map(t,e=-1){let r,i;return this.empty?r=i=t.mapPos(this.from,e):(r=t.mapPos(this.from,1),i=t.mapPos(this.to,-1)),r==this.from&&i==this.to?this:new xt(r,i,this.flags)}extend(t,e=t){var e;return t<=this.anchor&&e>=this.anchor?b.range(t,e):(e=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e,b.range(this.anchor,e))}eq(t){return this.anchor==t.anchor&&this.head==t.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(t&&"number"==typeof t.anchor&&"number"==typeof t.head)return b.range(t.anchor,t.head);throw new RangeError("Invalid JSON representation for SelectionRange")}static create(t,e,r){return new xt(t,e,r)}}class b{constructor(t,e){this.ranges=t,this.mainIndex=e}map(e,r=-1){return e.empty?this:b.create(this.ranges.map(t=>t.map(e,r)),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let t=0;t<this.ranges.length;t++)if(!this.ranges[t].eq(e.ranges[t]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return 1==this.ranges.length?this:new b([this.main],0)}addRange(t,e=!0){return b.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){var r=this.ranges.slice();return r[e]=t,b.create(r,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(t=>t.toJSON()),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||"number"!=typeof t.main||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new b(t.ranges.map(t=>xt.fromJSON(t)),t.main)}static single(t,e=t){return new b([b.range(t,e)],0)}static create(r,i=0){if(0==r.length)throw new RangeError("A selection needs at least one range");for(let t=0,e=0;e<r.length;e++){var n=r[e];if(n.empty?n.from<=t:n.from<t)return b.normalized(r.slice(),i);t=n.to}return new b(r,i)}static cursor(t,e=0,r,i){return xt.create(t,t,(0==e?0:e<0?4:8)|(null==r?3:Math.min(2,r))|(null!=i?i:33554431)<<5)}static range(t,e,r,i){var r=(null!=r?r:33554431)<<5|(null==i?3:Math.min(2,i));return e<t?xt.create(e,t,24|r):xt.create(t,e,(t<e?4:0)|r)}static normalized(e,r=0){var t=e[r];e.sort((t,e)=>t.from-e.from),r=e.indexOf(t);for(let t=1;t<e.length;t++){var i=e[t],n=e[t-1],s,n;(i.empty?i.from<=n.to:i.from<n.to)&&(s=n.from,n=Math.max(i.to,n.to),t<=r&&r--,e.splice(--t,2,i.anchor>i.head?b.range(n,s):b.range(s,n)))}return new b(e,r)}}function Ct(t,e){for(var r of t.ranges)if(r.to>e)throw new RangeError("Selection points outside of document")}let St=0;class m{constructor(t,e,r,i,n){this.combine=t,this.compareInput=e,this.compare=r,this.isStatic=i,this.id=St++,this.default=t([]),this.extensions="function"==typeof n?n(this):n}static define(t={}){return new m(t.combine||(t=>t),t.compareInput||((t,e)=>t===e),t.compare||(t.combine?(t,e)=>t===e:Pt),!!t.static,t.enables)}of(t){return new jt([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new jt(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new jt(t,this,2,e)}from(e,r){return r=r||(t=>t),this.compute([e],t=>r(t.field(e)))}}function Pt(t,r){return t==r||t.length==r.length&&t.every((t,e)=>t===r[e])}class jt{constructor(t,e,r,i){this.dependencies=t,this.facet=e,this.type=r,this.value=i,this.id=St++}dynamicSlot(t){var e,r;let s=this.value,o=this.facet.compareInput,h=this.id,a=t[h]>>1,u=2==this.type,i=!1,n=!1,l=[];for(r of this.dependencies)"doc"==r?i=!0:"selection"==r?n=!0:0==(1&(null!=(e=t[r.id])?e:1))&&l.push(t[r.id]);return{create(t){return t.values[a]=s(t),1},update(t,e){if(i&&e.docChanged||n&&(e.docChanged||e.selection)||Et(t,l)){var e=s(t);if(u?!Ot(e,t.values[a],o):!o(e,t.values[a]))return t.values[a]=e,1}return 0},reconfigure:(e,r)=>{let t,i=r.config.address[h];if(null!=i){var n=Ht(r,i);if(this.dependencies.every(t=>t instanceof m?r.facet(t)===e.facet(t):!(t instanceof M)||r.field(t,!1)==e.field(t,!1))||(u?Ot(t=s(e),n,o):o(t=s(e),n)))return e.values[a]=n,0}else t=s(e);return e.values[a]=t,1}}}}function Ot(e,r,i){if(e.length==r.length){for(let t=0;t<e.length;t++)if(!i(e[t],r[t]))return;return 1}}function Et(t,e){let r=!1;for(var i of e)1&$t(t,i)&&(r=!0);return r}function Dt(e,s,n){let o=n.map(t=>e[t.id]),h=n.map(t=>t.type),i=o.filter(t=>!(1&t)),a=e[s.id]>>1;function u(e){var r=[];for(let t=0;t<o.length;t++){var i=Ht(e,o[t]);if(2==h[t])for(var n of i)r.push(n);else r.push(i)}return s.combine(r)}return{create(t){for(var e of o)$t(t,e);return t.values[a]=u(t),1},update(t,e){var r;return!Et(t,i)||(r=u(t),s.compare(r,t.values[a]))?0:(t.values[a]=r,1)},reconfigure(t,e){var r=Et(t,o),i=e.config.facets[s.id],e=e.facet(s),r;return i&&!r&&Pt(n,i)||(r=u(t),s.compare(r,e))?(t.values[a]=e,0):(t.values[a]=r,1)}}}const At=m.define({static:!0});class M{constructor(t,e,r,i,n){this.id=t,this.createF=e,this.updateF=r,this.compareF=i,this.spec=n,this.provides=void 0}static define(t){var e=new M(St++,t.create,t.update,t.compare||((t,e)=>t===e),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){var e=t.facet(At).find(t=>t.field==this);return((null==e?void 0:e.create)||this.createF)(t)}slot(t){let i=t[this.id]>>1;return{create:t=>(t.values[i]=this.create(t),1),update:(t,e)=>{var r=t.values[i],e=this.updateF(r,e);return this.compareF(r,e)?0:(t.values[i]=e,1)},reconfigure:(t,e)=>null!=e.config.address[this.id]?(t.values[i]=e.field(this),0):(t.values[i]=this.create(t),1)}}init(t){return[this,At.of({field:this,create:t})]}get extension(){return this}}const Rt={lowest:4,low:3,default:2,high:1,highest:0};function It(e){return t=>new Tt(t,e)}const Lt={highest:It(Rt.highest),high:It(Rt.high),default:It(Rt.default),low:It(Rt.low),lowest:It(Rt.lowest)};class Tt{constructor(t,e){this.inner=t,this.prec=e}}class Bt{of(t){return new _t(this,t)}reconfigure(t){return Bt.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}}class _t{constructor(t,e){this.compartment=t,this.inner=e}}class Ft{constructor(t,e,r,i,n,s){for(this.base=t,this.compartments=e,this.dynamicSlots=r,this.address=i,this.staticValues=n,this.facets=s,this.statusTemplate=[];this.statusTemplate.length<r.length;)this.statusTemplate.push(0)}staticFacet(t){var e=this.address[t.id];return null==e?t.default:this.staticValues[e>>1]}static resolve(t,e,i){var r=[],n=Object.create(null),s=new Map,o;for(o of Nt(t,e,s))(o instanceof M?r:n[o.facet.id]||(n[o.facet.id]=[])).push(o);let h=Object.create(null);var a=[],u=[];for(let e of r)h[e.id]=u.length<<1,u.push(t=>e.slot(t));var l=null==i?void 0:i.config.facets,c;for(c in n){let r=n[c],e=r[0].facet;var f=l&&l[c]||[],f;if(r.every(t=>0==t.type)){h[e.id]=a.length<<1|1,Pt(f,r)?a.push(i.facet(e)):(f=e.combine(r.map(t=>t.value)),a.push(i&&e.compare(f,i.facet(e))?i.facet(e):f))}else{for(let e of r)0==e.type?(h[e.id]=a.length<<1|1,a.push(e.value)):(h[e.id]=u.length<<1,u.push(t=>e.dynamicSlot(t)));h[e.id]=u.length<<1,u.push(t=>Dt(t,e,r))}}var e=u.map(t=>t(h));return new Ft(t,s,e,h,a,n)}}function Nt(t,s,o){let h=[[],[],[],[],[]],a=new Map;function u(t,e){var r=a.get(t);if(null!=r){if(r<=e)return;var i=h[r].indexOf(t);-1<i&&h[r].splice(i,1),t instanceof _t&&o.delete(t.compartment)}if(a.set(t,e),Array.isArray(t))for(var n of t)u(n,e);else if(t instanceof _t){if(o.has(t.compartment))throw new RangeError("Duplicate use of compartment in extensions");var r=s.get(t.compartment)||t.inner;o.set(t.compartment,r),u(r,e)}else if(t instanceof Tt)u(t.inner,t.prec);else if(t instanceof M)h[e].push(t),t.provides&&u(t.provides,e);else if(t instanceof jt)h[e].push(t),t.facet.extensions&&u(t.facet.extensions,Rt.default);else{var i=t.extension;if(!i)throw new Error(`Unrecognized extension value in extension set (${t}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);u(i,e)}}return u(t,Rt.default),h.reduce((t,e)=>t.concat(e))}function $t(t,e){if(1&e)return 2;var e=e>>1,r=t.status[e];if(4==r)throw new Error("Cyclic dependency between fields and/or facets");if(2&r)return r;t.status[e]=4;var r=t.computeSlot(t,t.config.dynamicSlots[e]);return t.status[e]=2|r}function Ht(t,e){return(1&e?t.config.staticValues:t.values)[e>>1]}const Ut=m.define(),zt=m.define({combine:t=>t.some(t=>t),static:!0}),Wt=m.define({combine:t=>t.length?t[0]:void 0,static:!0}),Vt=m.define(),qt=m.define(),Gt=m.define(),Jt=m.define({combine:t=>!!t.length&&t[0]});class Kt{constructor(t,e){this.type=t,this.value=e}static define(){return new Qt}}class Qt{of(t){return new Kt(this,t)}}class Xt{constructor(t){this.map=t}of(t){return new l(this,t)}}class l{constructor(t,e){this.type=t,this.value=e}map(t){var t=this.type.map(this.value,t);return void 0===t?void 0:t==this.value?this:new l(this.type,t)}is(t){return this.type==t}static define(t={}){return new Xt(t.map||(t=>t))}static mapEffects(t,e){if(!t.length)return t;var r=[],i;for(i of t){var n=i.map(e);n&&r.push(n)}return r}}l.reconfigure=l.define(),l.appendConfig=l.define();class a{constructor(t,e,r,i,n,s){this.startState=t,this.changes=e,this.selection=r,this.effects=i,this.annotations=n,this.scrollIntoView=s,this.Qae=null,this.Kh=null,r&&Ct(r,e.newLength),n.some(t=>t.type==a.time)||(this.annotations=n.concat(a.time.of(Date.now())))}static create(t,e,r,i,n,s){return new a(t,e,r,i,n,s)}get newDoc(){return this.Qae||(this.Qae=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this.Kh||this.startState.applyTransaction(this),this.Kh}annotation(t){for(var e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){var e=this.annotation(a.userEvent);return!(!e||!(e==t||e.length>t.length&&e.slice(0,t.length)==t&&"."==e[t.length]))}}function Zt(n,s){var o=[];for(let r=0,i=0;;){let t,e;if(r<n.length&&(i==s.length||s[i]>=n[r]))t=n[r++],e=n[r++];else{if(!(i<s.length))return o;t=s[i++],e=s[i++]}!o.length||o[o.length-1]<t?o.push(t,e):o[o.length-1]<e&&(o[o.length-1]=e)}}function Yt(t,e,r){var r;let i,n,s;return{changes:s=r?(i=e.changes,n=v.empty(e.changes.length),t.changes.compose(e.changes)):(i=e.changes.map(t.changes),n=t.changes.mapDesc(e.changes,!0),t.changes.compose(i)),selection:e.selection?e.selection.map(n):null==(r=t.selection)?void 0:r.map(i),effects:l.mapEffects(t.effects,i).concat(l.mapEffects(e.effects,n)),annotations:t.annotations.length?t.annotations.concat(e.annotations):e.annotations,scrollIntoView:t.scrollIntoView||e.scrollIntoView}}function te(t,e,r){let i=e.selection,n=se(e.annotations);return e.userEvent&&(n=n.concat(a.userEvent.of(e.userEvent))),{changes:e.changes instanceof v?e.changes:v.of(e.changes||[],r,t.facet(Wt)),selection:i&&(i instanceof b?i:b.single(i.anchor,i.head)),effects:se(e.effects),annotations:n,scrollIntoView:!!e.scrollIntoView}}function ee(e,r,i){let n=te(e,r.length?r[0]:{},e.doc.length);r.length&&!1===r[0].filter&&(i=!1);for(let t=1;t<r.length;t++){!1===r[t].filter&&(i=!1);var s=!!r[t].sequential;n=Yt(n,te(e,r[t],s?n.changes.newLength:e.doc.length),s)}var t=a.create(e,n.changes,n.selection,n.effects,n.annotations,n.scrollIntoView);return ie(i?re(t):t)}function re(r){var i=r.startState,t,n;let s=!0;for(t of i.facet(Vt)){var e=t(r);if(!1===e){s=!1;break}Array.isArray(e)&&(s=!0===s?e:Zt(s,e))}if(!0!==s){let t,e;!1===s?(e=r.changes.invertedDesc,t=v.empty(i.doc.length)):(n=r.changes.filter(s),t=n.changes,e=n.filtered.mapDesc(n.changes).invertedDesc),r=a.create(i,t,r.selection&&r.selection.map(e),l.mapEffects(r.effects,e),r.annotations,r.scrollIntoView)}var o=i.facet(qt);for(let t=o.length-1;0<=t;t--){var h=o[t](r);r=h instanceof a?h:Array.isArray(h)&&1==h.length&&h[0]instanceof a?h[0]:ee(i,se(h),!1)}return r}function ie(e){let r=e.startState,i=r.facet(Gt),n=e;for(let t=i.length-1;0<=t;t--){var s=i[t](e);s&&Object.keys(s).length&&(n=Yt(n,te(r,s,e.changes.newLength),!0))}return n==e?e:a.create(r,e.changes,e.selection,n.effects,n.annotations,n.scrollIntoView)}a.time=Kt.define(),a.userEvent=Kt.define(),a.addToHistory=Kt.define(),a.remote=Kt.define();const ne=[];function se(t){return null==t?ne:Array.isArray(t)?t:[t]}c=function(t){return t[t.Word=0]="Word",t[t.Space=1]="Space",t[t.Other=2]="Other",t}(c=c||{});const oe=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let he;try{he=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(t){}function ae(e){if(he)return he.test(e);for(let t=0;t<e.length;t++){var r=e[t];if(/\w/.test(r)||"\x80"<r&&(r.toUpperCase()!=r.toLowerCase()||oe.test(r)))return 1}}function ue(r){return e=>{if(!/\S/.test(e))return c.Space;if(ae(e))return c.Word;for(let t=0;t<r.length;t++)if(-1<e.indexOf(r[t]))return c.Word;return c.Other}}class C{constructor(t,e,r,i,n,s){this.config=t,this.doc=e,this.selection=r,this.values=i,this.status=t.statusTemplate.slice(),this.computeSlot=n,s&&(s.Kh=this);for(let t=0;t<this.config.dynamicSlots.length;t++)$t(this,t<<1);this.computeSlot=null}field(t,e=!0){var t=this.config.address[t.id];if(null!=t)return $t(this,t),Ht(this,t);if(e)throw new RangeError("Field is not present in this state")}update(...t){return ee(this,t,!0)}applyTransaction(r){let t=this.config,{base:e,compartments:i}=t;for(var n of r.effects)n.is(Bt.reconfigure)?(t&&(i=new Map,t.compartments.forEach((t,e)=>i.set(e,t)),t=null),i.set(n.value.compartment,n.value.extension)):n.is(l.reconfigure)?(t=null,e=n.value):n.is(l.appendConfig)&&(t=null,e=se(e).concat(n.value));let s;var o;s=t?r.startState.values.slice():(t=Ft.resolve(e,i,this),(o=new C(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(t,e)=>e.reconfigure(t,this),null)).values),new C(t,r.newDoc,r.newSelection,s,(t,e)=>e.update(t,r),r)}replaceSelection(e){return"string"==typeof e&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:b.cursor(t.from+e.length)}))}changeByRange(t){var r=this.selection,e=t(r.ranges[0]);let i=this.changes(e.changes),n=[e.range],s=se(e.effects);for(let e=1;e<r.ranges.length;e++){var o=t(r.ranges[e]),h=this.changes(o.changes),a=h.map(i);for(let t=0;t<e;t++)n[t]=n[t].map(a);var h=i.mapDesc(h,!0);n.push(o.range.map(h)),i=i.compose(a),s=l.mapEffects(s,a).concat(l.mapEffects(se(o.effects),h))}return{changes:i,selection:b.create(n,r.mainIndex),effects:s}}changes(t=[]){return t instanceof v?t:v.of(t,this.doc.length,this.facet(C.lineSeparator))}toText(t){return g.of(t.split(this.facet(C.lineSeparator)||mt))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){var e=this.config.address[t.id];return null==e?t.default:($t(this,e),Ht(this,e))}toJSON(t){var e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(var r in t){var i=t[r];i instanceof M&&null!=this.config.address[i.id]&&(e[r]=i.spec.toJSON(this.field(t[r]),this))}return e}static fromJSON(t,e={},i){if(!t||"string"!=typeof t.doc)throw new RangeError("Invalid JSON representation for EditorState");var n=[];if(i)for(var s in i)if(Object.prototype.hasOwnProperty.call(t,s)){let e=i[s],r=t[s];n.push(e.init(t=>e.spec.fromJSON(r,t)))}return C.create({doc:t.doc,selection:b.fromJSON(t.selection),extensions:e.extensions?n.concat([e.extensions]):n})}static create(t={}){var e=Ft.resolve(t.extensions||[],new Map),r=t.doc instanceof g?t.doc:g.of((t.doc||"").split(e.staticFacet(C.lineSeparator)||mt));let i=t.selection?t.selection instanceof b?t.selection:b.single(t.selection.anchor,t.selection.head):b.single(0);return Ct(i,r.length),e.staticFacet(zt)||(i=i.asSingle()),new C(e,r,i,e.dynamicSlots.map(()=>null),(t,e)=>e.create(t),null)}get tabSize(){return this.facet(C.tabSize)}get lineBreak(){return this.facet(C.lineSeparator)||"\n"}get readOnly(){return this.facet(Jt)}phrase(t,...r){for(var e of this.facet(C.phrases))if(Object.prototype.hasOwnProperty.call(e,t)){t=e[t];break}return t=r.length?t.replace(/\$(\$|\d*)/g,(t,e)=>{var e;return"$"==e?"$":!(e=+(e||1))||e>r.length?t:r[e-1]}):t}languageDataAt(t,e,r=-1){var i=[],n;for(n of this.facet(Ut))for(var s of n(this,e,r))Object.prototype.hasOwnProperty.call(s,t)&&i.push(s[t]);return i}charCategorizer(t){return ue(this.languageDataAt("wordChars",t).join(""))}wordAt(t){var{text:e,from:r,length:i}=this.doc.lineAt(t),n=this.charCategorizer(t);let s=t-r,o=t-r;for(;0<s;){var h=at(e,s,!1);if(n(e.slice(h,s))!=c.Word)break;s=h}for(;o<i;){var a=at(e,o);if(n(e.slice(o,a))!=c.Word)break;o=a}return s==o?null:b.range(s+r,o+r)}}function le(t,e,r={}){var i={},n,s;for(n of t)for(var o of Object.keys(n)){var h=n[o],a=i[o];if(void 0===a)i[o]=h;else if(a!==h&&void 0!==h){if(!Object.hasOwnProperty.call(r,o))throw new Error("Config merge conflict for field "+o);i[o]=r[o](a,h)}}for(s in e)void 0===i[s]&&(i[s]=e[s]);return i}C.allowMultipleSelections=zt,C.tabSize=m.define({combine:t=>t.length?t[0]:4}),C.lineSeparator=Wt,C.readOnly=Jt,C.phrases=m.define({compare(e,r){var t=Object.keys(e),i=Object.keys(r);return t.length==i.length&&t.every(t=>e[t]==r[t])}}),C.languageData=Ut,C.changeFilter=Vt,C.transactionFilter=qt,C.transactionExtender=Gt,Bt.reconfigure=l.define();class ce{eq(t){return this==t}range(t,e=t){return fe.create(t,e,this)}}ce.prototype.startSide=ce.prototype.endSide=0,ce.prototype.point=!1,ce.prototype.mapMode=u.TrackDel;let fe=class ha{constructor(t,e,r){this.from=t,this.to=e,this.value=r}static create(t,e,r){return new ha(t,e,r)}};function de(t,e){return t.from-e.from||t.value.startSide-e.value.startSide}class ve{constructor(t,e,r,i){this.from=t,this.to=e,this.value=r,this.maxPoint=i}get length(){return this.to[this.to.length-1]}findIndex(r,i,n,s=0){var o=n?this.to:this.from;for(let t=s,e=o.length;;){if(t==e)return t;var h=t+e>>1,a=o[h]-r||(n?this.value[h].endSide:this.value[h].startSide)-i;if(h==t)return 0<=a?t:e;0<=a?e=h:t=1+h}}between(r,i,n,s){for(let t=this.findIndex(i,-1e9,!0),e=this.findIndex(n,1e9,!1,t);t<e;t++)if(!1===s(this.from[t]+r,this.to[t]+r,this.value[t]))return!1}map(o,h){let a=[],u=[],l=[],c=-1,f=-1;for(let s=0;s<this.value.length;s++){let t=this.value[s],e=this.from[s]+o,r=this.to[s]+o,i,n;if(e==r){var d=h.mapPos(e,t.startSide,t.mapMode);if(null==d)continue;if(i=n=d,t.startSide!=t.endSide&&(n=h.mapPos(e,t.endSide))<i)continue}else if(i=h.mapPos(e,t.startSide),n=h.mapPos(r,t.endSide),i>n||i==n&&0<t.startSide&&t.endSide<=0)continue;(n-i||t.endSide-t.startSide)<0||(c<0&&(c=i),t.point&&(f=Math.max(f,n-i)),a.push(t),u.push(i-c),l.push(n-c))}return{mapped:a.length?new ve(u,l,a,f):null,pos:c}}}class S{constructor(t,e,r,i){this.chunkPos=t,this.chunk=e,this.nextLayer=r,this.maxPoint=i}static create(t,e,r,i){return new S(t,e,r,i)}get length(){var t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(var e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:r=!1,filterFrom:i=0,filterTo:n=this.length}=t;var s=t.filter;if(0==e.length&&!s)return this;if(r&&(e=e.slice().sort(de)),this.isEmpty)return e.length?S.of(e):this;let o=new we(this,null,-1).goto(0),h=0,a=[];for(var u=new pe,l;o.value||h<e.length;){h<e.length&&0<=(o.from-e[h].from||o.startSide-e[h].value.startSide)?(l=e[h++],u.addInner(l.from,l.to,l.value)||a.push(l)):1==o.rangeIndex&&o.chunkIndex<this.chunk.length&&(h==e.length||this.chunkEnd(o.chunkIndex)<e[h].from)&&(!s||i>this.chunkEnd(o.chunkIndex)||n<this.chunkPos[o.chunkIndex])&&u.addChunk(this.chunkPos[o.chunkIndex],this.chunk[o.chunkIndex])?o.nextChunk():((!s||i>o.to||n<o.from||s(o.from,o.to,o.value))&&!u.addInner(o.from,o.to,o.value)&&a.push(fe.create(o.from,o.to,o.value)),o.next())}return u.finishInner(this.nextLayer.isEmpty&&!a.length?S.empty:this.nextLayer.update({add:a,filter:s,filterFrom:i,filterTo:n}))}map(e){if(e.empty||this.isEmpty)return this;let r=[],i=[],n=-1;for(let t=0;t<this.chunk.length;t++){var s=this.chunkPos[t],o=this.chunk[t],h=e.touchesRange(s,s+o.length),h,o;!1===h?(n=Math.max(n,o.maxPoint),r.push(o),i.push(e.mapPos(s))):!0===h&&({mapped:h,pos:o}=o.map(s,e),h)&&(n=Math.max(n,h.maxPoint),r.push(h),i.push(o))}var t=this.nextLayer.map(e);return 0==r.length?t:new S(i,r,t||S.empty,n)}between(e,r,i){if(!this.isEmpty){for(let t=0;t<this.chunk.length;t++){var n=this.chunkPos[t],s=this.chunk[t];if(n<=r&&e<=n+s.length&&!1===s.between(n,e-n,r-n,i))return}this.nextLayer.between(e,r,i)}}iter(t=0){return be.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return be.from(t).goto(e)}static compare(t,e,r,i,n=-1){var t=t.filter(t=>0<t.maxPoint||!t.isEmpty&&t.maxPoint>=n),e=e.filter(t=>0<t.maxPoint||!t.isEmpty&&t.maxPoint>=n),s=ge(t,e,r);let o=new ye(t,s,n),h=new ye(e,s,n);r.iterGaps((t,e,r)=>Me(o,t,h,e,r,i)),r.empty&&0==r.length&&Me(o,0,h,0,0,i)}static eq(e,r,t=0,i){null==i&&(i=1e9-1);var n=e.filter(t=>!t.isEmpty&&r.indexOf(t)<0),s=r.filter(t=>!t.isEmpty&&e.indexOf(t)<0);if(n.length!=s.length)return!1;if(!n.length)return!0;for(var o=ge(n,s),h=new ye(n,o,0).goto(t),a=new ye(s,o,0).goto(t);;){if(h.to!=a.to||!xe(h.active,a.active)||h.point&&(!a.point||!h.point.eq(a.point)))return!1;if(h.to>i)return!0;h.next(),a.next()}}static spans(t,e,r,i,n=-1){let s=new ye(t,null,n).goto(e),o=e,h=s.openStart;for(;;){var a=Math.min(s.to,r),u,l;if(s.point?(u=s.activeForPoint(s.to),l=s.pointFrom<e?u.length+1:Math.min(u.length,h),i.point(o,a,s.point,u,l,s.pointRank),h=Math.min(s.openEnd(a),u.length)):a>o&&(i.span(o,a,s.active,h),h=s.openEnd(a)),s.to>r)return h+(s.point&&s.to>r?1:0);o=s.to,s.next()}}static of(t,e=!1){var r=new pe,i;for(i of t instanceof fe?[t]:e?me(t):t)r.add(i.from,i.to,i.value);return r.finish()}}function me(r){if(1<r.length)for(let t=r[0],e=1;e<r.length;e++){var i=r[e];if(0<de(t,i))return r.slice().sort(de);t=i}return r}S.empty=new S([],[],null,-1),S.empty.nextLayer=S.empty;class pe{finishChunk(t){this.chunks.push(new ve(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(t,e,r){this.addInner(t,e,r)||(this.nextLayer||(this.nextLayer=new pe)).add(t,e,r)}addInner(t,e,r){var i=t-this.lastTo||r.startSide-this.last.endSide;if(i<=0&&(t-this.lastFrom||r.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return!(i<0||(250==this.from.length&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=r,this.lastFrom=t,this.lastTo=e,this.value.push(r),r.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),0))}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);var r=e.value.length-1;return this.last=e.value[r],this.lastFrom=e.from[r]+t,this.lastTo=e.to[r]+t,!0}finish(){return this.finishInner(S.empty)}finishInner(t){var t;return this.from.length&&this.finishChunk(!1),0==this.chunks.length||(t=S.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint),this.from=null),t}}function ge(t,e,r){var i=new Map,n;for(n of t)for(let t=0;t<n.chunk.length;t++)n.chunk[t].maxPoint<=0&&i.set(n.chunk[t],n.chunkPos[t]);var s=new Set,o;for(o of e)for(let t=0;t<o.chunk.length;t++){var h=i.get(o.chunk[t]);null==h||(r?r.mapPos(h):h)!=o.chunkPos[t]||null!=r&&r.touchesRange(h,h+o.chunk[t].length)||s.add(o.chunk[t])}return s}class we{constructor(t,e,r,i=0){this.layer=t,this.skip=e,this.minPoint=r,this.rank=i}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,r){for(;this.chunkIndex<this.layer.chunk.length;){var i=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(i)||this.layer.chunkEnd(this.chunkIndex)<t||i.maxPoint<this.minPoint))break;this.chunkIndex++,r=!1}var e;this.chunkIndex<this.layer.chunk.length&&(e=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0),!r||this.rangeIndex<e)&&this.setRangeIndex(e),this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}var t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],r=t+e.from[this.rangeIndex];if(this.from=r,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}}class be{constructor(t){this.heap=t}static from(r,i=null,n=-1){var s=[];for(let e=0;e<r.length;e++)for(let t=r[e];!t.isEmpty;t=t.nextLayer)t.maxPoint>=n&&s.push(new we(t,i,n,e));return 1==s.length?s[0]:new be(s)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(var r of this.heap)r.goto(t,e);for(let t=this.heap.length>>1;0<=t;t--)ke(this.heap,t);return this.next(),this}forward(t,e){for(var r of this.heap)r.forward(t,e);for(let t=this.heap.length>>1;0<=t;t--)ke(this.heap,t);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){var t;0==this.heap.length?(this.from=this.to=1e9,this.value=null,this.rank=-1):(t=this.heap[0],this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),ke(this.heap,0))}}function ke(r,i){for(var n=r[i];;){let t=1+(i<<1);if(t>=r.length)break;let e=r[t];if(t+1<r.length&&0<=e.compare(r[t+1])&&(e=r[t+1],t++),n.compare(e)<0)break;r[t]=n,r[i]=e,i=t}}class ye{constructor(t,e,r){this.minPoint=r,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=be.from(t,e,r)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;-1<this.minActive&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){Ce(this.active,t),Ce(this.activeTo,t),Ce(this.activeRank,t),this.minActive=Pe(this.active,this.activeTo)}addActive(t){let e=0,{value:r,to:i,rank:n}=this.cursor;for(;e<this.activeRank.length&&this.activeRank[e]<=n;)e++;Se(this.active,e,r),Se(this.activeTo,e,i),Se(this.activeRank,e,n),t&&Se(t,e,this.cursor.from),this.minActive=Pe(this.active,this.activeTo)}next(){for(var e=this.to,t=this.point,r=(this.point=null,this.openStart<0?[]:null);;){var i=this.minActive;if(-1<i&&(this.activeTo[i]-this.cursor.from||this.active[i].endSide-this.cursor.startSide)<0){if(this.activeTo[i]>e){this.to=this.activeTo[i],this.endSide=this.active[i].endSide;break}this.removeActive(i),r&&Ce(r,i)}else{if(!this.cursor.value){this.to=this.endSide=1e9;break}if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}var i=this.cursor.value;if(i.point){if(!(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)){this.point=i,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=i.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else this.addActive(r);this.cursor.next()}}if(r){this.openStart=0;for(let t=r.length-1;0<=t&&r[t]<e;t--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;var r=[];for(let t=this.active.length-1;0<=t&&!(this.activeRank[t]<this.pointRank);t--)(this.activeTo[t]>e||this.activeTo[t]==e&&this.active[t].endSide>=this.point.endSide)&&r.push(this.active[t]);return r.reverse()}openEnd(e){let r=0;for(let t=this.activeTo.length-1;0<=t&&this.activeTo[t]>e;t--)r++;return r}}function Me(t,e,r,i,n,s){t.goto(e),r.goto(i);var o=i+n;let h=i,a=i-e;for(;;){var u=t.to+a-r.to||t.endSide-r.endSide,l=u<0?t.to+a:r.to,c=Math.min(l,o);if(t.point||r.point?t.point&&r.point&&(t.point==r.point||t.point.eq(r.point))&&xe(t.activeForPoint(t.to),r.activeForPoint(r.to))||s.comparePoint(h,c,t.point,r.point):c>h&&!xe(t.active,r.active)&&s.compareRange(h,c,t.active,r.active),o<l)break;h=l,u<=0&&t.next(),0<=u&&r.next()}}function xe(e,r){if(e.length==r.length){for(let t=0;t<e.length;t++)if(e[t]!=r[t]&&!e[t].eq(r[t]))return;return 1}}function Ce(r,i){for(let t=i,e=r.length-1;t<e;t++)r[t]=r[t+1];r.pop()}function Se(e,r,t){for(let t=e.length-1;t>=r;t--)e[t+1]=e[t];e[r]=t}function Pe(e,r){let i=-1,n=1e9;for(let t=0;t<r.length;t++)(r[t]-n||e[t].endSide-e[i].endSide)<0&&(i=t,n=r[t]);return i}function je(e,r,i=e.length){let n=0;for(let t=0;t<i;)9==e.charCodeAt(t)?(n+=r-n%r,t++):(n++,t=at(e,t));return n}function Oe(r,i,n,t){for(let t=0,e=0;;){if(e>=i)return t;if(t==r.length)break;e+=9==r.charCodeAt(t)?n-e%n:1,t=at(r,t)}return!0===t?-1:r.length}F=Object.freeze({__proto__:null,Annotation:Kt,AnnotationType:Qt,ChangeDesc:pt,ChangeSet:v,get CharCategory(){return c},Compartment:Bt,EditorSelection:b,EditorState:C,Facet:m,Line:it,get MapMode(){return u},Prec:Lt,Range:fe,RangeSet:S,RangeSetBuilder:pe,RangeValue:ce,SelectionRange:xt,StateEffect:l,StateEffectType:Xt,StateField:M,Text:g,Transaction:a,codePointAt:x,codePointSize:vt,combineConfig:le,countColumn:je,findClusterBreak:at,findColumn:Oe,fromCodePoint:dt});const Ee="\u037c",De="undefined"==typeof Symbol?"__\u037c":Symbol.for(Ee),Ae="undefined"==typeof Symbol?"__styleSet"+Math.floor(1e8*Math.random()):Symbol("styleSet"),Re="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:{};class Ie{constructor(t,e){this.rules=[];let{finish:u}=e||{};function l(t){return/^@/.test(t)?[t]:t.split(/,\s*/)}function c(t,e,r,i){var n=[],s=/^@(\w+)\b/.exec(t[0]),o=s&&"keyframes"==s[1],h;if(s&&null==e)return r.push(t[0]+";");for(h in e){var a=e[h];if(/&/.test(h))c(h.split(/,\s*/).map(e=>t.map(t=>e.replace(/&/,t))).reduce((t,e)=>t.concat(e)),a,r);else if(a&&"object"==typeof a){if(!s)throw new RangeError("The value of a property ("+h+") should be a primitive value.");c(l(h),a,n,o)}else null!=a&&n.push(h.replace(/_.*/,"").replace(/[A-Z]/g,t=>"-"+t.toLowerCase())+": "+a+";")}(n.length||o)&&r.push((!u||s||i?t:t.map(u)).join(", ")+" {"+n.join(" ")+"}")}for(var r in t)c(l(r),t[r],this.rules)}getRules(){return this.rules.join("\n")}static newName(){var t=Re[De]||1;return Re[De]=t+1,Ee+t.toString(36)}static mount(t,e){(t[Ae]||new Te(t)).mount(Array.isArray(e)?e:[e])}}let Le=new Map;class Te{constructor(t){var e=t.ownerDocument||t,r=e.defaultView;if(!t.head&&t.adoptedStyleSheets&&r.CSSStyleSheet){var i=Le.get(e);if(i)return t.adoptedStyleSheets=[i.sheet,...t.adoptedStyleSheets],t[Ae]=i;this.sheet=new r.CSSStyleSheet,t.adoptedStyleSheets=[this.sheet,...t.adoptedStyleSheets],Le.set(e,this)}else{this.styleTag=e.createElement("style");var i=t.head||t;i.insertBefore(this.styleTag,i.firstChild)}this.modules=[],t[Ae]=this}mount(i){var n=this.sheet;let s=0,o=0;for(let r=0;r<i.length;r++){let e=i[r],t=this.modules.indexOf(e);if(t<o&&-1<t&&(this.modules.splice(t,1),o--,t=-1),-1==t){if(this.modules.splice(o++,0,e),n)for(let t=0;t<e.rules.length;t++)n.insertRule(e.rules[t],s++)}else{for(;o<t;)s+=this.modules[o++].rules.length;s+=e.rules.length,o++}}if(!n){let e="";for(let t=0;t<this.modules.length;t++)e+=this.modules[t].getRules()+"\n";this.styleTag.textContent=e}}}for(N={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},$={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},_="undefined"!=typeof navigator&&/Chrome\/(\d+)/.exec(navigator.userAgent),t="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),H="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),U=t||_&&+_[1]<57,e=0;e<10;e++)N[48+e]=N[96+e]=String(e);for(e=1;e<=24;e++)N[e+111]="F"+e;for(e=65;e<=90;e++)N[e]=String.fromCharCode(e+32),$[e]=String.fromCharCode(e);for(z in N)$.hasOwnProperty(z)||($[z]=N[z]);function Be(t){var e,t,e,t=!(U&&(t.ctrlKey||t.altKey||t.metaKey)||H&&t.shiftKey&&t.key&&1==t.key.length||"Unidentified"==t.key)&&t.key||(t.shiftKey?$:N)[t.keyCode]||t.key||"Unidentified";return t="Down"==(t="Right"==(t="Up"==(t="Left"==(t="Del"==(t="Esc"==t?"Escape":t)?"Delete":t)?"ArrowLeft":t)?"ArrowUp":t)?"ArrowRight":t)?"ArrowDown":t}function _e(t){let e;return(e=11!=t.nodeType||t.getSelection?t:t.ownerDocument).getSelection()}function Fe(t,e){return!!e&&(t==e||t.contains(1!=e.nodeType?e.parentNode:e))}function Ne(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function $e(t,e){if(!e.anchorNode)return!1;try{return Fe(t,e.anchorNode)}catch(t){return!1}}function He(t){return 3==t.nodeType?tr(t,0,t.nodeValue.length).getClientRects():1==t.nodeType?t.getClientRects():[]}function Ue(t,e,r,i){return r&&(We(t,e,r,i,-1)||We(t,e,r,i,1))}function ze(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e}function We(t,e,r,i,n){for(;;){if(t==r&&e==i)return!0;if(e==(n<0?0:Ve(t))){if("DIV"==t.nodeName)return!1;var s=t.parentNode;if(!s||1!=s.nodeType)return!1;e=ze(t)+(n<0?0:1),t=s}else{if(1!=t.nodeType)return!1;if(1==(t=t.childNodes[e+(n<0?-1:0)]).nodeType&&"false"==t.contentEditable)return!1;e=n<0?Ve(t):0}}}function Ve(t){return(3==t.nodeType?t.nodeValue:t.childNodes).length}function qe(t,e){var e=e?t.left:t.right;return{left:e,right:e,top:t.top,bottom:t.bottom}}function Ge(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}function Je(t,s,o,h,a,u,l,c){var f=t.ownerDocument,d=f.defaultView||window,v,m,m,m,p,p;for(let n=t;n;)if(1==n.nodeType){let t,e=n==f.body;if(e)t=Ge(d);else{if(n.scrollHeight<=n.clientHeight&&n.scrollWidth<=n.clientWidth){n=n.assignedSlot||n.parentNode;continue}var v=n.getBoundingClientRect();t={left:v.left,right:v.left+n.clientWidth,top:v.top,bottom:v.top+n.clientHeight}}let r=0,i=0;if("nearest"==a?s.top<t.top?(i=-(t.top-s.top+l),0<o&&s.bottom>t.bottom+i&&(i=s.bottom-t.bottom+i+l)):s.bottom>t.bottom&&(i=s.bottom-t.bottom+l,o<0)&&s.top-i<t.top&&(i=-(t.top+i-s.top+l)):(v=s.bottom-s.top,m=t.bottom-t.top,m="center"==a&&v<=m?s.top+v/2-m/2:"start"==a||"center"==a&&o<0?s.top-l:s.bottom-m+l,i=m-t.top),"nearest"==h?s.left<t.left?(r=-(t.left-s.left+u),0<o&&s.right>t.right+r&&(r=s.right-t.right+r+u)):s.right>t.right&&(r=s.right-t.right+u,o<0)&&s.left<t.left+r&&(r=-(t.left+r-s.left+u)):(m="center"==h?s.left+(s.right-s.left)/2-(t.right-t.left)/2:"start"==h==c?s.left-u:s.right-(t.right-t.left)+u,r=m-t.left),r||i)if(e)d.scrollBy(r,i);else{let t=0,e=0;i&&(p=n.scrollTop,n.scrollTop+=i,e=n.scrollTop-p),r&&(p=n.scrollLeft,n.scrollLeft+=r,t=n.scrollLeft-p),s={left:s.left-t,top:s.top-e,right:s.right-t,bottom:s.bottom-e},t&&Math.abs(t-r)<1&&(h="nearest"),e&&Math.abs(e-i)<1&&(a="nearest")}if(e)break;n=n.assignedSlot||n.parentNode}else{if(11!=n.nodeType)break;n=n.host}}function Ke(e){var r=e.ownerDocument;for(let t=e.parentNode;t&&t!=r.body;)if(1==t.nodeType){if(t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)return t;t=t.assignedSlot||t.parentNode}else{if(11!=t.nodeType)break;t=t.host}return null}class Qe{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){var{anchorNode:e,focusNode:r}=t;this.set(e,Math.min(t.anchorOffset,e?Ve(e):0),r,Math.min(t.focusOffset,r?Ve(r):0))}set(t,e,r,i){this.anchorNode=t,this.anchorOffset=e,this.focusNode=r,this.focusOffset=i}}let Xe=null;function Ze(e){if(e.setActive)return e.setActive();if(Xe)return e.focus(Xe);var r=[];for(let t=e;t&&(r.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(e.focus(null==Xe?{get preventScroll(){return Xe={preventScroll:!0},!0}}:void 0),!Xe){Xe=!1;for(let t=0;t<r.length;){var i=r[t++],n=r[t++],s=r[t++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=s&&(i.scrollLeft=s)}}}let Ye;function tr(t,e,r=e){var i=Ye=Ye||document.createRange();return i.setEnd(t,r),i.setStart(t,e),i}function er(t,e,r){var e={key:e,code:e,keyCode:r,which:r,cancelable:!0},r=new KeyboardEvent("keydown",e),e=(r.synthetic=!0,t.dispatchEvent(r),new KeyboardEvent("keyup",e));return e.synthetic=!0,t.dispatchEvent(e),r.defaultPrevented||e.defaultPrevented}function rr(t){for(;t;){if(t&&(9==t.nodeType||11==t.nodeType&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}function ir(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}function nr(t,e){let r=e.focusNode,i=e.focusOffset;if(r&&e.anchorNode==r&&e.anchorOffset==i)for(i=Math.min(i,Ve(r));;)if(i){if(1!=r.nodeType)return;var n=r.childNodes[i-1];"false"==n.contentEditable?i--:(r=n,i=Ve(r))}else{if(r==t)return 1;i=ze(r),r=r.parentNode}}class sr{constructor(t,e,r=!0){this.node=t,this.offset=e,this.precise=r}static before(t,e){return new sr(t.parentNode,ze(t),e)}static after(t,e){return new sr(t.parentNode,ze(t)+1,e)}}const or=[];class P{constructor(){this.parent=null,this.dom=null,this.dirty=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(var r of this.children){if(r==t)return e;e+=r.length+r.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}sync(r,i){if(2&this.dirty){var n=this.dom,s,o;let t=null,e;for(s of this.children){if(s.dirty&&(s.dom||!(e=t?t.nextSibling:n.firstChild)||(o=P.get(e))&&(o.parent||!o.canReuseDOM(s))||s.reuseDOM(e),s.sync(r,i),s.dirty=0),e=t?t.nextSibling:n.firstChild,i&&!i.written&&i.node==n&&e!=s.dom&&(i.written=!0),s.dom.parentNode==n)for(;e&&e!=s.dom;)e=hr(e);else n.insertBefore(s.dom,e);t=s.dom}for((e=t?t.nextSibling:n.firstChild)&&i&&i.node==n&&(i.written=!0);e;)e=hr(e)}else if(1&this.dirty)for(var t of this.children)t.dirty&&(t.sync(r,i),t.dirty=0)}reuseDOM(t){}localPosFromDOM(e,r){let i;if(e==this.dom)i=this.dom.childNodes[r];else{let t=0==Ve(e)?0:0==r?-1:1;for(;;){var n=e.parentNode;if(n==this.dom)break;0==t&&n.firstChild!=n.lastChild&&(t=e==n.firstChild?-1:1),e=n}i=t<0?e:e.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!P.get(i);)i=i.nextSibling;if(!i)return this.length;for(let t=0,e=0;;t++){var s=this.children[t];if(s.dom==i)return e;e+=s.length+s.breakAfter}}domBoundsAround(i,n,s=0){let o=-1,h=-1,a=-1,u=-1;for(let t=0,e=s,r=s;t<this.children.length;t++){var l=this.children[t],c=e+l.length;if(e<i&&n<c)return l.domBoundsAround(i,n,e);if(i<=c&&-1==o&&(o=t,h=e),e>n&&l.dom.parentNode==this.dom){a=t,u=r;break}r=c,e=c+l.breakAfter}return{from:h,to:u<0?s+this.length:u,startDOM:(o?this.children[o-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:a<this.children.length&&0<=a?this.children[a].dom:null}}markDirty(t=!1){this.dirty|=2,this.markParentsDirty(t)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.dirty|=2),1&t.dirty)return;t.dirty|=1,e=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.dirty)&&this.markParentsDirty(!0)}setDOM(t){this.dom&&(this.dom.cmView=null),(this.dom=t).cmView=this}get rootView(){for(let t=this;;){var e=t.parent;if(!e)return t;t=e}}replaceChildren(e,r,i=or){this.markDirty();for(let t=e;t<r;t++){var n=this.children[t];n.parent==this&&n.destroy()}this.children.splice(e,r-e,...i);for(let t=0;t<i.length;t++)i[t].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new ar(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){var t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==t?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(t,e,r,i,n,s){return!1}become(t){return!1}canReuseDOM(t){return t.constructor==this.constructor}getSide(){return 0}destroy(){this.parent=null}}function hr(t){var e=t.nextSibling;return t.parentNode.removeChild(t),e}P.prototype.breakAfter=0;class ar{constructor(t,e,r){this.children=t,this.pos=e,this.i=r,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(0<e||0==this.i||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;var r=this.children[--this.i];this.pos-=r.length+r.breakAfter}}}function ur(t,e,r,i,n,s,o,h,a){var{children:u}=t,l=u.length?u[e]:null,c=s.length?s[s.length-1]:null,f=c?c.breakAfter:o;if(!(e==i&&l&&!o&&!f&&s.length<2&&l.merge(r,n,s.length?c:null,0==r,h,a))){if(i<u.length){let t=u[i];t&&n<t.length?(e==i&&(t=t.split(n),n=0),!f&&c&&t.merge(0,n,c,!0,0,a)?s[s.length-1]=t:(n&&t.merge(0,n,null,!1,0,a),s.push(t))):null!==t&&void 0!==t&&t.breakAfter&&(c?c.breakAfter=1:o=1),i++}for(l&&(l.breakAfter=o,0<r)&&(!o&&s.length&&l.merge(r,l.length,s[0],!1,h,0)?l.breakAfter=s.shift().breakAfter:(r<l.length||l.children.length&&0==l.children[l.children.length-1].length)&&l.merge(r,l.length,null,!1,h,0),e++);e<i&&s.length;)if(u[i-1].become(s[s.length-1]))i--,s.pop(),a=s.length?0:h;else{if(!u[e].become(s[0]))break;e++,s.shift(),h=s.length?0:a}!s.length&&e&&i<u.length&&!u[e-1].breakAfter&&u[i].merge(0,0,u[e-1],!1,h,a)&&e--,(e<i||s.length)&&t.replaceChildren(e,i,s)}}function lr(t,e,r,i,n,s){var o=t.childCursor(),{i:h,off:a}=o.findPos(r,1),{i:o,off:u}=o.findPos(e,-1),l;let c=e-r;for(l of i)c+=l.length;t.length+=c,ur(t,o,u,h,a,i,0,n,s)}var t="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},_="undefined"!=typeof document?document:{documentElement:{style:{}}},cr=/Edge\/(\d+)/.exec(t.userAgent),fr=/MSIE \d/.test(t.userAgent),dr=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(t.userAgent),r=!!(fr||dr||cr),i=!r&&/gecko\/(\d+)/i.test(t.userAgent),n=!r&&/Chrome\/(\d+)/.exec(t.userAgent),vr="webkitFontSmoothing"in _.documentElement.style,mr=!r&&/Apple Computer/.test(t.vendor),s=mr&&(/Mobile\/\w+/.test(t.userAgent)||2<t.maxTouchPoints),p={mac:s||/Mac/.test(t.platform),windows:/Win/.test(t.platform),linux:/Linux|X11/.test(t.platform),ie:r,ie_version:fr?_.documentMode||6:dr?+dr[1]:cr?+cr[1]:0,gecko:i,gecko_version:i?+(/Firefox\/(\d+)/.exec(t.userAgent)||[0,0])[1]:0,chrome:!!n,chrome_version:n?+n[1]:0,ios:s,android:/Android\b/.test(t.userAgent),webkit:vr,safari:mr,webkit_version:vr?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=_.documentElement.style.tabSize?"tab-size":"-moz-tab-size"},pr;const gr=256;class wr extends P{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t,e){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){3==t.nodeType&&this.createDOM(t)}merge(t,e,r){return(!r||r instanceof wr&&!(this.length-(e-t)+r.length>gr))&&(this.text=this.text.slice(0,t)+(r?r.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){var e=new wr(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new sr(this.dom,t)}domBoundsAround(t,e,r){return{from:r,to:r+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return kr(this.dom,t,e)}}class br extends P{constructor(t,e=[],r=0){super(),this.mark=t,this.children=e,this.length=r;for(var i of e)i.setParent(this)}setAttrs(t){if(ir(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(var e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.dirty|=6)}sync(t,e){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t,e)}merge(t,e,r,i,n,s){return!(r&&(!(r instanceof br&&r.mark.eq(this.mark))||t&&n<=0||e<this.length&&s<=0)||(lr(this,t,e,r?r.children:[],n-1,s-1),this.markDirty(),0))}split(t){let e=[],r=0,i=-1,n=0;for(var s of this.children){var o=r+s.length;t<o&&e.push(r<t?s.split(t-r):s),i<0&&r>=t&&(i=n),r=o,n++}var h=this.length-t;return this.length=t,-1<i&&(this.children.length=i,this.markDirty()),new br(this.mark,e,h)}domAtPos(t){return Or(this,t)}coordsAt(t,e){return Dr(this,t,e)}}function kr(t,e,r){var i=t.nodeValue.length;let n=e=i<e?i:e,s=e,o=0;0==e&&r<0||e==i&&0<=r?p.chrome||p.gecko||(e?(n--,o=1):s<i&&(s++,o=-1)):r<0?n--:s<i&&s++;var e=tr(t,n,s).getClientRects();if(!e.length)return null;let h=e[(o?o<0:0<=r)?0:e.length-1];return p.safari&&!o&&0==h.width&&(h=Array.prototype.find.call(e,t=>t.width)||h),o?qe(h,o<0):h||null}class yr extends P{static create(t,e,r){return new(t.customView||yr)(t,e,r)}constructor(t,e,r){super(),this.widget=t,this.length=e,this.side=r,this.prevWidget=null}split(t){var e=yr.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(t){this.dom&&this.widget.updateDOM(this.dom,t)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(t)),this.dom.contentEditable="false")}getSide(){return this.side}merge(t,e,r,i,n,s){return!(r&&(!(r instanceof yr&&this.widget.compare(r.widget))||0<t&&n<=0||e<this.length&&s<=0)||(this.length=t+(r?r.length:0)+(this.length-e),0))}become(t){return t instanceof yr&&t.side==this.side&&this.widget.constructor==t.widget.constructor&&(this.widget.compare(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(0==this.length)return g.empty;let t=this;for(;t.parent;)t=t.parent;var{view:e}=t,e=e&&e.state.doc,r=this.posAtStart;return e?e.slice(r,r+this.length):g.empty}domAtPos(t){return(this.length?0==t:0<this.side)?sr.before(this.dom):sr.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(e,t){var t=this.widget.coordsAt(this.dom,e,t);if(t)return t;let r=this.dom.getClientRects(),i=null;if(!r.length)return null;for(let t=0<e?r.length-1:0;i=r[t],!(0<e?0==t:t==r.length-1||i.top<i.bottom);t+=0<e?-1:1);return this.length?i:qe(i,0<this.side)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Mr extends yr{domAtPos(t){var{topView:e,text:r}=this.widget;return e?xr(t,0,e,r,this.length-e.length,(t,e)=>t.domAtPos(e),(t,e)=>new sr(t,Math.min(e,t.nodeValue.length))):new sr(r,Math.min(t,r.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(t,e){var{topView:r,text:i}=this.widget;return r?Sr(t,e,r,i,this.length-r.length):Math.min(e,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(t,e){var{topView:r,text:i}=this.widget;return r?xr(t,e,r,i,this.length-r.length,(t,e,r)=>t.coordsAt(e,r),(t,e,r)=>kr(t,e,r)):kr(i,t,e)}destroy(){var t;super.destroy(),null!=(t=this.widget.topView)&&t.destroy()}get isEditable(){return!0}canReuseDOM(){return!0}}function xr(e,r,i,n,s,o,h){if(i instanceof br){for(let t=i.dom.firstChild;t;t=t.nextSibling){var a=P.get(t);if(a){var u=Fe(t,n),l=a.length+(u?s:0);if(e<l||e==l&&a.getSide()<=0)return u?xr(e,r,a,n,s,o,h):o(a,e,r);e-=l}else{var u=Cr(e,r,t,h);if("number"!=typeof u)return u;e=u}}return o(i,i.length,-1)}return i.dom==n?h(n,e,r):o(i,e,r)}function Cr(e,r,i,n){if(3==i.nodeType){var t=i.nodeValue.length;if(e<=t)return n(i,e,r);e-=t}else if(1==i.nodeType&&"false"!=i.contentEditable)for(let t=i.firstChild;t;t=t.nextSibling){var s=Cr(e,r,t,n);if("number"!=typeof s)return s;e=s}return e}function Sr(r,i,n,s,o){if(n instanceof br){let e=0;for(let t=n.dom.firstChild;t;t=t.nextSibling){var h=P.get(t);if(h){var a=Fe(t,s);if(Fe(t,r))return e+(a?Sr(r,i,h,s,o):h.localPosFromDOM(r,i));e+=h.length+(a?o:0)}else{var h=Pr(r,i,t);if(null!=h.result)return e+h.result;e+=h.size}}}else if(n.dom==s)return Math.min(i,s.nodeValue.length);return n.localPosFromDOM(r,i)}function Pr(i,n,s){if(3==s.nodeType)return i==s?{result:n}:{size:s.nodeValue.length};if(1!=s.nodeType||"false"==s.contentEditable)return s.contains(i)?{result:0}:{size:0};{let r=0;for(let t=s.firstChild,e=0;;t=t.nextSibling,e++){if(i==s&&e==n)return{result:r};if(!t)return{size:r};var o=Pr(i,n,t);if(null!=o.result)return{result:n+o.result};r+=o.size}}}class jr extends P{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof jr&&t.side==this.side}split(){return new jr(this.side)}sync(){var t;this.dom||((t=document.createElement("img")).className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t))}getSide(){return this.side}domAtPos(t){return 0<this.side?sr.before(this.dom):sr.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){return this.dom.getBoundingClientRect()}get overrideDOMText(){return g.empty}get isHidden(){return!0}}function Or(t,e){let r=t.dom,{children:i}=t,n=0;for(let t=0;n<i.length;n++){var s=i[n],o=t+s.length;if(!(o==t&&s.getSide()<=0)){if(e>t&&e<o&&s.dom.parentNode==r)return s.domAtPos(e-t);if(e<=t)break;t=o}}for(let t=n;0<t;t--){var h=i[t-1];if(h.dom.parentNode==r)return h.domAtPos(h.length)}for(let t=n;t<i.length;t++){var a=i[t];if(a.dom.parentNode==r)return a.domAtPos(0)}return new sr(r,0)}function Er(t,e,r){let i,{children:n}=t;0<r&&e instanceof br&&n.length&&(i=n[n.length-1])instanceof br&&i.mark.eq(e.mark)?Er(i,e.children[0],r-1):(n.push(e),e.setParent(t)),t.length+=e.length}function Dr(t,e,o){let h=null,a=-1,u=null,l=-1;function c(r,i){for(let t=0,e=0;t<r.children.length&&e<=i;t++){var n=r.children[t],s=e+n.length;i<=s&&(n.children.length?c(n,i-e):(!u||u.isHidden&&0<o)&&(i<s||e==s&&0<n.getSide())?(u=n,l=i-e):(e<i||e==s&&n.getSide()<0&&!n.isHidden)&&(h=n,a=i-e)),e=s}}c(t,e);var e=(o<0?h:u)||h||u;return e?e.coordsAt(Math.max(0,e==h?a:l),o):Ar(t)}function Ar(t){var e=t.dom.lastChild,e;return e?(e=He(e))[e.length-1]||null:t.dom.getBoundingClientRect()}function Rr(t,e){for(var r in t)"class"==r&&e.class?e.class+=" "+t.class:"style"==r&&e.style?e.style+=";"+t.style:e[r]=t[r];return e}function Ir(t,e){if(t!=e){if(!t||!e)return!1;var r=Object.keys(t),i=Object.keys(e),n;if(r.length!=i.length)return!1;for(n of r)if(-1==i.indexOf(n)||t[n]!==e[n])return!1}return!0}function Lr(t,e,r){let i=null;if(e)for(var n in e)r&&n in r||t.removeAttribute(i=n);if(r)for(var s in r)e&&e[s]==r[s]||t.setAttribute(i=s,r[s]);return!!i}wr.prototype.children=yr.prototype.children=jr.prototype.children=or;class Tr{eq(t){return!1}updateDOM(t,e){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}ignoreEvent(t){return!0}coordsAt(t,e,r){return null}get customView(){return null}get isHidden(){return!1}destroy(t){}}k=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(k=k||{});class j extends ce{constructor(t,e,r,i){super(),this.startSide=t,this.endSide=e,this.widget=r,this.spec=i}get heightRelevant(){return!1}static mark(t){return new Br(t)}static widget(t){var e=t.side||0,r=!!t.block;return e+=r?0<e?3e8:-4e8:0<e?1e8:-1e8,new Fr(t,e,e,r,t.widget||null,!1)}static replace(t){let e=!!t.block,r,i;var n,s;return i=t.isBlockGap?(r=-5e8,4e8):({start:n,end:s}=Nr(t,e),r=(n?e?-3e8:-1:5e8)-1,1+(s?e?2e8:1:-6e8)),new Fr(t,r,i,e,t.widget||null,!0)}static line(t){return new _r(t)}static set(t,e=!1){return S.of(t,e)}hasHeight(){return!!this.widget&&-1<this.widget.estimatedHeight}}j.none=S.empty;class Br extends j{constructor(t){var{start:e,end:r}=Nr(t);super(e?-1:5e8,r?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){return this==t||t instanceof Br&&this.tagName==t.tagName&&this.class==t.class&&Ir(this.attrs,t.attrs)}range(t,e=t){if(e<=t)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}Br.prototype.point=!1;class _r extends j{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof _r&&this.spec.class==t.spec.class&&Ir(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}_r.prototype.mapMode=u.TrackBefore,_r.prototype.point=!0;class Fr extends j{constructor(t,e,r,i,n,s){super(e,r,n,t),this.block=i,this.isReplace=s,this.mapMode=i?e<=0?u.TrackBefore:u.TrackAfter:u.TrackDel}get type(){return this.startSide<this.endSide?k.WidgetRange:this.startSide<=0?k.WidgetBefore:k.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&5<=this.widget.estimatedHeight}eq(t){return t instanceof Fr&&$r(this.widget,t.widget)&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide}range(t,e=t){if(this.isReplace&&(e<t||t==e&&0<this.startSide&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(this.isReplace||e==t)return super.range(t,e);throw new RangeError("Widget decorations can only have zero-length ranges")}}function Nr(t,e=!1){let{inclusiveStart:r,inclusiveEnd:i}=t;return null==r&&(r=t.inclusive),null==i&&(i=t.inclusive),{start:null!==r&&void 0!==r?r:e,end:null!==i&&void 0!==i?i:e}}function $r(t,e){return t==e||!!(t&&e&&t.compare(e))}function Hr(t,e,r,i=0){var n=r.length-1;0<=n&&r[n]+i>=t?r[n]=Math.max(r[n],e):r.push(t,e)}Fr.prototype.point=!0;class Ur extends P{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,r,i,n,s){if(r){if(!(r instanceof Ur))return!1;this.dom||r.transferDOM(this)}return i&&this.setDeco(r?r.attrs:null),lr(this,t,e,r?r.children:[],n,s),!0}split(r){var i=new Ur;if(i.breakAfter=this.breakAfter,0!=this.length){let{i:e,off:t}=this.childPos(r);t&&(i.append(this.children[e].split(t),0),this.children[e].merge(t,this.children[e].length,null,!1,0,0),e++);for(let t=e;t<this.children.length;t++)i.append(this.children[t],0);for(;0<e&&0==this.children[e-1].length;)this.children[--e].destroy();this.children.length=e,this.markDirty(),this.length=r}return i}transferDOM(t){this.dom&&(this.markDirty(),t.setDOM(this.dom),t.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){Ir(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){Er(this,t,e)}addLineDeco(t){var e=t.spec.attributes,t=t.spec.class;e&&(this.attrs=Rr(e,this.attrs||{})),t&&(this.attrs=Rr({class:t},this.attrs||{}))}domAtPos(t){return Or(this,t)}reuseDOM(t){"DIV"==t.nodeName&&(this.setDOM(t),this.dirty|=6)}sync(t,e){var t,e;this.dom?4&this.dirty&&(ir(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(Lr(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t,e);let r=this.dom.lastChild;for(;r&&P.get(r)instanceof br;)r=r.lastChild;r&&this.length&&("BR"==r.nodeName||0!=(null==(t=P.get(r))?void 0:t.isEditable)||p.ios&&this.children.some(t=>t instanceof wr))||((e=document.createElement("BR")).cmIgnore=!0,this.dom.appendChild(e))}measureTextSize(){if(0==this.children.length||20<this.length)return null;let t=0,e;for(var r of this.children){if(!(r instanceof wr)||/[^ -~]/.test(r.text))return null;var r=He(r.dom);if(1!=r.length)return null;t+=r[0].width,e=r[0].height}return t?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length,textHeight:e}:null}coordsAt(t,e){var t=Dr(this,t,e);if(!this.children.length&&t&&this.parent){var{heightOracle:e}=this.parent.view.viewState,r=t.bottom-t.top,r;if(Math.abs(r-e.lineHeight)<2&&e.textHeight<r)return r=(r-e.textHeight)/2,{top:t.top+r,bottom:t.bottom-r,left:t.left,right:t.left}}return t}become(t){return!1}get type(){return k.Text}static find(r,i){for(let t=0,e=0;t<r.children.length;t++){var n=r.children[t],s=e+n.length;if(i<=s){if(n instanceof Ur)return n;if(i<s)break}e=s+n.breakAfter}return null}}class zr extends P{constructor(t,e,r){super(),this.widget=t,this.length=e,this.type=r,this.breakAfter=0,this.prevWidget=null}merge(t,e,r,i,n,s){return!(r&&(!(r instanceof zr&&this.widget.compare(r.widget))||0<t&&n<=0||e<this.length&&s<=0)||(this.length=t+(r?r.length:0)+(this.length-e),0))}domAtPos(t){return 0==t?sr.before(this.dom):sr.after(this.dom,t==this.length)}split(t){var e=this.length-t,t=(this.length=t,new zr(this.widget,e,this.type));return t.breakAfter=this.breakAfter,t}get children(){return or}sync(t){this.dom&&this.widget.updateDOM(this.dom,t)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(t)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):g.empty}domBoundsAround(){return null}become(t){return t instanceof zr&&t.widget.constructor==this.widget.constructor&&(t.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.type=t.type,this.breakAfter=t.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(t,e){return this.widget.coordsAt(this.dom,t,e)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Wr{constructor(t,e,r,i){this.doc=t,this.pos=e,this.end=r,this.disallowBlockEffectsFor=i,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){var t;return 0==this.content.length?!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos:!((t=this.content[this.content.length-1]).breakAfter||t instanceof zr&&t.type==k.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new Ur),this.atCursorPos=!0),this.curLine}flushBuffer(t=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(Vr(new jr(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer(),this.curLine=null,this.content.push(t)}finish(t){this.pendingBuffer&&t<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,this.posCovered()||this.getLine()}buildText(t,e,r){for(;0<t;){if(this.textOff==this.text.length){var{value:i,lineBreak:n,done:s}=this.cursor.next(this.skip);if(this.skip=0,s)throw new Error("Ran out of text content when drawing inline views");if(n){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,t--;continue}this.text=i,this.textOff=0}var s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(e.length-r)),this.getLine().append(Vr(new wr(this.text.slice(this.textOff,this.textOff+s)),e),r),this.atCursorPos=!0,this.textOff+=s,t-=s,r=0}}span(t,e,r,i){this.buildText(e-t,r,i),this.pos=e,this.openStart<0&&(this.openStart=i)}point(t,e,r,i,n,s){if(this.disallowBlockEffectsFor[s]&&r instanceof Fr){if(r.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}var s=e-t,o,o,h,a,u;r instanceof Fr?r.block?({type:o}=r,o!=k.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new zr(r.widget||new qr("div"),s,o))):(o=yr.create(r.widget||new qr("span"),s,s?0:r.startSide),h=this.atCursorPos&&!o.isEditable&&n<=i.length&&(t<e||0<r.startSide),a=!o.isEditable&&(t<e||n>i.length||r.startSide<=0),u=this.getLine(),2!=this.pendingBuffer||h||o.isEditable||(this.pendingBuffer=0),this.flushBuffer(i),h&&(u.append(Vr(new jr(1),i),n),n=i.length+Math.max(0,n-i.length)),u.append(Vr(o,i),n),this.atCursorPos=a,this.pendingBuffer=a?t<e||n>i.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=i.slice())):this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(r),s&&(this.textOff+s<=this.text.length?this.textOff+=s:(this.skip+=s-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=n)}static build(t,e,r,i,n){var t=new Wr(t,e,r,n);return t.openEnd=S.spans(i,e,r,t),t.openStart<0&&(t.openStart=t.openEnd),t.finish(t.openEnd),t}}function Vr(t,e){for(var r of e)t=new br(r,[t],t.length);return t}class qr extends Tr{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}const Gr=m.define(),Jr=m.define(),Kr=m.define(),Qr=m.define(),Xr=m.define(),Zr=m.define(),Yr=m.define(),ti=m.define({combine:t=>t.some(t=>t)}),ei=m.define({combine:t=>t.some(t=>t)});class ri{constructor(t,e="nearest",r="nearest",i=5,n=5){this.range=t,this.y=e,this.x=r,this.yMargin=i,this.xMargin=n}map(t){return t.empty?this:new ri(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)}}const ii=l.define({map:(t,e)=>t.map(e)});function ni(t,e,r){var t=t.facet(Qr);t.length?t[0](e):window.onerror?window.onerror(String(e),r,void 0,void 0,e):r?console.error(r+":",e):console.error(e)}const si=m.define({combine:t=>!t.length||t[0]});let oi=0;const hi=m.define();class h{constructor(t,e,r,i){this.id=t,this.create=e,this.domEventHandlers=r,this.extension=i(this)}static define(t,e){const{eventHandlers:r,provide:i,decorations:n}=e||{};return new h(oi++,t,r,e=>{var t=[hi.of(e)];return n&&t.push(ci.of(t=>{var t=t.plugin(e);return t?n(t):j.none})),i&&t.push(i(e)),t})}static fromClass(e,t){return h.define(t=>new e(t),t)}}class ai{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){var r=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(r)}catch(t){if(ni(r.state,t,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(t){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){ni(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(null!=(t=this.value)&&t.destroy)try{this.value.destroy()}catch(t){ni(e.state,t,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const ui=m.define(),li=m.define(),ci=m.define(),fi=m.define(),di=m.define();function vi(t){let e=0,r=0,i=0,n=0;for(var s of t.state.facet(di)){var s=s(t);s&&(null!=s.left&&(e=Math.max(e,s.left)),null!=s.right&&(r=Math.max(r,s.right)),null!=s.top&&(i=Math.max(i,s.top)),null!=s.bottom)&&(n=Math.max(n,s.bottom))}return{left:e,right:r,top:i,bottom:n}}const mi=m.define();class pi{constructor(t,e,r,i){this.fromA=t,this.toA=e,this.fromB=r,this.toB=i}join(t){return new pi(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,r=this;for(;0<e;e--){var i=t[e-1];if(!(i.fromA>r.toA)){if(i.toA<r.fromA)break;r=r.join(i),t.splice(e-1,1)}}return t.splice(e,0,r),t}static extendWithRanges(n,s){if(0==s.length)return n;var o=[];for(let t=0,e=0,r=0,i=0;;t++){for(var h=t==n.length?null:n[t],a=r-i,u=h?h.fromB:1e9;e<s.length&&s[e]<u;){var l=s[e],c=s[e+1],l=Math.max(i,l),f=Math.min(u,c);if(l<=f&&new pi(l+a,f+a,l,f).addToSet(o),u<c)break;e+=2}if(!h)return o;new pi(h.fromA,h.toA,h.fromB,h.toB).addToSet(o),r=h.toA,i=h.toB}}}class gi{constructor(t,e,r){this.view=t,this.state=e,this.transactions=r,this.flags=0,this.startState=t.state,this.changes=v.empty(this.startState.doc.length);for(var i of r)this.changes=this.changes.compose(i.changes);let n=[];this.changes.iterChangedRanges((t,e,r,i)=>n.push(new pi(t,e,r,i))),this.changedRanges=n}static create(t,e,r){return new gi(t,e,r)}get viewportChanged(){return 0<(4&this.flags)}get heightChanged(){return 0<(2&this.flags)}get geometryChanged(){return this.docChanged||0<(10&this.flags)}get focusChanged(){return 0<(1&this.flags)}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(t=>t.selection)}get empty(){return 0==this.flags&&0==this.transactions.length}}const wi=(y=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(y=y||{})).LTR,bi=y.RTL;function ki(e){var r=[];for(let t=0;t<e.length;t++)r.push(1<<+e[t]);return r}const yi=ki("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),Mi=ki("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),xi=Object.create(null),Ci=[];for(pr of["()","[]","{}"]){var Si=pr.charCodeAt(0),Pi=pr.charCodeAt(1);xi[Si]=Pi,xi[Pi]=-Si}function ji(t){return t<=247?yi[t]:1424<=t&&t<=1524?2:1536<=t&&t<=1785?Mi[t-1536]:1774<=t&&t<=2220?4:8192<=t&&t<=8203?256:64336<=t&&t<=65023?4:8204==t?256:1}const Oi=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class Ei{get dir(){return this.level%2?bi:wi}constructor(t,e,r){this.from=t,this.to=e,this.level=r}side(t,e){return this.dir==e==t?this.to:this.from}static find(e,r,i,n){let s=-1;for(let t=0;t<e.length;t++){var o=e[t];if(o.from<=r&&o.to>=r){if(o.level==i)return t;(s<0||(0!=n?n<0?o.from<r:o.to>r:e[s].level>o.level))&&(s=t)}}if(s<0)throw new RangeError("Index out of range");return s}}const O=[];function Di(o,t){var h=o.length,a=t==wi?1:2,u=t==wi?2:1;if(!o||1==a&&!Oi.test(o))return Ai(h);for(let e=0,r=a,i=a;e<h;e++){let t=ji(o.charCodeAt(e));512==t?t=r:8==t&&4==i&&(t=16),O[e]=4==t?2:t,7&t&&(i=t),r=t}for(let r=0,i=a,n=a;r<h;r++){let t=O[r];if(128==t)r<h-1&&i==O[r+1]&&24&i?t=O[r]=i:O[r]=256;else if(64==t){let e=r+1;for(;e<h&&64==O[e];)e++;var s=r&&8==i||e<h&&8==O[e]?1==n?1:8:256;for(let t=r;t<e;t++)O[t]=s;r=e-1}else 8==t&&1==n&&(O[r]=1);7&(i=t)&&(n=t)}for(let e=0,r=0,t=0,i,n,s;e<h;e++)if(n=xi[i=o.charCodeAt(e)])if(n<0){for(let t=r-3;0<=t;t-=3)if(Ci[t+1]==-n){var l=Ci[t+2],l=2&l?a:4&l?1&l?u:a:0;l&&(O[e]=O[Ci[t]]=l),r=t;break}}else{if(189==Ci.length)break;Ci[r++]=e,Ci[r++]=i,Ci[r++]=t}else if(2==(s=O[e])||1==s){var c=s==a;t=c?0:1;for(let t=r-3;0<=t;t-=3){var f=Ci[t+2];if(2&f)break;if(c)Ci[t+2]|=2;else{if(4&f)break;Ci[t+2]|=4}}}for(let r=0;r<h;r++)if(256==O[r]){let e=r+1;for(;e<h&&256==O[e];)e++;var i=1==(r?O[r-1]:a),n,d=i==(1==(e<h?O[e]:a))?i?1:2:a;for(let t=r;t<e;t++)O[t]=d;r=e-1}var r=[];if(1==a)for(let e=0;e<h;){for(var v=e,m=1!=O[e++];e<h&&m==(1!=O[e]);)e++;if(m)for(let t=e;t>v;){for(var p=t,g=2!=O[--t];t>v&&g==(2!=O[t-1]);)t--;r.push(new Ei(t,p,g?2:1))}else r.push(new Ei(v,e,0))}else for(let t=0;t<h;){for(var e=t,w=2==O[t++];t<h&&w==(2==O[t]);)t++;r.push(new Ei(e,t,w?1:2))}return r}function Ai(t){return[new Ei(0,t,0)]}let Ri="";function Ii(t,e,r,i,n){var s;let o=i.head-t.from,h=-1;if(0==o){if(!n||!t.length)return null;e[0].level!=r&&(o=e[0].side(!1,r),h=0)}else if(o==t.length){if(n)return null;var s=e[e.length-1];s.level!=r&&(o=s.side(!0,r),h=e.length-1)}let a=e[h=h<0?Ei.find(e,o,null!=(s=i.bidiLevel)?s:-1,i.assoc):h];o==a.side(n,r)&&(a=e[h+=n?1:-1],o=a.side(!n,r));var s=n==(a.dir==r),i=at(t.text,o,s),s;return Ri=t.text.slice(Math.min(o,i),Math.max(o,i)),i!=a.side(n,r)?b.cursor(i+t.from,s?-1:1,a.level):(s=h==(n?e.length-1:0)?null:e[h+(n?1:-1)])||a.level==r?s&&s.level<a.level?b.cursor(s.side(!n,r)+t.from,n?1:-1,s.level):b.cursor(i+t.from,n?-1:1,a.level):b.cursor(n?t.to:t.from,n?-1:1,r)}const Li="\uffff";class Ti{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(C.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+=Li}readRange(e,r){if(e){var i=e.parentNode;for(let t=e;;){this.findPointBefore(i,t);var n=this.text.length,s=(this.readNode(t),t.nextSibling);if(s==r)break;var o=P.get(t),h=P.get(s);(o&&h?o.breakAfter:(o?o.breakAfter:Bi(t))||Bi(s)&&("BR"!=t.nodeName||t.cmIgnore)&&this.text.length>n)&&this.lineBreak(),t=s}this.findPointBefore(i,r)}return this}readTextNode(s){var o=s.nodeValue,t;for(t of this.points)t.node==s&&(t.pos=this.text.length+Math.min(t.offset,o.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let t=-1,e=1,r;if(this.lineSeparator?(t=o.indexOf(this.lineSeparator,i),e=this.lineSeparator.length):(r=n.exec(o))&&(t=r.index,e=r[0].length),this.append(o.slice(i,t<0?o.length:t)),t<0)break;if(this.lineBreak(),1<e)for(var h of this.points)h.node==s&&h.pos>this.text.length&&(h.pos-=e-1);i=t+e}}readNode(t){if(!t.cmIgnore){var e=P.get(t),e=e&&e.overrideDOMText;if(null!=e){this.findPointInside(t,e.length);for(var r=e.iter();!r.next().done;)r.lineBreak?this.lineBreak():this.append(r.value)}else 3==t.nodeType?this.readTextNode(t):"BR"==t.nodeName?t.nextSibling&&this.lineBreak():1==t.nodeType&&this.readRange(t.firstChild,null)}}findPointBefore(t,e){for(var r of this.points)r.node==t&&t.childNodes[r.offset]==e&&(r.pos=this.text.length)}findPointInside(t,e){for(var r of this.points)(3==t.nodeType?r.node==t:t.contains(r.node))&&(r.pos=this.text.length+Math.min(e,r.offset))}}function Bi(t){return 1==t.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class _i{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class Fi extends P{get length(){return this.view.state.doc.length}constructor(t){super(),this.view=t,this.compositionDeco=j.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new Ur],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new pi(0,0,0,t.state.doc.length)],0)}update(t){let e=t.changedRanges;0<this.minWidth&&e.length&&(e.every(({fromA:t,toA:e})=>e<this.minWidthFrom||t>this.minWidthTo)?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=j.none:(t.transactions.length||this.dirty)&&(this.compositionDeco=Ui(this.view,t.changes)),(p.ie||p.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);var r,i,n=Gi(this.decorations,this.updateDeco(),t.changes);return e=pi.extendWithRanges(e,n),(0!=this.dirty||0!=e.length)&&(this.updateInner(e,t.startState.doc.length),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e);let{observer:r}=this.view;r.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";var t=p.chrome||p.ios?{node:r.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,t),this.dirty=0,t&&(t.written||r.selectionRange.focusNode!=t.node)&&(this.forceSelection=!0),this.dom.style.height=""});var i=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(var n of this.children)n instanceof zr&&n.widget instanceof $i&&i.push(n.dom);r.updateGaps(i)}updateChildren(e,t){var r=this.childCursor(t);for(let t=e.length-1;;t--){var i=0<=t?e[t]:null;if(!i)break;var{fromA:i,toA:n,fromB:s,toB:o}=i,{content:s,breakAtStart:o,openStart:h,openEnd:a}=Wr.build(this.view.state.doc,s,o,this.decorations,this.dynamicDecorationMap),{i:n,off:u}=r.findPos(n,1),{i,off:l}=r.findPos(i,-1);ur(this,i,l,n,u,s,o,h,a)}}updateSelection(t=!1,e=!1){!t&&this.view.observer.selectionRange.focusNode||this.view.observer.readSelectionRange();let h=this.view.root.activeElement,r=h==this.dom,a=!r&&$e(this.dom,this.view.observer.selectionRange)&&!(h&&this.dom.contains(h));if(r||e||a){let e=this.forceSelection,i=(this.forceSelection=!1,this.view.state.selection.main),n=this.domAtPos(i.anchor),s=i.empty?n:this.domAtPos(i.head);if(p.gecko&&i.empty&&!this.compositionDeco.size&&Ni(n)){let t=document.createTextNode("");this.view.observer.ignore(()=>n.node.insertBefore(t,n.node.childNodes[n.offset]||null)),n=s=new sr(t,0),e=!0}let o=this.view.observer.selectionRange;!e&&o.focusNode&&Ue(n.node,n.offset,o.anchorNode,o.anchorOffset)&&Ue(s.node,s.offset,o.focusNode,o.focusOffset)||(this.view.observer.ignore(()=>{p.android&&p.chrome&&this.dom.contains(o.focusNode)&&Ji(o.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));var t=_e(this.view.root),e,r;if(t)if(i.empty){p.gecko&&(e=Vi(n.node,n.offset))&&3!=e&&(r=Wi(n.node,n.offset,1==e?1:-1))&&(n=new sr(r,1==e?0:r.nodeValue.length)),t.collapse(n.node,n.offset),null!=i.bidiLevel&&null!=o.cursorBidiLevel&&(o.cursorBidiLevel=i.bidiLevel)}else if(t.extend){t.collapse(n.node,n.offset);try{t.extend(s.node,s.offset)}catch(t){}}else{var e=document.createRange();i.anchor>i.head&&([n,s]=[s,n]),e.setEnd(s.node,s.offset),e.setStart(n.node,n.offset),t.removeAllRanges(),t.addRange(e)}a&&this.view.root.activeElement==this.dom&&(this.dom.blur(),h)&&h.focus()}),this.view.observer.setSelectionRange(n,s)),this.impreciseAnchor=n.precise?null:new sr(o.anchorNode,o.anchorOffset),this.impreciseHead=s.precise?null:new sr(o.focusNode,o.focusOffset)}}enforceCursorAssoc(){var t,e,r,i,n,s,o,o,s,o,s;this.compositionDeco.size||({view:t}=this,e=t.state.selection.main,r=_e(t.root),{anchorNode:i,anchorOffset:n}=t.observer.selectionRange,r&&e.empty&&e.assoc&&r.modify&&(s=Ur.find(this,e.head))&&(o=s.posAtStart,e.head==o||e.head==o+s.length||(o=this.coordsAt(e.head,-1),s=this.coordsAt(e.head,1),!o)||!s||o.bottom>s.top||(o=this.domAtPos(e.head+e.assoc),r.collapse(o.node,o.offset),r.modify("move",e.assoc<0?"forward":"backward","lineboundary"),t.observer.readSelectionRange(),s=t.observer.selectionRange,t.docView.posFromDOM(s.anchorNode,s.anchorOffset)!=e.from&&r.collapse(i,n))))}nearest(e){for(let t=e;t;){var r=P.get(t);if(r&&r.rootView==this)return r;t=t.parentNode}return null}posFromDOM(t,e){var r=this.nearest(t);if(r)return r.localPosFromDOM(t,e)+r.posAtStart;throw new RangeError("Trying to find position for a DOM position outside of the document")}domAtPos(t){let{i:e,off:r}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){var i=this.children[e];if(r<i.length||i instanceof Ur)break;e++,r=0}return this.children[e].domAtPos(r)}coordsAt(r,i){for(let t=this.length,e=this.children.length-1;;e--){var n=this.children[e],s=t-n.breakAfter-n.length;if(s<r||r==s&&n.type!=k.WidgetBefore&&n.type!=k.WidgetAfter&&(!e||2==i||this.children[e-1].breakAfter||this.children[e-1].type==k.WidgetBefore&&-2<i))return n.coordsAt(r-s,i);t=s}}measureVisibleLineHeights(t){var r=[],{from:i,to:n}=t,s=this.view.contentDOM.clientWidth,o=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1;let h=-1,a=this.view.textDirection==y.LTR;for(let t=0,e=0;e<this.children.length;e++){var u=this.children[e],l=t+u.length,c,f,f,f,c;if(n<l)break;t>=i&&(c=u.dom.getBoundingClientRect(),r.push(c.height),o)&&(f=(f=u.dom.lastChild)?He(f):[]).length&&(f=f[f.length-1],(c=a?f.right-c.left:c.right-f.left)>h)&&(h=c,this.minWidth=s,this.minWidthFrom=t,this.minWidthTo=l),t=l+u.breakAfter}return r}textDirectionAt(t){var{i:t}=this.childPos(t,1);return"rtl"==getComputedStyle(this.children[t].dom).direction?y.RTL:y.LTR}measureTextSize(){for(var t of this.children)if(t instanceof Ur){var t=t.measureTextSize();if(t)return t}let e=document.createElement("div"),r,i,n;return e.className="cm-line",e.style.width="99999px",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);var t=He(e.firstChild)[0];r=e.getBoundingClientRect().height,i=t?t.width/27:7,n=t?t.height:r,e.remove()}),{lineHeight:r,charWidth:i,textHeight:n}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new ar(this.children,t,e)}computeBlockGapDeco(){var r=[],i=this.view.viewState;for(let t=0,e=0;;e++){var n=e==i.viewports.length?null:i.viewports[e],s=n?n.from-1:this.length,o;if(s>t&&(o=i.lineBlockAt(s).bottom-i.lineBlockAt(t).top,r.push(j.replace({widget:new $i(o),block:!0,inclusive:!0,isBlockGap:!0}).range(t,s))),!n)break;t=n.to+1}return j.set(r)}updateDeco(){var e=this.view.state.facet(ci).map((t,e)=>{var r;return(this.dynamicDecorationMap[e]="function"==typeof t)?t(this.view):t});for(let t=e.length;t<e.length+3;t++)this.dynamicDecorationMap[t]=!1;return this.decorations=[...e,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(t){var{range:e}=t,r,r;let i=this.coordsAt(e.head,e.empty?e.assoc:e.head>e.anchor?-1:1),n;i&&(!e.empty&&(n=this.coordsAt(e.anchor,e.anchor>e.head?-1:1))&&(i={left:Math.min(i.left,n.left),top:Math.min(i.top,n.top),right:Math.max(i.right,n.right),bottom:Math.max(i.bottom,n.bottom)}),r=vi(this.view),r={left:i.left-r.left,top:i.top-r.top,right:i.right+r.right,bottom:i.bottom+r.bottom},Je(this.view.scrollDOM,r,e.head<e.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==y.LTR))}}function Ni(t){return 1==t.node.nodeType&&t.node.firstChild&&(0==t.offset||"false"==t.node.childNodes[t.offset-1].contentEditable)&&(t.offset==t.node.childNodes.length||"false"==t.node.childNodes[t.offset].contentEditable)}class $i extends Tr{constructor(t){super(),this.height=t}toDOM(){var t=document.createElement("div");return this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function Hi(r){var i=r.observer.selectionRange,i=i.focusNode&&Wi(i.focusNode,i.focusOffset,0);if(!i)return null;let n=r.docView.nearest(i);if(!n)return null;if(n instanceof Ur){let t=i;for(;t.parentNode!=n.dom;)t=t.parentNode;let e=t.previousSibling;for(;e&&!P.get(e);)e=e.previousSibling;var r=e?P.get(e).posAtEnd:n.posAtStart;return{from:r,to:r,node:t,text:i}}for(;;){var{parent:t}=n;if(!t)return null;if(t instanceof Ur)break;n=t}var r=n.posAtStart;return{from:r,to:r+n.length,node:n.dom,text:i}}function Ui(t,e){var r=Hi(t);if(!r)return j.none;var{from:r,to:i,node:n,text:s}=r;let o=e.mapPos(r,1),h=Math.max(o,e.mapPos(i,-1));var{state:r}=t,e=3==n.nodeType?n.nodeValue:new Ti([],r).readRange(n.firstChild,null).text;if(-1<e.indexOf(Li))return j.none;if(h-o<e.length)if(r.doc.sliceString(o,Math.min(r.doc.length,o+e.length))==e)h=o+e.length;else{if(r.doc.sliceString(Math.max(0,h-e.length),h)!=e)return j.none;o=h-e.length}else if(r.doc.sliceString(o,h)!=e)return j.none;let a=P.get(n);return a instanceof Mr?a=a.widget.topView:a&&(a.parent=null),j.set(j.replace({widget:new zi(n,s,a),inclusive:!0}).range(o,h))}class zi extends Tr{constructor(t,e,r){super(),this.top=t,this.text=e,this.topView=r}eq(t){return this.top==t.top&&this.text==t.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return Mr}}function Wi(r,i,n){if(n<=0)for(let t=r,e=i;;){if(3==t.nodeType)return t;if(!(1==t.nodeType&&0<e))break;t=t.childNodes[e-1],e=Ve(t)}if(0<=n)for(let t=r,e=i;;){if(3==t.nodeType)return t;if(!(1==t.nodeType&&e<t.childNodes.length&&0<=n))break;t=t.childNodes[e],e=0}return null}function Vi(t,e){return 1!=t.nodeType?0:(e&&"false"==t.childNodes[e-1].contentEditable?1:0)|(e<t.childNodes.length&&"false"==t.childNodes[e].contentEditable?2:0)}class qi{constructor(){this.changes=[]}compareRange(t,e){Hr(t,e,this.changes)}comparePoint(t,e){Hr(t,e,this.changes)}}function Gi(t,e,r){var i=new qi;return S.compare(t,e,r,i),i.changes}function Ji(e,r){for(let t=e;t&&t!=r;t=t.assignedSlot||t.parentNode)if(1==t.nodeType&&"false"==t.contentEditable)return 1}function Ki(t,e,r=1){var i=t.charCategorizer(e),n=t.doc.lineAt(e),t=e-n.from;if(0==n.length)return b.cursor(e);0==t?r=1:t==n.length&&(r=-1);let s=t,o=t;r<0?s=at(n.text,t,!1):o=at(n.text,t);for(var h=i(n.text.slice(s,o));0<s;){var a=at(n.text,s,!1);if(i(n.text.slice(a,s))!=h)break;s=a}for(;o<n.length;){var u=at(n.text,o);if(i(n.text.slice(o,u))!=h)break;o=u}return b.range(s+n.from,o+n.from)}function Qi(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function Xi(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function Zi(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function Yi(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function tn(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function en(t,i,n){let s,o,h,a,u=!1,l,c,f,d;for(let r=t.firstChild;r;r=r.nextSibling){var v=He(r);for(let e=0;e<v.length;e++){let t=v[e];var m=Qi(i,t=o&&Zi(o,t)?Yi(tn(t,o.bottom),o.top):t),p=Xi(n,t),p;if(0==m&&0==p)return(3==r.nodeType?rn:en)(r,i,n);(!s||a>p||a==p&&h>m)&&(s=r,o=t,h=m,p=(a=p)?n<t.top?-1:1:m?i<t.left?-1:1:0,u=!p||(0<p?e<v.length-1:0<e)),0==m?n>t.bottom&&(!f||f.bottom<t.bottom)?(l=r,f=t):n<t.top&&(!d||d.top>t.top)&&(c=r,d=t):f&&Zi(f,t)?f=tn(f,t.bottom):d&&Zi(d,t)&&(d=Yi(d,t.top))}}var e,r;return f&&f.bottom>=n?(s=l,o=f):d&&d.top<=n&&(s=c,o=d),s?(e=Math.max(o.left,Math.min(o.right,i)),3==s.nodeType?rn(s,e,n):u&&"false"!=s.contentEditable?en(s,e,n):{node:t,offset:Array.prototype.indexOf.call(t.childNodes,s)+(i>=(o.left+o.right)/2?1:0)}):{node:t,offset:0}}function rn(i,n,e){var t=i.nodeValue.length;let s=-1,o=1e9,h=0;for(let r=0;r<t;r++){var a=tr(i,r,r+1).getClientRects();for(let t=0;t<a.length;t++){var u=a[t];if(u.top!=u.bottom){h=h||n-u.left;var l=(u.top>e?u.top-e:e-u.bottom)-1,c;if(u.left-1<=n&&u.right+1>=n&&l<o){let t=n>=(u.left+u.right)/2,e=t;if((p.chrome||p.gecko)&&tr(i,r).getBoundingClientRect().left==u.right&&(e=!t),l<=0)return{node:i,offset:r+(e?1:0)};s=r+(e?1:0),o=l}}}}return{node:i,offset:-1<s?s:0<h?i.nodeValue.length:0}}function nn(r,t,i,n=-1){var e,e,e=r.contentDOM.getBoundingClientRect(),s=e.top+r.viewState.paddingTop;let o,{docHeight:h}=r.viewState,{x:a,y:u}=t,l=u-s;if(l<0)return 0;if(l>h)return r.state.doc.length;for(let t=r.defaultLineHeight/2,e=!1;(o=r.elementAtHeight(l)).type!=k.Text;)for(;!(0<=(l=0<n?o.bottom+t:o.top-t)&&l<=h);){if(e)return i?null:0;e=!0,n=-n}u=s+l;var s=o.from;if(s<r.viewport.from)return 0==r.viewport.from?0:i?null:sn(r,e,o,a,u);if(s>r.viewport.to)return r.viewport.to==r.state.doc.length?r.state.doc.length:i?null:sn(r,e,o,a,u);var c=r.dom.ownerDocument,f=r.root.elementFromPoint?r.root:c,f,e;let d=f.elementFromPoint(a,u);(d=d&&!r.contentDOM.contains(d)?null:d)||(a=Math.max(e.left+1,Math.min(e.right-1,a)),(d=f.elementFromPoint(a,u))&&!r.contentDOM.contains(d)&&(d=null));let v,m=-1;if(d&&0!=(null==(e=r.docView.nearest(d))?void 0:e.isEditable)&&(c.caretPositionFromPoint?(f=c.caretPositionFromPoint(a,u))&&({offsetNode:v,offset:m}=f):c.caretRangeFromPoint&&(e=c.caretRangeFromPoint(a,u))&&({startContainer:v,startOffset:m}=e,!r.contentDOM.contains(v)||p.safari&&on(v,m,a)||p.chrome&&hn(v,m,a))&&(v=void 0)),!v||!r.docView.dom.contains(v)){var f=Ur.find(r.docView,s);if(!f)return l>o.top+o.height/2?o.to:o.from;({node:v,offset:m}=en(f.dom,a,u))}var c=r.docView.nearest(v),s;return c?c.isWidget&&1==(null==(e=c.dom)?void 0:e.nodeType)?(s=c.dom.getBoundingClientRect(),t.y<s.top||t.y<=s.bottom&&t.x<=(s.left+s.right)/2?c.posAtStart:c.posAtEnd):c.localPosFromDOM(v,m)+c.posAtStart:null}function sn(t,e,r,i,n){let s=Math.round((i-e.left)*t.defaultCharacterWidth);var i,e=(t.lineWrapping&&r.height>1.5*t.defaultLineHeight&&(i=Math.floor((n-r.top)/t.defaultLineHeight),s+=i*t.viewState.heightOracle.lineLength),t.state.sliceDoc(r.from,r.to));return r.from+Oe(e,s,t.state.tabSize)}function on(e,t,r){let i;if(3==e.nodeType&&t==(i=e.nodeValue.length)){for(let t=e.nextSibling;t;t=t.nextSibling)if(1!=t.nodeType||"BR"!=t.nodeName)return;return tr(e,i-1,i).getBoundingClientRect().left>r}}function hn(e,t,r){if(0==t){for(let t=e;;){var i=t.parentNode;if(!i||1!=i.nodeType||i.firstChild!=t)return;if(i.classList.contains("cm-line"))break;t=i}var n;return 5<r-(1==e.nodeType?e:tr(e,0,Math.max(e.nodeValue.length,1))).getBoundingClientRect().left}}function an(t,e,r,i){var n=t.state.doc.lineAt(e.head),i=i&&t.lineWrapping?t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head):null;if(i){var s=t.dom.getBoundingClientRect(),o=t.textDirectionAt(n.from),o=t.posAtCoords({x:r==(o==y.LTR)?s.right-1:s.left+1,y:(i.top+i.bottom)/2});if(null!=o)return b.cursor(o,r?-1:1)}var s=Ur.find(t.docView,e.head),i=s?r?s.posAtEnd:s.posAtStart:r?n.to:n.from;return b.cursor(i,r?-1:1)}function un(n,t,s,o){let h=n.state.doc.lineAt(t.head),a=n.bidiSpans(h);var u=n.textDirectionAt(h.from);for(let r=t,i=null;;){let t=Ii(h,a,u,r,s),e=Ri;if(!t){if(h.number==(s?n.state.doc.lines:1))return r;e="\n",h=n.state.doc.line(h.number+(s?1:-1)),a=n.bidiSpans(h),t=b.cursor(s?h.from:h.to)}if(i){if(!i(e))return r}else{if(!o)return t;i=o(e)}r=t}}function ln(t,e,r){let i=t.state.charCategorizer(e),n=i(r);return t=>{var t=i(t);return(n=n==c.Space?t:n)==t}}function cn(e,r,t,i){var n=r.head,s=t?1:-1;if(n==(t?e.state.doc.length:0))return b.cursor(n,r.assoc);let o=r.goalColumn,h;var a=e.contentDOM.getBoundingClientRect(),t=e.coordsAtPos(n),u=e.documentTop,t,l=(h=t?(null==o&&(o=t.left-a.left),s<0?t.top:t.bottom):(t=e.viewState.lineBlockAt(n),null==o&&(o=Math.min(a.right-a.left,e.defaultCharacterWidth*(n-t.from))),(s<0?t.top:t.bottom)+u),a.left+o),c=null!=i?i:e.defaultLineHeight>>1;for(let t=0;;t+=10){var f=h+(c+t)*s,d=nn(e,{x:l,y:f},!1,s);if(f<a.top||f>a.bottom||(s<0?d<n:n<d))return b.cursor(d,r.assoc,void 0,o)}}function fn(t,s,o){for(;;){let n=0;for(var e of t)e.between(s-1,s+1,(t,e,r)=>{var i;t<s&&s<e&&(i=n||o||(s-t<e-s?-1:1),s=i<0?t:e,n=i)});if(!n)return s}}function dn(e,t,r){var t=fn(e.state.facet(fi).map(t=>t(e)),r.from,t.head>r.from?-1:1);return t==r.from?r:b.cursor(t,t<r.from?1:-1)}class vn{setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}constructor(r){this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null;let i=(t,e)=>{this.ignoreDuringComposition(e)||"keydown"==e.type&&this.keydown(r,e)||(this.mustFlushObserver(e)&&r.observer.forceFlush(),this.runCustomHandlers(e.type,r,e)?e.preventDefault():t(r,e))};for(var t in o){let e=o[t];r.contentDOM.addEventListener(t,t=>{Cn(r,t)&&i(e,t)},Sn[t]),this.registeredEvents.push(t)}r.scrollDOM.addEventListener("mousedown",t=>{if(t.target==r.scrollDOM&&t.clientY>r.contentDOM.getBoundingClientRect().bottom&&(i(o.mousedown,t),!t.defaultPrevented)&&2==t.button){let t=r.contentDOM.style.minHeight;r.contentDOM.style.minHeight="100%",setTimeout(()=>r.contentDOM.style.minHeight=t,200)}}),r.scrollDOM.addEventListener("drop",t=>{t.target==r.scrollDOM&&t.clientY>r.contentDOM.getBoundingClientRect().bottom&&i(o.drop,t)}),p.chrome&&102==p.chrome_version&&r.scrollDOM.addEventListener("wheel",()=>{this.chromeScrollHack<0?r.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout(()=>{this.chromeScrollHack=-1,r.contentDOM.style.pointerEvents=""},100)},{passive:!0}),this.notifiedFocused=r.hasFocus,p.safari&&r.contentDOM.addEventListener("input",()=>null)}ensureHandlers(r,t){var i,i,e;this.customHandlers=[];for(e of t)if(i=null==(i=e.update(r).spec)?void 0:i.domEventHandlers){this.customHandlers.push({plugin:e.value,handlers:i});for(let e in i)this.registeredEvents.indexOf(e)<0&&"scroll"!=e&&(this.registeredEvents.push(e),r.contentDOM.addEventListener(e,t=>{Cn(r,t)&&this.runCustomHandlers(e,r,t)&&t.preventDefault()}))}}runCustomHandlers(t,e,r){for(var i of this.customHandlers){var n=i.handlers[t];if(n)try{if(n.call(i.plugin,r,e)||r.defaultPrevented)return!0}catch(t){ni(e.state,t)}}return!1}runScrollHandlers(e,t){this.lastScrollTop=e.scrollDOM.scrollTop,this.lastScrollLeft=e.scrollDOM.scrollLeft;for(var r of this.customHandlers){var i=r.handlers.scroll;if(i)try{i.call(r.plugin,t,e)}catch(t){ni(e.state,t)}}}keydown(t,e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(27!=e.keyCode&&gn.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0),p.android&&p.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return t.observer.delayAndroidKey(e.key,e.keyCode),!0;let r;return!(!p.ios||e.synthetic||e.altKey||e.metaKey||!((r=mn.find(t=>t.keyCode==e.keyCode))&&!e.ctrlKey||-1<pn.indexOf(e.key)&&e.ctrlKey&&!e.shiftKey)||(this.pendingIOSKey=r||e,setTimeout(()=>this.flushIOSKey(t),250),0))}flushIOSKey(t){var e=this.pendingIOSKey;return!!e&&(this.pendingIOSKey=void 0,er(t.contentDOM,e.key,e.keyCode))}ignoreDuringComposition(t){return!!/^key/.test(t.type)&&(0<this.composing||!!(p.safari&&!p.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100)&&!(this.compositionPendingKey=!1))}mustFlushObserver(t){return"keydown"==t.type&&229!=t.keyCode}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.mouseSelection&&this.mouseSelection.update(t),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const mn=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],pn="dthko",gn=[16,17,18,20,91,92,224,225],wn=6;function bn(t){return.7*Math.max(0,t)+8}class kn{constructor(e,t,r,i){this.view=e,this.style=r,this.mustSelect=i,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParent=Ke(e.contentDOM),this.atoms=e.state.facet(fi).map(t=>t(e));var r=e.contentDOM.ownerDocument;r.addEventListener("mousemove",this.move=this.move.bind(this)),r.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(C.allowMultipleSelections)&&yn(e,t),this.dragMove=Mn(e,t),this.dragging=!(!xn(e,t)||1!=Fn(t))&&null}start(t){!1===this.dragging&&(t.preventDefault(),this.select(t))}move(r){var i;if(0==r.buttons)return this.destroy();if(!1===this.dragging){this.select(this.lastEvent=r);let t=0,e=0;var i=(null==(i=this.scrollParent)?void 0:i.getBoundingClientRect())||{left:0,top:0,right:this.view.win.innerWidth,bottom:this.view.win.innerHeight},n=vi(this.view);r.clientX-n.left<=i.left+6?t=-bn(i.left-r.clientX):r.clientX+n.right>=i.right-6&&(t=bn(r.clientX-i.right)),r.clientY-n.top<=i.top+6?e=-bn(i.top-r.clientY):r.clientY+n.bottom>=i.bottom-6&&(e=bn(r.clientY-i.bottom)),this.setScrollSpeed(t,e)}}up(t){null==this.dragging&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);var t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}setScrollSpeed(t,e){this.scrollSpeed={x:t,y:e},t||e?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):-1<this.scrolling&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){this.scrollParent?(this.scrollParent.scrollLeft+=this.scrollSpeed.x,this.scrollParent.scrollTop+=this.scrollSpeed.y):this.view.win.scrollBy(this.scrollSpeed.x,this.scrollSpeed.y),!1===this.dragging&&this.select(this.lastEvent)}skipAtoms(i){let n=null;for(let r=0;r<i.ranges.length;r++){let t=i.ranges[r],e=null;var s,s,o;t.empty?(s=fn(this.atoms,t.from,0))!=t.from&&(e=b.cursor(s,-1)):(s=fn(this.atoms,t.from,-1),o=fn(this.atoms,t.to,1),s==t.from&&o==t.to||(e=b.range(t.from==t.anchor?s:o,t.from==t.head?s:o))),e&&((n=n||i.ranges.slice())[r]=e)}return n?b.create(n,i.mainIndex):i}select(t){var{view:e}=this,t=this.skipAtoms(this.style.get(t,this.extend,this.multiple));!this.mustSelect&&t.eq(e.state.selection)&&t.main.assoc==e.state.selection.main.assoc||this.view.dispatch({selection:t,userEvent:"select.pointer"}),this.mustSelect=!1}update(t){t.docChanged&&this.dragging&&(this.dragging=this.dragging.map(t.changes)),this.style.update(t)&&setTimeout(()=>this.select(this.lastEvent),20)}}function yn(t,e){var t=t.state.facet(Gr);return t.length?t[0](e):p.mac?e.metaKey:e.ctrlKey}function Mn(t,e){var t=t.state.facet(Jr);return t.length?t[0](e):p.mac?!e.altKey:!e.ctrlKey}function xn(t,e){var{main:r}=t.state.selection;if(!r.empty){var r=_e(t.root);if(!r||0==r.rangeCount)return 1;var i=r.getRangeAt(0).getClientRects();for(let t=0;t<i.length;t++){var n=i[t];if(n.left<=e.clientX&&n.right>=e.clientX&&n.top<=e.clientY&&n.bottom>=e.clientY)return 1}}}function Cn(r,i){if(!i.bubbles)return 1;if(!i.defaultPrevented){for(let t=i.target,e;t!=r.contentDOM;t=t.parentNode)if(!t||11==t.nodeType||(e=P.get(t))&&e.ignoreEvent(i))return;return 1}}const o=Object.create(null),Sn=Object.create(null),Pn=p.ie&&p.ie_version<15||p.ios&&p.webkit_version<604;function jn(e){var r=e.dom.parentNode;if(r){let t=r.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{e.focus(),t.remove(),On(e,t.value)},50)}}function On(t,n){let{state:s}=t,e,o=1,h=s.toText(n),a=h.lines==s.selection.ranges.length;var r;if(null!=Wn&&s.selection.ranges.every(t=>t.empty)&&Wn==h.toString()){let i=-1;e=s.changeByRange(t=>{var e=s.doc.lineAt(t.from);if(e.from==i)return{range:t};i=e.from;var r=s.toText((a?h.line(o++).text:n)+s.lineBreak);return{changes:{from:e.from,insert:r},range:b.cursor(t.from+r.length)}})}else e=a?s.changeByRange(t=>{var e=h.line(o++);return{changes:{from:t.from,to:t.to,insert:e.text},range:b.cursor(t.from+e.length)}}):s.replaceSelection(h);t.dispatch(e,{userEvent:"input.paste",scrollIntoView:!0})}function En(r,i,n,s){if(1==s)return b.cursor(i,n);if(2==s)return Ki(r.state,i,n);{var s=Ur.find(r.docView,i),n=r.state.doc.lineAt(s?s.posAtEnd:i);let t=s?s.posAtStart:n.from,e=s?s.posAtEnd:n.to;return e<r.state.doc.length&&e==n.to&&e++,b.range(t,e)}}o.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),27==e.keyCode&&(t.inputState.lastEscPress=Date.now())},o.touchstart=(t,e)=>{t.inputState.lastTouchTime=Date.now(),t.inputState.setSelectionOrigin("select.pointer")},o.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")},Sn.touchstart=Sn.touchmove={passive:!0},o.mousedown=(e,r)=>{if(e.observer.flush(),!(e.inputState.lastTouchTime>Date.now()-2e3)){let t=null;for(var i of e.state.facet(Kr))if(t=i(e,r))break;var n;(t=t||0!=r.button?t:Nn(e,r))&&(n=e.root.activeElement!=e.contentDOM,e.inputState.startMouseSelection(new kn(e,r,t,n)),n&&e.observer.ignore(()=>Ze(e.contentDOM)),e.inputState.mouseSelection)&&e.inputState.mouseSelection.start(r)}};let Dn=(t,e)=>t>=e.top&&t<=e.bottom,An=(t,e,r)=>Dn(e,r)&&t>=r.left&&t<=r.right;function Rn(t,e,r,i){var t=Ur.find(t.docView,e),e,n,t;return t&&0!=(e=e-t.posAtStart)&&(e==t.length||(n=t.coordsAt(e,-1))&&An(r,i,n)||(!(t=t.coordsAt(e,1))||!An(r,i,t))&&n&&Dn(i,n))?-1:1}function In(t,e){var r=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:r,bias:Rn(t,r,e.clientX,e.clientY)}}const Ln=p.ie&&p.ie_version<=11;let Tn=null,Bn=0,_n=0;function Fn(t){var e,r;return Ln?(e=Tn,r=_n,Tn=t,_n=Date.now(),Bn=!e||r>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(Bn+1)%3:1):t.detail}function Nn(h,t){let a=In(h,t),u=Fn(t),l=h.state.selection;return{update(t){t.docChanged&&(a.pos=t.changes.mapPos(a.pos),l=l.map(t.changes))},get(t,e,r){let i=In(h,t),n,s=En(h,i.pos,i.bias,u);var t,o,t;return a.pos==i.pos||e||(t=En(h,a.pos,a.bias,u),o=Math.min(t.from,s.from),t=Math.max(t.to,s.to),s=o<s.from?b.range(o,t):b.range(t,o)),e?l.replaceRange(l.main.extend(s.from,s.to)):r&&1==u&&1<l.ranges.length&&(n=$n(l,i.pos))?n:r?l.addRange(s):b.create([s])}}}function $n(e,r){for(let t=0;t<e.ranges.length;t++){var{from:i,to:n}=e.ranges[t];if(i<=r&&r<=n)return b.create(e.ranges.slice(0,t).concat(e.ranges.slice(t+1)),e.mainIndex==t?0:e.mainIndex-(e.mainIndex>t?1:0))}return null}function Hn(t,e,r,i){var n,e,i,e,r;r&&(n=t.posAtCoords({x:e.clientX,y:e.clientY},!1),{mouseSelection:e}=(e.preventDefault(),t.inputState),i=i&&e&&e.dragging&&e.dragMove?{from:e.dragging.from,to:e.dragging.to}:null,e={from:n,insert:r},r=t.state.changes(i?[i,e]:e),t.focus(),t.dispatch({changes:r,selection:{anchor:r.mapPos(n,-1),head:r.mapPos(n,1)},userEvent:i?"move.drop":"input.drop"}))}function Un(e,r){var i=e.dom.parentNode;if(i){let t=i.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.value=r,t.focus(),t.selectionEnd=r.length,t.selectionStart=0,setTimeout(()=>{t.remove(),e.focus()},50)}}function zn(e){let r=[],i=[],n=!1;for(var t of e.selection.ranges)t.empty||(r.push(e.sliceDoc(t.from,t.to)),i.push(t));if(!r.length){let t=-1;for(var{from:s}of e.selection.ranges){var s=e.doc.lineAt(s);s.number>t&&(r.push(s.text),i.push({from:s.from,to:Math.min(e.doc.length,s.to+1)})),t=s.number}n=!0}return{text:r.join(e.lineBreak),ranges:i,linewise:n}}o.dragstart=(t,e)=>{var{selection:{main:r}}=t.state,{mouseSelection:i}=t.inputState;i&&(i.dragging=r),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(r.from,r.to)),e.dataTransfer.effectAllowed="copyMove")},o.drop=(e,s)=>{if(s.dataTransfer){if(e.state.readOnly)return s.preventDefault();let n=s.dataTransfer.files;if(n&&n.length){s.preventDefault();let r=Array(n.length),t=0,i=()=>{++t==n.length&&Hn(e,s,r.filter(t=>null!=t).join(e.state.lineBreak),!1)};for(let e=0;e<n.length;e++){let t=new FileReader;t.onerror=i,t.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(t.result)||(r[e]=t.result),i()},t.readAsText(n[e])}}else Hn(e,s,s.dataTransfer.getData("Text"),!0)}},o.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();var r=Pn?null:e.clipboardData;r?(On(t,r.getData("text/plain")||r.getData("text/uri-text")),e.preventDefault()):jn(t)};let Wn=null;o.copy=o.cut=(t,e)=>{var{text:r,ranges:i,linewise:n}=zn(t.state),n;(r||n)&&(Wn=n?r:null,(n=Pn?null:e.clipboardData)?(e.preventDefault(),n.clearData(),n.setData("text/plain",r)):Un(t,r),"cut"!=e.type||t.state.readOnly||t.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"}))};const Vn=Kt.define();function qn(t,e){var r=[],i;for(i of t.facet(Yr)){var n=i(t,e);n&&r.push(n)}return r?t.update({effects:r,annotations:Vn.of(!0)}):null}function Gn(e){setTimeout(()=>{var t=e.hasFocus,t;t!=e.inputState.notifiedFocused&&((t=qn(e.state,t))?e.dispatch(t):e.update([]))},10)}o.focus=t=>{t.inputState.lastFocusTime=Date.now(),t.scrollDOM.scrollTop||!t.inputState.lastScrollTop&&!t.inputState.lastScrollLeft||(t.scrollDOM.scrollTop=t.inputState.lastScrollTop,t.scrollDOM.scrollLeft=t.inputState.lastScrollLeft),Gn(t)},o.blur=t=>{t.observer.clearSelectionRange(),Gn(t)},o.compositionstart=o.compositionupdate=t=>{null==t.inputState.compositionFirstChange&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0)},o.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionPendingKey=!0,t.inputState.compositionPendingChange=0<t.observer.pendingRecords().length,t.inputState.compositionFirstChange=null,p.chrome&&p.android?t.observer.flushSoon():t.inputState.compositionPendingChange?Promise.resolve().then(()=>t.observer.flush()):setTimeout(()=>{t.inputState.composing<0&&t.docView.compositionDeco.size&&t.update([])},50)},o.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()},o.beforeinput=(r,e)=>{var t;let i;if(p.chrome&&p.android&&(i=mn.find(t=>t.inputType==e.inputType))&&(r.observer.delayAndroidKey(i.key,i.keyCode),"Backspace"==i.key||"Delete"==i.key)){let e=(null==(t=window.visualViewport)?void 0:t.height)||0;setTimeout(()=>{var t;((null==(t=window.visualViewport)?void 0:t.height)||0)>e+10&&r.hasFocus&&(r.contentDOM.blur(),r.focus())},100)}};const Jn=["pre-wrap","normal","pre-line","break-spaces"];class Kn{constructor(t){this.lineWrapping=t,this.doc=g.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30,this.heightChanged=!1}heightForGap(t,e){let r=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(r+=Math.max(0,Math.ceil((e-t-r*this.lineLength*.5)/this.lineLength))),this.lineHeight*r}heightForLine(t){var e;return this.lineWrapping?(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForWrapping(t){return-1<Jn.indexOf(t)!=this.lineWrapping}mustRefreshForHeights(e){let r=!1;for(let t=0;t<e.length;t++){var i=e[t];i<0?t++:this.heightSamples[Math.floor(10*i)]||(r=!0,this.heightSamples[Math.floor(10*i)]=!0)}return r}refresh(t,e,r,i,n,s){var t=-1<Jn.indexOf(t),o=Math.round(e)!=Math.round(this.lineHeight)||this.lineWrapping!=t;if(this.lineWrapping=t,this.lineHeight=e,this.charWidth=r,this.textHeight=i,this.lineLength=n,o){this.heightSamples={};for(let t=0;t<s.length;t++){var h=s[t];h<0?t++:this.heightSamples[Math.floor(10*h)]=!0}}return o}}class Qn{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class Xn{constructor(t,e,r,i,n,s){this.from=t,this.length=e,this.top=r,this.height=i,this.children=n,this.deco=s}get type(){var t,t,t;return null!=(t=null!=(t=this.children)?t:null==(t=this.deco)?void 0:t.type)?t:k.Text}get widget(){return this.deco&&this.deco.widget}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(t){var e=(this.children||[this]).concat(t.children||[t]);return new Xn(this.from,this.length+t.length,this.top,this.height+t.height,e,null)}}d=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(d=d||{});const Zn=.001;class Yn{constructor(t,e,r=2){this.length=t,this.height=e,this.flags=r}get outdated(){return 0<(2&this.flags)}set outdated(t){this.flags=(t?2:0)|-3&this.flags}setHeight(t,e){this.height!=e&&(Math.abs(this.height-e)>Zn&&(t.heightChanged=!0),this.height=e)}replace(t,e,r){return Yn.of(r)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(o,h,a,u){let l=this,c=a.doc;for(let s=u.length-1;0<=s;s--){let{fromA:t,toA:e,fromB:r,toB:i}=u[s],n=l.lineAt(t,d.ByPosNoHeight,a.setDoc(h),0,0);var f=n.to>=e?n:l.lineAt(e,d.ByPosNoHeight,a,0,0);for(i+=f.to-e,e=f.to;0<s&&n.from<=u[s-1].toA;)t=u[s-1].fromA,r=u[s-1].fromB,s--,t<n.from&&(n=l.lineAt(t,d.ByPosNoHeight,a,0,0));r+=n.from-t,t=n.from;var f=os.build(a.setDoc(c),o,r,i);l=l.replace(t,e,f)}return l.updateHeight(a,0)}static empty(){return new es(0,0)}static of(t){if(1==t.length)return t[0];let e=0,r=t.length,i=0,n=0;for(;;){var s,s;if(e==r)if(i>2*n){var o=t[e-1];o.break?t.splice(--e,1,o.left,null,o.right):t.splice(--e,1,o.left,o.right),r+=1+o.break,i-=o.size}else{if(!(n>2*i))break;var o=t[r];o.break?t.splice(r,1,o.left,null,o.right):t.splice(r,1,o.left,o.right),r+=2+o.break,n-=o.size}else i<n?(s=t[e++])&&(i+=s.size):(s=t[--r])&&(n+=s.size)}let h=0;return null==t[e-1]?(h=1,e--):null==t[e]&&(h=1,r++),new is(Yn.of(t.slice(0,e)),h,Yn.of(t.slice(r)))}}Yn.prototype.size=1;class ts extends Yn{constructor(t,e,r){super(t,e),this.deco=r}blockAt(t,e,r,i){return new Xn(i,this.length,r,this.height,null,this.deco)}lineAt(t,e,r,i,n){return this.blockAt(0,r,i,n)}forEachLine(t,e,r,i,n,s){t<=n+this.length&&n<=e&&s(this.blockAt(0,r,i,n))}updateHeight(t,e=0,r=!1,i){return i&&i.from<=e&&i.more&&this.setHeight(t,i.heights[i.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class es extends ts{constructor(t,e){super(t,e,null),this.collapsed=0,this.widgetHeight=0}replace(t,e,r){let i=r[0];return 1==r.length&&(i instanceof es||i instanceof rs&&4&i.flags)&&Math.abs(this.length-i.length)<10?(i instanceof rs?i=new es(i.length,this.height):i.height=this.height,this.outdated||(i.outdated=!1),i):Yn.of(r)}updateHeight(t,e=0,r=!1,i){return i&&i.from<=e&&i.more?this.setHeight(t,i.heights[i.index++]):(r||this.outdated)&&this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class rs extends Yn{constructor(t){super(t,0)}heightMetrics(t,e){var r=t.doc.lineAt(e).number,e=t.doc.lineAt(e+this.length).number,i=e-r+1,t;let n,s=0;return t.lineWrapping?(t=Math.min(this.height,t.lineHeight*i),n=t/i,this.length>1+i&&(s=(this.height-t)/(this.length-i-1))):n=this.height/i,{firstLine:r,lastLine:e,perLine:n,perChar:s}}blockAt(t,e,r,i){var{firstLine:n,lastLine:s,perLine:o,perChar:h}=this.heightMetrics(e,i),i,i,h,a,i,a,h;return e.lineWrapping?(i=i+Math.round(Math.max(0,Math.min(1,(t-r)/this.height))*this.length),h=o+(i=e.doc.lineAt(i)).length*h,a=Math.max(r,t-h/2),new Xn(i.from,i.length,a,h,null,null)):(i=Math.max(0,Math.min(s-n,Math.floor((t-r)/o))),{from:a,length:h}=e.doc.line(n+i),new Xn(a,h,r+o*i,o,null,null))}lineAt(t,e,r,i,n){var e,s,s,e,o,r,t,e,s;return e==d.ByHeight?this.blockAt(t,r,i,n):e==d.ByPosNoHeight?({from:e,to:s}=r.doc.lineAt(t),new Xn(e,s-e,0,0,null,null)):({firstLine:s,perLine:e,perChar:o}=this.heightMetrics(r,n),t=e+(r=r.doc.lineAt(t)).length*o,s=i+e*(e=r.number-s)+o*(r.from-n-e),new Xn(r.from,r.length,Math.max(i,Math.min(s,i+this.height-t)),t,null,null))}forEachLine(r,i,n,s,o,h){r=Math.max(r,o),i=Math.min(i,o+this.length);var{firstLine:a,perLine:u,perChar:l}=this.heightMetrics(n,o);for(let t=r,e=s;t<=i;){var c=n.doc.lineAt(t),f,f=(t==r&&(f=c.number-a,e+=u*f+l*(r-o-f)),u+l*c.length);h(new Xn(c.from,c.length,e,f,null,null)),e+=f,t=c.to+1}}replace(t,e,r){var e=this.length-e,i,i;return 0<e&&((i=r[r.length-1])instanceof rs?r[r.length-1]=new rs(i.length+e):r.push(null,new rs(e-1))),0<t&&((i=r[0])instanceof rs?r[0]=new rs(t+i.length):r.unshift(new rs(t-1),null)),Yn.of(r)}decomposeLeft(t,e){e.push(new rs(t-1),null)}decomposeRight(t,e){e.push(null,new rs(this.length-t-1))}updateHeight(i,n=0,t=!1,s){var o=n+this.length;if(s&&s.from<=n+this.length&&s.more){let t=[],e=Math.max(n,s.from),r=-1;for(s.from>n&&t.push(new rs(s.from-n-1).updateHeight(i,n));e<=o&&s.more;){var h=i.doc.lineAt(e).length,a=(t.length&&t.push(null),s.heights[s.index++]),a=(-1==r?r=a:Math.abs(a-r)>=Zn&&(r=-2),new es(h,a));a.outdated=!1,t.push(a),e+=h+1}e<=o&&t.push(null,new rs(o-e).updateHeight(i,e));var u=Yn.of(t);return(r<0||Math.abs(u.height-this.height)>=Zn||Math.abs(r-this.heightMetrics(i,n).perLine)>=Zn)&&(i.heightChanged=!0),u}return(t||this.outdated)&&(this.setHeight(i,i.heightForGap(n,n+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class is extends Yn{constructor(t,e,r){super(t.length+e+r.length,t.height+r.height,e|(t.outdated||r.outdated?2:0)),this.left=t,this.right=r,this.size=t.size+r.size}get break(){return 1&this.flags}blockAt(t,e,r,i){var n=r+this.left.height;return t<n?this.left.blockAt(t,e,r,i):this.right.blockAt(t,e,n,i+this.left.length+this.break)}lineAt(t,e,r,i,n){var s=i+this.left.height,o=n+this.left.length+this.break,h=e==d.ByHeight?t<s:t<o,t=h?this.left.lineAt(t,e,r,i,n):this.right.lineAt(t,e,r,s,o),e;return this.break||(h?t.to<o:t.from>o)?t:(e=e==d.ByPosNoHeight?d.ByPosNoHeight:d.ByPos,h?t.join(this.right.lineAt(o,e,r,s,o)):this.left.lineAt(o,e,r,i,n).join(t))}forEachLine(t,e,r,i,n,s){var o=i+this.left.height,h=n+this.left.length+this.break,a;this.break?(t<h&&this.left.forEachLine(t,e,r,i,n,s),h<=e&&this.right.forEachLine(t,e,r,o,h,s)):(t<(a=this.lineAt(h,d.ByPos,r,i,n)).from&&this.left.forEachLine(t,a.from-1,r,i,n,s),a.to>=t&&a.from<=e&&s(a),e>a.to&&this.right.forEachLine(a.to+1,e,r,o,h,s))}replace(t,e,r){var i=this.left.length+this.break;if(e<i)return this.balanced(this.left.replace(t,e,r),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-i,e-i,r));var n=[],i=(0<t&&this.decomposeLeft(t,n),n.length),s,r;for(s of r)n.push(s);return 0<t&&ns(n,i-1),e<this.length&&(r=n.length,this.decomposeRight(e,n),ns(n,r)),Yn.of(n)}decomposeLeft(t,e){let r=this.left.length;if(t<=r)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&t>=++r&&e.push(null),t>r&&this.right.decomposeLeft(t-r,e)}decomposeRight(t,e){var r=this.left.length,i=r+this.break;if(i<=t)return this.right.decomposeRight(t-i,e);t<r&&this.left.decomposeRight(t,e),this.break&&t<i&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?Yn.of(this.break?[t,null,e]:[t,e]):(this.left=t,this.right=e,this.height=t.height+e.height,this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,r=!1,i){let{left:n,right:s}=this,o=e+n.length+this.break,h=null;return i&&i.from<=e+n.length&&i.more?h=n=n.updateHeight(t,e,r,i):n.updateHeight(t,e,r),i&&i.from<=o+s.length&&i.more?h=s=s.updateHeight(t,o,r,i):s.updateHeight(t,o,r),h?this.balanced(n,s):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function ns(t,e){let r,i;null==t[e]&&(r=t[e-1])instanceof rs&&(i=t[e+1])instanceof rs&&t.splice(e-1,3,new rs(r.length+1+i.length))}const ss=5;class os{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){var r,i;-1<this.lineStart&&(r=Math.min(e,this.lineEnd),(i=this.nodes[this.nodes.length-1])instanceof es?i.length+=r-this.pos:(r>this.pos||!this.isCovered)&&this.nodes.push(new es(r-this.pos,-1)),(this.writtenTo=r)<e)&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1),this.pos=e}point(e,r,i){if(e<r||i.heightRelevant){let t=i.widget?i.widget.estimatedHeight:0;t<0&&(t=this.oracle.lineHeight);var n=r-e;i.block?this.addBlock(new ts(n,t,i)):(n||5<=t)&&this.addLineDeco(t,n)}else e<r&&this.span(e,r);-1<this.lineEnd&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){var t,e;-1<this.lineStart||({from:t,to:e}=this.oracle.doc.lineAt(this.pos),this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new es(this.pos-t,-1)),this.writtenTo=this.pos)}blankContent(t,e){var r=new rs(e-t);return this.oracle.doc.lineAt(t).to==e&&(r.flags|=4),r}ensureLine(){this.enterLine();var t=this.nodes.length?this.nodes[this.nodes.length-1]:null,t;return t instanceof es||(t=new es(0,-1),this.nodes.push(t)),t}addBlock(t){var e,e=(this.enterLine(),null==(e=t.deco)?void 0:e.type);e!=k.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,e!=k.WidgetBefore&&(this.covering=t)}addLineDeco(t,e){var r=this.ensureLine();r.length+=e,r.collapsed+=e,r.widgetHeight=Math.max(r.widgetHeight,t),this.writtenTo=this.pos=this.pos+e}finish(t){var e=0==this.nodes.length?null:this.nodes[this.nodes.length-1],r;!(-1<this.lineStart)||e instanceof es||this.isCovered?(this.writtenTo<this.pos||null==e)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new es(0,-1));let i=t;for(r of this.nodes)r instanceof es&&r.updateHeight(this.oracle,i),i+=r?r.length:1;return this.nodes}static build(t,e,r,i){var t=new os(r,t);return S.spans(e,r,i,t,0),t.finish(r)}}function hs(t,e,r){var i=new as;return S.compare(t,e,r,i,0),i.changes}class as{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,r,i){(t<e||r&&r.heightRelevant||i&&i.heightRelevant)&&Hr(t,e,this.changes,5)}}function us(e,t){var r=e.getBoundingClientRect(),i=e.ownerDocument,n=i.defaultView||window;let s=Math.max(0,r.left),o=Math.min(n.innerWidth,r.right),h=Math.max(0,r.top),a=Math.min(n.innerHeight,r.bottom);for(let t=e.parentNode;t&&t!=i.body;)if(1==t.nodeType){var u=t,l=window.getComputedStyle(u),c;(u.scrollHeight>u.clientHeight||u.scrollWidth>u.clientWidth)&&"visible"!=l.overflow&&(c=u.getBoundingClientRect(),s=Math.max(s,c.left),o=Math.min(o,c.right),h=Math.max(h,c.top),a=t==e.parentNode?c.bottom:Math.min(a,c.bottom)),t="absolute"==l.position||"fixed"==l.position?u.offsetParent:u.parentNode}else{if(11!=t.nodeType)break;t=t.host}return{left:s-r.left,right:Math.max(s,o)-r.left,top:h-(r.top+t),bottom:Math.max(h,a)-(r.top+t)}}function ls(t,e){var t=t.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}class cs{constructor(t,e,r){this.from=t,this.to=e,this.size=r}static same(e,r){if(e.length!=r.length)return!1;for(let t=0;t<e.length;t++){var i=e[t],n=r[t];if(i.from!=n.from||i.to!=n.to||i.size!=n.size)return!1}return!0}draw(t){return j.replace({widget:new fs(this.size,t)}).range(this.from,this.to)}}class fs extends Tr{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){var t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class ds{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scaler=bs,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=y.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;var e=t.facet(li).some(t=>"function"!=typeof t&&"cm-lineWrapping"==t.class);this.heightOracle=new Kn(e),this.stateDeco=t.facet(ci).filter(t=>"function"!=typeof t),this.heightMap=Yn.empty().applyChanges(this.stateDeco,g.empty,this.heightOracle.setDoc(t.doc),[new pi(0,0,0,t.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=j.set(this.lineGaps.map(t=>t.draw(!1))),this.computeVisibleRanges()}updateForViewport(){var e=[this.viewport],{main:i}=this.state.selection,n,s;for(let t=0;t<=1;t++){let r=t?i.head:i.anchor;e.some(({from:t,to:e})=>r>=t&&r<=e)||({from:n,to:s}=this.lineBlockAt(r),e.push(new vs(n,s)))}this.viewports=e.sort((t,e)=>t.from-e.from),this.scaler=this.heightMap.height<=7e6?bs:new ks(this.heightOracle,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,t=>{this.viewportLines.push(1==this.scaler.scale?t:ys(t,this.scaler))})}update(t,e=null){this.state=t.state;var r=this.stateDeco,i=(this.stateDeco=this.state.facet(ci).filter(t=>"function"!=typeof t),t.changedRanges),i=pi.extendWithRanges(i,hs(r,this.stateDeco,t?t.changes:v.empty(this.state.doc.length))),r=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,t.startState.doc,this.heightOracle.setDoc(this.state.doc),i),this.heightMap.height!=r&&(t.flags|=2);let n=i.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<n.from||e.range.head>n.to)||!this.viewportIsAppropriate(n))&&(n=this.getViewport(0,e));var r=!t.changes.empty||2&t.flags||n.from!=this.viewport.from||n.to!=this.viewport.to;this.viewport=n,this.updateForViewport(),r&&this.updateViewportLines(),(this.lineGaps.length||4e3<this.viewport.to-this.viewport.from)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&!t.state.facet(ei)&&(this.mustEnforceCursorAssoc=!0)}measure(t){var e=t.contentDOM,r=window.getComputedStyle(e),i=this.heightOracle,n=r.whiteSpace;this.defaultTextDirection="rtl"==r.direction?y.RTL:y.LTR;let s=this.heightOracle.mustRefreshForWrapping(n);var o=e.getBoundingClientRect();let h=s||this.mustMeasureContent||this.contentDOMHeight!=o.height,a=(this.contentDOMHeight=o.height,this.mustMeasureContent=!1,0),u=0;var l=parseInt(r.paddingTop)||0,r=parseInt(r.paddingBottom)||0,l=(this.paddingTop==l&&this.paddingBottom==r||(this.paddingTop=l,this.paddingBottom=r,a|=10),this.editorWidth!=t.scrollDOM.clientWidth&&(i.lineWrapping&&(h=!0),this.editorWidth=t.scrollDOM.clientWidth,a|=8),(this.printing?ls:us)(e,this.paddingTop)),r=l.top-this.pixelViewport.top,e=l.bottom-this.pixelViewport.bottom,l=(this.pixelViewport=l,this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left);if(l!=this.inView&&(this.inView=l)&&(h=!0),!this.inView&&!this.scrollTarget)return 0;var l=o.width;if(this.contentDOMWidth==l&&this.editorHeight==t.scrollDOM.clientHeight||(this.contentDOMWidth=o.width,this.editorHeight=t.scrollDOM.clientHeight,a|=8),h){var c=t.docView.measureVisibleLineHeights(this.viewport),o,f,d,v;((s=i.mustRefreshForHeights(c)?!0:s)||i.lineWrapping&&Math.abs(l-this.contentDOMWidth)>i.charWidth)&&({lineHeight:o,charWidth:f,textHeight:d}=t.docView.measureTextSize(),s=0<o&&i.refresh(n,o,f,d,l/f,c))&&(t.docView.minWidth=0,a|=8),0<r&&0<e?u=Math.max(r,e):r<0&&e<0&&(u=Math.min(r,e)),i.heightChanged=!1;for(v of this.viewports){var m=v.from==this.viewport.from?c:t.docView.measureVisibleLineHeights(v);this.heightMap=(s?Yn.empty().applyChanges(this.stateDeco,g.empty,this.heightOracle,[new pi(0,0,0,t.state.doc.length)]):this.heightMap).updateHeight(i,0,s,new Qn(v.from,m))}i.heightChanged&&(a|=2)}var n=!this.viewportIsAppropriate(this.viewport,u)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return n&&(this.viewport=this.getViewport(u,this.scrollTarget)),this.updateForViewport(),(2&a||n)&&this.updateViewportLines(),(this.lineGaps.length||4e3<this.viewport.to-this.viewport.from)&&this.updateLineGaps(this.ensureLineGaps(s?[]:this.lineGaps,t)),a|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),a}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,r){var t=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),i=this.heightMap,n=this.heightOracle,{visibleTop:s,visibleBottom:o}=this;let h=new vs(i.lineAt(s-1e3*t,d.ByHeight,n,0,0).from,i.lineAt(o+1e3*(1-t),d.ByHeight,n,0,0).to);if(r){var{head:s}=r.range;if(s<h.from||s>h.to){var o=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top);let t=i.lineAt(s,d.ByPos,n,0,0),e;e="center"==r.y?(t.top+t.bottom)/2-o/2:"start"==r.y||"nearest"==r.y&&s<h.from?t.top:t.bottom-o,h=new vs(i.lineAt(e-500,d.ByHeight,n,0,0).from,i.lineAt(e+o+500,d.ByHeight,n,0,0).to)}}return h}mapViewport(t,e){var r=e.mapPos(t.from,-1),e=e.mapPos(t.to,1);return new vs(this.heightMap.lineAt(r,d.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(e,d.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:t,to:e},r=0){var i,n,s,o;return!this.inView||({top:i}=this.heightMap.lineAt(t,d.ByPos,this.heightOracle,0,0),{bottom:n}=this.heightMap.lineAt(e,d.ByPos,this.heightOracle,0,0),{visibleTop:s,visibleBottom:o}=this,(0==t||i<=s-Math.max(10,Math.min(-r,250)))&&(e==this.state.doc.length||n>=o+Math.max(10,Math.min(r,250)))&&s-2e3<i&&n<o+2e3)}mapLineGaps(t,e){if(!t.length||e.empty)return t;var r=[],i;for(i of t)e.touchesRange(i.from,i.to)||r.push(new cs(e.mapPos(i.from),e.mapPos(i.to),i.size));return r}ensureLineGaps(u,l){let c=this.heightOracle.lineWrapping,n=c?1e4:2e3,f=n>>1,t=n<<1;if(this.defaultTextDirection!=y.LTR&&!c)return[];let d=[],v=(i,n,s,o)=>{if(!(n-i<f)){let t=this.state.selection.main,r=[t.from];t.empty||r.push(t.to);for(var h of r)if(h>i&&h<n)return v(i,h-10,s,o),void v(h+10,n,s,o);let e=ws(u,e=>e.from>=s.from&&e.to<=s.to&&Math.abs(e.from-i)<f&&Math.abs(e.to-n)<f&&!r.some(t=>e.from<t&&e.to>t));var a;e||(n<s.to&&l&&c&&l.visibleRanges.some(t=>t.from<=n&&t.to>=n)&&(a=l.moveToLineBoundary(b.cursor(n),!1,!0).head,i<a)&&(n=a),e=new cs(i,n,this.gapSize(s,i,n,o))),d.push(e)}};for(var s of this.viewportLines)if(!(s.length<t)){var o=ms(s.from,s.to,this.stateDeco);if(!(o.total<t)){var h=this.scrollTarget?this.scrollTarget.range.head:null;let r,i;if(c){var a=n/this.heightOracle.lineLength*this.heightOracle.lineHeight,m,p;let t,e;e=null!=h?(m=gs(o,h),p=((this.visibleBottom-this.visibleTop)/2+a)/s.height,t=m-p,m+p):(t=(this.visibleTop-s.top-a)/s.height,(this.visibleBottom-s.top+a)/s.height),r=ps(o,t),i=ps(o,e)}else{var m=o.total*this.heightOracle.charWidth,p=n*this.heightOracle.charWidth,a,h;let t,e;e=null!=h?(a=gs(o,h),h=((this.pixelViewport.right-this.pixelViewport.left)/2+p)/m,t=a-h,a+h):(t=(this.pixelViewport.left-p)/m,(this.pixelViewport.right+p)/m),r=ps(o,t),i=ps(o,e)}r>s.from&&v(s.from,r,s,o),i<s.to&&v(i,s.to,s,o)}}return d}gapSize(t,e,r,i){var r=gs(i,r)-gs(i,e);return this.heightOracle.lineWrapping?t.height*r:i.total*this.heightOracle.charWidth*r}updateLineGaps(t){cs.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=j.set(t.map(t=>t.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let t=this.stateDeco,r=(this.lineGaps.length&&(t=t.concat(this.lineGapDeco)),[]);S.spans(t,this.viewport.from,this.viewport.to,{span(t,e){r.push({from:t,to:e})},point(){}},20);var e=r.length!=this.visibleRanges.length||this.visibleRanges.some((t,e)=>t.from!=r[e].from||t.to!=r[e].to);return this.visibleRanges=r,e?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||ys(this.heightMap.lineAt(e,d.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(t){return ys(this.heightMap.lineAt(this.scaler.fromDOM(t),d.ByHeight,this.heightOracle,0,0),this.scaler)}elementAtHeight(t){return ys(this.heightMap.blockAt(this.scaler.fromDOM(t),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class vs{constructor(t,e){this.from=t,this.to=e}}function ms(t,e,r){let i=[],n=t,s=0;return S.spans(r,t,e,{span(){},point(t,e){t>n&&(i.push({from:n,to:t}),s+=t-n),n=e}},20),n<e&&(i.push({from:n,to:e}),s+=e-n),{total:s,ranges:i}}function ps({total:t,ranges:e},r){if(r<=0)return e[0].from;if(1<=r)return e[e.length-1].to;let i=Math.floor(t*r);for(let t=0;;t++){var{from:n,to:s}=e[t],s=s-n;if(i<=s)return n+i;i-=s}}function gs(t,e){let r=0;for(var{from:i,to:n}of t.ranges){if(e<=n){r+=e-i;break}r+=n-i}return r/t.total}function ws(t,e){for(var r of t)if(e(r))return r}const bs={toDOM(t){return t},fromDOM(t){return t},scale:1};class ks{constructor(n,s,t){let o=0,e=0,r=0;this.viewports=t.map(({from:t,to:e})=>{var r=s.lineAt(t,d.ByPos,n,0,0).top,i=s.lineAt(e,d.ByPos,n,0,0).bottom;return o+=i-r,{from:t,to:e,top:r,bottom:i,domTop:0,domBottom:0}}),this.scale=(7e6-o)/(s.height-o);for(var i of this.viewports)i.domTop=r+(i.top-e)*this.scale,r=i.domBottom=i.domTop+(i.bottom-i.top),e=i.bottom}toDOM(i){for(let t=0,e=0,r=0;;t++){var n=t<this.viewports.length?this.viewports[t]:null;if(!n||i<n.top)return r+(i-e)*this.scale;if(i<=n.bottom)return n.domTop+(i-n.top);e=n.bottom,r=n.domBottom}}fromDOM(i){for(let t=0,e=0,r=0;;t++){var n=t<this.viewports.length?this.viewports[t]:null;if(!n||i<n.domTop)return e+(i-r)/this.scale;if(i<=n.domBottom)return n.top+(i-n.domTop);e=n.bottom,r=n.domBottom}}}function ys(t,e){var r,i;return 1==e.scale?t:(r=e.toDOM(t.top),i=e.toDOM(t.bottom),new Xn(t.from,t.length,r,i-r,t.children&&t.children.map(t=>ys(t,e)),t.deco))}const Ms=m.define({combine:t=>t.join(" ")}),xs=m.define({combine:t=>-1<t.indexOf(!0)}),Cs=Ie.newName(),Ss=Ie.newName(),Ps=Ie.newName(),js={"&light":"."+Ss,"&dark":"."+Ps};function Os(e,t,r){return new Ie(t,{finish(t){return/&/.test(t)?t.replace(/&\w*/,t=>{if("&"==t)return e;if(r&&r[t])return r[t];throw new RangeError("Unsupported selector: "+t)}):e+" "+t}})}const Es=Os("."+Cs,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace:before":{content:"attr(data-display)",position:"absolute",pointerEvents:"none",color:"#888"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},js);class Ds{constructor(t,e,r,i){this.typeOver=i,this.bounds=null,this.text="";var{impreciseHead:i,impreciseAnchor:n}=t.docView,e,r,r,e,i;t.state.readOnly&&-1<e?this.newSel=null:-1<e&&(this.bounds=t.docView.domBoundsAround(e,r,0))?(e=i||n?[]:Is(t),(r=new Ti(e,t.state)).readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=r.text,this.newSel=Ls(e,this.bounds.from)):(r=t.observer.selectionRange,e=i&&i.node==r.focusNode&&i.offset==r.focusOffset||!Fe(t.contentDOM,r.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(r.focusNode,r.focusOffset),i=n&&n.node==r.anchorNode&&n.offset==r.anchorOffset||!Fe(t.contentDOM,r.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(r.anchorNode,r.anchorOffset),this.newSel=b.single(i,e))}}function As(l,r){let c,{newSel:i}=r,f=l.state.selection.main;var n=l.inputState.lastKeyTime>Date.now()-100?l.inputState.lastKeyCode:-1;if(r.bounds){var{from:s,to:o}=r.bounds;let t=f.from,e=null;(8===n||p.android&&r.text.length<o-s)&&(t=f.to,e="end");var o=Rs(l.state.doc.sliceString(s,o,Li),r.text,t-s,e);o&&(p.chrome&&13==n&&o.toB==o.from+2&&"\uffff\uffff"==r.text.slice(o.from,o.toB)&&o.toB--,c={from:s+o.from,to:s+o.toA,insert:g.of(r.text.slice(o.from,o.toB).split(Li))})}else i&&(!l.hasFocus&&l.state.facet(si)||i.main.eq(f))&&(i=null);if(!c&&!i)return!1;if(!c&&r.typeOver&&!f.empty&&i&&i.main.empty?c={from:f.from,to:f.to,insert:l.state.doc.slice(f.from,f.to)}:c&&c.from>=f.from&&c.to<=f.to&&(c.from!=f.from||c.to!=f.to)&&f.to-f.from-(c.to-c.from)<=4?c={from:f.from,to:f.to,insert:l.state.doc.slice(f.from,c.from).append(c.insert).append(l.state.doc.slice(c.to,f.to))}:(p.mac||p.android)&&c&&c.from==c.to&&c.from==f.head-1&&/^\. ?$/.test(c.insert.toString())&&"off"==l.contentDOM.getAttribute("autocorrect")?(i&&2==c.insert.length&&(i=b.single(i.main.anchor-1,i.main.head-1)),c={from:f.from,to:f.to,insert:g.of([" "])}):p.chrome&&c&&c.from==c.to&&c.from==f.head&&"\n "==c.insert.toString()&&l.lineWrapping&&(i=i&&b.single(i.main.anchor-1,i.main.head-1),c={from:f.from,to:f.to,insert:g.of([" "])}),c){let u=l.state;if((!p.ios||!l.inputState.flushIOSKey(l))&&(!p.android||!(c.from==f.from&&c.to==f.to&&1==c.insert.length&&2==c.insert.lines&&er(l.contentDOM,"Enter",13)||(c.from==f.from-1&&c.to==f.to&&0==c.insert.length||8==n&&c.insert.length<c.to-c.from)&&er(l.contentDOM,"Backspace",8)||c.from==f.from&&c.to==f.to+1&&0==c.insert.length&&er(l.contentDOM,"Delete",46)))){let e=c.insert.toString();if(!l.state.facet(Zr).some(t=>t(l,c.from,c.to,e))){0<=l.inputState.composing&&l.inputState.composing++;let t;if(c.from>=f.from&&c.to<=f.to&&c.to-c.from>=(f.to-f.from)/3&&(!i||i.main.empty&&i.main.from==c.from+c.insert.length)&&l.inputState.composing<0){var s=f.from<c.from?u.sliceDoc(f.from,c.from):"",o=f.to>c.to?u.sliceDoc(c.to,f.to):"";t=u.replaceSelection(l.state.toText(s+c.insert.sliceString(0,void 0,l.state.lineBreak)+o))}else{let h=u.changes(c),a=i&&i.main.to<=h.newLength?i.main:void 0;if(1<u.selection.ranges.length&&0<=l.inputState.composing&&c.to<=f.to&&c.to>=f.to-10){let i=l.state.sliceDoc(c.from,c.to),n=Hi(l)||l.state.doc.lineAt(f.head),s=f.to-c.to,o=f.to-f.from;t=u.changeByRange(t=>{var e,r,r,e;return t.from==f.from&&t.to==f.to?{changes:h,range:a||t.map(h)}:(r=(e=t.to-s)-i.length,t.to-t.from!=o||l.state.sliceDoc(r,e)!=i||n&&t.to>=n.from&&t.from<=n.to?{range:t}:(r=u.changes({from:r,to:e,insert:c.insert}),e=t.to-f.to,{changes:r,range:a?b.range(Math.max(0,a.anchor+e),Math.max(0,a.head+e)):t.map(r)}))})}else t={changes:h,selection:a&&u.selection.replaceRange(a)}}let e="input.type";(l.composing||l.inputState.compositionPendingChange&&l.inputState.compositionEndedAt>Date.now()-50)&&(l.inputState.compositionPendingChange=!1,e+=".compose",l.inputState.compositionFirstChange)&&(e+=".start",l.inputState.compositionFirstChange=!1),l.dispatch(t,{scrollIntoView:!0,userEvent:e})}}return!0}if(!i||i.main.eq(f))return!1;{let t=!1,e="select";return l.inputState.lastSelectionTime>Date.now()-50&&("select"==l.inputState.lastSelectionOrigin&&(t=!0),e=l.inputState.lastSelectionOrigin),l.dispatch({selection:i,scrollIntoView:t,userEvent:e}),!0}}function Rs(t,e,r,i){var n=Math.min(t.length,e.length),i,i,i;let s=0;for(;s<n&&t.charCodeAt(s)==e.charCodeAt(s);)s++;if(s==n&&t.length==e.length)return null;let o=t.length,h=e.length;for(;0<o&&0<h&&t.charCodeAt(o-1)==e.charCodeAt(h-1);)o--,h--;return"end"==i&&(i=Math.max(0,s-Math.min(o,h)),r-=o+i-s),o<s&&t.length<e.length?(i=r<=s&&r>=o?s-r:0,s-=i,h=s+(h-o),o=s):h<s&&(i=r<=s&&r>=h?s-r:0,s-=i,o=s+(o-h),h=s),{from:s,toA:o,toB:h}}function Is(t){var e=[],t,r,i,n;return t.root.activeElement==t.contentDOM&&({anchorNode:t,anchorOffset:r,focusNode:i,focusOffset:n}=t.observer.selectionRange,t)&&(e.push(new _i(t,r)),i==t&&n==r||e.push(new _i(i,n))),e}function Ls(t,e){var r,t;return 0!=t.length&&(r=t[0].pos,t=2==t.length?t[1].pos:r,-1<r)&&-1<t?b.single(r+e,t+e):null}const Ts={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Bs=p.ie&&p.ie_version<=11;class _s{constructor(r){this.view=r,this.active=!1,this.selectionRange=new Qe,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.resizeContent=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=r.contentDOM,this.observer=new MutationObserver(t=>{for(var e of t)this.queue.push(e);(p.ie&&p.ie_version<=11||p.ios&&r.composing)&&t.some(t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length)?this.flushSoon():this.flush()}),Bs&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),"function"==typeof ResizeObserver&&(this.resizeScroll=new ResizeObserver(()=>{var t;(null==(t=this.view.docView)?void 0:t.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(r.scrollDOM),this.resizeContent=new ResizeObserver(()=>this.view.requestMeasure()),this.resizeContent.observe(r.contentDOM)),this.addWindowListeners(this.win=r.win),this.start(),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver(t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),0<t.length&&0<t[t.length-1].intersectionRatio!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView)&&this.onScrollChanged(document.createEvent("Event"))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(t=>{0<t.length&&0<t[t.length-1].intersectionRatio&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(t){this.view.inputState.runScrollHandlers(this.view,t),this.intersecting&&this.view.measure()}onScroll(t){this.intersecting&&this.flush(!1),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(r){if(this.gapIntersection&&(r.length!=this.gaps.length||this.gaps.some((t,e)=>t!=r[e]))){this.gapIntersection.disconnect();for(var t of r)this.gapIntersection.observe(t);this.gaps=r}}onSelectionChange(t){var e=this.selectionChanged,r,i,n;this.readSelectionRange()&&!this.delayedAndroidKey&&({view:r}=this,i=this.selectionRange,r.state.facet(si)?r.root.activeElement==this.dom:$e(r.dom,i))&&((n=i.anchorNode&&r.docView.nearest(i.anchorNode))&&n.ignoreEvent(t)?e||(this.selectionChanged=!1):(p.ie&&p.ie_version<=11||p.android&&p.chrome)&&!r.state.selection.main.empty&&i.focusNode&&Ue(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){var{view:t}=this,e=p.safari&&11==t.root.nodeType&&Ne(this.dom.ownerDocument)==this.dom&&Ns(this.view)||_e(t.root),r;return!(!e||this.selectionRange.eq(e)||((r=$e(this.dom,e))&&!this.selectionChanged&&t.inputState.lastFocusTime>Date.now()-200&&t.inputState.lastTouchTime<Date.now()-300&&nr(this.dom,e)?(this.view.inputState.lastFocusTime=0,t.docView.updateSelection(),1):(this.selectionRange.setRange(e),r&&(this.selectionChanged=!0),0)))}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,r=null;for(let t=this.dom;t;)if(1==t.nodeType)!r&&e<this.scrollTargets.length&&this.scrollTargets[e]==t?e++:r=r||this.scrollTargets.slice(0,e),r&&r.push(t),t=t.assignedSlot||t.parentNode;else{if(11!=t.nodeType)break;t=t.host}if(r=e<this.scrollTargets.length&&!r?this.scrollTargets.slice(0,e):r){for(var t of this.scrollTargets)t.removeEventListener("scroll",this.onScroll);for(var i of this.scrollTargets=r)i.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Ts),Bs&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Bs)&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData)}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){var t,r;this.delayedAndroidKey||(this.flushingAndroidKey=this.view.win.requestAnimationFrame(()=>{var t=this.delayedAndroidKey,e;t&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=t.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush())&&t.force&&er(this.dom,t.key,t.keyCode)})),this.delayedAndroidKey&&"Enter"!=t||(this.delayedAndroidKey={key:t,keyCode:e,force:this.lastChange<Date.now()-50||!(null==(t=this.delayedAndroidKey)||!t.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){0<=this.delayedFlush&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(var t of this.observer.takeRecords())this.queue.push(t);return this.queue}processRecords(){var t=this.pendingRecords(),e;t.length&&(this.queue=[]);let r=-1,i=-1,n=!1;for(e of t){var s=this.readMutation(e);s&&(s.typeOver&&(n=!0),-1==r?{from:r,to:i}=s:(r=Math.min(s.from,r),i=Math.max(s.to,i)))}return{from:r,to:i,typeOver:n}}readChange(){var{from:t,to:e,typeOver:r}=this.processRecords(),i=this.selectionChanged&&$e(this.dom,this.selectionRange);return t<0&&!i?null:(-1<t&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1,new Ds(this.view,t,e,r))}flush(t=!0){if(0<=this.delayedFlush||this.delayedAndroidKey)return!1;t&&this.readSelectionRange();var t=this.readChange(),e,t;return!!t&&(e=this.view.state,t=As(this.view,t),this.view.state==e&&this.view.update([]),t)}readMutation(t){var e=this.view.docView.nearest(t.target),r,i;return!e||e.ignoreMutation(t)?null:(e.markDirty("attributes"==t.type),"attributes"==t.type&&(e.dirty|=4),"childList"==t.type?(r=Fs(e,t.previousSibling||t.target.previousSibling,-1),i=Fs(e,t.nextSibling||t.target.nextSibling,1),{from:r?e.posAfter(r):e.posAtStart,to:i?e.posBefore(i):e.posAtEnd,typeOver:!1}):"characterData"==t.type?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null)}setWindow(t){t!=this.win&&(this.removeWindowListeners(this.win),this.win=t,this.addWindowListeners(this.win))}addWindowListeners(t){t.addEventListener("resize",this.onResize),t.addEventListener("beforeprint",this.onPrint),t.addEventListener("scroll",this.onScroll),t.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(t){t.removeEventListener("scroll",this.onScroll),t.removeEventListener("resize",this.onResize),t.removeEventListener("beforeprint",this.onPrint),t.document.removeEventListener("selectionchange",this.onSelectionChange)}destroy(){var t,t,t,t,e;this.stop(),null!=(t=this.intersection)&&t.disconnect(),null!=(t=this.gapIntersection)&&t.disconnect(),null!=(t=this.resizeScroll)&&t.disconnect(),null!=(t=this.resizeContent)&&t.disconnect();for(e of this.scrollTargets)e.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey)}}function Fs(t,e,r){for(;e;){var i=P.get(e);if(i&&i.parent==t)return i;var i=e.parentNode;e=i!=t.dom?i:0<r?e.nextSibling:e.previousSibling}return null}function Ns(t){let e=null;function r(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",r,!0),t.dom.ownerDocument.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",r,!0),!e)return null;let i=e.startContainer,n=e.startOffset,s=e.endContainer,o=e.endOffset;var t=t.docView.domAtPos(t.state.selection.main.anchor);return Ue(t.node,t.offset,s,o)&&([i,n,s,o]=[s,o,i,n]),{anchorNode:i,anchorOffset:n,focusNode:s,focusOffset:o}}class E{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return 0<this.inputState.composing}get compositionStarted(){return 0<=this.inputState.composing}get root(){return this.Nkt}get win(){return this.dom.ownerDocument.defaultView||window}constructor(t={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: fixed; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this.hue=t.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.Nkt=t.root||rr(t.parent)||document,this.viewState=new ds(t.state||C.create(t)),this.plugins=this.state.facet(hi).map(t=>new ai(t));for(var e of this.plugins)e.update(this);this.observer=new _s(this),this.inputState=new vn(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new Fi(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),t.parent&&t.parent.appendChild(this.dom)}dispatch(...t){var t=1==t.length&&t[0]instanceof a?t[0]:this.state.update(...t);this.hue(t,this)}update(o){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let h=!1,a=!1,u,l=this.state;for(var t of o){if(t.startState!=l)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");l=t.state}if(this.destroyed)this.viewState.state=l;else{let t=this.hasFocus,e=0,r=null,i=(o.some(t=>t.annotation(Vn))?(this.inputState.notifiedFocused=t,e=1):t==this.inputState.notifiedFocused||(this.inputState.notifiedFocused=t,r=qn(l,t))||(e=1),this.observer.delayedAndroidKey),n=null;if(i?(this.observer.clearDelayedAndroidKey(),(!(n=this.observer.readChange())||this.state.doc.eq(l.doc))&&this.state.selection.eq(l.selection)||(n=null)):this.observer.clear(),l.facet(C.phrases)!=this.state.facet(C.phrases))return this.setState(l);(u=gi.create(this,l,o)).flags|=e;let s=this.viewState.scrollTarget;try{this.updateState=2;for(var c of o){var f,d;s=s&&s.map(c.changes),c.scrollIntoView&&({main:f}=c.state.selection,s=new ri(f.empty?f:b.cursor(f.head,f.head>f.anchor?-1:1)));for(d of c.effects)d.is(ii)&&(s=d.value)}this.viewState.update(u,s),this.bidiCache=Us.update(this.bidiCache,u.changes),u.empty||(this.updatePlugins(u),this.inputState.update(u)),h=this.docView.update(u),this.state.facet(mi)!=this.styleModules&&this.mountStyles(),a=this.updateAttrs(),this.showAnnouncements(o),this.docView.updateSelection(h,o.some(t=>t.isUserEvent("select.pointer")))}finally{this.updateState=0}if(u.startState.facet(Ms)!=u.state.facet(Ms)&&(this.viewState.mustMeasureContent=!0),(h||a||s||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!u.empty)for(var v of this.state.facet(Xr))v(u);(r||n)&&Promise.resolve().then(()=>{r&&this.state==r.startState&&this.dispatch(r),n&&!As(this,n)&&i.force&&er(this.contentDOM,i.key,i.keyCode)})}}setState(t){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)this.viewState.state=t;else{this.updateState=2;var e=this.hasFocus;try{for(var r of this.plugins)r.destroy(this);this.viewState=new ds(t),this.plugins=t.facet(hi).map(t=>new ai(t)),this.pluginMap.clear();for(var i of this.plugins)i.update(this);this.docView=new Fi(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}}updatePlugins(t){var e=t.startState.facet(hi),r=t.state.facet(hi);if(e!=r){var i=[],n,s;for(n of r){var o=e.indexOf(n),o;o<0?i.push(new ai(n)):((o=this.plugins[o]).mustUpdate=t,i.push(o))}for(s of this.plugins)s.mustUpdate!=t&&s.destroy(this);this.plugins=i,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(var h of this.plugins)h.mustUpdate=t;for(let t=0;t<this.plugins.length;t++)this.plugins[t].update(this)}measure(t=!0){if(!this.destroyed){-1<this.measureScheduled&&this.win.cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,t&&this.observer.forceFlush();let s=null;var{scrollHeight:t,scrollTop:e,clientHeight:r}=this.scrollDOM,o=t-r-4<e?t:e;try{for(let n=0;;n++){this.updateState=1;var h=this.viewport,a=this.viewState.lineBlockAtHeight(o),u=this.viewState.measure(this);if(!u&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(5<n){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let e=[];4&u||([this.measureRequests,e]=[e,this.measureRequests]);var l=e.map(t=>{try{return t.read(this)}catch(t){return ni(this.state,t),Hs}}),c;let t=gi.create(this,this.state,[]),r=!1,i=!1;t.flags|=u,s?s.flags|=u:s=t,this.updateState=2,t.empty||(this.updatePlugins(t),this.inputState.update(t),this.updateAttrs(),r=this.docView.update(t));for(let t=0;t<e.length;t++)if(l[t]!=Hs)try{var f=e[t];f.write&&f.write(l[t],this)}catch(t){ni(this.state,t)}if(this.viewState.editorHeight&&(this.viewState.scrollTarget?(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,i=!0):(1<(c=this.viewState.lineBlockAt(a.from).top-a.top)||c<-1)&&(this.scrollDOM.scrollTop+=c,i=!0)),r&&this.docView.updateSelection(!0),this.viewport.from==h.from&&this.viewport.to==h.to&&!i&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(s&&!s.empty)for(var i of this.state.facet(Xr))i(s)}}get themeClasses(){return Cs+" "+(this.state.facet(xs)?Ps:Ss)+" "+this.state.facet(Ms)}updateAttrs(){let r=zs(this,ui,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),i={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(si)?"true":"false",class:"cm-content",style:p.tabSize+": "+this.state.tabSize,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(i["aria-readonly"]="true"),zs(this,li,i);var t=this.observer.ignore(()=>{var t=Lr(this.contentDOM,this.contentAttrs,i),e=Lr(this.dom,this.editorAttrs,r);return t||e});return this.editorAttrs=r,this.contentAttrs=i,t}showAnnouncements(t){let e=!0;for(var r of t)for(var i of r.effects){var n;i.is(E.announce)&&(e&&(this.announceDOM.textContent=""),e=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=i.value)}}mountStyles(){this.styleModules=this.state.facet(mi),Ie.mount(this.root,this.styleModules.concat(Es).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&-1<this.measureScheduled&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e&&!(-1<this.measureRequests.indexOf(e))){if(null!=e.key)for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key)return void(this.measureRequests[t]=e);this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(void 0===t||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find(t=>t.spec==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,r){return dn(this,t,un(this,t,e,r))}moveByGroup(e,t){return dn(this,e,un(this,e,t,t=>ln(this,e.head,t)))}moveToLineBoundary(t,e,r=!0){return an(this,t,e,r)}moveVertically(t,e,r){return dn(this,t,cn(this,t,e,r))}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),nn(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();var r=this.docView.coordsAt(t,e),i,n,s;return r&&r.left!=r.right?(i=this.state.doc.lineAt(t),qe(r,(n=this.bidiSpans(i))[Ei.find(n,t-i.from,-1,e)].dir==y.LTR==0<e)):r}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(t){var e;return!this.state.facet(ti)||t<this.viewport.from||t>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(t))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>$s)return Ai(t.length);var e=this.textDirectionAt(t.from),r;for(r of this.bidiCache)if(r.from==t.from&&r.dir==e)return r.order;var i=Di(t.text,e);return this.bidiCache.push(new Us(t.from,t.to,e,i)),i}get hasFocus(){var t;return(this.dom.ownerDocument.hasFocus()||p.safari&&(null==(t=this.inputState)?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{Ze(this.contentDOM),this.docView.updateSelection()})}setRoot(t){this.Nkt!=t&&(this.Nkt=t,this.observer.setWindow((9==t.nodeType?t:t.ownerDocument).defaultView||window),this.mountStyles())}destroy(){for(var t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),-1<this.measureScheduled&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return ii.of(new ri("number"==typeof t?b.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}static domEventHandlers(t){return h.define(()=>({}),{eventHandlers:t})}static theme(t,e){var r=Ie.newName(),r=[Ms.of(r),mi.of(Os("."+r,t))];return e&&e.dark&&r.push(xs.of(!0)),r}static baseTheme(t){return Lt.lowest(mi.of(Os("."+Cs,t,js)))}static findFromDOM(t){var t,e=t.querySelector(".cm-content"),e=e&&P.get(e)||P.get(t);return(null==(t=null==e?void 0:e.rootView)?void 0:t.view)||null}}E.styleModule=mi,E.inputHandler=Zr,E.focusChangeEffect=Yr,E.perLineTextDirection=ti,E.exceptionSink=Qr,E.updateListener=Xr,E.editable=si,E.mouseSelectionStyle=Kr,E.dragMovesSelection=Jr,E.clickAddsSelectionRange=Gr,E.decorations=ci,E.atomicRanges=fi,E.scrollMargins=di,E.darkTheme=xs,E.contentAttributes=li,E.editorAttributes=ui,E.lineWrapping=E.contentAttributes.of({class:"cm-lineWrapping"}),E.announce=l.define();const $s=4096,Hs={};class Us{constructor(t,e,r,i){this.from=t,this.to=e,this.dir=r,this.order=i}static update(e,r){if(r.empty)return e;var i=[],n=e.length?e[e.length-1].dir:y.LTR;for(let t=Math.max(0,e.length-10);t<e.length;t++){var s=e[t];s.dir!=n||r.touchesRange(s.from,s.to)||i.push(new Us(r.mapPos(s.from,1),r.mapPos(s.to,-1),s.dir,s.order))}return i}}function zs(r,i,n){for(let t=r.state.facet(i),e=t.length-1;0<=e;e--){var s=t[e],s="function"==typeof s?s(r):s;s&&Rr(s,n)}return n}const Ws=p.mac?"mac":p.windows?"win":p.linux?"linux":"key";function Vs(t,e){var r=t.split(/-(?!$)/);let i=r[r.length-1];"Space"==i&&(i=" ");let n,s,o,h;for(let t=0;t<r.length-1;++t){var a=r[t];if(/^(cmd|meta|m)$/i.test(a))h=!0;else if(/^a(lt)?$/i.test(a))n=!0;else if(/^(c|ctrl|control)$/i.test(a))s=!0;else if(/^s(hift)?$/i.test(a))o=!0;else{if(!/^mod$/i.test(a))throw new Error("Unrecognized modifier name: "+a);"mac"==e?h=!0:s=!0}}return n&&(i="Alt-"+i),s&&(i="Ctrl-"+i),h&&(i="Meta-"+i),i=o?"Shift-"+i:i}function qs(t,e,r){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),t=!1!==r&&e.shiftKey?"Shift-"+t:t}var r=Lt.default(E.domEventHandlers({keydown(t,e){return to(Ks(e.state),t,e,"editor")}}));const Gs=m.define({enables:r}),Js=new WeakMap;function Ks(t){var t=t.facet(Gs);let e=Js.get(t);return e||Js.set(t,e=Ys(t.reduce((t,e)=>t.concat(e),[]))),e}function Qs(t,e,r){return to(Ks(t.state),e,t,r)}let Xs=null;const Zs=4e3;function Ys(t,o=Ws){let h=Object.create(null),i=Object.create(null),a=(t,e)=>{var r=i[t];if(null==r)i[t]=e;else if(r!=e)throw new Error("Key binding "+t+" is used both as a regular binding and as a multi-stroke prefix")};var e=(i,t,e,r)=>{var t,t,n=h[i]||(h[i]=Object.create(null)),s=t.split(/ (?!$)/).map(t=>Vs(t,o));for(let t=1;t<s.length;t++){let r=s.slice(0,t).join(" ");a(r,!0),n[r]||(n[r]={preventDefault:!0,run:[t=>{let e=Xs={view:t,prefix:r,scope:i};return setTimeout(()=>{Xs==e&&(Xs=null)},Zs),!0}]})}var t=s.join(" "),t=(a(t,!1),n[t]||(n[t]={preventDefault:!1,run:(null==(t=null==(t=n.$de)?void 0:t.run)?void 0:t.slice())||[]}));e&&t.run.push(e),r&&(t.preventDefault=!0)},r;for(r of t){var n=r.scope?r.scope.split(" "):["editor"];if(r.any)for(var s of n){var u=h[s]||(h[s]=Object.create(null)),l;for(l in u.$de||(u.$de={preventDefault:!1,run:[]}),u)u[l].run.push(r.any)}var c=r[o]||r.key;if(c)for(var f of n)e(f,c,r.run,r.preventDefault),r.shift&&e(f,"Shift-"+c,r.shift,r.preventDefault)}return h}function to(t,r,i,e){var n=Be(r),s,o=vt(x(n,0))==n.length&&" "!=n;let h="",a=!1,u=(Xs&&Xs.view==i&&Xs.scope==e&&(h=Xs.prefix+" ",a=gn.indexOf(r.keyCode)<0)&&(Xs=null),new Set);var l=t=>{if(t){for(var e of t.run)if(!u.has(e)&&(u.add(e),e(i,r)))return!0;t.preventDefault&&(a=!0)}return!1};let c=t[e],f,d;if(c){if(l(c[h+qs(n,r,!o)]))return!0;if(o&&(r.altKey||r.metaKey||r.ctrlKey)&&!(p.windows&&r.ctrlKey&&r.altKey)&&(f=N[r.keyCode])&&f!=n){if(l(c[h+qs(f,r,!0)]))return!0;if(r.shiftKey&&(d=$[r.keyCode])!=n&&d!=f&&l(c[h+qs(d,r,!1)]))return!0}else if(o&&r.shiftKey&&l(c[h+qs(n,r,!0)]))return!0;if(l(c.$de))return!0}return a}class eo{constructor(t,e,r,i,n){this.className=t,this.left=e,this.top=r,this.width=i,this.height=n}draw(){var t=document.createElement("div");return t.className=this.className,this.adjust(t),t}update(t,e){return e.className==this.className&&(this.adjust(t),!0)}adjust(t){t.style.left=this.left+"px",t.style.top=this.top+"px",null!=this.width&&(t.style.width=this.width+"px"),t.style.height=this.height+"px"}eq(t){return this.left==t.left&&this.top==t.top&&this.width==t.width&&this.height==t.height&&this.className==t.className}static forRange(t,e,r){var i,n;return r.empty?(i=t.coordsAtPos(r.head,r.assoc||1))?(n=ro(t),[new eo(e,i.left-n.left,i.top-n.top,null,i.bottom-i.top)]):[]:so(t,e,r)}}function ro(t){var e=t.scrollDOM.getBoundingClientRect(),r;return{left:(t.textDirection==y.LTR?e.left:e.right-t.scrollDOM.clientWidth)-t.scrollDOM.scrollLeft,top:e.top-t.scrollDOM.scrollTop}}function io(t,e,r){var e=b.cursor(e);return{from:Math.max(r.from,t.moveToLineBoundary(e,!1,!0).from),to:Math.min(r.to,t.moveToLineBoundary(e,!0,!0).from),type:k.Text}}function no(t,e){var r=t.lineBlockAt(e);if(Array.isArray(r.type))for(var i of r.type)if(i.to>e||i.to==e&&(i.to==r.to||i.type==k.Text))return i;return r}function so(p,n,t){if(t.to<=p.viewport.from||t.from>=p.viewport.to)return[];var e=Math.max(t.from,p.viewport.from),r=Math.min(t.to,p.viewport.to);let g=p.textDirection==y.LTR,i=p.contentDOM,s=i.getBoundingClientRect(),o=ro(p);var h=i.querySelector(".cm-line"),h=h&&window.getComputedStyle(h);let w=s.left+(h?parseInt(h.paddingLeft)+Math.min(0,parseInt(h.textIndent)):0),b=s.right-(h?parseInt(h.paddingRight):0);var h=no(p,e),a=no(p,r),e,r,t;let u=h.type==k.Text?h:null,l=a.type==k.Text?a:null;return p.lineWrapping&&(u=u&&io(p,e,u),l=l&&io(p,r,l)),u&&l&&u.from==l.from?f(d(t.from,t.to,u)):(e=u?d(t.from,null,u):v(h,!1),r=l?d(null,t.to,l):v(a,!0),t=[],(u||h).to<(l||a).from-(u&&l?1:0)?t.push(c(w,e.bottom,b,r.top)):e.bottom<r.top&&p.elementAtHeight((e.bottom+r.top)/2).type==k.Text&&(e.bottom=r.top=(e.bottom+r.top)/2),f(e).concat(t).concat(f(r)));function c(t,e,r,i){return new eo(n,t-o.left,e-o.top-.01,r-t,i-e+.01)}function f({top:e,bottom:r,horizontal:i}){var n=[];for(let t=0;t<i.length;t+=2)n.push(c(i[t],e,i[t+1],r));return n}function d(r,i,s){let o=1e9,h=-1e9,a=[];function n(t,e,r,i,n){var t=p.coordsAtPos(t,t==s.to?-2:2),r=p.coordsAtPos(r,r==s.from?2:-2);t&&r&&(o=Math.min(t.top,r.top,o),h=Math.max(t.bottom,r.bottom,h),n==y.LTR?a.push(g&&e?w:t.left,g&&i?b:r.right):a.push(!g&&i?w:r.left,!g&&e?b:t.right))}var u=null!=r?r:s.from,l=null!=i?i:s.to,c;for(c of p.visibleRanges)if(c.to>u&&c.from<l)for(let t=Math.max(c.from,u),e=Math.min(c.to,l);;){var f=p.state.doc.lineAt(t),d;for(d of p.bidiSpans(f)){var v=d.from+f.from,m=d.to+f.from;if(e<=v)break;m>t&&n(Math.max(v,t),null==r&&v<=u,Math.min(m,e),null==i&&l<=m,d.dir)}if((t=f.to+1)>=e)break}return 0==a.length&&n(u,null==r,l,null==i,p.textDirection),{top:o,bottom:h,horizontal:a}}function v(t,e){var e=s.top+(e?t.top:t.bottom);return{top:e,bottom:e,horizontal:[]}}}function oo(t,e){return t.constructor==e.constructor&&t.eq(e)}class ho{constructor(t,e){this.view=t,this.layer=e,this.drawn=[],this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=t.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),e.above&&this.dom.classList.add("cm-layer-above"),e.class&&this.dom.classList.add(e.class),this.dom.setAttribute("aria-hidden","true"),this.setOrder(t.state),t.requestMeasure(this.measureReq),e.mount&&e.mount(this.dom,t)}update(t){t.startState.facet(ao)!=t.state.facet(ao)&&this.setOrder(t.state),(this.layer.update(t,this.dom)||t.geometryChanged)&&t.view.requestMeasure(this.measureReq)}setOrder(t){let e=0,r=t.facet(ao);for(;e<r.length&&r[e]!=this.layer;)e++;this.dom.style.zIndex=String((this.layer.above?150:-1)-e)}measure(){return this.layer.markers(this.view)}draw(r){if(r.length!=this.drawn.length||r.some((t,e)=>!oo(t,this.drawn[e]))){let t=this.dom.firstChild,e=0;for(var i of r)i.update&&t&&i.constructor&&this.drawn[e].constructor&&i.update(t,this.drawn[e])?(t=t.nextSibling,e++):this.dom.insertBefore(i.draw(),t);for(;t;){var n=t.nextSibling;t.remove(),t=n}this.drawn=r}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const ao=m.define();function uo(e){return[h.define(t=>new ho(t,e)),ao.of(e)]}const lo=!p.ios,co=m.define({combine(t){return le(t,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(t,e)=>Math.min(t,e),drawRangeCursor:(t,e)=>t||e})}});function fo(t={}){return[co.of(t),mo,go,wo,ei.of(!0)]}function vo(t){return t.startState.facet(co)!=t.state.facet(co)}const mo=uo({above:!0,markers(t){var{state:e}=t,r=e.facet(co),i=[],n;for(n of e.selection.ranges){var s=n==e.selection.main;if(n.empty?!s||lo:r.drawRangeCursor){var s=s?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",o=n.empty?n:b.cursor(n.head,n.head>n.anchor?-1:1),h;for(h of eo.forRange(t,s,o))i.push(h)}}return i},update(t,e){t.transactions.some(t=>t.selection)&&(e.style.animationName="cm-blink"==e.style.animationName?"cm-blink2":"cm-blink");var r=vo(t);return r&&po(t.state,e),t.docChanged||t.selectionSet||r},mount(t,e){po(e.state,t)},class:"cm-cursorLayer"});function po(t,e){e.style.animationDuration=t.facet(co).cursorBlinkRate+"ms"}const go=uo({above:!1,markers(e){return e.state.selection.ranges.map(t=>t.empty?[]:eo.forRange(e,"cm-selectionBackground",t)).reduce((t,e)=>t.concat(e))},update(t,e){return t.docChanged||t.selectionSet||t.viewportChanged||vo(t)},class:"cm-selectionLayer"});var fr={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};lo&&(fr[".cm-line"].caretColor="transparent !important");const wo=Lt.highest(E.theme(fr)),bo=l.define({map(t,e){return null==t?null:e.mapPos(t)}}),ko=M.define({create(){return null},update(t,e){return null!=t&&(t=e.changes.mapPos(t)),e.effects.reduce((t,e)=>e.is(bo)?e.value:t,t)}}),yo=h.fromClass(class{constructor(t){this.view=t,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(t){var e,r=t.state.field(ko);null==r?null!=this.cursor&&(null!=(e=this.cursor)&&e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(t.startState.field(ko)!=r||t.docChanged||t.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){var t=this.view.state.field(ko),t=null!=t&&this.view.coordsAtPos(t),e;return t?(e=this.view.scrollDOM.getBoundingClientRect(),{left:t.left-e.left+this.view.scrollDOM.scrollLeft,top:t.top-e.top+this.view.scrollDOM.scrollTop,height:t.bottom-t.top}):null}drawCursor(t){this.cursor&&(t?(this.cursor.style.left=t.left+"px",this.cursor.style.top=t.top+"px",this.cursor.style.height=t.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(t){this.view.state.field(ko)!=t&&this.view.dispatch({effects:bo.of(t)})}},{eventHandlers:{dragover(t){this.setDropPos(this.view.posAtCoords({x:t.clientX,y:t.clientY}))},dragleave(t){t.target!=this.view.contentDOM&&this.view.contentDOM.contains(t.relatedTarget)||this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function Mo(){return[ko,yo]}function xo(i,n,s,o,h){n.lastIndex=0;for(let t=i.iterRange(s,o),e=s,r;!t.next().done;e+=t.value.length)if(!t.lineBreak)for(;r=n.exec(t.value);)h(e+r.index,r)}function Co(t,e){var r=t.visibleRanges;if(1==r.length&&r[0].from==t.viewport.from&&r[0].to==t.viewport.to)return r;var i=[],n,s;for({from:n,to:s}of r)n=Math.max(t.state.doc.lineAt(n).from,n-e),s=Math.min(t.state.doc.lineAt(s).to,s+e),i.length&&i[i.length-1].to>=n?i[i.length-1].to=s:i.push({from:n,to:s});return i}class So{constructor(t){const{regexp:e,decoration:n,decorate:s,boundary:r,maxLength:i=1e3}=t;if(!e.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=e,s)this.addMatch=(t,e,r,i)=>s(i,r,r+t[0].length,t,e);else if("function"==typeof n)this.addMatch=(t,e,r,i)=>{var e=n(t,e,r);e&&i(r,r+t[0].length,e)};else{if(!n)throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.addMatch=(t,e,r,i)=>i(r,r+t[0].length,n)}this.boundary=r,this.maxLength=i}createDeco(r){let t=new pe,i=t.add.bind(t);for(var{from:e,to:n}of Co(r,this.maxLength))xo(r.state.doc,this.regexp,e,n,(t,e)=>this.addMatch(e,r,t,i));return t.finish()}updateDeco(n,t){let s=1e9,o=-1;return n.docChanged&&n.changes.iterChanges((t,e,r,i)=>{i>n.view.viewport.from&&r<n.view.viewport.to&&(s=Math.min(r,s),o=Math.max(i,o))}),n.viewportChanged||1e3<o-s?this.createDeco(n.view):-1<o?this.updateRange(n.view,t.map(n.changes),s,o):t}updateRange(h,a,t,r){for(var u of h.visibleRanges){let e=Math.max(u.from,t),o=Math.min(u.to,r);if(o>e){var l=h.state.doc.lineAt(e),c=l.to<o?h.state.doc.lineAt(o):l;let r=Math.max(u.from,l.from),i=Math.min(u.to,c.to);if(this.boundary){for(;e>l.from;e--)if(this.boundary.test(l.text[e-1-l.from])){r=e;break}for(;o<c.to;o++)if(this.boundary.test(c.text[o-c.from])){i=o;break}}let n=[],t,s=(t,e,r)=>n.push(r.range(t,e));if(l==c)for(this.regexp.lastIndex=r-l.from;(t=this.regexp.exec(l.text))&&t.index<i-l.from;)this.addMatch(t,h,t.index+l.from,s);else xo(h.state.doc,this.regexp,r,i,(t,e)=>this.addMatch(e,h,t,s));a=a.update({filterFrom:r,filterTo:i,filter:(t,e)=>t<r||e>i,add:n})}}return a}}const Po=null!=/x/.unicode?"gu":"g",jo=new RegExp("[\0-\b\n-\x1f\x7f-\x9f\xad\u061c\u200b\u200e\u200f\u2028\u2029\u202d\u202e\u2066\u2067\u2069\ufeff\ufff9-\ufffc]",Po),Oo={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let Eo=null;function Do(){var t,e;return null==Eo&&"undefined"!=typeof document&&document.body&&(e=document.body.style,Eo=null!=(null!=(t=e.tabSize)?t:e.MozTabSize)),Eo}const Ao=m.define({combine(t){var t=le(t,{render:null,specialChars:jo,addSpecialChars:null});return(t.replaceTabs=!Do())&&(t.specialChars=new RegExp("\t|"+t.specialChars.source,Po)),t.addSpecialChars&&(t.specialChars=new RegExp(t.specialChars.source+"|"+t.addSpecialChars.source,Po)),t}});function Ro(t={}){return[Ao.of(t),Lo()]}let Io=null;function Lo(){return Io=Io||h.fromClass(class{constructor(t){this.view=t,this.decorations=j.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(t.state.facet(Ao)),this.decorations=this.decorator.createDeco(t)}makeDecorator(n){return new So({regexp:n.specialChars,decoration:(t,e,r)=>{var{doc:i}=e.state,t=x(t[0],0),i,e,r;return 9==t?(i=i.lineAt(r),e=e.state.tabSize,r=je(i.text,e,r-i.from),j.replace({widget:new Fo((e-r%e)*this.view.defaultCharacterWidth)})):this.decorationCache[t]||(this.decorationCache[t]=j.replace({widget:new _o(n,t)}))},boundary:n.replaceTabs?void 0:/[^]/})}update(t){var e=t.state.facet(Ao);t.startState.facet(Ao)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(t.view)):this.decorations=this.decorator.updateDeco(t,this.decorations)}},{decorations:t=>t.decorations})}const To="\u2022";function Bo(t){return 32<=t?To:10==t?"\u2424":String.fromCharCode(9216+t)}class _o extends Tr{constructor(t,e){super(),this.options=t,this.code=e}eq(t){return t.code==this.code}toDOM(t){var e=Bo(this.code),t=t.state.phrase("Control character")+" "+(Oo[this.code]||"0x"+this.code.toString(16)),r=this.options.render&&this.options.render(this.code,t,e),r;return r||((r=document.createElement("span")).textContent=e,r.title=t,r.setAttribute("aria-label",t),r.className="cm-specialChar",r)}ignoreEvent(){return!1}}class Fo extends Tr{constructor(t){super(),this.width=t}eq(t){return t.width==this.width}toDOM(){var t=document.createElement("span");return t.textContent="\t",t.className="cm-tab",t.style.width=this.width+"px",t}ignoreEvent(){return!1}}const No=h.fromClass(class{constructor(){this.height=1e3,this.attrs={style:"padding-bottom: 1000px"}}update(t){var{view:t}=t,t=t.viewState.editorHeight-t.defaultLineHeight-t.documentPadding.top-.5;t!=this.height&&(this.height=t,this.attrs={style:`padding-bottom: ${t}px`})}});function $o(){return[No,li.of(t=>{var t;return(null==(t=t.plugin(No))?void 0:t.attrs)||null})]}function Ho(){return zo}const Uo=j.line({class:"cm-activeLine"}),zo=h.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.docChanged||t.selectionSet)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=-1,r=[];for(var i of t.state.selection.ranges){var i=t.lineBlockAt(i.head);i.from>e&&(r.push(Uo.range(i.from)),e=i.from)}return j.set(r)}},{decorations:t=>t.decorations});class Wo extends Tr{constructor(t){super(),this.content=t}toDOM(){var t=document.createElement("span");return t.className="cm-placeholder",t.style.pointerEvents="none",t.appendChild("string"==typeof this.content?document.createTextNode(this.content):this.content),"string"==typeof this.content?t.setAttribute("aria-label","placeholder "+this.content):t.setAttribute("aria-hidden","true"),t}coordsAt(t){var e=t.firstChild?He(t.firstChild):[],t,e,t;return e.length?(t=window.getComputedStyle(t.parentNode),e=qe(e[0],"rtl"!=t.direction),t=parseInt(t.lineHeight),e.bottom-e.top>1.5*t?{left:e.left,right:e.right,top:e.top,bottom:e.top+t}:e):null}ignoreEvent(){return!1}}function Vo(e){return h.fromClass(class{constructor(t){this.view=t,this.placeholder=j.set([j.widget({widget:new Wo(e),side:1}).range(0)])}get decorations(){return this.view.state.doc.length?j.none:this.placeholder}},{decorations:t=>t.decorations})}const qo=2e3;function Go(e,t,r){var i=Math.min(t.line,r.line),n=Math.max(t.line,r.line),s=[];if(t.off>qo||r.off>qo||t.col<0||r.col<0){var o=Math.min(t.off,r.off),h=Math.max(t.off,r.off);for(let t=i;t<=n;t++){var a=e.doc.line(t);a.length<=h&&s.push(b.range(a.from+o,a.to+h))}}else{var u=Math.min(t.col,r.col),l=Math.max(t.col,r.col);for(let t=i;t<=n;t++){var c=e.doc.line(t),f=Oe(c.text,u,e.tabSize,!0),d;f<0?s.push(b.cursor(c.to)):(d=Oe(c.text,l,e.tabSize),s.push(b.range(c.from+f,c.from+d)))}}return s}function Jo(t,e){var r=t.coordsAtPos(t.viewport.from);return r?Math.round(Math.abs((r.left-e)/t.defaultCharacterWidth)):-1}function Ko(t,e){var r=t.posAtCoords({x:e.clientX,y:e.clientY},!1),i=t.state.doc.lineAt(r),n=r-i.from,e=n>qo?-1:n==i.length?Jo(t,e.clientX):je(i.text,t.state.tabSize,r-i.from);return{line:i.number,col:e,off:n}}function Qo(i,t){let n=Ko(i,t),s=i.state.selection;return n?{update(t){var e,e;t.docChanged&&(e=t.changes.mapPos(t.startState.doc.line(n.line).from),e=t.state.doc.lineAt(e),n={line:e.number,col:n.col,off:Math.min(n.off,e.length)},s=s.map(t.changes))},get(t,e,r){var t=Ko(i,t),t;return t&&(t=Go(i.state,n,t)).length?r?b.create(t.concat(s.ranges)):b.create(t):s}}:null}function Xo(t){let r=(null==t?void 0:t.eventFilter)||(t=>t.altKey&&0==t.button);return E.mouseSelectionStyle.of((t,e)=>r(e)?Qo(t,e):null)}const Zo={Alt:[18,t=>!!t.altKey],Control:[17,t=>!!t.ctrlKey],Shift:[16,t=>!!t.shiftKey],Meta:[91,t=>!!t.metaKey]},Yo={style:"cursor: crosshair"};function th(t={}){let[e,r]=Zo[t.key||"Alt"],i=h.fromClass(class{constructor(t){this.view=t,this.isDown=!1}set(t){this.isDown!=t&&(this.isDown=t,this.view.update([]))}},{eventHandlers:{keydown(t){this.set(t.keyCode==e||r(t))},keyup(t){t.keyCode!=e&&r(t)||this.set(!1)},mousemove(t){this.set(r(t))}}});return[i,E.contentAttributes.of(t=>{var t;return null!=(t=t.plugin(i))&&t.isDown?Yo:null})]}const eh="-10000px";class rh{constructor(t,e,r){this.facet=e,this.createTooltipView=r,this.input=t.state.facet(e),this.tooltips=this.input.filter(t=>t),this.tooltipViews=this.tooltips.map(r)}update(i){var t,e=i.state.facet(this.facet),n=e.filter(t=>t);if(e===this.input){for(var r of this.tooltipViews)r.update&&r.update(i);return!1}var s=[],o,h;for(let t=0;t<n.length;t++){let e=n[t],r=-1;if(e){for(let t=0;t<this.tooltips.length;t++){var a=this.tooltips[t];a&&a.create==e.create&&(r=t)}r<0?s[t]=this.createTooltipView(e):(o=s[t]=this.tooltipViews[r]).update&&o.update(i)}}for(h of this.tooltipViews)s.indexOf(h)<0&&(h.dom.remove(),null!=(t=h.destroy))&&t.call(h);return this.input=e,this.tooltips=n,this.tooltipViews=s,!0}}function ih(t={}){return sh.of(t)}function nh(t){var{win:t}=t;return{top:0,left:0,bottom:t.innerHeight,right:t.innerWidth}}const sh=m.define({combine:t=>{var e,e,e;return{position:p.ios?"absolute":(null==(e=t.find(t=>t.position))?void 0:e.position)||"fixed",parent:(null==(e=t.find(t=>t.parent))?void 0:e.parent)||null,tooltipSpace:(null==(e=t.find(t=>t.tooltipSpace))?void 0:e.tooltipSpace)||nh}}}),oh=new WeakMap,hh=h.fromClass(class{constructor(t){this.view=t,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;var e=t.state.facet(sh);this.position=e.position,this.parent=e.parent,this.classes=t.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new rh(t,uh,t=>this.createTooltip(t)),this.intersectionObserver="function"==typeof IntersectionObserver?new IntersectionObserver(t=>{Date.now()>this.lastTransaction-50&&0<t.length&&t[t.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),t.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(var t of this.manager.tooltipViews)this.intersectionObserver.observe(t.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(t){t.transactions.length&&(this.lastTransaction=Date.now());var e=this.manager.update(t);e&&this.observeIntersection();let r=e||t.geometryChanged;var e=t.state.facet(sh);if(e.position!=this.position){this.position=e.position;for(var i of this.manager.tooltipViews)i.dom.style.position=this.position;r=!0}if(e.parent!=this.parent){this.parent&&this.container.remove(),this.parent=e.parent,this.createContainer();for(var n of this.manager.tooltipViews)this.container.appendChild(n.dom);r=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);r&&this.maybeMeasure()}createTooltip(t){var e=t.create(this.view),t;return e.dom.classList.add("cm-tooltip"),t.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")&&((t=document.createElement("div")).className="cm-tooltip-arrow",e.dom.appendChild(t)),e.dom.style.position=this.position,e.dom.style.top=eh,this.container.appendChild(e.dom),e.mount&&e.mount(this.view),e}destroy(){var t,e,r;this.view.win.removeEventListener("resize",this.measureSoon);for(r of this.manager.tooltipViews)r.dom.remove(),null!=(t=r.destroy)&&t.call(r);null!=(e=this.intersectionObserver)&&e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){var t=this.view.dom.getBoundingClientRect();return{editor:t,parent:this.parent?this.container.getBoundingClientRect():t,pos:this.manager.tooltips.map((t,e)=>{var e=this.manager.tooltipViews[e];return e.getCoords?e.getCoords(t.pos):this.view.coordsAtPos(t.pos)}),size:this.manager.tooltipViews.map(({dom:t})=>t.getBoundingClientRect()),space:this.view.state.facet(sh).tooltipSpace(this.view)}}writeMeasure(n){var s,{editor:e,space:o}=n,h=[];for(let t=0;t<this.manager.tooltips.length;t++){var a=this.manager.tooltips[t],u=this.manager.tooltipViews[t],{dom:l}=u,c=n.pos[t],f=n.size[t];if(!c||c.bottom<=Math.max(e.top,o.top)||c.top>=Math.min(e.bottom,o.bottom)||c.right<Math.max(e.left,o.left)-.1||c.left>Math.min(e.right,o.right)+.1)l.style.top=eh;else{var d=a.arrow?u.dom.querySelector(".cm-tooltip-arrow"):null,v=d?7:0;let t=f.right-f.left,e=null!=(s=oh.get(u))?s:f.bottom-f.top;var s=u.offset||ah,m=this.view.textDirection==y.LTR,p=f.width>o.right-o.left?m?o.left:o.right-f.width:m?Math.min(c.left-(d?14:0)+s.x,o.right-t):Math.max(o.left,c.left-t+(d?14:0)-s.x);let r=!!a.above;var a=((r=!a.strictSide&&(r?c.top-(f.bottom-f.top)-s.y<o.top:c.bottom+(f.bottom-f.top)+s.y>o.bottom)&&r==o.bottom-c.bottom>c.top-o.top?!r:r)?c.top-o.top:o.bottom-c.bottom)-v;if(a<e&&!1!==u.resize){if(a<this.view.defaultLineHeight){l.style.top=eh;continue}oh.set(u,e),l.style.height=(e=a)+"px"}else l.style.height&&(l.style.height="");let i=r?c.top-e-v-s.y:c.bottom+v+s.y;var g=p+t;if(!0!==u.overlap)for(var w of h)w.left<g&&w.right>p&&w.top<i+e&&w.bottom>i&&(i=r?w.top-e-2-v:w.bottom+v+2);"absolute"==this.position?(l.style.top=i-n.parent.top+"px",l.style.left=p-n.parent.left+"px"):(l.style.top=i+"px",l.style.left=p+"px"),d&&(d.style.left=c.left+(m?s.x:-s.x)-(p+14-7)+"px"),!0!==u.overlap&&h.push({left:p,top:i,right:g,bottom:i+e}),l.classList.toggle("cm-tooltip-above",r),l.classList.toggle("cm-tooltip-below",!r),u.positioned&&u.positioned(n.space)}}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView)&&(this.inView=this.view.inView,!this.inView))for(var t of this.manager.tooltipViews)t.dom.style.top=eh}},{eventHandlers:{scroll(){this.maybeMeasure()}}});var dr=E.baseTheme({".cm-tooltip":{zIndex:100,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}});const ah={x:0,y:0},uh=m.define({enables:[hh,dr]}),lh=m.define();class ch{static create(t){return new ch(t)}constructor(t){this.view=t,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new rh(t,lh,t=>this.createHostedView(t))}createHostedView(t){var t=t.create(this.view);return t.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(t.dom),this.mounted&&t.mount&&t.mount(this.view),t}mount(t){for(var e of this.manager.tooltipViews)e.mount&&e.mount(t);this.mounted=!0}positioned(t){for(var e of this.manager.tooltipViews)e.positioned&&e.positioned(t)}update(t){this.manager.update(t)}destroy(){var t,e;for(e of this.manager.tooltipViews)null!=(t=e.destroy)&&t.call(e)}}const fh=uh.compute([lh],t=>{var t=t.facet(lh).filter(t=>t);return 0===t.length?null:{pos:Math.min(...t.map(t=>t.pos)),end:Math.max(...t.filter(t=>null!=t.end).map(t=>t.end)),create:ch.create,above:t[0].above,arrow:t.some(t=>t.arrow)}});class dh{constructor(t,e,r,i,n){this.view=t,this.source=e,this.field=r,this.setHover=i,this.hoverTime=n,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:t.dom,time:0},this.checkHover=this.checkHover.bind(this),t.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),t.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){var t;this.hoverTimeout=-1,this.active||((t=Date.now()-this.lastMove.time)<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-t):this.startHover())}startHover(){clearTimeout(this.restartTimeout);var{lastMove:t}=this;let r=this.view.contentDOM.contains(t.target)?this.view.posAtCoords(t):null;if(null!=r){var e=this.view.coordsAtPos(r);if(!(null==e||t.y<e.top||t.y>e.bottom||t.x<e.left-this.view.defaultCharacterWidth||t.x>e.right+this.view.defaultCharacterWidth)){var i=this.view.bidiSpans(this.view.state.doc.lineAt(r)).find(t=>t.from<=r&&t.to>=r),i=i&&i.dir==y.RTL?-1:1,t=this.source(this.view,r,t.x<e.left?-i:i);if(null!=t&&t.then){let e=this.pending={pos:r};t.then(t=>{this.pending==e&&(this.pending=null,t)&&this.view.dispatch({effects:this.setHover.of(t)})},t=>ni(this.view.state,t,"hover tooltip"))}else t&&this.view.dispatch({effects:this.setHover.of(t)})}}}mousemove(t){var e,e=(this.lastMove={x:t.clientX,y:t.clientY,target:t.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime)),this.active),r,e;(e&&!vh(this.lastMove.target)||this.pending)&&({pos:r}=e||this.pending,r==(e=null!=(e=null==e?void 0:e.end)?e:r)?this.view.posAtCoords(this.lastMove)!=r:!mh(this.view,r,e,t.clientX,t.clientY,6))&&(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}mouseleave(t){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1,this.active&&!vh(t.relatedTarget)&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}function vh(e){for(let t=e;t;t=t.parentNode)if(1==t.nodeType&&t.classList.contains("cm-tooltip"))return 1}function mh(t,e,r,i,n,s){var o=document.createRange(),e=t.domAtPos(e),t=t.domAtPos(r),h=(o.setEnd(t.node,t.offset),o.setStart(e.node,e.offset),o.getClientRects());o.detach();for(let t=0;t<h.length;t++){var a=h[t],u;if(Math.max(a.top-n,n-a.bottom,a.left-i,i-a.right)<=s)return 1}}function ph(e,s={}){let o=l.define(),r=M.define({create(){return null},update(t,e){if(t&&(s.hideOnChange&&(e.docChanged||e.selection)||s.hideOn&&s.hideOn(e,t)))return null;if(t&&e.docChanged){var r=e.changes.mapPos(t.pos,-1,u.TrackDel);if(null==r)return null;var i=Object.assign(Object.create(null),t);i.pos=r,null!=t.end&&(i.end=e.changes.mapPos(t.end)),t=i}for(var n of e.effects)n.is(o)&&(t=n.value),n.is(bh)&&(t=null);return t},provide:t=>lh.from(t)});return[r,h.define(t=>new dh(t,e,r,o,s.hoverTime||300)),fh]}function gh(t,e){var t=t.plugin(hh),e;return!t||(e=t.manager.tooltips.indexOf(e))<0?null:t.manager.tooltipViews[e]}function wh(t){return t.facet(lh).some(t=>t)}const bh=l.define();var cr=bh.of(null);function kh(t){var t;null!=(t=t.plugin(hh))&&t.maybeMeasure()}const yh=m.define({combine(t){let e,r;for(var i of t)e=e||i.topContainer,r=r||i.bottomContainer;return{topContainer:e,bottomContainer:r}}});function Mh(t){return t?[yh.of(t)]:[]}function xh(t,e){var t=t.plugin(Ch),e=t?t.specs.indexOf(e):-1;return-1<e?t.panels[e]:null}const Ch=h.fromClass(class{constructor(e){this.input=e.state.facet(jh),this.specs=this.input.filter(t=>t),this.panels=this.specs.map(t=>t(e));var t=e.state.facet(yh),r;this.top=new Sh(e,!0,t.topContainer),this.bottom=new Sh(e,!1,t.bottomContainer),this.top.sync(this.panels.filter(t=>t.top)),this.bottom.sync(this.panels.filter(t=>!t.top));for(r of this.panels)r.dom.classList.add("cm-panel"),r.mount&&r.mount()}update(r){var t=r.state.facet(yh),t=(this.top.container!=t.topContainer&&(this.top.sync([]),this.top=new Sh(r.view,!0,t.topContainer)),this.bottom.container!=t.bottomContainer&&(this.bottom.sync([]),this.bottom=new Sh(r.view,!1,t.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses(),r.state.facet(jh));if(t!=this.input){var t=t.filter(t=>t),i=[],n=[],s=[],o=[],h,e;for(h of t){let t=this.specs.indexOf(h),e;t<0?(e=h(r.view),o.push(e)):(e=this.panels[t]).update&&e.update(r),i.push(e),(e.top?n:s).push(e)}this.specs=t,this.panels=i,this.top.sync(n),this.bottom.sync(s);for(e of o)e.dom.classList.add("cm-panel"),e.mount&&e.mount()}else for(var a of this.panels)a.update&&a.update(r)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:e=>E.scrollMargins.of(t=>{var t=t.plugin(e);return t&&{top:t.top.scrollMargin(),bottom:t.bottom.scrollMargin()}})});class Sh{constructor(t,e,r){this.view=t,this.top=e,this.container=r,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(t){for(var e of this.panels)e.destroy&&t.indexOf(e)<0&&e.destroy();this.panels=t,this.syncDOM()}syncDOM(){if(0==this.panels.length)this.dom&&(this.dom.remove(),this.dom=void 0);else{var e,r;this.dom||(this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0",(e=this.container||this.view.dom).insertBefore(this.dom,this.top?e.firstChild:null));let t=this.dom.firstChild;for(r of this.panels)if(r.dom.parentNode==this.dom){for(;t!=r.dom;)t=Ph(t);t=t.nextSibling}else this.dom.insertBefore(r.dom,t);for(;t;)t=Ph(t)}}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(this.container&&this.classes!=this.view.themeClasses){for(var t of this.classes.split(" "))t&&this.container.classList.remove(t);for(var e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function Ph(t){var e=t.nextSibling;return t.remove(),e}const jh=m.define({enables:Ch});class Oh extends ce{compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}eq(t){return!1}destroy(t){}}Oh.prototype.elementClass="",Oh.prototype.toDOM=void 0,Oh.prototype.mapMode=u.TrackBefore,Oh.prototype.startSide=Oh.prototype.endSide=-1;const Eh=m.define(),Dh={class:"",renderEmptyElements:!(Oh.prototype.point=!0),elementStyle:"",markers:()=>S.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},Ah=m.define();function Rh(t){return[Lh(),Ah.of(Object.assign(Object.assign({},Dh),t))]}const Ih=m.define({combine:t=>t.some(t=>t)});function Lh(t){var e=[Th];return t&&!1===t.fixed&&e.push(Ih.of(!0)),e}const Th=h.fromClass(class{constructor(e){this.view=e,this.prevViewport=e.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=e.state.facet(Ah).map(t=>new Nh(e,t));for(var t of this.gutters)this.dom.appendChild(t.dom);this.fixed=!e.state.facet(Ih),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),e.scrollDOM.insertBefore(this.dom,e.contentDOM)}update(t){var e,r,e;this.updateGutters(t)&&(e=this.prevViewport,r=t.view.viewport,e=Math.min(e.to,r.to)-Math.max(e.from,r.from),this.syncGutters(e<.8*(r.to-r.from))),t.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(Ih)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=t.view.viewport}syncGutters(t){var e=this.dom.nextSibling,r=(t&&this.dom.remove(),S.iter(this.view.state.facet(Eh),this.view.viewport.from));let i=[];var n=this.gutters.map(t=>new Fh(t,this.view.viewport,-this.view.documentPadding.top)),s,o;for(s of this.view.viewportLineBlocks)if(i.length&&(i=[]),Array.isArray(s.type)){let t=!0;for(var h of s.type)if(h.type==k.Text&&t){_h(r,i,h.from);for(var a of n)a.line(this.view,h,i);t=!1}else if(h.widget)for(var u of n)u.widget(this.view,h)}else if(s.type==k.Text){_h(r,i,s.from);for(var l of n)l.line(this.view,s,i)}for(o of n)o.finish();t&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(t){var e=t.startState.facet(Ah),r=t.state.facet(Ah);let i=t.docChanged||t.heightChanged||t.viewportChanged||!S.eq(t.startState.facet(Eh),t.state.facet(Eh),t.view.viewport.from,t.view.viewport.to);if(e==r)for(var n of this.gutters)n.update(t)&&(i=!0);else{i=!0;var s=[],o,h,a;for(o of r){var u=e.indexOf(o);u<0?s.push(new Nh(this.view,o)):(this.gutters[u].update(t),s.push(this.gutters[u]))}for(h of this.gutters)h.dom.remove(),s.indexOf(h)<0&&h.destroy();for(a of s)this.dom.appendChild(a.dom);this.gutters=s}return i}destroy(){for(var t of this.gutters)t.destroy();this.dom.remove()}},{provide:r=>E.scrollMargins.of(t=>{var e=t.plugin(r);return e&&0!=e.gutters.length&&e.fixed?t.textDirection==y.LTR?{left:e.dom.offsetWidth}:{right:e.dom.offsetWidth}:null})});function Bh(t){return Array.isArray(t)?t:[t]}function _h(t,e,r){for(;t.value&&t.from<=r;)t.from==r&&e.push(t.value),t.next()}class Fh{constructor(t,e,r){this.gutter=t,this.height=r,this.i=0,this.cursor=S.iter(t.markers,e.from)}addElement(t,e,r){var{gutter:i}=this,n=e.top-this.height,s;this.i==i.elements.length?(s=new $h(t,e.height,n,r),i.elements.push(s),i.dom.appendChild(s.dom)):i.elements[this.i].update(t,e.height,n,r),this.height=e.bottom,this.i++}line(t,e,r){let i=[];_h(this.cursor,i,e.from),r.length&&(i=i.concat(r));var r=this.gutter.config.lineMarker(t,e,i),r=(r&&i.unshift(r),this.gutter);0==i.length&&!r.config.renderEmptyElements||this.addElement(t,e,i)}widget(t,e){var r=this.gutter.config.widgetMarker(t,e.widget,e);r&&this.addElement(t,e,[r])}finish(){for(var t=this.gutter;t.elements.length>this.i;){var e=t.elements.pop();t.dom.removeChild(e.dom),e.destroy()}}}class Nh{constructor(s,o){this.view=s,this.config=o,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let n in o.domEventHandlers)this.dom.addEventListener(n,t=>{let e=t.target,r;if(e!=this.dom&&this.dom.contains(e)){for(;e.parentNode!=this.dom;)e=e.parentNode;var i=e.getBoundingClientRect();r=(i.top+i.bottom)/2}else r=t.clientY;var i=s.lineBlockAtHeight(r-s.documentTop);o.domEventHandlers[n](s,i,t)&&t.preventDefault()});this.markers=Bh(o.markers(s)),o.initialSpacer&&(this.spacer=new $h(s,0,0,[o.initialSpacer(s)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(t){var e=this.markers,r,r=(this.markers=Bh(this.config.markers(t.view)),this.spacer&&this.config.updateSpacer&&(r=this.config.updateSpacer(this.spacer.markers[0],t))!=this.spacer.markers[0]&&this.spacer.update(t.view,0,0,[r]),t.view.viewport);return!S.eq(this.markers,e,r.from,r.to)||!!this.config.lineMarkerChange&&this.config.lineMarkerChange(t)}destroy(){for(var t of this.elements)t.destroy()}}class $h{constructor(t,e,r,i){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(t,e,r,i)}update(t,e,r,i){this.height!=e&&(this.dom.style.height=(this.height=e)+"px"),this.above!=r&&(this.dom.style.marginTop=(this.above=r)?r+"px":""),Hh(this.markers,i)||this.setMarkers(t,i)}setMarkers(s,o){let h="cm-gutterElement",a=this.dom.firstChild;for(let t=0,n=0;;){let e=n,r=t<o.length?o[t++]:null,i=!1;if(r){var u=r.elementClass;u&&(h+=" "+u);for(let t=n;t<this.markers.length;t++)if(this.markers[t].compare(r)){e=t,i=!0;break}}else e=this.markers.length;for(;n<e;){var l=this.markers[n++],l;l.toDOM&&(l.destroy(a),l=a.nextSibling,a.remove(),a=l)}if(!r)break;r.toDOM&&(i?a=a.nextSibling:this.dom.insertBefore(r.toDOM(s),a)),i&&n++}this.dom.className=h,this.markers=o}destroy(){this.setMarkers(null,[])}}function Hh(e,r){if(e.length==r.length){for(let t=0;t<e.length;t++)if(!e[t].compare(r[t]))return;return 1}}const Uh=m.define(),zh=m.define({combine(t){return le(t,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(t,e){var r=Object.assign({},t),s;for(s in e){let i=r[s],n=e[s];r[s]=i?(t,e,r)=>i(t,e,r)||n(t,e,r):n}return r}})}});class Wh extends Oh{constructor(t){super(),this.number=t}eq(t){return this.number==t.number}toDOM(){return document.createTextNode(this.number)}}function Vh(t,e){return t.state.facet(zh).formatNumber(e,t.state)}const qh=Ah.compute([zh],t=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(t){return t.state.facet(Uh)},lineMarker(t,e,r){return r.some(t=>t.toDOM)?null:new Wh(Vh(t,t.state.doc.lineAt(e.from).number))},widgetMarker:()=>null,lineMarkerChange:t=>t.startState.facet(zh)!=t.state.facet(zh),initialSpacer(t){return new Wh(Vh(t,Jh(t.state.doc.lines)))},updateSpacer(t,e){var e=Vh(e.view,Jh(e.view.state.doc.lines));return e==t.number?t:new Wh(e)},domEventHandlers:t.facet(zh).domEventHandlers}));function Gh(t={}){return[zh.of(t),Lh(),qh]}function Jh(t){let e=9;for(;e<t;)e=10*e+9;return e}const Kh=new class extends Oh{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},Qh=Eh.compute(["selection"],t=>{let e=[],r=-1;for(var i of t.selection.ranges){var i=t.doc.lineAt(i.head).from;i>r&&(r=i,e.push(Kh.range(i)))}return S.of(e)});function Xh(){return Qh}const Zh=new Map;function Yh(t){let e=Zh.get(t);return e||Zh.set(t,e=j.mark({attributes:"\t"===t?{class:"cm-highlightTab"}:{class:"cm-highlightSpace","data-display":t.replace(/ /g,"\xb7")}})),e}function ta(e){return h.define(t=>({decorations:e.createDeco(t),update(t){this.decorations=e.updateDeco(t,this.decorations)}}),{decorations:t=>t.decorations})}const ea=ta(new So({regexp:/\t| +/g,decoration:t=>Yh(t[0]),boundary:/\S/}));function ra(){return ea}const ia=ta(new So({regexp:/\s+$/g,decoration:j.mark({class:"cm-trailingSpace"}),boundary:/\S/}));function na(){return ia}var i={HeightMap:Yn,HeightOracle:Kn,MeasuredHeights:Qn,QueryType:d,ChangedRange:pi,computeOrder:Di,moveVisually:Ii},W=Object.freeze({__proto__:null,BidiSpan:Ei,BlockInfo:Xn,get BlockType(){return k},Decoration:j,get Direction(){return y},EditorView:E,GutterMarker:Oh,MatchDecorator:So,RectangleMarker:eo,ViewPlugin:h,ViewUpdate:gi,WidgetType:Tr,qde:i,closeHoverTooltips:cr,crosshairCursor:th,drawSelection:fo,dropCursor:Mo,getPanel:xh,getTooltip:gh,gutter:Rh,gutterLineClass:Eh,gutters:Lh,hasHoverTooltips:wh,highlightActiveLine:Ho,highlightActiveLineGutter:Xh,highlightSpecialChars:Ro,highlightTrailingWhitespace:na,highlightWhitespace:ra,hoverTooltip:ph,keymap:Gs,layer:uo,lineNumberMarkers:Uh,lineNumbers:Gh,logException:ni,panels:Mh,placeholder:Vo,rectangularSelection:Xo,repositionTooltips:kh,runScopeHandlers:Qs,scrollPastEnd:$o,showPanel:jh,showTooltip:uh,tooltips:ih}),n;const sa=1024;let oa=0;class ha{constructor(t,e){this.from=t,this.to=e}}class L{constructor(t={}){this.id=oa++,this.perNode=!!t.perNode,this.deserialize=t.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof e&&(e=ua.match(e)),t=>{var t=e(t);return void 0===t?null:[this,t]}}}L.closedBy=new L({deserialize:t=>t.split(" ")}),L.openedBy=new L({deserialize:t=>t.split(" ")}),L.group=new L({deserialize:t=>t.split(" ")}),L.contextHash=new L({perNode:!0}),L.lookAhead=new L({perNode:!0}),L.mounted=new L({perNode:!0});const aa=Object.create(null);class ua{constructor(t,e,r,i=0){this.name=t,this.props=e,this.id=r,this.flags=i}static define(t){var e=t.props&&t.props.length?Object.create(null):aa,r=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(null==t.name?8:0),i=new ua(t.name||"",e,t.id,r);if(t.props)for(var n of t.props)if(n=Array.isArray(n)?n:n(i)){if(n[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");e[n[0].id]=n[1]}return i}prop(t){return this.props[t.id]}get isTop(){return 0<(1&this.flags)}get isSkipped(){return 0<(2&this.flags)}get isError(){return 0<(4&this.flags)}get isAnonymous(){return 0<(8&this.flags)}is(t){var e;return"string"==typeof t?this.name==t||!!(e=this.prop(L.group))&&-1<e.indexOf(t):this.id==t}static match(t){let n=Object.create(null);for(var e in t)for(var r of e.split(" "))n[r]=t[e];return r=>{for(let t=r.prop(L.group),e=-1;e<(t?t.length:0);e++){var i=n[e<0?r.name:t[e]];if(i)return i}}}}ua.none=new ua("",Object.create(null),0,8);class la{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){var r=[],i;for(i of this.types){let t=null;for(var n of e){var n=n(i);n&&((t=t||Object.assign({},i.props))[n[0].id]=n[1])}r.push(t?new ua(i.name,t,i.id,i.flags):i)}return new la(r)}}const ca=new WeakMap,fa=new WeakMap;(n=f=f||{})[n.ExcludeBuffers=1]="ExcludeBuffers",n[n.IncludeAnonymous=2]="IncludeAnonymous",n[n.IgnoreMounts=4]="IgnoreMounts",n[n.IgnoreOverlays=8]="IgnoreOverlays";class T{constructor(t,e,r,i,n){if(this.type=t,this.children=e,this.positions=r,this.length=i,this.props=null,n&&n.length){this.props=Object.create(null);for(var[s,o]of n)this.props["number"==typeof s?s:s.id]=o}}toString(){var t=this.prop(L.mounted),e;if(t&&!t.overlay)return t.tree.toString();let r="";for(e of this.children){var i=e.toString();i&&(r&&(r+=","),r+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(r.length?"("+r+")":""):r}cursor(t=0){return new xa(this.topNode,t)}cursorAt(t,e=0,r=0){var i=ca.get(this)||this.topNode,i=new xa(i);return i.moveTo(t,e),ca.set(this,i.oMi),i}get topNode(){return new wa(this,0,0,null)}resolve(t,e=0){var t=ga(ca.get(this)||this.topNode,t,e,!1);return ca.set(this,t),t}resolveInner(t,e=0){var t=ga(fa.get(this)||this.topNode,t,e,!0);return fa.set(this,t),t}iterate(t){for(var{enter:e,leave:r,from:i=0,to:n=this.length}=t,t=t.mode||0,s=0<(t&f.IncludeAnonymous),o=this.cursor(t|f.IncludeAnonymous);;){let t=!1;if(o.from<=n&&o.to>=i&&(!s&&o.type.isAnonymous||!1!==e(o))){if(o.firstChild())continue;t=!0}for(;t&&r&&(s||!o.type.isAnonymous)&&r(o),!o.nextSibling();){if(!o.parent())return;t=!0}}}prop(t){return t.perNode?this.props?this.props[t.id]:void 0:this.type.prop(t)}get propValues(){var t=[];if(this.props)for(var e in this.props)t.push([+e,this.props[e]]);return t}balance(t={}){return this.children.length<=8?this:Oa(ua.none,this.children,this.positions,0,this.children.length,0,this.length,(t,e,r)=>new T(this.type,t,e,r,this.propValues),t.makeTree||((t,e,r)=>new T(ua.none,t,e,r)))}static build(t){return Sa(t)}}T.empty=new T(ua.none,[],[],0);class da{constructor(t,e){this.buffer=t,this.index=e}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new da(this.buffer,this.index)}}class va{constructor(t,e,r){this.buffer=t,this.length=e,this.set=r}get type(){return ua.none}toString(){var e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(t){var e=this.buffer[t],r=this.buffer[t+3];let i=this.set.types[e],n=i.name;if(/\W/.test(n)&&!i.isError&&(n=JSON.stringify(n)),r==(t+=4))return n;for(var s=[];t<r;)s.push(this.childString(t)),t=this.buffer[t+3];return n+"("+s.join(",")+")"}findChild(e,r,i,n,s){let{buffer:o}=this,h=-1;for(let t=e;t!=r&&!(ma(s,n,o[t+1],o[t+2])&&(h=t,0<i));t=o[t+3]);return h}slice(r,i,n){var s=this.buffer;let o=new Uint16Array(i-r),h=0;for(let t=r,e=0;t<i;){o[e++]=s[t++],o[e++]=s[t++]-n;var a=o[e++]=s[t++]-n;o[e++]=s[t++]-r,h=Math.max(h,a)}return new va(o,h,this.set)}}function ma(t,e,r,i){switch(t){case-2:return r<e;case-1:return e<=i&&r<e;case 0:return r<e&&e<i;case 1:return r<=e&&e<i;case 2:return e<i;case 4:return 1}}function pa(t,e){let r=t.childBefore(e);for(;r;){var i=r.lastChild;if(!i||i.to!=r.to)break;r=i.type.isError&&i.from==i.to?(t=r,i.prevSibling):i}return t}function ga(r,i,n,t){for(var s;r.from==r.to||(n<1?r.from>=i:r.from>i)||(-1<n?r.to<=i:r.to<i);){var e=!t&&r instanceof wa&&r.index<0?null:r.parent;if(!e)return r;r=e}var o=t?0:f.IgnoreOverlays;if(t)for(let t=r,e=t.parent;e;e=(t=e).parent)t instanceof wa&&t.index<0&&(null==(s=e.enter(i,n,o))?void 0:s.from)!=t.from&&(r=e);for(;;){var h=r.enter(i,n,o);if(!h)return r;r=h}}class wa{constructor(t,e,r,i){this.oMi=t,this.from=e,this.index=r,this.sft=i}get type(){return this.oMi.type}get name(){return this.oMi.type.name}get to(){return this.from+this.oMi.length}nextChild(r,i,n,s,o=0){for(let e=this;;){for(var{children:t,positions:h}=e.oMi,a=0<i?t.length:-1;r!=a;r+=i){var u=t[r],l=h[r]+e.from,c;if(ma(s,n,l,l+u.length))if(u instanceof va){if(!(o&f.ExcludeBuffers)){var c=u.findChild(0,u.buffer.length,i,n-l,s);if(-1<c)return new Ma(new ya(e,u,r,l),null,c)}}else if(o&f.IncludeAnonymous||!u.type.isAnonymous||Ca(u)){let t;return o&f.IgnoreMounts||!u.props||!(t=u.prop(L.mounted))||t.overlay?(c=new wa(u,l,r,e),o&f.IncludeAnonymous||!c.type.isAnonymous?c:c.nextChild(i<0?u.children.length-1:0,i,n,s)):new wa(t.tree,l,r,e)}}if(o&f.IncludeAnonymous||!e.type.isAnonymous)return null;if(r=0<=e.index?e.index+i:i<0?-1:e.sft.oMi.children.length,!(e=e.sft))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this.oMi.children.length-1,-1,0,4)}childAfter(t){return this.nextChild(0,1,t,2)}childBefore(t){return this.nextChild(this.oMi.children.length-1,-1,t,-2)}enter(t,e,r=0){let i;if(!(r&f.IgnoreOverlays)&&(i=this.oMi.prop(L.mounted))&&i.overlay){var n=t-this.from,s,o;for({from:s,to:o}of i.overlay)if((0<e?s<=n:s<n)&&(e<0?o>=n:o>n))return new wa(i.tree,i.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,t,e,r)}nextSignificantParent(){let t=this;for(;t.type.isAnonymous&&t.sft;)t=t.sft;return t}get parent(){return this.sft?this.sft.nextSignificantParent():null}get nextSibling(){return this.sft&&0<=this.index?this.sft.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this.sft&&0<=this.index?this.sft.nextChild(this.index-1,-1,0,4):null}cursor(t=0){return new xa(this,t)}get tree(){return this.oMi}toTree(){return this.oMi}resolve(t,e=0){return ga(this,t,e,!1)}resolveInner(t,e=0){return ga(this,t,e,!0)}enterUnfinishedNodesBefore(t){return pa(this,t)}getChild(t,e=null,r=null){var t=ba(this,t,e,r);return t.length?t[0]:null}getChildren(t,e=null,r=null){return ba(this,t,e,r)}toString(){return this.oMi.toString()}get node(){return this}matchContext(t){return ka(this,t)}}function ba(t,e,r,i){var n=t.cursor(),s=[];if(!n.firstChild())return s;if(null!=r)for(;!n.type.is(r);)if(!n.nextSibling())return s;for(;;){if(null!=i&&n.type.is(i))return s;if(n.type.is(e)&&s.push(n.node),!n.nextSibling())return null==i?s:[]}}function ka(e,r,i=r.length-1){for(let t=e.parent;0<=i;t=t.parent){if(!t)return!1;if(!t.type.isAnonymous){if(r[i]&&r[i]!=t.name)return!1;i--}}return!0}class ya{constructor(t,e,r,i){this.parent=t,this.buffer=e,this.index=r,this.start=i}}class Ma{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(t,e,r){this.context=t,this.sft=e,this.index=r,this.type=t.buffer.set.types[t.buffer.buffer[r]]}child(t,e,r){var{buffer:i}=this.context,i=i.findChild(this.index+4,i.buffer[this.index+3],t,e-this.context.start,r);return i<0?null:new Ma(this.context,this,i)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(t){return this.child(1,t,2)}childBefore(t){return this.child(-1,t,-2)}enter(t,e,r=0){var r,r;return r&f.ExcludeBuffers||({buffer:r}=this.context,(r=r.findChild(this.index+4,r.buffer[this.index+3],0<e?1:-1,t-this.context.start,e))<0)?null:new Ma(this.context,this,r)}get parent(){return this.sft||this.context.parent.nextSignificantParent()}externalSibling(t){return this.sft?null:this.context.parent.nextChild(this.context.index+t,t,0,4)}get nextSibling(){var{buffer:t}=this.context,e=t.buffer[this.index+3];return e<(this.sft?t.buffer[this.sft.index+3]:t.buffer.length)?new Ma(this.context,this.sft,e):this.externalSibling(1)}get prevSibling(){var{buffer:t}=this.context,e=this.sft?this.sft.index+4:0;return this.index==e?this.externalSibling(-1):new Ma(this.context,this.sft,t.findChild(e,this.index,-1,0,4))}cursor(t=0){return new xa(this,t)}get tree(){return null}toTree(){var t=[],e=[],{buffer:r}=this.context,i=this.index+4,n=r.buffer[this.index+3],s;return i<n&&(s=r.buffer[this.index+1],t.push(r.slice(i,n,s)),e.push(0)),new T(this.type,t,e,this.to-this.from)}resolve(t,e=0){return ga(this,t,e,!1)}resolveInner(t,e=0){return ga(this,t,e,!0)}enterUnfinishedNodesBefore(t){return pa(this,t)}toString(){return this.context.buffer.childString(this.index)}getChild(t,e=null,r=null){var t=ba(this,t,e,r);return t.length?t[0]:null}getChildren(t,e=null,r=null){return ba(this,t,e,r)}get node(){return this}matchContext(t){return ka(this,t)}}class xa{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof wa)this.yieldNode(e);else{this.oMi=e.context.parent,this.buffer=e.context;for(let t=e.sft;t;t=t.sft)this.stack.unshift(t.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(t){return!!t&&(this.oMi=t,this.type=t.type,this.from=t.from,this.to=t.to,!0)}yieldBuf(t,e){this.index=t;var{start:r,buffer:i}=this.buffer;return this.type=e||i.set.types[i.buffer[t]],this.from=r+i.buffer[t+1],this.to=r+i.buffer[t+2],!0}yield(t){return!!t&&(t instanceof wa?(this.buffer=null,this.yieldNode(t)):(this.buffer=t.context,this.yieldBuf(t.index,t.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this.oMi.toString()}enterChild(t,e,r){var i,i;return this.buffer?({buffer:i}=this.buffer,!((i=i.findChild(this.index+4,i.buffer[this.index+3],t,e-this.buffer.start,r))<0)&&(this.stack.push(this.index),this.yieldBuf(i))):this.yield(this.oMi.nextChild(t<0?this.oMi.oMi.children.length-1:0,t,e,r,this.mode))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(t){return this.enterChild(1,t,2)}childBefore(t){return this.enterChild(-1,t,-2)}enter(t,e,r=this.mode){return this.buffer?!(r&f.ExcludeBuffers)&&this.enterChild(1,t,e):this.yield(this.oMi.enter(t,e,r))}parent(){var t;return this.buffer?this.stack.length?this.yieldBuf(this.stack.pop()):(t=this.mode&f.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent(),this.buffer=null,this.yieldNode(t)):this.yieldNode(this.mode&f.IncludeAnonymous?this.oMi.sft:this.oMi.parent)}sibling(t){if(!this.buffer)return!!this.oMi.sft&&this.yield(this.oMi.index<0?null:this.oMi.sft.nextChild(this.oMi.index+t,t,0,4,this.mode));var{buffer:e}=this.buffer,r=this.stack.length-1;if(t<0){var i=r<0?0:this.stack[r]+4;if(this.index!=i)return this.yieldBuf(e.findChild(i,this.index,-1,0,4))}else{var i=e.buffer[this.index+3];if(i<(r<0?e.buffer.length:e.buffer[this.stack[r]+3]))return this.yieldBuf(i)}return r<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(r){let i,n,{buffer:e}=this;if(e){if(0<r){if(this.index<e.buffer.buffer.length)return!1}else for(let t=0;t<this.index;t++)if(e.buffer.buffer[t+3]<this.index)return!1;({index:i,parent:n}=e)}else({index:i,sft:n}=this.oMi);for(;n;{index:i,sft:n}=n)if(-1<i)for(let t=i+r,e=r<0?-1:n.oMi.children.length;t!=e;t+=r){var s=n.oMi.children[t];if(this.mode&f.IncludeAnonymous||s instanceof va||!s.type.isAnonymous||Ca(s))return!1}return!0}move(t,e){if(e&&this.enterChild(t,0,4))return!0;for(;;){if(this.sibling(t))return!0;if(this.atLastNode(t)||!this.parent())return!1}}next(t=!0){return this.move(1,t)}prev(t=!0){return this.move(-1,t)}moveTo(t,e=0){for(;(this.from==this.to||(e<1?this.from>=t:this.from>t)||(-1<e?this.to<=t:this.to<t))&&this.parent(););for(;this.enterChild(1,t,e););return this}get node(){if(!this.buffer)return this.oMi;let i=this.bufferNode,n=null,s=0;if(i&&i.context==this.buffer)t:for(let e=this.index,r=this.stack.length;0<=r;){for(let t=i;t;t=t.sft)if(t.index==e){if(e==this.index)return t;n=t,s=r+1;break t}e=this.stack[--r]}for(let t=s;t<this.stack.length;t++)n=new Ma(this.buffer,n,this.stack[t]);return this.bufferNode=new Ma(this.buffer,n,this.index)}get tree(){return this.buffer?null:this.oMi.oMi}iterate(r,i){for(let e=0;;){let t=!1;if(this.type.isAnonymous||!1!==r(this)){if(this.firstChild()){e++;continue}this.type.isAnonymous||(t=!0)}for(;t&&i&&i(this),t=this.type.isAnonymous,!this.nextSibling();){if(!e)return;this.parent(),e--,t=!0}}}matchContext(r){if(!this.buffer)return ka(this.node,r);var{buffer:i}=this.buffer,{types:n}=i.set;for(let t=r.length-1,e=this.stack.length-1;0<=t;e--){if(e<0)return ka(this.node,r,t);var s=n[i.buffer[this.stack[e]]];if(!s.isAnonymous){if(r[t]&&r[t]!=s.name)return!1;t--}}return!0}}function Ca(t){return t.children.some(t=>t instanceof va||!t.type.isAnonymous||Ca(t))}function Sa(t){var e;let{buffer:r,nodeSet:k,maxBufferLength:y=sa,reused:M=[],minRepeatType:x=k.types.length}=t,C=Array.isArray(r)?new da(r,r.length):r,S=k.types,P=0,j=0;function O(r,i,t,e,n){for(var{id:s,start:o,end:h,size:a}=C,u=j,l;a<0;){if(C.next(),-1==a)return l=M[s],t.push(l),void e.push(o-r);if(-3==a)return void(P=s);if(-4==a)return void(j=s);throw new RangeError("Unrecognized record size: "+a)}let c=S[s],f,d,v=o-r;if(h-o<=y&&(d=R(C.pos-i,n))){var m=new Uint16Array(d.size-d.skip);let t=C.pos-d.size,e=m.length;for(;C.pos>t;)e=I(d.start,m,e);f=new va(m,h-d.start,k),v=d.start-r}else{var p=C.pos-a,g=(C.next(),[]),w=[],b=s>=x?s:-1,i;let t=0,e=h;for(;C.pos>p;)0<=b&&C.id==b&&0<=C.size?(C.end<=e-y&&(D(g,w,o,t,C.end,e,b,u),t=g.length,e=C.end),C.next()):O(o,p,g,w,b);0<=b&&0<t&&t<g.length&&D(g,w,o,t,o,e,b,u),g.reverse(),w.reverse(),f=-1<b&&0<t?(i=E(c),Oa(c,g,w,0,g.length,0,h-o,i,i)):A(c,g,w,h-o,u-h)}t.push(f),e.push(v)}function E(h){return(t,e,r)=>{let i=0,n=t.length-1,s,o;if(0<=n&&(s=t[n])instanceof T){if(!n&&s.type==h&&s.length==r)return s;(o=s.prop(L.lookAhead))&&(i=e[n]+s.length+o)}return A(h,t,e,r,i)}}function D(t,e,r,i,n,s,o,h){for(var a=[],u=[];t.length>i;)a.push(t.pop()),u.push(e.pop()+r-n);t.push(A(k.types[o],a,u,s-n,h-s)),e.push(n-r)}function A(t,e,r,i,n=0,s){var o,o;return P&&(o=[L.contextHash,P],s=s?[o].concat(s):[o]),25<n&&(o=[L.lookAhead,n],s=s?[o].concat(s):[o]),new T(t,e,r,i,s)}function R(t,e){var r=C.fork();let i=0,n=0,s=0,o=r.end-y;var h={size:0,start:0,skip:0};t:for(var a=r.pos-t;r.pos>a;){var u=r.size;if(r.id==e&&0<=u)h.size=i,h.start=n,h.skip=s,s+=4,i+=4,r.next();else{var l=r.pos-u;if(u<0||l<a||r.start<o)break;let t=r.id>=x?4:0;var c=r.start;for(r.next();r.pos>l;){if(r.size<0){if(-3!=r.size)break t;t+=4}else r.id>=x&&(t+=4);r.next()}n=c,i+=u,s+=t}}return(e<0||i==t)&&(h.size=i,h.start=n,h.skip=s),4<h.size?h:void 0}function I(t,e,r){var{id:i,start:n,end:s,size:o}=C;if(C.next(),0<=o&&i<x){var h=r;if(4<o)for(var a=C.pos-(o-4);C.pos>a;)r=I(t,e,r);e[--r]=h,e[--r]=s-t,e[--r]=n-t,e[--r]=i}else-3==o?P=i:-4==o&&(j=i);return r}for(var i=[],n=[];0<C.pos;)O(t.start||0,t.bufferStart||0,i,n,-1);var e=null!=(e=t.length)?e:i.length?n[0]+i[0].length:0;return new T(S[t.topID],i.reverse(),n.reverse(),e)}const Pa=new WeakMap;function ja(t,e){if(!t.isAnonymous||e instanceof va||e.type!=t)return 1;let r=Pa.get(e);if(null==r){r=1;for(var i of e.children){if(i.type!=t||!(i instanceof T)){r=1;break}r+=ja(t,i)}Pa.set(e,r)}return r}function Oa(l,e,t,r,i,c,n,s,f){let o=0;for(let t=r;t<i;t++)o+=ja(l,e[t]);let d=Math.ceil(1.5*o/8),v=[],m=[];function p(n,s,t,o,h){for(let i=t;i<o;){let t=i,e=s[i],r=ja(l,n[i]);for(i++;i<o;i++){var a=ja(l,n[i]);if(r+a>=d)break;r+=a}if(i==t+1){if(r>d){var u=n[t];p(u.children,u.positions,0,u.children.length,s[t]+h);continue}v.push(n[t])}else{var u=s[i-1]+n[i-1].length-e;v.push(Oa(l,n,s,t,i,e,u,null,f))}m.push(e+h-c)}}return p(e,t,r,i,0),(s||f)(v,m,n)}class Ea{constructor(t,e,r,i,n=!1,s=!1){this.from=t,this.to=e,this.tree=r,this.offset=i,this.open=(n?1:0)|(s?2:0)}get openStart(){return 0<(1&this.open)}get openEnd(){return 0<(2&this.open)}static addTree(t,e=[],r=!1){var i=[new Ea(0,t.length,t,0,!1,r)],n;for(n of e)n.to>t.length&&i.push(n);return i}static applyChanges(n,t,s=128){if(!t.length)return n;var o=[];let h=1,a=n.length?n[0]:null;for(let e=0,r=0,i=0;;e++){var u=e<t.length?t[e]:null,l=u?u.fromA:1e9,c,f;if(l-r>=s)for(;a&&a.from<l;){let t=a;if((r>=t.from||l<=t.to||i)&&(c=Math.max(t.from,r)-i,f=Math.min(t.to,l)-i,t=f<=c?null:new Ea(c,f,t.tree,t.offset+i,0<e,!!u)),t&&o.push(t),a.to>l)break;a=h<n.length?n[h++]:null}if(!u)break;r=u.toA,i=u.toA-u.toB}return o}}class Da{startParse(t,e,r){return"string"==typeof t&&(t=new Aa(t)),r=r?r.length?r.map(t=>new ha(t.from,t.to)):[new ha(0,0)]:[new ha(0,t.length)],this.createParse(t,e||[],r)}parse(t,e,r){for(var i=this.startParse(t,e,r);;){var n=i.advance();if(n)return n}}}class Aa{constructor(t){this.string=t}get length(){return this.string.length}chunk(t){return this.string.slice(t)}get lineChunks(){return!1}read(t,e){return this.string.slice(t,e)}}new L({perNode:!0});let Ra=0;class Ia{constructor(t,e,r){this.set=t,this.base=e,this.modified=r,this.id=Ra++}static define(t){if(null!=t&&t.base)throw new Error("Can not derive from a modified tag");var e=new Ia([],null,[]);if(e.set.push(e),t)for(var r of t.set)e.set.push(r);return e}static defineModifier(){let e=new Ta;return t=>-1<t.modified.indexOf(e)?t:Ta.get(t.base||t,t.modified.concat(e).sort((t,e)=>t.id-e.id))}}let La=0;class Ta{constructor(){this.instances=[],this.id=La++}static get(e,r){if(!r.length)return e;var t=r[0].instances.find(t=>t.base==e&&Ba(r,t.modified));if(t)return t;var i=[],n=new Ia(i,e,r),s;for(s of r)s.instances.push(n);var o=_a(r),h;for(h of e.set)if(!h.modified.length)for(var a of o)i.push(Ta.get(h,a));return n}}function Ba(t,r){return t.length==r.length&&t.every((t,e)=>t==r[e])}function _a(i){var n=[[]];for(let r=0;r<i.length;r++)for(let t=0,e=n.length;t<e;t++)n.push(n[t].concat(i[r]));return n.sort((t,e)=>e.length-t.length)}function Fa(e){var n=Object.create(null),r;for(r in e){let t=e[r];Array.isArray(t)||(t=[t]);for(var s of r.split(" "))if(s){let e=[],r=2,i=s;for(let t=0;;){if("..."==i&&0<t&&t+3==s.length){r=1;break}var o=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(i);if(!o)throw new RangeError("Invalid path: "+s);if(e.push("*"==o[0]?"":'"'==o[0][0]?JSON.parse(o[0]):o[0]),(t+=o[0].length)==s.length)break;var o=s[t++];if(t==s.length&&"!"==o){r=0;break}if("/"!=o)throw new RangeError("Invalid path: "+s);i=s.slice(t)}var h=e.length-1,a=e[h];if(!a)throw new RangeError("Invalid path: "+s);var h=new $a(t,r,0<h?e.slice(0,h):null);n[a]=h.sort(n[a])}}return Na.add(n)}const Na=new L;class $a{constructor(t,e,r,i){this.tags=t,this.mode=e,this.context=r,this.next=i}get opaque(){return 0==this.mode}get inherit(){return 1==this.mode}sort(t){return!t||t.depth<this.depth?(this.next=t,this):(t.next=this.sort(t.next),t)}get depth(){return this.context?this.context.length:0}}function Ha(t,e){let n=Object.create(null);for(var r of t)if(Array.isArray(r.tag))for(var i of r.tag)n[i.id]=r.class;else n[r.tag.id]=r.class;let{scope:s,all:o=null}=e||{};return{style:t=>{let e=o;for(var r of t)for(var i of r.set){var i=n[i.id];if(i){e=e?e+" "+i:i;break}}return e},scope:s}}function Ua(t,e){let r=null;for(var i of t){var i=i.style(e);i&&(r=r?r+" "+i:i)}return r}function za(t,e,r,i=0,n=t.length){var e=new Wa(i,Array.isArray(e)?e:[e],r);e.highlightRange(t.cursor(),i,n,"",e.highlighters),e.flush(n)}$a.empty=new $a([],2,null);class Wa{constructor(t,e,r){this.at=t,this.highlighters=e,this.span=r,this.class=""}startSpan(t,e){e!=this.class&&(this.flush(t),t>this.at&&(this.at=t),this.class=e)}flush(t){t>this.at&&this.class&&this.span(this.at,t,this.class)}highlightRange(n,s,o,h,a){let{type:e,from:u,to:l}=n;if(!(o<=u||l<=s)){e.isTop&&(a=this.highlighters.filter(t=>!t.scope||t.scope(e)));let i=h;var t=Va(n)||$a.empty,r=Ua(a,t.tags);if(r&&(i&&(i+=" "),i+=r,1==t.mode)&&(h+=(h?" ":"")+r),this.startSpan(Math.max(s,u),i),!t.opaque){let r=n.tree&&n.tree.prop(L.mounted);if(r&&r.overlay){var c=n.node.enter(r.overlay[0].from+u,1),f=this.highlighters.filter(t=>!t.scope||t.scope(r.tree.type)),d=n.firstChild();for(let t=0,e=u;;t++){var v=t<r.overlay.length?r.overlay[t]:null,m=v?v.from+u:l,p=Math.max(s,e),g=Math.min(o,m);if(p<g&&d)for(;n.from<g&&(this.highlightRange(n,p,g,h,a),this.startSpan(Math.min(g,n.to),i),!(n.to>=m))&&n.nextSibling(););if(!v||o<m)break;(e=v.to+u)>s&&(this.highlightRange(c.cursor(),Math.max(s,v.from+u),Math.min(o,e),"",f),this.startSpan(Math.min(o,e),i))}d&&n.parent()}else if(n.firstChild()){r&&(h="");do{if(!(n.to<=s)){if(n.from>=o)break;this.highlightRange(n,s,o,h,a),this.startSpan(Math.min(o,n.to),i)}}while(n.nextSibling());n.parent()}}}}}function Va(t){let e=t.type.prop(Na);for(;e&&e.context&&!t.matchContext(e.context);)e=e.next;return e||null}var s=Ia.define,t=s(),mr=s(),vr=s(mr),_=s(mr),r=s(),fr=s(r),dr=s(r),i=s(),cr=s(i),n=s(),qa=s(),Ga=s(),Ja=s(Ga),Ka=s();const D={comment:t,lineComment:s(t),blockComment:s(t),docComment:s(t),name:mr,variableName:s(mr),typeName:vr,tagName:s(vr),propertyName:_,attributeName:s(_),className:s(mr),labelName:s(mr),namespace:s(mr),macroName:s(mr),literal:r,string:fr,docString:s(fr),character:s(fr),attributeValue:s(fr),number:dr,integer:s(dr),float:s(dr),bool:s(r),regexp:s(r),escape:s(r),color:s(r),url:s(r),keyword:n,self:s(n),null:s(n),atom:s(n),unit:s(n),modifier:s(n),operatorKeyword:s(n),controlKeyword:s(n),definitionKeyword:s(n),moduleKeyword:s(n),operator:qa,derefOperator:s(qa),arithmeticOperator:s(qa),logicOperator:s(qa),bitwiseOperator:s(qa),compareOperator:s(qa),updateOperator:s(qa),definitionOperator:s(qa),typeOperator:s(qa),controlOperator:s(qa),punctuation:Ga,separator:s(Ga),bracket:Ja,angleBracket:s(Ja),squareBracket:s(Ja),paren:s(Ja),brace:s(Ja),content:i,heading:cr,heading1:s(cr),heading2:s(cr),heading3:s(cr),heading4:s(cr),heading5:s(cr),heading6:s(cr),contentSeparator:s(i),list:s(i),quote:s(i),emphasis:s(i),strong:s(i),link:s(i),monospace:s(i),strikethrough:s(i),inserted:s(),deleted:s(),changed:s(),invalid:s(),meta:Ka,documentMeta:s(Ka),annotation:s(Ka),processingInstruction:s(Ka),definition:Ia.defineModifier(),constant:Ia.defineModifier(),function:Ia.defineModifier(),standard:Ia.defineModifier(),local:Ia.defineModifier(),special:Ia.defineModifier()},Qa=(Ha([{tag:D.link,class:"tok-link"},{tag:D.heading,class:"tok-heading"},{tag:D.emphasis,class:"tok-emphasis"},{tag:D.strong,class:"tok-strong"},{tag:D.keyword,class:"tok-keyword"},{tag:D.atom,class:"tok-atom"},{tag:D.bool,class:"tok-bool"},{tag:D.url,class:"tok-url"},{tag:D.labelName,class:"tok-labelName"},{tag:D.inserted,class:"tok-inserted"},{tag:D.deleted,class:"tok-deleted"},{tag:D.literal,class:"tok-literal"},{tag:D.string,class:"tok-string"},{tag:D.number,class:"tok-number"},{tag:[D.regexp,D.escape,D.special(D.string)],class:"tok-string2"},{tag:D.variableName,class:"tok-variableName"},{tag:D.local(D.variableName),class:"tok-variableName tok-local"},{tag:D.definition(D.variableName),class:"tok-variableName tok-definition"},{tag:D.special(D.variableName),class:"tok-variableName2"},{tag:D.definition(D.propertyName),class:"tok-propertyName tok-definition"},{tag:D.typeName,class:"tok-typeName"},{tag:D.namespace,class:"tok-namespace"},{tag:D.className,class:"tok-className"},{tag:D.macroName,class:"tok-macroName"},{tag:D.propertyName,class:"tok-propertyName"},{tag:D.operator,class:"tok-operator"},{tag:D.comment,class:"tok-comment"},{tag:D.meta,class:"tok-meta"},{tag:D.invalid,class:"tok-invalid"},{tag:D.punctuation,class:"tok-punctuation"}]),new L);function Xa(e){return m.define({combine:e?t=>t.concat(e):void 0})}const Za=new L;class Ya{constructor(t,e,r=[],i=""){this.data=t,this.name=i,C.prototype.hasOwnProperty("tree")||Object.defineProperty(C.prototype,"tree",{get(){return A(this)}}),this.parser=e,this.extension=[vu.of(this),C.languageData.of((t,e,r)=>{var i=tu(t,e,r),n=i.type.prop(Qa);if(!n)return[];var s=t.facet(n),n=i.type.prop(Za);if(n){var o=i.resolve(e-i.from,r),h,a;for(h of n){if(h.test(o,t))return a=t.facet(h.facet),"replace"==h.type?a:a.concat(s)}}return s})].concat(r)}isActiveAt(t,e,r=-1){return tu(t,e,r).type.prop(Qa)==this.data}findRegions(t){var e=t.facet(vu);if((null==e?void 0:e.data)==this.data)return[{from:0,to:t.doc.length}];if(!e||!e.allowsNesting)return[];let o=[],h=(e,r)=>{if(e.prop(Qa)==this.data)o.push({from:r,to:r+e.length});else{var t=e.prop(L.mounted);if(t){if(t.tree.prop(Qa)==this.data){if(t.overlay)for(var i of t.overlay)o.push({from:i.from+r,to:i.to+r});else o.push({from:r,to:r+e.length});return}if(t.overlay){var n=o.length;if(h(t.tree,t.overlay[0].from+r),o.length>n)return}}for(let t=0;t<e.children.length;t++){var s=e.children[t];s instanceof T&&h(s,e.positions[t]+r)}}};return h(A(t),0),o}get allowsNesting(){return!0}}function tu(t,e,r){let i=t.facet(vu),n=A(t).topNode;if(!i||i.allowsNesting)for(let t=n;t;t=t.enter(e,r,f.ExcludeBuffers))t.type.isTop&&(n=t);return n}Ya.setState=l.define();class eu extends Ya{constructor(t,e,r){super(t,e,[],r),this.parser=e}static define(t){let e=Xa(t.languageData);return new eu(e,t.parser.configure({props:[Qa.add(t=>t.isTop?e:void 0)]}),t.name)}configure(t,e){return new eu(this.data,this.parser.configure(t),e||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function A(t){var t=t.field(Ya.state,!1);return t?t.tree:T.empty}function ru(t,e,r=50){var t,t=null==(t=t.field(Ya.state,!1))?void 0:t.context,i,r;return t?(i=t.viewport,t.updateViewport({from:0,to:e}),r=t.isDone(e)||t.work(r,e)?t.tree:null,t.updateViewport(i),r):null}function iu(t,e=t.doc.length){var r;return(null==(r=t.field(Ya.state,!1))?void 0:r.context.isDone(e))||!1}function nu(t,e=t.viewport.to,r=100){var e=ru(t.state,e,r);return e!=A(t.state)&&t.dispatch({}),!!e}function su(t){var t;return(null==(t=t.plugin(du))?void 0:t.isWorking())||!1}class ou{constructor(t){this.doc=t,this.cursorPos=0,this.string="",this.cursor=t.iter()}get length(){return this.doc.length}syncTo(t){return this.string=this.cursor.next(t-this.cursorPos).value,this.cursorPos=t+this.string.length,this.cursorPos-this.string.length}chunk(t){return this.syncTo(t),this.string}get lineChunks(){return!0}read(t,e){var r=this.cursorPos-this.string.length;return t<r||e>=this.cursorPos?this.doc.sliceString(t,e):this.string.slice(t-r,e-r)}}let hu=null;class au{constructor(t,e,r=[],i,n,s,o,h){this.parser=t,this.state=e,this.fragments=r,this.tree=i,this.treeLen=n,this.viewport=s,this.skipped=o,this.scheduleOn=h,this.parse=null,this.tempSkipped=[]}static create(t,e,r){return new au(t,e,[],T.empty,0,r,[],null)}startParse(){return this.parser.startParse(new ou(this.state.doc),this.fragments)}work(r,i){return null!=i&&i>=this.state.doc.length&&(i=void 0),this.tree!=T.empty&&this.isDone(null!=i?i:this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var t;if("number"==typeof r){let t=Date.now()+r;r=()=>Date.now()>t}for(this.parse||(this.parse=this.startParse()),null!=i&&(null==this.parse.stoppedAt||this.parse.stoppedAt>i)&&i<this.state.doc.length&&this.parse.stopAt(i);;){var e=this.parse.advance();if(e){if(this.fragments=this.withoutTempSkipped(Ea.addTree(e,this.fragments,null!=this.parse.stoppedAt)),this.treeLen=null!=(t=this.parse.stoppedAt)?t:this.state.doc.length,this.tree=e,this.parse=null,!(this.treeLen<(null!=i?i:this.state.doc.length)))return!0;this.parse=this.startParse()}if(r())return!1}})}takeTree(){let t,e;this.parse&&(t=this.parse.parsedPos)>=this.treeLen&&((null==this.parse.stoppedAt||this.parse.stoppedAt>t)&&this.parse.stopAt(t),this.withContext(()=>{for(;!(e=this.parse.advance()););}),this.treeLen=t,this.tree=e,this.fragments=this.withoutTempSkipped(Ea.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(t){var e=hu;hu=this;try{return t()}finally{hu=e}}withoutTempSkipped(t){for(var e;e=this.tempSkipped.pop();)t=uu(t,e.from,e.to);return t}changes(t,e){let{fragments:r,tree:i,treeLen:s,viewport:o,skipped:h}=this;if(this.takeTree(),!t.empty){let n=[];if(t.iterChangedRanges((t,e,r,i)=>n.push({fromA:t,toA:e,fromB:r,toB:i})),r=Ea.applyChanges(r,n),i=T.empty,s=0,o={from:t.mapPos(o.from,-1),to:t.mapPos(o.to,1)},this.skipped.length){h=[];for(var a of this.skipped){var u=t.mapPos(a.from,1),a=t.mapPos(a.to,-1);u<a&&h.push({from:u,to:a})}}}return new au(this.parser,e,r,i,s,o,h,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;var t=this.skipped.length;for(let t=0;t<this.skipped.length;t++){var{from:r,to:i}=this.skipped[t];r<e.to&&i>e.from&&(this.fragments=uu(this.fragments,r,i),this.skipped.splice(t--,1))}return!(this.skipped.length>=t||(this.reset(),0))}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(t,e){this.skipped.push({from:t,to:e})}static getSkippingParser(o){return new class extends Da{createParse(t,e,r){let i=r[0].from,n=r[r.length-1].to;var s;return{parsedPos:i,advance(){var t=hu;if(t){for(var e of r)t.tempSkipped.push(e);o&&(t.scheduleOn=t.scheduleOn?Promise.all([t.scheduleOn,o]):o)}return this.parsedPos=n,new T(ua.none,[],[],n-i)},stoppedAt:null,stopAt(){}}}}}isDone(t){t=Math.min(t,this.state.doc.length);var e=this.fragments;return this.treeLen>=t&&e.length&&0==e[0].from&&e[0].to>=t}static get(){return hu}}function uu(t,e,r){return Ea.applyChanges(t,[{fromA:e,toA:r,fromB:e,toB:r}])}class lu{constructor(t){this.context=t,this.tree=t.tree}apply(t){var e,t;return t.docChanged||this.tree!=this.context.tree?(e=this.context.changes(t.changes,t.state),t=this.context.treeLen==t.startState.doc.length?void 0:Math.max(t.changes.mapPos(this.context.treeLen),e.viewport.to),e.work(20,t)||e.takeTree(),new lu(e)):this}static init(t){var e=Math.min(3e3,t.doc.length),t=au.create(t.facet(vu).parser,t,{from:0,to:e});return t.work(20,e)||t.takeTree(),new lu(t)}}Ya.state=M.define({create:lu.init,update(t,e){for(var r of e.effects)if(r.is(Ya.setState))return r.value;return e.startState.facet(vu)!=e.state.facet(vu)?lu.init(e.state):t.apply(e)}});let cu=t=>{let e=setTimeout(()=>t(),500);return()=>clearTimeout(e)};"undefined"!=typeof requestIdleCallback&&(cu=t=>{let e=-1,r=setTimeout(()=>{e=requestIdleCallback(t,{timeout:400})},100);return()=>e<0?clearTimeout(r):cancelIdleCallback(e)});const fu="undefined"!=typeof navigator&&null!=(t=navigator.scheduling)&&t.isInputPending?()=>navigator.scheduling.isInputPending():null,du=h.fromClass(class Om{constructor(t){this.view=t,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(t){var e=this.view.state.field(Ya.state).context;(e.updateViewport(t.view.viewport)||this.view.viewport.to>e.treeLen)&&this.scheduleWork(),t.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(e)}scheduleWork(){var t,e;this.working||({state:t}=this.view,(e=t.field(Ya.state)).tree==e.context.tree&&e.context.isDone(t.doc.length))||(this.working=cu(this.work))}work(e){this.working=null;var r=Date.now();if(this.chunkEnd<r&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=r+3e4,this.chunkBudget=3e3),!(this.chunkBudget<=0)){var{state:i,viewport:{to:n}}=this.view,s=i.field(Ya.state);if(s.tree!=s.context.tree||!s.context.isDone(n+1e5)){let t=Date.now()+Math.min(this.chunkBudget,100,e&&!fu?Math.max(25,e.timeRemaining()-5):1e9);var e=s.context.treeLen<n&&i.doc.length>n+1e3,i=s.context.work(()=>fu&&fu()||Date.now()>t,n+(e?0:1e5));this.chunkBudget-=Date.now()-r,(i||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:Ya.setState.of(new lu(s.context))})),0<this.chunkBudget&&(!i||e)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}}}checkAsyncSchedule(t){t.scheduleOn&&(this.workScheduled++,t.scheduleOn.then(()=>this.scheduleWork()).catch(t=>ni(this.view.state,t)).then(()=>this.workScheduled--),t.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||0<this.workScheduled)}},{eventHandlers:{focus(){this.scheduleWork()}}}),vu=m.define({combine(t){return t.length?t[0]:null},enables:e=>[Ya.state,du,E.contentAttributes.compute([e],t=>{var t=t.facet(e);return t&&t.name?{"data-language":t.name}:{}})]});class mu{constructor(t,e=[]){this.language=t,this.support=e,this.extension=[t,e]}}class pu{constructor(t,e,r,i,n,s=void 0){this.name=t,this.alias=e,this.extensions=r,this.filename=i,this.loadFunc=n,this.support=s,this.loading=null}load(){return this.loading||(this.loading=this.loadFunc().then(t=>this.support=t,t=>{throw this.loading=null,t}))}static of(t){let{load:e,support:r}=t;if(!e){if(!r)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");e=()=>Promise.resolve(r)}return new pu(t.name,(t.alias||[]).concat(t.name).map(t=>t.toLowerCase()),t.extensions||[],t.filename,e,r)}static matchFilename(t,e){for(var r of t)if(r.filename&&r.filename.test(e))return r;var i=/\.([^.]+)$/.exec(e);if(i)for(var n of t)if(-1<n.extensions.indexOf(i[1]))return n;return null}static matchLanguageName(t,e,r=!0){e=e.toLowerCase();for(var i of t)if(i.alias.some(t=>t==e))return i;if(r)for(var n of t)for(var s of n.alias){var o=e.indexOf(s);if(-1<o&&(2<s.length||!/\w/.test(e[o-1])&&!/\w/.test(e[o+s.length])))return n}return null}}const gu=m.define(),wu=m.define({combine:t=>{if(!t.length)return"  ";let e=t[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(t[0]));return e}});function bu(t){var e=t.facet(wu);return 9==e.charCodeAt(0)?t.tabSize*e.length:e.length}function ku(t,e){let r="",i=t.tabSize,n=t.facet(wu)[0];if("\t"==n){for(;i<=e;)r+="\t",e-=i;n=" "}for(let t=0;t<e;t++)r+=n;return r}function yu(t,e){for(var r of(t=t instanceof C?new xu(t):t).state.facet(gu)){var r=r(t,e);if(void 0!==r)return r}var i=A(t.state);return i?Su(t,i,e):null}function Mu(r,t,i){let n=Object.create(null);var s=new xu(r,{overrideIndentation:t=>{var t;return null!=(t=n[t])?t:-1}}),o=[];for(let e=t;e<=i;){var h=r.doc.lineAt(e),a,u;e=h.to+1;let t=yu(s,h.from);null!=t&&(/\S/.test(h.text)||(t=0),(a=/^\s*/.exec(h.text)[0])!=(u=ku(r,t)))&&(n[h.from]=t,o.push({from:h.from,to:h.from+a.length,insert:u}))}return r.changes(o)}class xu{constructor(t,e={}){this.state=t,this.options=e,this.unit=bu(t)}lineAt(t,e=1){var r=this.state.doc.lineAt(t),{simulateBreak:i,simulateDoubleBreak:n}=this.options;return null!=i&&i>=r.from&&i<=r.to?n&&i==t?{text:"",from:t}:(e<0?i<t:i<=t)?{text:r.text.slice(i-r.from),from:i}:{text:r.text.slice(0,i-r.from),from:r.from}:r}textAfterPos(t,e=1){var e,r;return this.options.simulateDoubleBreak&&t==this.options.simulateBreak?"":({text:e,from:r}=this.lineAt(t,e),e.slice(t-r,Math.min(e.length,t+100-r)))}column(t,e=1){var{text:e,from:r}=this.lineAt(t,e);let i=this.countColumn(e,t-r);var t=this.options.overrideIndentation?this.options.overrideIndentation(r):-1;return-1<t&&(i+=t-this.countColumn(e,e.search(/\S|$/))),i}countColumn(t,e=t.length){return je(t,this.state.tabSize,e)}lineIndent(t,e=1){var{text:t,from:e}=this.lineAt(t,e),r=this.options.overrideIndentation;if(r){var r=r(e);if(-1<r)return r}return this.countColumn(t,t.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const Cu=new L;function Su(t,e,r){return Ou(e.resolveInner(r).enterUnfinishedNodesBefore(r),r,t)}function Pu(t){return t.pos==t.options.simulateBreak&&t.options.simulateDoubleBreak}function ju(t){var e=t.type.prop(Cu);if(e)return e;let r=t.firstChild,i;if(r&&(i=r.type.prop(L.closedBy))){let e=t.lastChild,r=e&&-1<i.indexOf(e.name);return t=>Lu(t,!0,1,void 0,r&&!Pu(t)?e.from:void 0)}return null==t.parent?Eu:null}function Ou(t,e,r){for(;t;t=t.parent){var i=ju(t);if(i)return i(Du.create(r,e,t))}return null}function Eu(){return 0}class Du extends xu{constructor(t,e,r){super(t.state,t.options),this.base=t,this.pos=e,this.node=r}static create(t,e,r){return new Du(t,e,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let e=this.state.doc.lineAt(this.node.from);for(;;){let t=this.node.resolve(e.from);for(;t.parent&&t.parent.from==t.from;)t=t.parent;if(Au(t,this.node))break;e=this.state.doc.lineAt(t.from)}return this.lineIndent(e.from)}continue(){var t=this.node.parent;return t?Ou(t,this.pos,this.base):0}}function Au(e,r){for(let t=r;t;t=t.parent)if(e==t)return 1}function Ru(t){var e=t.node,r=e.childAfter(e.from),i=e.lastChild;if(!r)return null;var n=t.options.simulateBreak,t=t.state.doc.lineAt(r.from),s=null==n||n<=t.from?t.to:Math.min(t.to,n);for(let t=r.to;;){var o=e.childAfter(t);if(!o||o==i)return null;if(!o.type.isSkipped)return o.from<s?r:null;t=o.to}}function Iu({closing:e,align:r=!0,units:i=1}){return t=>Lu(t,r,i,e)}function Lu(t,e,r,i,n){var s=t.textAfter,o=s.match(/^\s*/)[0].length,s=i&&s.slice(o,o+i.length)==i||n==t.pos+o,i=e?Ru(t):null;return i?s?t.column(i.from):t.column(i.to):t.baseIndent+(s?0:t.unit*r)}var vr=t=>t.baseIndent;function Tu({except:r,units:i=1}={}){return t=>{var e=r&&r.test(t.textAfter);return t.baseIndent+(e?0:i*t.unit)}}const Bu=200;function _u(){return C.transactionFilter.of(t=>{if(!t.docChanged||!t.isUserEvent("input.type")&&!t.isUserEvent("input.complete"))return t;var e=t.startState.languageDataAt("indentOnInput",t.startState.selection.main.head);if(!e.length)return t;var r=t.newDoc,{head:i}=t.newSelection.main,n=r.lineAt(i),s;if(i>n.from+Bu)return t;let o=r.sliceString(n.from,i);if(!e.some(t=>t.test(o)))return t;let{state:h}=t,a=-1,u=[];for({head:s}of h.selection.ranges){var l=h.doc.lineAt(s),c,f,d;l.from!=a&&(a=l.from,null!=(c=yu(h,l.from))&&(f=/^\s*/.exec(l.text)[0])!=(d=ku(h,c)))&&u.push({from:l.from,to:l.from+f.length,insert:d})}return u.length?[t,{changes:u,sequential:!0}]:t})}const Fu=m.define(),Nu=new L;function $u(t){var e=t.firstChild,r=t.lastChild;return e&&e.to<r.from?{from:e.to,to:r.type.isError?t.to:r.from}:null}function Hu(e,r,i){var n=A(e),t;if(n.length<i)return null;let s=null;for(let t=n.resolveInner(i,1);t;t=t.parent)if(!(t.to<=i||t.from>i)){if(s&&t.from<r)break;var o=t.type.prop(Nu),o;o&&(t.to<n.length-50||n.length==e.doc.length||!Uu(t))&&(o=o(t,e))&&o.from<=i&&o.from>=r&&o.to>i&&(s=o)}return s}function Uu(t){var e=t.lastChild;return e&&e.to==t.to&&e.type.isError}function zu(t,e,r){for(var i of t.facet(Fu)){var i=i(t,e,r);if(i)return i}return Hu(t,e,r)}function Wu(t,e){var r=e.mapPos(t.from,1),e=e.mapPos(t.to,-1);return e<=r?void 0:{from:r,to:e}}const Vu=l.define({map:Wu}),qu=l.define({map:Wu});function Gu(t){var r=[];for(let{head:e}of t.state.selection.ranges)r.some(t=>t.from<=e&&t.to>=e)||r.push(t.lineBlockAt(e));return r}const Ju=M.define({create(){return j.none},update(t,e){t=t.map(e.changes);for(let r of e.effects)r.is(Vu)&&!Xu(t,r.value.from,r.value.to)?t=t.update({add:[sl.range(r.value.from,r.value.to)]}):r.is(qu)&&(t=t.update({filter:(t,e)=>r.value.from!=t||r.value.to!=e,filterFrom:r.value.from,filterTo:r.value.to}));if(e.selection){let r=!1,{head:i}=e.selection.main;t.between(i,i,(t,e)=>{t<i&&e>i&&(r=!0)}),r&&(t=t.update({filterFrom:i,filterTo:i,filter:(t,e)=>e<=i||t>=i}))}return t},provide:t=>E.decorations.from(t),toJSON(t,e){let r=[];return t.between(0,e.doc.length,(t,e)=>{r.push(t,e)}),r},fromJSON(e){if(!Array.isArray(e)||e.length%2)throw new RangeError("Invalid JSON for fold state");var r=[];for(let t=0;t<e.length;){var i=e[t++],n=e[t++];if("number"!=typeof i||"number"!=typeof n)throw new RangeError("Invalid JSON for fold state");r.push(sl.range(i,n))}return j.set(r,!0)}});function Ku(t){return t.field(Ju,!1)||S.empty}function Qu(t,e,r){var t;let i=null;return null!=(t=t.field(Ju,!1))&&t.between(e,r,(t,e)=>{(!i||i.from>t)&&(i={from:t,to:e})}),i}function Xu(t,r,i){let n=!1;return t.between(r,r,(t,e)=>{t==r&&e==i&&(n=!0)}),n}function Zu(t,e){return t.field(Ju,!1)?e:e.concat(l.appendConfig.of(nl()))}var _=t=>{for(var e of Gu(t)){var e=zu(t.state,e.from,e.to);if(e)return t.dispatch({effects:Zu(t.state,[Vu.of(e),Yu(t,e)])}),!0}return!1},mr=t=>{if(!t.state.field(Ju,!1))return!1;var e=[],r;for(r of Gu(t)){var i=Qu(t.state,r.from,r.to);i&&e.push(qu.of(i),Yu(t,i,!1))}return e.length&&t.dispatch({effects:e}),0<e.length};function Yu(t,e,r=!0){var i=t.state.doc.lineAt(e.from).number,e=t.state.doc.lineAt(e.to).number;return E.announce.of(`${t.state.phrase(r?"Folded lines":"Unfolded lines")} ${i} ${t.state.phrase("to")} ${e}.`)}var fr=e=>{var{state:r}=e,i=[];for(let t=0;t<r.doc.length;){var n=e.lineBlockAt(t),s=zu(r,n.from,n.to);s&&i.push(Vu.of(s)),t=(s?e.lineBlockAt(s.to):n).to+1}return i.length&&e.dispatch({effects:Zu(e.state,i)}),!!i.length},dr=t=>{var e=t.state.field(Ju,!1);if(!e||!e.size)return!1;let r=[];return e.between(0,t.state.doc.length,(t,e)=>{r.push(qu.of({from:t,to:e}))}),t.dispatch({effects:r}),!0};function tl(e,r){for(let t=r;;){var i=zu(e.state,t.from,t.to);if(i&&i.to>r.from)return i;if(!t.from)return null;t=e.lineBlockAt(t.from-1)}}var r=t=>{var e=[],r;for(r of Gu(t)){var i=Qu(t.state,r.from,r.to),i;i?e.push(qu.of(i),Yu(t,i,!1)):(i=tl(t,r))&&e.push(Vu.of(i),Yu(t,i))}return 0<e.length&&t.dispatch({effects:Zu(t.state,e)}),!!e.length};const el=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:_},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:mr},{key:"Ctrl-Alt-[",run:fr},{key:"Ctrl-Alt-]",run:dr}],rl={placeholderDOM:null,placeholderText:"\u2026"},il=m.define({combine(t){return le(t,rl)}});function nl(t){var e=[Ju,ul];return t&&e.push(il.of(t)),e}const sl=j.replace({widget:new class extends Tr{toDOM(r){var{state:t}=r,e=t.facet(il),i=t=>{var e=r.lineBlockAt(r.posAtDOM(t.target)),e=Qu(r.state,e.from,e.to);e&&r.dispatch({effects:qu.of(e)}),t.preventDefault()},n;return e.placeholderDOM?e.placeholderDOM(r,i):((n=document.createElement("span")).textContent=e.placeholderText,n.setAttribute("aria-label",t.phrase("folded code")),n.title=t.phrase("unfold"),n.className="cm-foldPlaceholder",n.onclick=i,n)}}}),ol={openText:"\u2304",closedText:"\u203a",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class hl extends Oh{constructor(t,e){super(),this.config=t,this.open=e}eq(t){return this.config==t.config&&this.open==t.open}toDOM(t){var e;return this.config.markerDOM?this.config.markerDOM(this.open):((e=document.createElement("span")).textContent=this.open?this.config.openText:this.config.closedText,e.title=t.state.phrase(this.open?"Fold line":"Unfold line"),e)}}function al(t={}){let e=Object.assign(Object.assign({},ol),t),n=new hl(e,!0),s=new hl(e,!1),r=h.fromClass(class{constructor(t){this.from=t.viewport.from,this.markers=this.buildMarkers(t)}update(t){(t.docChanged||t.viewportChanged||t.startState.facet(vu)!=t.state.facet(vu)||t.startState.field(Ju,!1)!=t.state.field(Ju,!1)||A(t.startState)!=A(t.state)||e.foldingChanged(t))&&(this.markers=this.buildMarkers(t.view))}buildMarkers(t){var e=new pe,r;for(r of t.viewportLineBlocks){var i=Qu(t.state,r.from,r.to)?s:zu(t.state,r.from,r.to)?n:null;i&&e.add(r.from,r.from,i)}return e.finish()}}),{domEventHandlers:i}=e;return[r,Rh({class:"cm-foldGutter",markers(t){var t;return(null==(t=t.plugin(r))?void 0:t.markers)||S.empty},initialSpacer(){return new hl(e,!1)},domEventHandlers:Object.assign(Object.assign({},i),{click:(t,e,r)=>{var r,r;return!((!i.click||!i.click(t,e,r))&&((r=Qu(t.state,e.from,e.to))?(t.dispatch({effects:qu.of(r)}),0):!(r=zu(t.state,e.from,e.to))||(t.dispatch({effects:Vu.of(r)}),0)))}})}),nl()]}const ul=E.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class ll{constructor(t,e){this.specs=t;let r;function i(t){var e=Ie.newName();return(r=r||Object.create(null))["."+e]=t,e}var n="string"==typeof e.all?e.all:e.all?i(e.all):void 0;const s=e.scope;this.scope=s instanceof Ya?t=>t.prop(Qa)==s.data:s?t=>t==s:void 0,this.style=Ha(t.map(t=>({tag:t.tag,class:t.class||i(Object.assign({},t,{tag:null}))})),{all:n}).style,this.module=r?new Ie(r):null,this.themeType=e.themeType}static define(t,e){return new ll(t,e||{})}}const cl=m.define(),fl=m.define({combine(t){return t.length?[t[0]]:null}});function dl(t){var e=t.facet(cl);return e.length?e:t.facet(fl)}function vl(e,t){let r=[gl],i;return e instanceof ll&&(e.module&&r.push(E.styleModule.of(e.module)),i=e.themeType),null!=t&&t.fallback?r.push(fl.of(e)):i?r.push(cl.computeN([E.darkTheme],t=>t.facet(E.darkTheme)==("dark"==i)?[e]:[])):r.push(cl.of(e)),r}function ml(t,e,r){var t=dl(t),i;let n=null;if(t)for(var i of t){(!i.scope||r&&i.scope(r))&&(i=i.style(e))&&(n=n?n+" "+i:i)}return n}class pl{constructor(t){this.markCache=Object.create(null),this.tree=A(t.state),this.decorations=this.buildDeco(t,dl(t.state))}update(t){var e=A(t.state),r=dl(t.state),i=r!=dl(t.startState);e.length<t.view.viewport.to&&!i&&e.type==this.tree.type?this.decorations=this.decorations.map(t.changes):(e!=this.tree||t.viewportChanged||i)&&(this.tree=e,this.decorations=this.buildDeco(t.view,r))}buildDeco(t,e){if(!e||!this.tree.length)return j.none;let i=new pe;for(var{from:r,to:n}of t.visibleRanges)za(this.tree,e,(t,e,r)=>{i.add(t,e,this.markCache[r]||(this.markCache[r]=j.mark({class:r})))},r,n);return i.finish()}}const gl=Lt.high(h.fromClass(pl,{decorations:t=>t.decorations})),wl=ll.define([{tag:D.meta,color:"#404740"},{tag:D.link,textDecoration:"underline"},{tag:D.heading,textDecoration:"underline",fontWeight:"bold"},{tag:D.emphasis,fontStyle:"italic"},{tag:D.strong,fontWeight:"bold"},{tag:D.strikethrough,textDecoration:"line-through"},{tag:D.keyword,color:"#708"},{tag:[D.atom,D.bool,D.url,D.contentSeparator,D.labelName],color:"#219"},{tag:[D.literal,D.inserted],color:"#164"},{tag:[D.string,D.deleted],color:"#a11"},{tag:[D.regexp,D.escape,D.special(D.string)],color:"#e40"},{tag:D.definition(D.variableName),color:"#00f"},{tag:D.local(D.variableName),color:"#30a"},{tag:[D.typeName,D.namespace],color:"#085"},{tag:D.className,color:"#167"},{tag:[D.special(D.variableName),D.macroName],color:"#256"},{tag:D.definition(D.propertyName),color:"#00c"},{tag:D.comment,color:"#940"},{tag:D.invalid,color:"#f00"}]);var n=E.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),bl,kl,yl;const Ml=1e4,xl="()[]{}",Cl=m.define({combine(t){return le(t,{afterCursor:!0,brackets:xl,maxScanDistance:Ml,renderMatch:jl})}}),Sl=j.mark({class:"cm-matchingBracket"}),Pl=j.mark({class:"cm-nonmatchingBracket"});function jl(t){var e=[],r=t.matched?Sl:Pl;return e.push(r.range(t.start.from,t.start.to)),t.end&&e.push(r.range(t.end.from,t.end.to)),e}const Ol=[M.define({create(){return j.none},update(t,e){if(!e.docChanged&&!e.selection)return t;let r=[];var i=e.state.facet(Cl),n,s;for(n of e.state.selection.ranges){n.empty&&(s=Il(e.state,n.head,-1,i)||0<n.head&&Il(e.state,n.head-1,1,i)||i.afterCursor&&(Il(e.state,n.head,1,i)||n.head<e.state.doc.length&&Il(e.state,n.head+1,-1,i)))&&(r=r.concat(i.renderMatch(s,e.state)))}return j.set(r,!0)},provide:t=>E.decorations.from(t)}),n];function El(t={}){return[Cl.of(t),Ol]}const Dl=new L;function Al(t,e,r){var i=t.prop(e<0?L.openedBy:L.closedBy);if(i)return i;if(1==t.name.length){var i=r.indexOf(t.name);if(-1<i&&i%2==(e<0?1:0))return[r[i+e]]}return null}function Rl(t){var e=t.type.prop(Dl);return e?e(t.node):t}function Il(e,r,i,t={}){var n=t.maxScanDistance||Ml,s=t.brackets||xl,t=A(e),o=t.resolveInner(r,i);for(let t=o;t;t=t.parent){var h=Al(t.type,i,s);if(h&&t.from<t.to){var a=Rl(t);if(a&&(0<i?r>=a.from&&r<a.to:r>a.from&&r<=a.to))return Ll(e,r,i,t,a,h,s)}}return Tl(e,r,i,t,o.type,n,s)}function Ll(t,e,r,i,n,s,o){var h=i.parent,a={from:n.from,to:n.to},u,u;let l=0,c=null==h?void 0:h.cursor();if(c&&(r<0?c.childBefore(i.from):c.childAfter(i.to)))do{if(r<0?c.to<=i.from:c.from>=i.to){if(0==l&&-1<s.indexOf(c.type.name)&&c.from<c.to)return{start:a,end:(u=Rl(c))?{from:u.from,to:u.to}:void 0,matched:!0};if(Al(c.type,r,o))l++;else if(Al(c.type,-r,o)){if(0==l)return{start:a,end:(u=Rl(c))&&u.from<u.to?{from:u.from,to:u.to}:void 0,matched:!1};l--}}}while(r<0?c.prevSibling():c.nextSibling());return{start:a,matched:!1}}function Tl(t,e,r,i,n,s,o){var h=r<0?t.sliceDoc(e-1,e):t.sliceDoc(e,e+1),a=o.indexOf(h);if(a<0||a%2==0!=0<r)return null;var u={from:r<0?e-1:e,to:0<r?e+1:e};let l=t.doc.iterRange(e,0<r?t.doc.length:0),c=0;for(let t=0;!l.next().done&&t<=s;){var f=l.value,d=(r<0&&(t+=f.length),e+t*r);for(let t=0<r?0:f.length-1,e=0<r?f.length:-1;t!=e;t+=r){var v=o.indexOf(f[t]);if(!(v<0||i.resolveInner(d+t,1).type!=n))if(v%2==0==0<r)c++;else{if(1==c)return{start:u,end:{from:d+t,to:d+t+1},matched:v>>1==a>>1};c--}}0<r&&(t+=f.length)}return l.done?{start:u,matched:!1}:null}function Bl(e,r,i,n=0,t=0){null==r&&-1==(r=e.search(/[^\s\u00a0]/))&&(r=e.length);let s=t;for(let t=n;t<r;t++)9==e.charCodeAt(t)?s+=i-s%i:s++;return s}class _l{constructor(t,e,r,i){this.string=t,this.tabSize=e,this.indentUnit=r,this.overrideIndent=i,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return 0==this.pos}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(t){var e=this.string.charAt(this.pos);let r;if(r="string"==typeof t?e==t:e&&(t instanceof RegExp?t.test(e):t(e)))return++this.pos,e}eatWhile(t){for(var e=this.pos;this.eat(t););return this.pos>e}eatSpace(){for(var t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t}skipToEnd(){this.pos=this.string.length}skipTo(t){var t=this.string.indexOf(t,this.pos);if(-1<t)return this.pos=t,!0}backUp(t){this.pos-=t}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Bl(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){var t;return null!=(t=this.overrideIndent)?t:Bl(this.string,null,this.tabSize)}match(t,e,r){var i,n,i;return"string"==typeof t?(i=t=>r?t.toLowerCase():t)(this.string.substr(this.pos,t.length))==i(t)?(!1!==e&&(this.pos+=t.length),!0):null:(i=this.string.slice(this.pos).match(t))&&0<i.index?null:(i&&!1!==e&&(this.pos+=i[0].length),i)}current(){return this.string.slice(this.start,this.pos)}}function Fl(t){return{name:t.name||"",token:t.token,blankLine:t.blankLine||(()=>{}),startState:t.startState||(()=>!0),copyState:t.copyState||Nl,indent:t.indent||(()=>null),languageData:t.languageData||{},tokenTable:t.tokenTable||Gl}}function Nl(t){if("object"!=typeof t)return t;var e={},r;for(r in t){var i=t[r];e[r]=i instanceof Array?i.slice():i}return e}const $l=new WeakMap;class Hl extends Ya{constructor(t){var e=Xa(t.languageData),r;let i=Fl(t),n;super(e,new class extends Da{createParse(t,e,r){return new Vl(n,t,e,r)}},[gu.of((t,e)=>this.getIndent(t,e))],t.name),this.topNode=rc(e),(n=this).streamParser=i,this.stateAfter=new L({perNode:!0}),this.tokenTable=t.tokenTable?new Zl(i.tokenTable):Yl}static define(t){return new Hl(t)}getIndent(t,e){let r=A(t.state),i=r.resolve(e);for(;i&&i.type!=this.topNode;)i=i.parent;if(!i)return null;let n=void 0;var{overrideIndentation:s}=t.options;s&&null!=(n=$l.get(t.state))&&n<e-1e4&&(n=void 0);let o=Ul(this,r,0,i.from,null!==n&&void 0!==n?n:e),h,a;if(1e4<e-(h=o?(a=o.state,o.pos+1):(a=this.streamParser.startState(t.unit),0)))return null;for(;h<e;){var u=t.state.doc.lineAt(h),l=Math.min(e,u.to);if(u.length)for(var c=s?s(u.from):-1,f=new _l(u.text,t.state.tabSize,t.unit,c<0?void 0:c);f.pos<l-u.from;)ql(this.streamParser.token,f,a);else this.streamParser.blankLine(a,t.unit);if(l==e)break;h=u.to+1}var d=t.lineAt(e);return s&&null==n&&$l.set(t.state,d.from),this.streamParser.indent(a,/^\s*(.*)/.exec(d.text)[1],t)}get allowsNesting(){return!1}}function Ul(e,r,i,n,s){var t=n<=i&&i+r.length<=s&&r.prop(e.stateAfter);if(t)return{state:e.streamParser.copyState(t),pos:i+r.length};for(let t=r.children.length-1;0<=t;t--){var o=r.children[t],h=i+r.positions[t],o=o instanceof T&&h<s&&Ul(e,o,h,n,s);if(o)return o}return null}function zl(e,r,i,n,s){if(s&&i<=0&&n>=r.length)return r;s||r.type!=e.topNode||(s=!0);for(let t=r.children.length-1;0<=t;t--){var o=r.positions[t],h=r.children[t],h;if(o<n&&h instanceof T){if(h=zl(e,h,i-o,n-o,s))return s?new T(r.type,r.children.slice(0,t).concat(h),r.positions.slice(0,t+1),o+h.length):h;break}}return null}function Wl(r,t,i,e){for(var n of t){var s=n.from+(n.openStart?25:0),o=n.to-(n.openEnd?25:0);let t=s<=i&&i<o&&Ul(r,n.tree,0-n.offset,i,o),e;if(t&&(e=zl(r,n.tree,i+n.offset,t.pos+n.offset,!1)))return{state:t.state,tree:e}}return{state:r.streamParser.startState(e?bu(e):4),tree:T.empty}}class Vl{constructor(t,e,r,i){this.lang=t,this.input=e,this.fragments=r,this.ranges=i,this.stoppedAt=null,this.chunks=[],this.chunkPos=[],this.chunk=[],this.chunkReused=void 0,this.rangeIndex=0,this.to=i[i.length-1].to;var e=au.get(),i=i[0].from,{state:t,tree:n}=Wl(t,r,i,null==e?void 0:e.state);this.state=t,this.parsedPos=this.chunkStart=i+n.length;for(let t=0;t<n.children.length;t++)this.chunks.push(n.children[t]),this.chunkPos.push(n.positions[t]);e&&this.parsedPos<e.viewport.from-1e5&&(this.state=this.lang.streamParser.startState(bu(e.state)),e.skipUntilInView(this.parsedPos,e.viewport.from),this.parsedPos=e.viewport.from),this.moveRangeIndex()}advance(){var t=au.get(),e=null==this.stoppedAt?this.to:Math.min(this.to,this.stoppedAt);let r=Math.min(e,this.chunkStart+2048);for(t&&(r=Math.min(r,t.viewport.to));this.parsedPos<r;)this.parseLine(t);return this.chunkStart<this.parsedPos&&this.finishChunk(),this.parsedPos>=e?this.finish():t&&this.parsedPos>=t.viewport.to?(t.skipUntilInView(this.parsedPos,e),this.finish()):null}stopAt(t){this.stoppedAt=t}lineAfter(t){let e=this.input.chunk(t);var r;return this.input.lineChunks?"\n"==e&&(e=""):-1<(r=e.indexOf("\n"))&&(e=e.slice(0,r)),t+e.length<=this.to?e:e.slice(0,this.to-t)}nextLine(){let t=this.parsedPos,e=this.lineAfter(t),r=t+e.length;for(let t=this.rangeIndex;;){var i=this.ranges[t].to;if(i>=r)break;if(e=e.slice(0,i-(r-e.length)),++t==this.ranges.length)break;var i=this.ranges[t].from,n=this.lineAfter(i);e+=n,r=i+n.length}return{line:e,end:r}}skipGapsTo(t,e,r){for(;;){var i=this.ranges[this.rangeIndex].to,n=t+e,s;if(0<r?n<i:n<=i)break;e+=this.ranges[++this.rangeIndex].from-i}return e}moveRangeIndex(){for(;this.ranges[this.rangeIndex].to<this.parsedPos;)this.rangeIndex++}emitToken(t,e,r,i,n){var s;return 1<this.ranges.length&&(e+=n=this.skipGapsTo(e,n,1),s=this.chunk.length,r+=n=this.skipGapsTo(r,n,-1),i+=this.chunk.length-s),this.chunk.push(t,e,r,i),n}parseLine(t){let{line:e,end:r}=this.nextLine(),i=0,{streamParser:n}=this.lang;var s=new _l(e,t?t.state.tabSize:4,t?bu(t.state):2);if(s.eol())n.blankLine(this.state,s.indentUnit);else for(;!s.eol();){var o=ql(n.token,s,this.state);if(o&&(i=this.emitToken(this.lang.tokenTable.resolve(o),this.parsedPos+s.start,this.parsedPos+s.pos,4,i)),1e4<s.start)break}this.parsedPos=r,this.moveRangeIndex(),this.parsedPos<this.to&&this.parsedPos++}finishChunk(){var t=T.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet:Kl,topID:0,maxBufferLength:2048,reused:this.chunkReused}),t=new T(t.type,t.children,t.positions,t.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]);this.chunks.push(t),this.chunkPos.push(this.chunkStart-this.ranges[0].from),this.chunk=[],this.chunkReused=void 0,this.chunkStart=this.parsedPos}finish(){return new T(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance()}}function ql(e,r,i){r.start=r.pos;for(let t=0;t<10;t++){var n=e(r,i);if(r.pos>r.start)return n}throw new Error("Stream parser failed to advance stream.")}const Gl=Object.create(null),Jl=[ua.none],Kl=new la(Jl),Ql=[],Xl=Object.create(null);for([kl,yl]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])Xl[kl]=ec(Gl,yl);class Zl{constructor(t){this.extra=t,this.table=Object.assign(Object.create(null),Xl)}resolve(t){return t?this.table[t]||(this.table[t]=ec(this.extra,t)):0}}const Yl=new Zl(Gl);function tc(t,e){-1<Ql.indexOf(t)||(Ql.push(t),console.warn(e))}function ec(t,e){let r=null;for(var i of e.split(".")){var n=t[i]||D[i];n?"function"==typeof n?r?r=n(r):tc(i,`Modifier ${i} used at start of tag`):r?tc(i,`Tag ${i} used as modifier`):r=n:tc(i,"Unknown highlighting tag "+i)}var e,e;return r?(e=e.replace(/ /g,"_"),e=ua.define({id:Jl.length,name:e,props:[Fa({[e]:r})]}),Jl.push(e),e.id):0}function rc(t){var e=ua.define({id:Jl.length,name:"Document",props:[Qa.add(()=>t)]});return Jl.push(e),e}V=Object.freeze({__proto__:null,DocInput:ou,HighlightStyle:ll,IndentContext:xu,LRLanguage:eu,Language:Ya,LanguageDescription:pu,LanguageSupport:mu,ParseContext:au,StreamLanguage:Hl,StringStream:_l,TreeIndentContext:Du,bracketMatching:El,bracketMatchingHandle:Dl,codeFolding:nl,continuedIndent:Tu,defaultHighlightStyle:wl,defineLanguageFacet:Xa,delimitedIndent:Iu,ensureSyntaxTree:ru,flatIndent:vr,foldAll:fr,foldCode:_,foldEffect:Vu,foldGutter:al,foldInside:$u,foldKeymap:el,foldNodeProp:Nu,foldService:Fu,foldState:Ju,foldable:zu,foldedRanges:Ku,forceParsing:nu,getIndentUnit:bu,getIndentation:yu,highlightingFor:ml,indentNodeProp:Cu,indentOnInput:_u,indentRange:Mu,indentService:gu,indentString:ku,indentUnit:wu,language:vu,languageDataProp:Qa,matchBrackets:Il,sublanguageProp:Za,syntaxHighlighting:vl,syntaxParserRunning:su,syntaxTree:A,syntaxTreeAvailable:iu,toggleFold:r,unfoldAll:dr,unfoldCode:mr,unfoldEffect:qu});class ic{constructor(t,e,r){this.state=t,this.pos=e,this.explicit=r,this.abortListeners=[]}tokenBefore(t){let e=A(this.state).resolveInner(this.pos,-1);for(;e&&t.indexOf(e.name)<0;)e=e.parent;return e?{from:e.from,to:this.pos,text:this.state.sliceDoc(e.from,this.pos),type:e.type}:null}matchBefore(t){var e=this.state.doc.lineAt(this.pos),r=Math.max(e.from,this.pos-250),e=e.text.slice(r-e.from,this.pos-e.from),t=e.search(cc(t,!1));return t<0?null:{from:r+t,to:this.pos,text:e.slice(t)}}get aborted(){return null==this.abortListeners}addEventListener(t,e){"abort"==t&&this.abortListeners&&this.abortListeners.push(e)}}function nc(t){let e=Object.keys(t).join("");var t=/\w/.test(e);return`[${t?"\\w":""}${(e=t?e.replace(/\w/g,""):e).replace(/[^\w\s]/g,"\\$&")}]`}function sc(t){var e=Object.create(null),r=Object.create(null),i;for({label:i}of t){e[i[0]]=!0;for(let t=1;t<i.length;t++)r[i[t]]=!0}var t=nc(e)+nc(r)+"*$";return[new RegExp("^"+t),new RegExp(t)]}function oc(t){let r=t.map(t=>"string"==typeof t?{label:t}:t),[i,n]=r.every(t=>/^\w+$/.test(t.label))?[/\w*$/,/\w+$/]:sc(r);return t=>{var e=t.matchBefore(n);return e||t.explicit?{from:e?e.from:t.pos,options:r,validFor:i}:null}}function hc(r,i){return e=>{for(let t=A(e.state).resolveInner(e.pos,-1);t;t=t.parent){if(-1<r.indexOf(t.name))return i(e);if(t.type.isTop)break}return null}}function ac(r,t){return e=>{for(let t=A(e.state).resolveInner(e.pos,-1);t;t=t.parent){if(-1<r.indexOf(t.name))return null;if(t.type.isTop)break}return t(e)}}class uc{constructor(t,e,r,i){this.completion=t,this.source=e,this.match=r,this.score=i}}function lc(t){return t.selection.main.from}function cc(t,e){var e,{source:r}=t,e=e&&"^"!=r[0],i="$"!=r[r.length-1];return e||i?new RegExp(`${e?"^":""}(?:${r})`+(i?"$":""),null!=(e=t.flags)?e:t.ignoreCase?"i":""):t}const fc=Kt.define();function dc(e,r,i,n){let{main:s}=e.selection,o=i-s.from,h=n-s.from;return Object.assign(Object.assign({},e.changeByRange(t=>t!=s&&i!=n&&e.sliceDoc(t.from+o,t.from+h)!=e.sliceDoc(i,n)?{range:t}:{changes:{from:t.from+o,to:n==s.from?t.to:t.from+h,insert:r},range:b.cursor(t.from+o+r.length)})),{userEvent:"input.complete"})}const vc=new WeakMap;function mc(t){if(!Array.isArray(t))return t;let e=vc.get(t);return e||vc.set(t,e=oc(t)),e}const pc=l.define(),gc=l.define();class wc{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[];for(let t=0;t<e.length;){var r=x(e,t),i=vt(r),r=(this.chars.push(r),e.slice(t,t+i)),n=r.toUpperCase();this.folded.push(x(n==r?r.toLowerCase():n,0)),t+=i}this.astral=e.length!=this.chars.length}match(i){if(0==this.pattern.length)return[-100];if(i.length<this.pattern.length)return null;var{chars:n,folded:s,any:r,precise:o,byWord:h}=this;if(1==n.length){var e=x(i,0),a=vt(e);let t=a==i.length?0:-100;if(e!=n[0]){if(e!=s[0])return null;t+=-200}return[t,0,a]}var u=i.indexOf(this.pattern);if(0==u)return[i.length==this.pattern.length?0:-100,0,this.pattern.length];let l=n.length,c=0;if(u<0){for(let t=0,e=Math.min(i.length,200);t<e&&c<l;){var f=x(i,t);f!=n[c]&&f!=s[c]||(r[c++]=t),t+=vt(f)}if(c<l)return null}let d=0,v=0,m=!1,p=0,g=-1,w=-1,b=/[a-z]/.test(i),k=!0;for(let t=0,e=Math.min(i.length,200),r=0;t<e&&v<l;){var y=x(i,t);u<0&&(d<l&&y==n[d]&&(o[d++]=t),p<l)&&(y==n[p]||y==s[p]?(0==p&&(g=t),w=t+1,p++):p=0);var M,M=y<255?48<=y&&y<=57||97<=y&&y<=122?2:65<=y&&y<=90?1:0:(M=dt(y))!=M.toLowerCase()?1:M!=M.toUpperCase()?2:0;(!t||1==M&&b||0==r&&0!=M)&&(n[v]==y||s[v]==y&&(m=!0)?h[v++]=t:h.length&&(k=!1)),r=M,t+=vt(y)}return v==l&&0==h[0]&&k?this.result((m?-200:0)-100,h,i):p==l&&0==g?[-200-i.length+(w==i.length?0:-100),0,w]:-1<u?[-700-i.length,u,u+this.pattern.length]:p==l?[-900-i.length,g,w]:v==l?this.result((m?-200:0)-100-700+(k?0:-1100),h,i):2==n.length?null:this.result((r[0]?-700:0)-200-1100,r,i)}result(t,e,r){let i=[t-r.length],n=1;for(var s of e){var o=s+(this.astral?vt(x(r,s)):1);1<n&&i[n-1]==s?i[n-1]=o:(i[n++]=s,i[n++]=o)}return i}}const bc=m.define({combine(t){return le(t,{activateOnTyping:!0,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:yc,compareCompletions:(t,e)=>t.label.localeCompare(e.label),interactionDelay:75},{defaultKeymap:(t,e)=>t&&e,closeOnBlur:(t,e)=>t&&e,icons:(t,e)=>t&&e,tooltipClass:(e,r)=>t=>kc(e(t),r(t)),optionClass:(e,r)=>t=>kc(e(t),r(t)),addToOptions:(t,e)=>t.concat(e)})}});function kc(t,e){return t?e?t+" "+e:t:e}function yc(t,e,r,i,n){let s=t.textDirection==y.RTL,o=s,h=!1,a="top",u,l;var t=e.left-n.left,c=n.right-e.right,f=i.right-i.left,i=i.bottom-i.top,f;return o&&t<Math.min(f,c)?o=!1:!o&&c<Math.min(f,t)&&(o=!0),f<=(o?t:c)?(u=Math.max(n.top,Math.min(r.top,n.bottom-i))-e.top,l=Math.min(400,o?t:c)):(h=!0,l=Math.min(400,(s?e.right:n.right-e.left)-30),f=n.bottom-e.bottom,u=i<=f||f>e.top?r.bottom-e.top:(a="bottom",e.bottom-r.top)),{style:`${a}: ${u}px; max-width: ${l}px`,class:"cm-completionInfo-"+(h?s?"left-narrow":"right-narrow":o?"left":"right")}}function Mc(o,h="option"){return t=>{var e=t.state.field(R,!1);if(!e||!e.open||e.open.disabled||Date.now()-e.open.timestamp<t.state.facet(bc).interactionDelay)return!1;let r=1,i;"page"==h&&(i=gh(t,e.open.tooltip))&&(r=Math.max(2,Math.floor(i.dom.offsetHeight/i.dom.querySelector("li").offsetHeight)-1));var{length:n}=e.open.options;let s=-1<e.open.selected?e.open.selected+r*(o?1:-1):o?0:n-1;return s<0?s="page"==h?0:n-1:s>=n&&(s="page"==h?n-1:0),t.dispatch({effects:Gc.of(s)}),!0}}var qa=t=>{var e=t.state.field(R,!1);return!(t.state.readOnly||!e||!e.open||e.open.selected<0||Date.now()-e.open.timestamp<t.state.facet(bc).interactionDelay)&&(!!e.open.disabled||Oc(t,e.open.options[e.open.selected]))},Ga=t=>{var e;return!!t.state.field(R,!1)&&(t.dispatch({effects:pc.of(!0)}),!0)},Ja=t=>{var e=t.state.field(R,!1);return!(!e||!e.active.some(t=>0!=t.state)||(t.dispatch({effects:gc.of(null)}),0))};class xc{constructor(t,e){this.active=t,this.context=e,this.time=Date.now(),this.updates=[],this.done=void 0}}const Cc=50,Sc=50,Pc=1e3,jc=h.fromClass(class{constructor(t){this.view=t,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(var e of t.state.field(R).active)1==e.state&&this.startQuery(e)}update(e){var t=e.state.field(R);if(e.selectionSet||e.docChanged||e.startState.field(R)!=t){var r=e.transactions.some(t=>(t.selection||t.docChanged)&&!Uc(t));for(let t=0;t<this.running.length;t++){var i=this.running[t];if(r||50<i.updates.length+e.transactions.length&&Date.now()-i.time>Pc){for(var n of i.context.abortListeners)try{n()}catch(t){ni(this.view.state,t)}i.context.abortListeners=null,this.running.splice(t--,1)}else i.updates.push(...e.transactions)}if(-1<this.debounceUpdate&&clearTimeout(this.debounceUpdate),this.debounceUpdate=t.active.some(e=>1==e.state&&!this.running.some(t=>t.active.source==e.source))?setTimeout(()=>this.startUpdate(),50):-1,0!=this.composing)for(var s of e.transactions)"input"==Uc(s)?this.composing=2:2==this.composing&&s.selection&&(this.composing=3)}}startUpdate(){this.debounceUpdate=-1;var{state:t}=this.view,e;for(let e of t.field(R).active)1!=e.state||this.running.some(t=>t.active.source==e.source)||this.startQuery(e)}startQuery(t){var{state:e}=this.view,r=lc(e),e=new ic(e,r,t.explicitPos==r);let i=new xc(t,e);this.running.push(i),Promise.resolve(t.source(e)).then(t=>{i.context.aborted||(i.done=t||null,this.scheduleAccept())},t=>{this.view.dispatch({effects:gc.of(null)}),ni(this.view.state,t)})}scheduleAccept(){this.running.every(t=>void 0!==t.done)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),50))}accept(){var r,i=(-1<this.debounceAccept&&clearTimeout(this.debounceAccept),this.debounceAccept=-1,[]),n=this.view.state.facet(bc);for(let t=0;t<this.running.length;t++){let e=this.running[t];if(void 0!==e.done){if(this.running.splice(t--,1),e.done){let t=new Wc(e.active.source,e.active.explicitPos,e.done,e.done.from,null!=(r=e.done.to)?r:lc(e.updates.length?e.updates[0].startState:this.view.state));for(var s of e.updates)t=t.update(s,n);if(t.hasResult()){i.push(t);continue}}var r=this.view.state.field(R).active.find(t=>t.source==e.active.source);if(r&&1==r.state)if(null==e.done){let t=new zc(e.active.source,0);for(var o of e.updates)t=t.update(o,n);1!=t.state&&i.push(t)}else this.startQuery(r)}}i.length&&this.view.dispatch({effects:qc.of(i)})}},{eventHandlers:{blur(t){var e=this.view.state.field(R,!1),e;e&&e.tooltip&&this.view.state.facet(bc).closeOnBlur&&((e=e.open&&gh(this.view,e.open.tooltip))&&e.dom.contains(t.relatedTarget)||this.view.dispatch({effects:gc.of(null)}))},compositionstart(){this.composing=1},compositionend(){3==this.composing&&setTimeout(()=>this.view.dispatch({effects:pc.of(!1)}),20),this.composing=0}}});function Oc(t,e){var r=e.completion.apply||e.completion.label,i=t.state.field(R).active.find(t=>t.source==e.source);return i instanceof Wc&&("string"==typeof r?t.dispatch(Object.assign(Object.assign({},dc(t.state,r,i.from,i.to)),{annotations:fc.of(e.completion)})):r(t,e.completion,i.from,i.to),!0)}function Ec(t){var e=t.addToOptions.slice();return t.icons&&e.push({render(t){var e=document.createElement("div");return e.classList.add("cm-completionIcon"),t.type&&e.classList.add(...t.type.split(/\s+/g).map(t=>"cm-completionIcon-"+t)),e.setAttribute("aria-hidden","true"),e},position:20}),e.push({render(t,e,r){var i=document.createElement("span");i.className="cm-completionLabel";let{label:n}=t,s=0;for(let t=1;t<r.length;){var o=r[t++],h=r[t++],a=(o>s&&i.appendChild(document.createTextNode(n.slice(s,o))),i.appendChild(document.createElement("span")));a.appendChild(document.createTextNode(n.slice(o,h))),a.className="cm-completionMatchedText",s=h}return s<n.length&&i.appendChild(document.createTextNode(n.slice(s))),i},position:50},{render(t){var e;return t.detail?((e=document.createElement("span")).className="cm-completionDetail",e.textContent=t.detail,e):null},position:80}),e.sort((t,e)=>t.position-e.position).map(t=>t.render)}function Dc(t,e,r){var i,i;return t<=r?{from:0,to:t}:(e=e<0?0:e)<=t>>1?{from:(i=Math.floor(e/r))*r,to:(i+1)*r}:{from:t-((i=Math.floor((t-e)/r))+1)*r,to:t-i*r}}class Ac{constructor(i,t){this.view=i,this.stateField=t,this.info=null,this.placeInfoReq={read:()=>this.measureInfo(),write:t=>this.placeInfo(t),key:this},this.space=null,this.currentClass="";var t=i.state.field(t);let{options:n,selected:e}=t.open;var r=i.state.facet(bc);this.optionContent=Ec(r),this.optionClass=r.optionClass,this.tooltipClass=r.tooltipClass,this.range=Dc(n.length,e,r.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(i.state),this.dom.addEventListener("mousedown",r=>{for(let t=r.target,e;t&&t!=this.dom;t=t.parentNode)if("LI"==t.nodeName&&(e=/-(\d+)$/.exec(t.id))&&+e[1]<n.length)return Oc(i,n[+e[1]]),void r.preventDefault()}),this.dom.addEventListener("focusout",t=>{var e=i.state.field(this.stateField,!1);e&&e.tooltip&&i.state.facet(bc).closeOnBlur&&t.relatedTarget!=i.contentDOM&&i.dispatch({effects:gc.of(null)})}),this.list=this.dom.appendChild(this.createListBox(n,t.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}mount(){this.updateSel()}update(t){var t,t,e,r=t.state.field(this.stateField),e=t.startState.field(this.stateField);this.updateTooltipClass(t.state),r!=e&&(this.updateSel(),(null==(t=r.open)?void 0:t.disabled)!=(null==(t=e.open)?void 0:t.disabled))&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!(null==(e=r.open)||!e.disabled))}updateTooltipClass(t){var t=this.tooltipClass(t);if(t!=this.currentClass){for(var e of this.currentClass.split(" "))e&&this.dom.classList.remove(e);for(var r of t.split(" "))r&&this.dom.classList.add(r);this.currentClass=t}}positioned(t){this.space=t,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;var r,i,i;(-1<t.selected&&t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=Dc(t.options.length,t.selected,this.view.state.facet(bc).maxRenderedOptions),this.list.remove(),this.list=this.dom.appendChild(this.createListBox(t.options,e.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})),this.updateSelectedOption(t.selected)&&(this.info&&(this.info.remove(),this.info=null),{completion:r}=t.options[t.selected],{info:i}=r,i)&&(i="string"==typeof i?document.createTextNode(i):i(r))&&("then"in i?i.then(t=>{t&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(t)}).catch(t=>ni(this.view.state,t,"completion info")):this.addInfoPane(i))}addInfoPane(t){var e=this.info=document.createElement("div");e.className="cm-tooltip cm-completionInfo",e.appendChild(t),this.dom.appendChild(e),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(r){let i=null;for(let t=this.list.firstChild,e=this.range.from;t;t=t.nextSibling,e++)"LI"==t.nodeName&&t.id?e==r?t.hasAttribute("aria-selected")||(t.setAttribute("aria-selected","true"),i=t):t.hasAttribute("aria-selected")&&t.removeAttribute("aria-selected"):e--;return i&&Ic(this.list,i),i}measureInfo(){var t=this.dom.querySelector("[aria-selected]");if(!t||!this.info)return null;var e=this.dom.getBoundingClientRect(),r=this.info.getBoundingClientRect(),t=t.getBoundingClientRect(),i;let n=this.space;return n||(i=this.dom.ownerDocument.defaultView||window,n={left:0,top:0,right:i.innerWidth,bottom:i.innerHeight}),t.top>Math.min(n.bottom,e.bottom)-10||t.bottom<Math.max(n.top,e.top)+10?null:this.view.state.facet(bc).positionInfo(this.view,e,t,r,n)}placeInfo(t){this.info&&(t?(t.style&&(this.info.style.cssText=t.style),this.info.className="cm-tooltip cm-completionInfo "+(t.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,r,i){var n=document.createElement("ul");n.id=r,n.setAttribute("role","listbox"),n.setAttribute("aria-expanded","true"),n.setAttribute("aria-label",this.view.state.phrase("Completions"));let s=null;for(let t=i.from;t<i.to;t++){var{completion:o,match:h}=e[t],{section:a}=o,u,l,c=(a&&(u="string"==typeof a?a:a.name)!=s&&(t>i.from||0==i.from)&&(s=u,"string"!=typeof a&&a.header?n.appendChild(a.header(a)):n.appendChild(document.createElement("completion-section")).textContent=u),n.appendChild(document.createElement("li"))),a=(c.id=r+"-"+t,c.setAttribute("role","option"),this.optionClass(o)),f;a&&(c.className=a);for(f of this.optionContent){var d=f(o,this.view.state,h);d&&c.appendChild(d)}}return i.from&&n.classList.add("cm-completionListIncompleteTop"),i.to<e.length&&n.classList.add("cm-completionListIncompleteBottom"),n}}function Rc(e){return t=>new Ac(t,e)}function Ic(t,e){var r=t.getBoundingClientRect(),e=e.getBoundingClientRect();e.top<r.top?t.scrollTop-=r.top-e.top:e.bottom>r.bottom&&(t.scrollTop+=e.bottom-r.bottom)}function Lc(t){return 100*(t.boost||0)+(t.apply?10:0)+(t.info?5:0)+(t.type?1:0)}function Tc(t,e){let r=[],i=null;var n=t=>{r.push(t);var{section:t}=t.completion;if(t){i=i||[];let e="string"==typeof t?t:t.name;i.some(t=>t.name==e)||i.push("string"==typeof t?{name:e}:t)}},s,o,h,a,u;for(s of t)if(s.hasResult())if(!1===s.result.filter){var l=s.result.getMatch,c;for(c of s.result.options){var f=[1e9-r.length];if(l)for(var d of l(c))f.push(d);n(new uc(c,s.source,f,f[0]))}}else{var v=new wc(e.sliceDoc(s.from,s.to)),m,p;for(p of s.result.options)(m=v.match(p.label))&&n(new uc(p,s.source,m,m[0]+(p.boost||0)))}if(i){let t=Object.create(null),e=0;for(h of i.sort((t,e)=>{var r,r;return(null!=(r=t.rank)?r:1e9)-(null!=(r=e.rank)?r:1e9)||(t.name<e.name?-1:1)}))e-=1e5,t[h.name]=e;for(a of r){var{section:g}=a.completion;g&&(a.score+=t["string"==typeof g?g:g.name])}}let w=[],b=null,k=e.facet(bc).compareCompletions;for(u of r.sort((t,e)=>e.score-t.score||k(t.completion,e.completion)))!b||b.label!=u.completion.label||b.detail!=u.completion.detail||null!=b.type&&null!=u.completion.type&&b.type!=u.completion.type||b.apply!=u.completion.apply?w.push(u):Lc(u.completion)>Lc(b)&&(w[w.length-1]=u),b=u.completion;return w}class Bc{constructor(t,e,r,i,n,s){this.options=t,this.attrs=e,this.tooltip=r,this.timestamp=i,this.selected=n,this.disabled=s}setSelected(t,e){return t==this.selected||t>=this.options.length?this:new Bc(this.options,$c(e,t),this.tooltip,this.timestamp,t,this.disabled)}static build(t,e,r,i,n){var s=Tc(t,e);if(!s.length)return i&&t.some(t=>1==t.state)?new Bc(i.options,i.attrs,i.tooltip,i.timestamp,i.selected,!0):null;let o=e.facet(bc).selectOnOpen?0:-1;if(i&&i.selected!=o&&-1!=i.selected){var h=i.options[i.selected].completion;for(let t=0;t<s.length;t++)if(s[t].completion==h){o=t;break}}return new Bc(s,$c(r,o),{pos:t.reduce((t,e)=>e.hasResult()?Math.min(t,e.from):t,1e8),create:Rc(R),above:n.aboveCursor},i?i.timestamp:Date.now(),o,!1)}map(t){return new Bc(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:t.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}}class _c{constructor(t,e,r){this.active=t,this.id=e,this.open=r}static start(){return new _c(Hc,"cm-ac-"+Math.floor(2e6*Math.random()).toString(36),null)}update(r){let{state:t}=r,i=t.facet(bc);var e,n;let s=(i.override||t.languageDataAt("autocomplete",lc(t)).map(mc)).map(e=>{var t;return(this.active.find(t=>t.source==e)||new zc(e,this.active.some(t=>0!=t.state)?1:0)).update(r,i)}),o=(s.length==this.active.length&&s.every((t,e)=>t==this.active[e])&&(s=this.active),this.open);o&&r.docChanged&&(o=o.map(r.changes)),r.selection||s.some(t=>t.hasResult()&&r.changes.touchesRange(t.from,t.to))||!Fc(s,this.active)?o=Bc.build(s,t,this.id,o,i):o&&o.disabled&&!s.some(t=>1==t.state)&&(o=null),!o&&s.every(t=>1!=t.state)&&s.some(t=>t.hasResult())&&(s=s.map(t=>t.hasResult()?new zc(t.source,0):t));for(n of r.effects)n.is(Gc)&&(o=o&&o.setSelected(n.value,this.id));return s==this.active&&o==this.open?this:new _c(s,this.id,o)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:Nc}}function Fc(r,i){if(r==i)return 1;for(let t=0,e=0;;){for(;t<r.length&&!r[t].hasResult;)t++;for(;e<i.length&&!i[e].hasResult;)e++;var n=t==r.length,s=e==i.length;if(n||s)return n==s;if(r[t++].result!=i[e++].result)return}}const Nc={"aria-autocomplete":"list"};function $c(t,e){var r={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":t};return-1<e&&(r["aria-activedescendant"]=t+"-"+e),r}const Hc=[];function Uc(t){return t.isUserEvent("input.type")?"input":t.isUserEvent("delete.backward")?"delete":null}class zc{constructor(t,e,r=-1){this.source=t,this.state=e,this.explicitPos=r}hasResult(){return!1}update(t,e){let r=Uc(t),i=this;r?i=i.handleUserEvent(t,r,e):t.docChanged?i=i.handleChange(t):t.selection&&0!=i.state&&(i=new zc(i.source,0));for(var n of t.effects)if(n.is(pc))i=new zc(i.source,1,n.value?lc(t.state):-1);else if(n.is(gc))i=new zc(i.source,0);else if(n.is(qc))for(var s of n.value)s.source==i.source&&(i=s);return i}handleUserEvent(t,e,r){return"delete"!=e&&r.activateOnTyping?new zc(this.source,1):this.map(t.changes)}handleChange(t){return t.changes.touchesRange(lc(t.startState))?new zc(this.source,0):this.map(t.changes)}map(t){return t.empty||this.explicitPos<0?this:new zc(this.source,this.state,t.mapPos(this.explicitPos))}}class Wc extends zc{constructor(t,e,r,i,n){super(t,2,e),this.result=r,this.from=i,this.to=n}hasResult(){return!0}handleUserEvent(t,e,r){var e,i=t.changes.mapPos(this.from),n=t.changes.mapPos(this.to,1),s=lc(t.state);if((this.explicitPos<0?s<=i:s<this.from)||n<s||"delete"==e&&lc(t.startState)==this.from)return new zc(this.source,"input"==e&&r.activateOnTyping?1:0);let o=this.explicitPos<0?-1:t.changes.mapPos(this.explicitPos),h;return Vc(this.result.validFor,t.state,i,n)?new Wc(this.source,o,this.result,i,n):this.result.update&&(h=this.result.update(this.result,i,n,new ic(t.state,s,0<=o)))?new Wc(this.source,o,h,h.from,null!=(e=h.to)?e:lc(t.state)):new zc(this.source,1,o)}handleChange(t){return t.changes.touchesRange(this.from,this.to)?new zc(this.source,0):this.map(t.changes)}map(t){return t.empty?this:new Wc(this.source,this.explicitPos<0?-1:t.mapPos(this.explicitPos),this.result,t.mapPos(this.from),t.mapPos(this.to,1))}}function Vc(t,e,r,i){var n;if(t)return n=e.sliceDoc(r,i),"function"==typeof t?t(n,r,i,e):cc(t,!0).test(n)}const qc=l.define({map(t,e){return t.map(t=>t.map(e))}}),Gc=l.define(),R=M.define({create(){return _c.start()},update(t,e){return t.update(e)},provide:t=>[uh.from(t,t=>t.tooltip),E.contentAttributes.from(t,t=>t.attrs)]}),Jc=E.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"\xb7\xb7\xb7"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'\u0192'"}},".cm-completionIcon-class":{"&:after":{content:"'\u25cb'"}},".cm-completionIcon-interface":{"&:after":{content:"'\u25cc'"}},".cm-completionIcon-variable":{"&:after":{content:"'\ud835\udc65'"}},".cm-completionIcon-constant":{"&:after":{content:"'\ud835\udc36'"}},".cm-completionIcon-type":{"&:after":{content:"'\ud835\udc61'"}},".cm-completionIcon-enum":{"&:after":{content:"'\u222a'"}},".cm-completionIcon-property":{"&:after":{content:"'\u25a1'"}},".cm-completionIcon-keyword":{"&:after":{content:"'\ud83d\udd11\ufe0e'"}},".cm-completionIcon-namespace":{"&:after":{content:"'\u25a2'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class Kc{constructor(t,e,r,i){this.field=t,this.line=e,this.from=r,this.to=i}}class Qc{constructor(t,e,r){this.field=t,this.from=e,this.to=r}map(t){var e=t.mapPos(this.from,-1,u.TrackDel),t=t.mapPos(this.to,1,u.TrackDel);return null==e||null==t?null:new Qc(this.field,e,t)}}class Xc{constructor(t,e){this.lines=t,this.fieldPositions=e}instantiate(i,t){let e=[],n=[t];var r=i.doc.lineAt(t),s=/^\s*/.exec(r.text)[0],o;for(o of this.lines){if(e.length){let e=s,r=/^\t*/.exec(o)[0].length;for(let t=0;t<r;t++)e+=i.facet(wu);n.push(t+e.length-r),o=e+o.slice(r)}e.push(o),t+=o.length+1}var r=this.fieldPositions.map(t=>new Qc(t.field,n[t.line]+t.from,n[t.line]+t.to));return{text:e,ranges:r}}static parse(t){var n=[],s=[],o=[],h,a,e;for(a of t.split(/\r\n?|\n/)){for(;h=/[#$]\{(?:(\d+)(?::([^}]*))?|([^}]*))\}/.exec(a);){let e=h[1]?+h[1]:null,r=h[2]||h[3]||"",i=-1;for(let t=0;t<n.length;t++)(null!=e?n[t].seq==e:r&&n[t].name==r)&&(i=t);if(i<0){let t=0;for(;t<n.length&&(null==e||null!=n[t].seq&&n[t].seq<e);)t++;n.splice(t,0,{seq:e,name:r}),i=t;for(var u of o)u.field>=i&&u.field++}o.push(new Kc(i,s.length,h.index,h.index+r.length)),a=a.slice(0,h.index)+r+a.slice(h.index+h[0].length)}for(;e=/\\([{}])/.exec(a);){a=a.slice(0,e.index)+e[1]+a.slice(e.index+e[0].length);for(var r of o)r.line==s.length&&r.from>e.index&&(r.from--,r.to--)}s.push(a)}return new Xc(s,o)}}let Zc=j.widget({widget:new class extends Tr{toDOM(){var t=document.createElement("span");return t.className="cm-snippetFieldPosition",t}ignoreEvent(){return!1}}}),Yc=j.mark({class:"cm-snippetField"});class tf{constructor(t,e){this.ranges=t,this.active=e,this.deco=j.set(t.map(t=>(t.from==t.to?Zc:Yc).range(t.from,t.to)))}map(t){var e=[],r;for(r of this.ranges){var i=r.map(t);if(!i)return null;e.push(i)}return new tf(e,this.active)}selectionInsideField(t){return t.ranges.every(e=>this.ranges.some(t=>t.field==this.active&&t.from<=e.from&&t.to>=e.to))}}const ef=l.define({map(t,e){return t&&t.map(e)}}),rf=l.define(),nf=M.define({create(){return null},update(t,e){for(var r of e.effects){if(r.is(ef))return r.value;if(r.is(rf)&&t)return new tf(t.ranges,r.value)}return t=(t=t&&e.docChanged?t.map(e.changes):t)&&e.selection&&!t.selectionInsideField(e.selection)?null:t},provide:t=>E.decorations.from(t,t=>t?t.deco:j.none)});function sf(t,e){return b.create(t.filter(t=>t.field==e).map(t=>b.range(t.from,t.to)))}function of(t){let o=Xc.parse(t);return(t,e,r,i)=>{var{text:n,ranges:s}=o.instantiate(t.state,r),r={changes:{from:r,to:i,insert:g.of(n)},scrollIntoView:!0,annotations:e?fc.of(e):void 0},i,n;s.length&&(r.selection=sf(s,0)),1<s.length&&(i=new tf(s,0),n=r.effects=[ef.of(i)],void 0===t.state.field(nf,!1))&&n.push(l.appendConfig.of([nf,ff,vf,Jc])),t.dispatch(t.state.update(r))}}function hf(s){return({state:t,dispatch:e})=>{var r=t.field(nf,!1);if(!r||s<0&&0==r.active)return!1;let i=r.active+s,n=0<s&&!r.ranges.some(t=>t.field==i+s);return e(t.update({selection:sf(r.ranges,i),effects:ef.of(n?null:new tf(r.ranges,i))})),!0}}var cr=({state:t,dispatch:e})=>{var r;return!!t.field(nf,!1)&&(e(t.update({effects:ef.of(null)})),!0)},i=hf(1),s=hf(-1);function af(t){let e=t.field(nf,!1);return!(!e||!e.ranges.some(t=>t.field==e.active+1))}function uf(t){var t=t.field(nf,!1);return!!(t&&0<t.active)}const lf=[{key:"Tab",run:i,shift:s},{key:"Escape",run:cr}],cf=m.define({combine(t){return t.length?t[0]:lf}}),ff=Lt.highest(Gs.compute([cf],t=>t.facet(cf)));function df(t,e){return Object.assign(Object.assign({},e),{apply:of(t)})}const vf=E.domEventHandlers({mousedown(t,e){let r=e.state.field(nf,!1),i;if(!r||null==(i=e.posAtCoords({x:t.clientX,y:t.clientY})))return!1;let n=r.ranges.find(t=>t.from<=i&&t.to>=i);return!(!n||n.field==r.active||(e.dispatch({selection:sf(r.ranges,n.field),effects:ef.of(r.ranges.some(t=>t.field>n.field)?new tf(r.ranges,n.field):null)}),0))}});function mf(e){var e=e.replace(/[\\[.+*?(){|^$]/g,"\\$&");try{return new RegExp(`[\\p{Alphabetic}\\p{Number}_${e}]+`,"ug")}catch(t){return new RegExp(`[w${e}]`,"g")}}function pf(t,e){return new RegExp(e(t.source),t.unicode?"u":"")}const gf=Object.create(null);function wf(t){return gf[t]||(gf[t]=new WeakMap)}function bf(r,i,n,s,o){for(let t=r.iterLines(),e=0;!t.next().done;){var{value:h}=t,a;for(i.lastIndex=0;a=i.exec(h);)if(!s[a[0]]&&e+a.index!=o&&(n.push({type:"text",label:a[0]}),s[a[0]]=!0,2e3<=n.length))return;e+=h.length+1}}function kf(e,r,i,n,s){var t=1e3<=e.length,o=t&&r.get(e);if(o)return o;var h=[],a=Object.create(null);if(e.children){let t=0;for(var u of e.children){if(1e3<=u.length)for(var l of kf(u,r,i,n-t,s-t))a[l.label]||(a[l.label]=!0,h.push(l));else bf(u,i,h,a,s-t);t+=u.length+1}}else bf(e,i,h,a,s);return t&&h.length<2e3&&r.set(e,h),h}var Ka=t=>{var e=t.state.languageDataAt("wordChars",t.pos).join(""),r=mf(e),i=t.matchBefore(pf(r,t=>t+"$")),i,n;return i||t.explicit?{from:i=i?i.from:t.pos,options:kf(t.state.doc,wf(e),r,5e4,i),validFor:pf(r,t=>"^"+t)}:null};const yf={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},Mf=l.define({map(t,e){var e=e.mapPos(t,-1,u.TrackAfter);return null==e?void 0:e}}),xf=new class extends ce{},Cf=(xf.startSide=1,xf.endSide=-1,M.define({create(){return S.empty},update(t,e){var r,i,n;t=(t=e.selection&&(r=e.state.doc.lineAt(e.selection.main.head).from,i=e.startState.doc.lineAt(e.startState.selection.main.head).from,r!=e.changes.mapPos(i,-1))?S.empty:t).map(e.changes);for(n of e.effects)n.is(Mf)&&(t=t.update({add:[xf.range(n.value,n.value+1)]}));return t}}));function Sf(){return[Df,Cf]}const Pf="()[]{}<>";function jf(e){for(let t=0;t<Pf.length;t+=2)if(Pf.charCodeAt(t)==e)return Pf.charAt(t+1);return dt(e<128?e:e+1)}function Of(t,e){return t.languageDataAt("closeBrackets",e)[0]||yf}const Ef="object"==typeof navigator&&/Android\b/.test(navigator.userAgent),Df=E.inputHandler.of((t,e,r,i)=>{var n,e;return!((Ef?t.composing:t.compositionStarted)||t.state.readOnly||(n=t.state.selection.main,2<i.length)||2==i.length&&1==vt(x(i,0))||e!=n.from||r!=n.to||!(e=Rf(t.state,i))||(t.dispatch(e),0))});var t=({state:i,dispatch:t})=>{if(i.readOnly)return!1;var e;let n=Of(i,i.selection.main.head).brackets||yf.brackets,s=null,r=i.changeByRange(t=>{if(t.empty){var e=Tf(i.doc,t.head),r;for(r of n)if(r==e&&Lf(i.doc,t.head)==jf(x(r,0)))return{changes:{from:t.head-r.length,to:t.head+r.length},range:b.cursor(t.head-r.length)}}return{range:s=t}});return s||t(i.update(r,{scrollIntoView:!0,userEvent:"delete.backward"})),!s};const Af=[{key:"Backspace",run:t}];function Rf(t,e){var r=Of(t,t.selection.main.head),i=r.brackets||yf.brackets,n;for(n of i){var s=jf(x(n,0));if(e==n)return s==n?Ff(t,n,-1<i.indexOf(n+n+n),r):Bf(t,n,s,r.before||yf.before);if(e==s&&If(t,t.selection.main.from))return _f(t,n,s)}return null}function If(t,e){let r=!1;return t.field(Cf).between(0,t.doc.length,t=>{t==e&&(r=!0)}),r}function Lf(t,e){var t=t.sliceString(e,e+2);return t.slice(0,vt(x(t,0)))}function Tf(t,e){var t=t.sliceString(e-2,e);return vt(x(t,0))==t.length?t:t.slice(1)}function Bf(r,i,n,s){let o=null,t=r.changeByRange(t=>{var e;return t.empty?!(e=Lf(r.doc,t.head))||/\s/.test(e)||-1<s.indexOf(e)?{changes:{insert:i+n,from:t.head},effects:Mf.of(t.head+i.length),range:b.cursor(t.head+i.length)}:{range:o=t}:{changes:[{insert:i,from:t.from},{insert:n,from:t.to}],effects:Mf.of(t.to+i.length),range:b.range(t.anchor+i.length,t.head+i.length)}});return o?null:r.update(t,{scrollIntoView:!0,userEvent:"input.type"})}function _f(e,t,r){let i=null,n=e.changeByRange(t=>t.empty&&Lf(e.doc,t.head)==r?{changes:{from:t.head,to:t.head+r.length,insert:r},range:b.cursor(t.head+r.length)}:i={range:t});return i?null:e.update(n,{scrollIntoView:!0,userEvent:"input.type"})}function Ff(o,h,a,t){let u=t.stringPrefixes||yf.stringPrefixes,l=null,e=o.changeByRange(t=>{if(!t.empty)return{changes:[{insert:h,from:t.from},{insert:h,from:t.to}],effects:Mf.of(t.to+h.length),range:b.range(t.anchor+h.length,t.head+h.length)};let e=t.head,r=Lf(o.doc,e),i;if(r==h){if(Nf(o,e))return{changes:{insert:h+h,from:e},effects:Mf.of(e+h.length),range:b.cursor(e+h.length)};var n,s;if(If(o,e))return{changes:{from:e,to:e+(s=a&&o.sliceDoc(e,e+3*h.length)==h+h+h?h+h+h:h).length,insert:s},range:b.cursor(e+s.length)}}else{if(a&&o.sliceDoc(e-2*h.length,e)==h+h&&-1<(i=Hf(o,e-2*h.length,u))&&Nf(o,i))return{changes:{insert:h+h+h+h,from:e},effects:Mf.of(e+h.length),range:b.cursor(e+h.length)};if(o.charCategorizer(e)(r)!=c.Word&&-1<Hf(o,e,u)&&!$f(o,e,h,u))return{changes:{insert:h+h,from:e},effects:Mf.of(e+h.length),range:b.cursor(e+h.length)}}return{range:l=t}});return l?null:o.update(e,{scrollIntoView:!0,userEvent:"input.type"})}function Nf(t,e){var t=A(t).resolveInner(e+1);return t.parent&&t.from==e}function $f(e,r,i,n){let s=A(e).resolveInner(r,-1);var o=n.reduce((t,e)=>Math.max(t,e.length),0);for(let t=0;t<5;t++){var h=e.sliceDoc(s.from,Math.min(s.to,s.from+i.length+o)),a=h.indexOf(i);if(!a||-1<a&&-1<n.indexOf(h.slice(0,a))){let t=s.firstChild;for(;t&&t.from==s.from&&t.to-t.from>i.length+a;){if(e.sliceDoc(t.to-i.length,t.to)==i)return;t=t.firstChild}return 1}var h=s.to==r&&s.parent;if(!h)break;s=h}}function Hf(t,e,r){var i=t.charCategorizer(e),n;if(i(t.sliceDoc(e-1,e))!=c.Word)return e;for(n of r){var s=e-n.length;if(t.sliceDoc(s,e)==n&&i(t.sliceDoc(s-1,s))!=c.Word)return s}return-1}function Uf(t={}){return[R,bc.of(t),jc,Wf,Jc]}const zf=[{key:"Ctrl-Space",run:Ga},{key:"Escape",run:Ja},{key:"ArrowDown",run:Mc(!0)},{key:"ArrowUp",run:Mc(!1)},{key:"PageDown",run:Mc(!0,"page")},{key:"PageUp",run:Mc(!1,"page")},{key:"Enter",run:qa}],Wf=Lt.highest(Gs.computeN([bc],t=>t.facet(bc).defaultKeymap?[zf]:[]));function Vf(t){var t=t.field(R,!1);return t&&t.active.some(t=>1==t.state)?"pending":t&&t.active.some(t=>0!=t.state)?"active":null}const qf=new WeakMap;function Gf(t){var t,t=null==(t=t.field(R,!1))?void 0:t.open;if(!t||t.disabled)return[];let e=qf.get(t.options);return e||qf.set(t.options,e=t.options.map(t=>t.completion)),e}function Jf(t){var t,t=null==(t=t.field(R,!1))?void 0:t.open;return t&&!t.disabled&&0<=t.selected?t.options[t.selected].completion:null}function Kf(t){var t,t=null==(t=t.field(R,!1))?void 0:t.open;return t&&!t.disabled&&0<=t.selected?t.selected:null}function Qf(t){return Gc.of(t)}var q=Object.freeze({__proto__:null,CompletionContext:ic,acceptCompletion:qa,autocompletion:Uf,clearSnippet:cr,closeBrackets:Sf,closeBracketsKeymap:Af,closeCompletion:Ja,completeAnyWord:Ka,completeFromList:oc,completionKeymap:zf,completionStatus:Vf,currentCompletions:Gf,deleteBracketPair:t,hasNextSnippetField:af,hasPrevSnippetField:uf,ifIn:hc,ifNotIn:ac,insertBracket:Rf,insertCompletionText:dc,moveCompletionSelection:Mc,nextSnippetField:i,pickedCompletion:fc,prevSnippetField:s,selectedCompletion:Jf,selectedCompletionIndex:Kf,setSelectedCompletion:Qf,snippet:of,snippetCompletion:df,snippetKeymap:cf,startCompletion:Ga}),n=t=>{var{state:e}=t,e=e.doc.lineAt(e.selection.main.from),e=t0(t.state,e.from);return e.line?Zf(t):!!e.block&&Yf(t)};function Xf(i,n){return({state:t,dispatch:e})=>{var r;return!t.readOnly&&!!(r=i(n,t))&&(e(t.update(r)),!0)}}const Zf=Xf(s0,0);var vr=Xf(s0,1),fr=Xf(s0,2),_=Xf(n0,0),r=Xf(n0,1),dr=Xf(n0,2);const Yf=Xf((t,e)=>n0(t,e,i0(e)),0);function t0(t,e){var t=t.languageDataAt("commentTokens",e);return t.length?t[0]:{}}const e0=50;function r0(t,{open:e,close:r},i,n){var s=t.sliceDoc(i-e0,i),o=t.sliceDoc(n,n+e0),h=/\s*$/.exec(s)[0].length,a=/^\s*/.exec(o)[0].length,u=s.length-h;if(s.slice(u-e.length,u)==e&&o.slice(a,a+r.length)==r)return{open:{pos:i-h,margin:h&&1},close:{pos:n+a,margin:a&&1}};let l,c;n-i<=2*e0?l=c=t.sliceDoc(i,n):(l=t.sliceDoc(i,i+e0),c=t.sliceDoc(n-e0,n));var s=/^\s*/.exec(l)[0].length,u=/\s*$/.exec(c)[0].length,o=c.length-u-r.length;return l.slice(s,s+e.length)==e&&c.slice(o,o+r.length)==r?{open:{pos:i+s+e.length,margin:/\s/.test(l.charAt(s+e.length))?1:0},close:{pos:n-u-r.length,margin:/\s/.test(c.charAt(o-1))?1:0}}:null}function i0(t){var e=[],r;for(r of t.selection.ranges){var i=t.doc.lineAt(r.from),n=r.to<=i.to?i:t.doc.lineAt(r.to),s=e.length-1;0<=s&&e[s].to>i.from?e[s].to=n.to:e.push({from:i.from+/^\s*/.exec(i.text)[0].length,to:n.to})}return e}function n0(t,i,e=i.selection.ranges){let n=e.map(t=>t0(i,t.from).block);if(n.every(t=>t)){let r=e.map((t,e)=>r0(i,n[e],t.from,t.to));if(2!=t&&!r.every(t=>t))return{changes:i.changes(e.map((t,e)=>r[e]?[]:[{from:t.from,insert:n[e].open+" "},{from:t.to,insert:" "+n[e].close}]))};if(1!=t&&r.some(t=>t)){var s=[],o,h,a;for(let t=0,e;t<r.length;t++){(e=r[t])&&(o=n[t],{open:h,close:a}=e,s.push({from:h.pos-o.open.length,to:h.pos+h.margin},{from:a.pos-a.margin,to:a.pos+o.close.length}))}return{changes:s}}}return null}function s0(t,i,e=i.selection.ranges){var n=[],s,o;let h=-1;for({from:s,to:o}of e){let e=n.length,r=1e9;var a=t0(i,s).line;if(a){for(let t=s;t<=o;){var u=i.doc.lineAt(t),l,c,f;u.from>h&&(s==o||o>u.from)&&(h=u.from,c=(l=/^\s*/.exec(u.text)[0].length)==u.length,f=u.text.slice(l,l+a.length)==a?l:-1,l<u.text.length&&l<r&&(r=l),n.push({line:u,comment:f,token:a,indent:l,empty:c,single:!1})),t=u.to+1}if(r<1e9)for(let t=e;t<n.length;t++)n[t].indent<n[t].line.text.length&&(n[t].indent=r);n.length==e+1&&(n[e].single=!0)}}if(2!=t&&n.some(t=>t.comment<0&&(!t.empty||t.single))){var r=[],d,v,m,p,g;for({line:d,token:v,indent:m,empty:p,single:g}of n)!g&&p||r.push({from:d.from+m,insert:v+" "});var e=i.changes(r);return{changes:e,selection:i.selection.map(e,1)}}if(1!=t&&n.some(t=>0<=t.comment)){var w=[],b,k,y;for({line:b,comment:k,token:y}of n)if(0<=k){let t=b.from+k,e=t+y.length;" "==b.text[e-b.from]&&e++,w.push({from:t,to:e})}return{changes:w}}return null}const o0=Kt.define(),h0=Kt.define(),a0=m.define(),u0=m.define({combine(t){return le(t,{minDepth:100,newGroupDelay:500,joinToEvent:(t,e)=>e},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(r,i)=>(t,e)=>r(t,e)||i(t,e)})}});function l0(t){let r=0;return t.iterChangedRanges((t,e)=>r=e),r}const c0=M.define({create(){return E0.empty},update(e,r){var i=r.state.facet(u0),n=r.annotation(o0);if(n){var s=r.docChanged?b.single(l0(r.changes)):void 0,s=g0.fromTransaction(r,s),o=n.side;let t=0==o?e.undone:e.done;return t=s?w0(t,t.length,i.minDepth,s):C0(t,r.startState.selection),new E0(0==o?n.rest:t,0==o?t:n.rest)}var s=r.annotation(h0),o,n,t;return"full"!=s&&"before"!=s||(e=e.isolate()),!1===r.annotation(a.addToHistory)?r.changes.empty?e:e.addMapping(r.changes.desc):(o=g0.fromTransaction(r),n=r.annotation(a.time),t=r.annotation(a.userEvent),o?e=e.addChanges(o,n,t,i,r):r.selection&&(e=e.addSelection(r.startState.selection,n,t,i.newGroupDelay)),"full"!=s&&"after"!=s?e:e.isolate())},toJSON(t){return{done:t.done.map(t=>t.toJSON()),undone:t.undone.map(t=>t.toJSON())}},fromJSON(t){return new E0(t.done.map(g0.fromJSON),t.undone.map(g0.fromJSON))}});function f0(t={}){return[c0,u0.of(t),E.domEventHandlers({beforeinput(t,e){var r="historyUndo"==t.inputType?v0:"historyRedo"==t.inputType?m0:null;return!!r&&(t.preventDefault(),r(e))}})]}var mr=c0;function d0(i,n){return function({state:t,dispatch:e}){var r,r;return!(!n&&t.readOnly||!(r=t.field(c0,!1))||!(r=r.pop(i,t,n))||(e(r),0))}}const v0=d0(0,!1),m0=d0(1,!1);var qa=d0(0,!0),cr=d0(1,!0);function p0(e){return function(t){var t=t.field(c0,!1),t;return t?(t=0==e?t.done:t.undone).length-(t.length&&!t[0].changes?1:0):0}}var Ja=p0(0),Ka=p0(1);class g0{constructor(t,e,r,i,n){this.changes=t,this.effects=e,this.mapped=r,this.startSelection=i,this.selectionsAfter=n}setSelAfter(t){return new g0(this.changes,this.effects,this.mapped,this.startSelection,t)}toJSON(){var t,t,t;return{changes:null==(t=this.changes)?void 0:t.toJSON(),mapped:null==(t=this.mapped)?void 0:t.toJSON(),startSelection:null==(t=this.startSelection)?void 0:t.toJSON(),selectionsAfter:this.selectionsAfter.map(t=>t.toJSON())}}static fromJSON(t){return new g0(t.changes&&v.fromJSON(t.changes),[],t.mapped&&pt.fromJSON(t.mapped),t.startSelection&&b.fromJSON(t.startSelection),t.selectionsAfter.map(b.fromJSON))}static fromTransaction(t,e){let r=M0;for(var i of t.startState.facet(a0)){var i=i(t);i.length&&(r=r.concat(i))}return!r.length&&t.changes.empty?null:new g0(t.changes.invert(t.startState.doc),r,void 0,e||t.startState.selection,M0)}static selection(t){return new g0(void 0,M0,void 0,void 0,t)}}function w0(t,e,r,i){var n,t=t.slice(r+20<e+1?e-r-1:0,e);return t.push(i),t}function b0(t,e){let o=[],h=!1;return t.iterChangedRanges((t,e)=>o.push(t,e)),e.iterChangedRanges((t,e,r,i)=>{for(let t=0;t<o.length;){var n=o[t++],s=o[t++];n<=i&&r<=s&&(h=!0)}}),h}function k0(t,r){return t.ranges.length==r.ranges.length&&0===t.ranges.filter((t,e)=>t.empty!=r.ranges[e].empty).length}function y0(t,e){return t.length?e.length?t.concat(e):t:e}const M0=[],x0=200;function C0(t,e){var r,i;return t.length?(i=(r=t[t.length-1]).selectionsAfter.slice(Math.max(0,r.selectionsAfter.length-x0))).length&&i[i.length-1].eq(e)?t:(i.push(e),w0(t,t.length-1,1e9,r.setSelAfter(i))):[g0.selection([e])]}function S0(t){var e=t[t.length-1],r=t.slice();return r[t.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),r}function P0(t,e){if(!t.length)return t;let r=t.length,i=M0;for(;r;){var n=j0(t[r-1],e,i),s;if(n.changes&&!n.changes.empty||n.effects.length)return(s=t.slice(0,r))[r-1]=n,s;e=n.mapped,r--,i=n.selectionsAfter}return i.length?[g0.selection(i)]:M0}function j0(t,e,r){var r=y0(t.selectionsAfter.length?t.selectionsAfter.map(t=>t.map(e)):M0,r),i,n,s;return t.changes?(i=t.changes.map(e),n=e.mapDesc(t.changes,!0),s=t.mapped?t.mapped.composeDesc(n):n,new g0(i,l.mapEffects(t.effects,e),s,t.startSelection.map(n),r)):g0.selection(r)}const O0=/^(input\.type|delete)($|\.)/;class E0{constructor(t,e,r=0,i=void 0){this.done=t,this.undone=e,this.prevTime=r,this.prevUserEvent=i}isolate(){return this.prevTime?new E0(this.done,this.undone):this}addChanges(t,e,r,i,n){let s=this.done,o=s[s.length-1];return s=o&&o.changes&&!o.changes.empty&&t.changes&&(!r||O0.test(r))&&(!o.selectionsAfter.length&&e-this.prevTime<i.newGroupDelay&&i.joinToEvent(n,b0(o.changes,t.changes))||"input.type.compose"==r)?w0(s,s.length-1,i.minDepth,new g0(t.changes.compose(o.changes),y0(t.effects,o.effects),o.mapped,o.startSelection,M0)):w0(s,s.length,i.minDepth,t),new E0(s,M0,e,r)}addSelection(t,e,r,i){var n=this.done.length?this.done[this.done.length-1].selectionsAfter:M0;return 0<n.length&&e-this.prevTime<i&&r==this.prevUserEvent&&r&&/^select($|\.)/.test(r)&&k0(n[n.length-1],t)?this:new E0(C0(this.done,t),this.undone,e,r)}addMapping(t){return new E0(P0(this.done,t),P0(this.undone,t),this.prevTime,this.prevUserEvent)}pop(e,r,t){var i=0==e?this.done:this.undone;if(0!=i.length){var n=i[i.length-1];if(t&&n.selectionsAfter.length)return r.update({selection:n.selectionsAfter[n.selectionsAfter.length-1],annotations:o0.of({side:e,rest:S0(i)}),userEvent:0==e?"select.undo":"select.redo",scrollIntoView:!0});if(n.changes){let t=1==i.length?M0:i.slice(0,i.length-1);return n.mapped&&(t=P0(t,n.mapped)),r.update({changes:n.changes,selection:n.startSelection,effects:n.effects,annotations:o0.of({side:e,rest:t}),filter:!1,userEvent:0==e?"undo":"redo",scrollIntoView:!0})}}return null}}E0.empty=new E0(M0,M0);const D0=[{key:"Mod-z",run:v0,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:m0,preventDefault:!0},{linux:"Ctrl-Shift-z",run:m0,preventDefault:!0},{key:"Mod-u",run:qa,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:cr,preventDefault:!0}];function A0(t,e){return b.create(t.ranges.map(e),t.mainIndex)}function R0(t,e){return t.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function I0({state:t,dispatch:e},r){var r=A0(t.selection,r);return!r.eq(t.selection)&&(e(R0(t,r)),!0)}function L0(t,e){return b.cursor(e?t.to:t.from)}function T0(e,r){return I0(e,t=>t.empty?e.moveByChar(t,r):L0(t,r))}function B0(t){return t.textDirectionAt(t.state.selection.main.head)==y.LTR}var t=t=>T0(t,!B0(t)),i=t=>T0(t,B0(t)),_0,F0;function N0(e,r){return I0(e,t=>t.empty?e.moveByGroup(t,r):L0(t,r))}var s=t=>N0(t,!B0(t)),Ga=t=>N0(t,B0(t)),$0,H0,U0,z0;function W0(a,r,u){let l=a.state.charCategorizer(r.from);return a.moveByChar(r,u,t=>{let i=c.Space,n=r.from,s=!1,o=!1,h=!1;var e=t=>{if(s)return!1;n+=u?t.length:-t.length;let e=l(t),r;if(e==c.Word&&t.charCodeAt(0)<128&&/[\W_]/.test(t)&&(e=-1),(i=i==c.Space?e:i)!=e)return!1;if(i==c.Word)if(t.toLowerCase()==t){if(!u&&o)return!1;h=!0}else if(h){if(u)return!1;s=!0}else{if(o&&u&&l(r=a.state.sliceDoc(n,n+1))==c.Word&&r.toLowerCase()==r)return!1;o=!0}return!0};return e(t),e})}function V0(e,r){return I0(e,t=>t.empty?W0(e,t,r):L0(t,r))}function q0(t,e,r){var r;return e.type.prop(r)||(r=e.to-e.from)&&(2<r||/[^\s,.;:]/.test(t.sliceDoc(e.from,e.to)))||e.firstChild}function G0(e,r,i){let n=A(e).resolveInner(r.head);var s=i?L.closedBy:L.openedBy;for(let t=r.head;;){var o=i?n.childAfter(t):n.childBefore(t);if(!o)break;q0(e,o,s)?n=o:t=i?o.to:o.from}let t=n.type.prop(s),h,a;return a=t&&(h=i?Il(e,n.from,1):Il(e,n.to,-1))&&h.matched?i?h.end.to:h.end.from:i?n.to:n.from,b.cursor(a,i?-1:1)}var J0=e=>I0(e,t=>G0(e.state,t,!B0(e))),K0=e=>I0(e,t=>G0(e.state,t,B0(e)));function Q0(r,i){return I0(r,t=>{var e;return t.empty?(e=r.moveVertically(t,i)).head!=t.head?e:r.moveToLineBoundary(t,i):L0(t,i)})}var X0=t=>Q0(t,!1),Z0=t=>Q0(t,!0);function Y0(t){var e=t.scrollDOM.clientHeight<t.scrollDOM.scrollHeight-2;let r=0,i=0,n;if(e){for(var s of t.state.facet(E.scrollMargins)){var s=s(t);null!=s&&s.top&&(r=Math.max(null==s?void 0:s.top,r)),null!=s&&s.bottom&&(i=Math.max(null==s?void 0:s.bottom,i))}n=t.scrollDOM.clientHeight-r-i}else n=(t.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:r,marginBottom:i,selfScroll:e,height:Math.max(t.defaultLineHeight,n-5)}}function td(e,r){let i=Y0(e);var{state:t}=e,n=A0(t.selection,t=>t.empty?e.moveVertically(t,r,i.height):L0(t,r)),s,o,h,o;if(n.eq(t.selection))return!1;let a;return i.selfScroll&&(s=e.coordsAtPos(t.selection.main.head),h=(o=e.scrollDOM.getBoundingClientRect()).top+i.marginTop,o=o.bottom-i.marginBottom,s)&&s.top>h&&s.bottom<o&&(a=E.scrollIntoView(n.main.head,{y:"start",yMargin:s.top-h})),e.dispatch(R0(t,n),{effects:a}),!0}var ed=t=>td(t,!1),rd=t=>td(t,!0);function id(t,e,r){let i=t.lineBlockAt(e.head),n=t.moveToLineBoundary(e,r);var r;return n.head==e.head&&n.head!=(r?i.to:i.from)&&(n=t.moveToLineBoundary(e,r,!1)),n=!r&&n.head==i.from&&i.length&&(r=/^\s*/.exec(t.state.sliceDoc(i.from,Math.min(i.from+100,i.to)))[0].length)&&e.head!=i.from+r?b.cursor(i.from+r):n}var nd=e=>I0(e,t=>id(e,t,!0)),sd=e=>I0(e,t=>id(e,t,!1)),od=e=>I0(e,t=>id(e,t,!B0(e))),hd=e=>I0(e,t=>id(e,t,B0(e))),ad=e=>I0(e,t=>b.cursor(e.lineBlockAt(t.head).from,1)),ud=e=>I0(e,t=>b.cursor(e.lineBlockAt(t.head).to,-1));function ld(r,t,i){let n=!1,e=A0(r.selection,t=>{var e=Il(r,t.head,-1)||Il(r,t.head,1)||0<t.head&&Il(r,t.head-1,1)||t.head<r.doc.length&&Il(r,t.head+1,-1);if(!e||!e.end)return t;n=!0;var e=e.start.from==t.head?e.end.to:e.end.from;return i?b.range(t.anchor,e):b.cursor(e)});return!!n&&(t(R0(r,e)),!0)}var cd=({state:t,dispatch:e})=>ld(t,e,!1),fd;function dd(t,r){var e=A0(t.state.selection,t=>{var e=r(t);return b.range(t.anchor,e.head,e.goalColumn,e.bidiLevel||void 0)});return!e.eq(t.state.selection)&&(t.dispatch(R0(t.state,e)),!0)}function vd(e,r){return dd(e,t=>e.moveByChar(t,r))}var md=t=>vd(t,!B0(t)),pd=t=>vd(t,B0(t)),gd,wd;function bd(e,r){return dd(e,t=>e.moveByGroup(t,r))}var kd=t=>bd(t,!B0(t)),yd=t=>bd(t,B0(t)),Md,xd;function Cd(e,r){return dd(e,t=>W0(e,t,r))}var Sd,Pd,jd=e=>dd(e,t=>G0(e.state,t,!B0(e))),Od=e=>dd(e,t=>G0(e.state,t,B0(e)));function Ed(e,r){return dd(e,t=>e.moveVertically(t,r))}var Dd=t=>Ed(t,!1),Ad=t=>Ed(t,!0);function Rd(e,r){return dd(e,t=>e.moveVertically(t,r,Y0(e).height))}var Id=t=>Rd(t,!1),Ld=t=>Rd(t,!0),Td=e=>dd(e,t=>id(e,t,!0)),Bd=e=>dd(e,t=>id(e,t,!1)),_d=e=>dd(e,t=>id(e,t,!B0(e))),Fd=e=>dd(e,t=>id(e,t,B0(e))),Nd=e=>dd(e,t=>b.cursor(e.lineBlockAt(t.head).from)),$d=e=>dd(e,t=>b.cursor(e.lineBlockAt(t.head).to)),Hd=({state:t,dispatch:e})=>(e(R0(t,{anchor:0})),!0),Ud=({state:t,dispatch:e})=>(e(R0(t,{anchor:t.doc.length})),!0),zd=({state:t,dispatch:e})=>(e(R0(t,{anchor:t.selection.main.anchor,head:0})),!0),Wd=({state:t,dispatch:e})=>(e(R0(t,{anchor:t.selection.main.anchor,head:t.doc.length})),!0),Vd=({state:t,dispatch:e})=>(e(t.update({selection:{anchor:0,head:t.doc.length},userEvent:"select"})),!0),qd=({state:r,dispatch:t})=>{var e=av(r).map(({from:t,to:e})=>b.range(t,Math.min(e+1,r.doc.length)));return t(r.update({selection:b.create(e),userEvent:"select"})),!0},Gd=({state:i,dispatch:t})=>{var e=A0(i.selection,t=>{var e;let r=A(i).resolveInner(t.head,1);for(;!(r.from<t.from&&r.to>=t.to||r.to>t.to&&r.from<=t.from||null==(e=r.parent))&&e.parent;)r=r.parent;return b.range(r.to,r.from)});return t(R0(i,e)),!0},Jd=({state:t,dispatch:e})=>{let r=t.selection,i=null;return 1<r.ranges.length?i=b.create([r.main]):r.main.empty||(i=b.create([b.cursor(r.main.head)])),!!i&&(e(R0(t,i)),!0)};function Kd(i,n){if(i.state.readOnly)return!1;let s="delete.selection",{state:t}=i;var e=t.changeByRange(t=>{let{from:e,to:r}=t;if(e==r){let t=n(e);t<e?(s="delete.backward",t=Qd(i,t,!1)):t>e&&(s="delete.forward",t=Qd(i,t,!0)),e=Math.min(e,t),r=Math.max(r,t)}else e=Qd(i,e,!1),r=Qd(i,r,!0);return e==r?{range:t}:{changes:{from:e,to:r},range:b.cursor(e)}});return!e.changes.empty&&(i.dispatch(t.update(e,{scrollIntoView:!0,userEvent:s,effects:"delete.selection"==s?E.announce.of(t.phrase("Selection deleted")):void 0})),!0)}function Qd(e,r,i){if(e instanceof E)for(var t of e.state.facet(E.atomicRanges).map(t=>t(e)))t.between(r,r,(t,e)=>{t<r&&r<e&&(r=i?e:t)});return r}const Xd=(h,a)=>Kd(h,e=>{let{state:t}=h,r=t.doc.lineAt(e),i,n;if(!a&&e>r.from&&e<r.from+200&&!/[^ \t]/.test(i=r.text.slice(0,e-r.from))){if("\t"==i[i.length-1])return e-1;var s,o=je(i,t.tabSize)%bu(t)||bu(t);for(let t=0;t<o&&" "==i[i.length-1-t];t++)e--;n=e}else(n=at(r.text,e-r.from,a,a)+r.from)==e&&r.number!=(a?t.doc.lines:1)&&(n+=a?1:-1);return n});var Zd=t=>Xd(t,!1),Yd=t=>Xd(t,!0);const tv=(t,u)=>Kd(t,e=>{let r=e,{state:i}=t,n=i.doc.lineAt(r);var s=i.charCategorizer(r);for(let t=null;;){if(r==(u?n.to:n.from)){r==e&&n.number!=(u?i.doc.lines:1)&&(r+=u?1:-1);break}var o=at(n.text,r-n.from,u)+n.from,h=n.text.slice(Math.min(r,o)-n.from,Math.max(r,o)-n.from),a=s(h);if(null!=t&&a!=t)break;" "==h&&r==e||(t=a),r=o}return r});var ev=t=>tv(t,!1),rv=t=>tv(t,!0),iv=r=>Kd(r,t=>{var e=r.lineBlockAt(t).to;return t<e?e:Math.min(r.state.doc.length,t+1)}),nv=r=>Kd(r,t=>{var e=r.lineBlockAt(t).from;return e<t?e:Math.max(0,t-1)}),sv,ov=({state:t,dispatch:e})=>{var r;return!t.readOnly&&(r=t.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:g.of(["",""])},range:b.cursor(t.from)})),e(t.update(r,{scrollIntoView:!0,userEvent:"input"})),!0)},hv=({state:n,dispatch:t})=>{var e;return!n.readOnly&&!(e=n.changeByRange(t=>{var e,r,i,r;return t.empty&&0!=t.from&&t.from!=n.doc.length?{changes:{from:i=(e=t.from)==(r=n.doc.lineAt(e)).from?e-1:at(r.text,e-r.from,!1)+r.from,to:r=e==r.to?e+1:at(r.text,e-r.from,!0)+r.from,insert:n.doc.slice(e,r).append(n.doc.slice(i,e))},range:b.cursor(r)}:{range:t}})).changes.empty&&(t(n.update(e,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function av(r){let i=[],n=-1;for(var s of r.selection.ranges){let t=r.doc.lineAt(s.from),e=r.doc.lineAt(s.to);var o;s.empty||s.to!=e.from||(e=r.doc.lineAt(s.to-1)),n>=t.number?((o=i[i.length-1]).to=e.to,o.ranges.push(s)):i.push({from:t.from,to:e.to,ranges:[s]}),n=e.number+1}return i}function uv(t,e,r){if(t.readOnly)return!1;var i=[],n=[],s;for(s of av(t))if(r?s.to!=t.doc.length:0!=s.from){var o=t.doc.lineAt(r?s.to+1:s.from-1),h=o.length+1;if(r){i.push({from:s.to,to:o.to},{from:s.from,insert:o.text+t.lineBreak});for(var a of s.ranges)n.push(b.range(Math.min(t.doc.length,a.anchor+h),Math.min(t.doc.length,a.head+h)))}else{i.push({from:o.from,to:s.from},{from:s.to,insert:t.lineBreak+o.text});for(var u of s.ranges)n.push(b.range(u.anchor-h,u.head-h))}}return!!i.length&&(e(t.update({changes:i,scrollIntoView:!0,selection:b.create(n,t.selection.mainIndex),userEvent:"move.line"})),!0)}var lv=({state:t,dispatch:e})=>uv(t,e,!1),cv=({state:t,dispatch:e})=>uv(t,e,!0);function fv(t,e,r){if(t.readOnly)return!1;var i=[],n;for(n of av(t))i.push(r?{from:n.from,insert:t.doc.slice(n.from,n.to)+t.lineBreak}:{from:n.to,insert:t.lineBreak+t.doc.slice(n.from,n.to)});return e(t.update({changes:i,scrollIntoView:!0,userEvent:"input.copyline"})),!0}var dv=({state:t,dispatch:e})=>fv(t,e,!1),vv=({state:t,dispatch:e})=>fv(t,e,!0),mv=e=>{if(e.state.readOnly)return!1;let{state:r}=e,t=r.changes(av(r).map(({from:t,to:e})=>(0<t?t--:e<r.doc.length&&e++,{from:t,to:e})));var i=A0(r.selection,t=>e.moveVertically(t,!0)).map(t);return e.dispatch({changes:t,selection:i,scrollIntoView:!0,userEvent:"delete.line"}),!0},pv;function gv(t,e){if(/\(\)|\[\]|\{\}/.test(t.sliceDoc(e-1,e+1)))return{from:e,to:e};var r=A(t).resolveInner(e);let i=r.childBefore(e),n=r.childAfter(e),s;return i&&n&&i.to<=e&&n.from>=e&&(s=i.type.prop(L.closedBy))&&-1<s.indexOf(n.name)&&t.doc.lineAt(i.to).from==t.doc.lineAt(n.from).from?{from:i.to,to:n.from}:null}var wv=kv(!1),bv=kv(!0);function kv(a){return({state:h,dispatch:t})=>{var e;return!h.readOnly&&(e=h.changeByRange(t=>{let{from:e,to:r}=t,i=h.doc.lineAt(e);var t=!a&&e==r&&gv(h,e),n=(a&&(e=r=(r<=i.to?i:h.doc.lineAt(r)).to),new xu(h,{simulateBreak:e,simulateDoubleBreak:!!t}));let s=yu(n,e);for(null==s&&(s=/^\s*/.exec(h.doc.lineAt(e).text)[0].length);r<i.to&&/\s/.test(i.text[r-i.from]);)r++;t?{from:e,to:r}=t:e>i.from&&e<i.from+100&&!/\S/.test(i.text.slice(0,e))&&(e=i.from);var o=["",ku(h,s)];return t&&o.push(ku(h,n.lineIndent(i.from,-1))),{changes:{from:e,to:r,insert:g.of(o)},range:b.cursor(e+1+o[1].length)}}),t(h.update(e,{scrollIntoView:!0,userEvent:"input"})),!0)}}function yv(n,s){let o=-1;return n.changeByRange(e=>{var r=[];for(let t=e.from;t<=e.to;){var i=n.doc.lineAt(t);i.number>o&&(e.empty||e.to>i.from)&&(s(i,r,e),o=i.number),t=i.to+1}var t=n.changes(r);return{changes:r,range:b.range(t.mapPos(e.anchor,1),t.mapPos(e.head,1))}})}var Mv=({state:o,dispatch:t})=>{if(o.readOnly)return!1;let h=Object.create(null),a=new xu(o,{overrideIndentation:t=>{var t=h[t];return null==t?-1:t}});var e=yv(o,(t,e,r)=>{let i=yu(a,t.from);var n,s;null!=i&&(/\S/.test(t.text)||(i=0),(n=/^\s*/.exec(t.text)[0])!=(s=ku(o,i))||r.from<t.from+n.length)&&(h[t.from]=i,e.push({from:t.from,to:t.from+n.length,insert:s}))});return e.changes.empty||t(o.update(e,{userEvent:"indent"})),!0};const xv=({state:r,dispatch:t})=>!r.readOnly&&(t(r.update(yv(r,(t,e)=>{e.push({from:t.from,insert:r.facet(wu)})}),{userEvent:"input.indent"})),!0);var Cv=({state:o,dispatch:t})=>!o.readOnly&&(t(o.update(yv(o,(r,i)=>{var n=/^\s*/.exec(r.text)[0];if(n){let t=je(n,o.tabSize),e=0;for(var s=ku(o,Math.max(0,t-bu(o)));e<n.length&&e<s.length&&n.charCodeAt(e)==s.charCodeAt(e);)e++;i.push({from:r.from+e,to:r.from+n.length,insert:s.slice(e)})}}),{userEvent:"delete.dedent"})),!0),Sv,Pv=[{key:"Ctrl-b",run:t,shift:md,preventDefault:!0},{key:"Ctrl-f",run:i,shift:pd},{key:"Ctrl-p",run:X0,shift:Dd},{key:"Ctrl-n",run:Z0,shift:Ad},{key:"Ctrl-a",run:ad,shift:Nd},{key:"Ctrl-e",run:ud,shift:$d},{key:"Ctrl-d",run:Yd},{key:"Ctrl-h",run:Zd},{key:"Ctrl-k",run:iv},{key:"Ctrl-Alt-h",run:ev},{key:"Ctrl-o",run:ov},{key:"Ctrl-t",run:hv},{key:"Ctrl-v",run:rd}],jv=[{key:"ArrowLeft",run:t,shift:md,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:s,shift:kd,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:od,shift:_d,preventDefault:!0},{key:"ArrowRight",run:i,shift:pd,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:Ga,shift:yd,preventDefault:!0},{mac:"Cmd-ArrowRight",run:hd,shift:Fd,preventDefault:!0},{key:"ArrowUp",run:X0,shift:Dd,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Hd,shift:zd},{mac:"Ctrl-ArrowUp",run:ed,shift:Id},{key:"ArrowDown",run:Z0,shift:Ad,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Ud,shift:Wd},{mac:"Ctrl-ArrowDown",run:rd,shift:Ld},{key:"PageUp",run:ed,shift:Id},{key:"PageDown",run:rd,shift:Ld},{key:"Home",run:sd,shift:Bd,preventDefault:!0},{key:"Mod-Home",run:Hd,shift:zd},{key:"End",run:nd,shift:Td,preventDefault:!0},{key:"Mod-End",run:Ud,shift:Wd},{key:"Enter",run:wv},{key:"Mod-a",run:Vd},{key:"Backspace",run:Zd,shift:Zd},{key:"Delete",run:Yd},{key:"Mod-Backspace",mac:"Alt-Backspace",run:ev},{key:"Mod-Delete",mac:"Alt-Delete",run:rv},{mac:"Mod-Backspace",run:nv},{mac:"Mod-Delete",run:iv}].concat(Pv.map(t=>({mac:t.key,run:t.run,shift:t.shift})));const Ov=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:J0,shift:jd},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:K0,shift:Od},{key:"Alt-ArrowUp",run:lv},{key:"Shift-Alt-ArrowUp",run:dv},{key:"Alt-ArrowDown",run:cv},{key:"Shift-Alt-ArrowDown",run:vv},{key:"Escape",run:Jd},{key:"Mod-Enter",run:bv},{key:"Alt-l",mac:"Ctrl-l",run:qd},{key:"Mod-i",run:Gd,preventDefault:!0},{key:"Mod-[",run:Cv},{key:"Mod-]",run:xv},{key:"Mod-Alt-\\",run:Mv},{key:"Shift-Mod-k",run:mv},{key:"Shift-Mod-\\",run:cd},{key:"Mod-/",run:n},{key:"Alt-A",run:_}].concat(jv);var Ev={key:"Tab",run:xv,shift:Cv};function I(t,e){var r,i,n,s,o,r=t;if("string"==typeof r&&(r=document.createElement(r)),i=1,(n=e)&&"object"==typeof n&&null==n.nodeType&&!Array.isArray(n)){for(s in n)Object.prototype.hasOwnProperty.call(n,s)&&("string"==typeof(o=n[s])?r.setAttribute(s,o):null!=o&&(r[s]=o));i++}for(;i<arguments.length;i++)Dv(r,arguments[i]);return r}function Dv(t,e){if("string"==typeof e)t.appendChild(document.createTextNode(e));else if(null!=e)if(null!=e.nodeType)t.appendChild(e);else{if(!Array.isArray(e))throw new RangeError("Unsupported child node: "+e);for(var r=0;r<e.length;r++)Dv(t,e[r])}}G=Object.freeze({__proto__:null,blockComment:r,blockUncomment:dr,copyLineDown:vv,copyLineUp:dv,cursorCharBackward:t=>T0(t,!1),cursorCharForward:t=>T0(t,!0),cursorCharLeft:t,cursorCharRight:i,cursorDocEnd:Ud,cursorDocStart:Hd,cursorGroupBackward:t=>N0(t,!1),cursorGroupForward:t=>N0(t,!0),cursorGroupLeft:s,cursorGroupRight:Ga,cursorLineBoundaryBackward:sd,cursorLineBoundaryForward:nd,cursorLineBoundaryLeft:od,cursorLineBoundaryRight:hd,cursorLineDown:Z0,cursorLineEnd:ud,cursorLineStart:ad,cursorLineUp:X0,cursorMatchingBracket:cd,cursorPageDown:rd,cursorPageUp:ed,cursorSubwordBackward:t=>V0(t,!1),cursorSubwordForward:t=>V0(t,!0),cursorSyntaxLeft:J0,cursorSyntaxRight:K0,defaultKeymap:Ov,deleteCharBackward:Zd,deleteCharForward:Yd,deleteGroupBackward:ev,deleteGroupForward:rv,deleteLine:mv,deleteToLineEnd:iv,deleteToLineStart:nv,deleteTrailingWhitespace:({state:i,dispatch:t})=>{if(i.readOnly)return!1;var n=[];for(let t=0,e="",r=i.doc.iter();;){if(r.next(),r.lineBreak||r.done){var s=e.search(/\s+$/);if(-1<s&&n.push({from:t-(e.length-s),to:t}),r.done)break;e=""}else e=r.value;t+=r.value.length}return!!n.length&&(t(i.update({changes:n,userEvent:"delete"})),!0)},emacsStyleKeymap:Pv,history:f0,historyField:mr,historyKeymap:D0,indentLess:Cv,indentMore:xv,indentSelection:Mv,indentWithTab:Ev,insertBlankLine:bv,insertNewline:({state:t,dispatch:e})=>(e(t.update(t.replaceSelection(t.lineBreak),{scrollIntoView:!0,userEvent:"input"})),!0),insertNewlineAndIndent:wv,insertTab:({state:t,dispatch:e})=>t.selection.ranges.some(t=>!t.empty)?xv({state:t,dispatch:e}):(e(t.update(t.replaceSelection("\t"),{scrollIntoView:!0,userEvent:"input"})),!0),invertedEffects:a0,isolateHistory:h0,lineComment:vr,lineUncomment:fr,moveLineDown:cv,moveLineUp:lv,redo:m0,redoDepth:Ka,redoSelection:cr,selectAll:Vd,selectCharBackward:t=>vd(t,!1),selectCharForward:t=>vd(t,!0),selectCharLeft:md,selectCharRight:pd,selectDocEnd:Wd,selectDocStart:zd,selectGroupBackward:t=>bd(t,!1),selectGroupForward:t=>bd(t,!0),selectGroupLeft:kd,selectGroupRight:yd,selectLine:qd,selectLineBoundaryBackward:Bd,selectLineBoundaryForward:Td,selectLineBoundaryLeft:_d,selectLineBoundaryRight:Fd,selectLineDown:Ad,selectLineEnd:$d,selectLineStart:Nd,selectLineUp:Dd,selectMatchingBracket:({state:t,dispatch:e})=>ld(t,e,!0),selectPageDown:Ld,selectPageUp:Id,selectParentSyntax:Gd,selectSubwordBackward:t=>Cd(t,!1),selectSubwordForward:t=>Cd(t,!0),selectSyntaxLeft:jd,selectSyntaxRight:Od,simplifySelection:Jd,splitLine:ov,standardKeymap:jv,toggleBlockComment:_,toggleBlockCommentByLine:Yf,toggleComment:n,toggleLineComment:Zf,transposeChars:hv,undo:v0,undoDepth:Ja,undoSelection:qa});class Av{constructor(t,e,r){this.from=t,this.to=e,this.diagnostic=r}}class Rv{constructor(t,e,r){this.diagnostics=t,this.panel=e,this.selected=r}static init(t,e,r){let i=t;var t=r.facet(Jv).markerFilter,t=(t&&(i=t(i)),j.set(i.map(t=>t.from==t.to||t.from==t.to-1&&r.doc.lineAt(t.from).to==t.from?j.widget({widget:new Yv(t),diagnostic:t}).range(t.from):j.mark({attributes:{class:"cm-lintRange cm-lintRange-"+t.severity},diagnostic:t}).range(t.from,t.to)),!0));return new Rv(t,e,Iv(t))}}function Iv(t,i=null,e=0){let n=null;return t.between(e,1e9,(t,e,{spec:r})=>{if(!i||r.diagnostic==i)return n=new Av(t,e,r.diagnostic),!1}),n}function Lv(t,e){return!(!t.effects.some(t=>t.is(_v))&&!t.changes.touchesRange(e.pos))}function Tv(t,e){return t.field($v,!1)?e:e.concat(l.appendConfig.of(d1))}function Bv(t,e){return{effects:Tv(t,[_v.of(e)])}}const _v=l.define(),Fv=l.define(),Nv=l.define(),$v=M.define({create(){return new Rv(j.none,null,null)},update(r,i){if(i.docChanged){let t=r.diagnostics.map(i.changes),e=null;var n;r.selected&&(n=i.changes.mapPos(r.selected.from,1),e=Iv(t,r.selected.diagnostic,n)||Iv(t,null,n)),r=new Rv(t,r.panel,e)}for(var t of i.effects)t.is(_v)?r=Rv.init(t.value,r.panel,i.state):t.is(Fv)?r=new Rv(r.diagnostics,t.value?e1.open:null,r.selected):t.is(Nv)&&(r=new Rv(r.diagnostics,r.panel,t.value));return r},provide:t=>[jh.from(t,t=>t.panel),E.decorations.from(t,t=>t.diagnostics)]});function Hv(t){var t=t.field($v,!1);return t?t.diagnostics.size:0}const Uv=j.mark({class:"cm-lintRange cm-lintRange-active"});function zv(t,i,n){var{diagnostics:e}=t.state.field($v);let s=[],o=2e8,h=0;e.between(i-(n<0?1:0),i+(0<n?1:0),(t,e,{spec:r})=>{t<=i&&i<=e&&(t==e||(t<i||0<n)&&(i<e||n<0))&&(s.push(r.diagnostic),o=Math.min(t,o),h=Math.max(e,h))});var e=t.state.facet(Jv).tooltipFilter;return(s=e?e(s):s).length?{pos:o,end:h,above:t.state.doc.lineAt(o).to<h,create(){return{dom:Wv(t,s)}}}:null}function Wv(e,t){return I("ul",{class:"cm-tooltip-lint"},t.map(t=>Zv(e,t,!1)))}var r=t=>{var e=t.state.field($v,!1),e=(e&&e.panel||t.dispatch({effects:Tv(t.state,[Fv.of(!0)])}),xh(t,e1.open));return e&&e.dom.querySelector(".cm-panel-lint ul").focus(),!0};const Vv=t=>{var e=t.state.field($v,!1);return!(!e||!e.panel||(t.dispatch({effects:Fv.of(!1)}),0))};var dr=t=>{var e=t.state.field($v,!1);if(!e)return!1;let r=t.state.selection.main,i=e.diagnostics.iter(r.to+1);return!(!i.value&&(!(i=e.diagnostics.iter(0)).value||i.from==r.from&&i.to==r.to)||(t.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0}),0))};const qv=[{key:"Mod-Shift-m",run:r,preventDefault:!0},{key:"F8",run:dr}],Gv=h.fromClass(class{constructor(t){this.view=t,this.timeout=-1,this.set=!0;var{delay:t}=t.state.facet(Jv);this.lintTime=Date.now()+t,this.run=this.run.bind(this),this.timeout=setTimeout(this.run,t)}run(){var t=Date.now();if(t<this.lintTime-10)setTimeout(this.run,this.lintTime-t);else{this.set=!1;let{state:e}=this.view,{sources:t}=e.facet(Jv);Promise.all(t.map(t=>Promise.resolve(t(this.view)))).then(t=>{var t=t.reduce((t,e)=>t.concat(e));this.view.state.doc==e.doc&&this.view.dispatch(Bv(this.view.state,t))},t=>{ni(this.view.state,t)})}}update(t){var e=t.state.facet(Jv);(t.docChanged||e!=t.startState.facet(Jv)||e.needsRefresh&&e.needsRefresh(t))&&(this.lintTime=Date.now()+e.delay,this.set||(this.set=!0,this.timeout=setTimeout(this.run,e.delay)))}force(){this.set&&(this.lintTime=Date.now(),this.run())}destroy(){clearTimeout(this.timeout)}}),Jv=m.define({combine(t){return Object.assign({sources:t.map(t=>t.source)},le(t.map(t=>t.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null},{needsRefresh:(e,r)=>e?r?t=>e(t)||r(t):e:r}))}});function Kv(t,e={}){return[Jv.of({source:t,config:e}),Gv,d1]}function Qv(t){var t=t.plugin(Gv);t&&t.force()}function Xv(t){var r=[];if(t)t:for(var{name:i}of t){for(let t=0;t<i.length;t++){let e=i[t];if(/[a-zA-Z]/.test(e)&&!r.some(t=>t.toLowerCase()==e.toLowerCase())){r.push(e);continue t}}r.push("")}return r}function Zv(h,a,t){var t;let u=t?Xv(a.actions):[];return I("li",{class:"cm-diagnostic cm-diagnostic-"+a.severity},I("span",{class:"cm-diagnosticText"},a.renderMessage?a.renderMessage():a.message),null==(t=a.actions)?void 0:t.map((e,t)=>{let r=!1,i=t=>{var t;t.preventDefault(),!r&&(r=!0,t=Iv(h.state.field($v).diagnostics,a))&&e.apply(h,t.from,t.to)};var{name:n}=e,s=u[t]?n.indexOf(u[t]):-1,o=s<0?n:[n.slice(0,s),I("u",n.slice(s,s+1)),n.slice(s+1)];return I("button",{type:"button",class:"cm-diagnosticAction",onclick:i,onmousedown:i,"aria-label":` Action: ${n}${s<0?"":` (access key "${u[t]})"`}.`},o)}),a.source&&I("div",{class:"cm-diagnosticSource"},a.source))}class Yv extends Tr{constructor(t){super(),this.diagnostic=t}eq(t){return t.diagnostic==this.diagnostic}toDOM(){return I("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class t1{constructor(t,e){this.diagnostic=e,this.id="item_"+Math.floor(4294967295*Math.random()).toString(16),this.dom=Zv(t,e,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class e1{constructor(s){this.view=s,this.items=[];var t=e=>{if(27==e.keyCode)Vv(this.view),this.view.focus();else if(38==e.keyCode||33==e.keyCode)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(40==e.keyCode||34==e.keyCode)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(36==e.keyCode)this.moveSelection(0);else if(35==e.keyCode)this.moveSelection(this.items.length-1);else if(13==e.keyCode)this.view.focus();else{if(!(65<=e.keyCode&&e.keyCode<=90&&0<=this.selectedIndex))return;var{diagnostic:r}=this.items[this.selectedIndex],i=Xv(r.actions),n;for(let t=0;t<i.length;t++){i[t].toUpperCase().charCodeAt(0)==e.keyCode&&(n=Iv(this.view.state.field($v).diagnostics,r))&&r.actions[t].apply(s,n.from,n.to)}}e.preventDefault()},e=e=>{for(let t=0;t<this.items.length;t++)this.items[t].dom.contains(e.target)&&this.moveSelection(t)};this.list=I("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:t,onclick:e}),this.dom=I("div",{class:"cm-panel-lint"},this.list,I("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>Vv(this.view)},"\xd7")),this.update()}get selectedIndex(){var e=this.view.state.field($v).selected;if(e)for(let t=0;t<this.items.length;t++)if(this.items[t].diagnostic==e.diagnostic)return t;return-1}update(){let{diagnostics:t,selected:s}=this.view.state.field($v),o=0,h=!1,a=null;for(t.between(0,this.view.state.doc.length,(t,e,{spec:r})=>{let i=-1,n;for(let t=o;t<this.items.length;t++)if(this.items[t].diagnostic==r.diagnostic){i=t;break}i<0?(n=new t1(this.view,r.diagnostic),this.items.splice(o,0,n),h=!0):(n=this.items[i],i>o&&(this.items.splice(o,i-o),h=!0)),s&&n.diagnostic==s.diagnostic?n.dom.hasAttribute("aria-selected")||(n.dom.setAttribute("aria-selected","true"),a=n):n.dom.hasAttribute("aria-selected")&&n.dom.removeAttribute("aria-selected"),o++});o<this.items.length&&!(1==this.items.length&&this.items[0].diagnostic.from<0);)h=!0,this.items.pop();0==this.items.length&&(this.items.push(new t1(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),h=!0),a?(this.list.setAttribute("aria-activedescendant",a.id),this.view.requestMeasure({key:this,read:()=>({sel:a.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:t,panel:e})=>{t.top<e.top?this.list.scrollTop-=e.top-t.top:t.bottom>e.bottom&&(this.list.scrollTop+=t.bottom-e.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),h&&this.sync()}sync(){let e=this.list.firstChild;function t(){var t=e;e=t.nextSibling,t.remove()}for(var r of this.items)if(r.dom.parentNode==this.list){for(;e!=r.dom;)t();e=r.dom.nextSibling}else this.list.insertBefore(r.dom,e);for(;e;)t()}moveSelection(t){var e,t;this.selectedIndex<0||(t=Iv(this.view.state.field($v).diagnostics,this.items[t].diagnostic))&&this.view.dispatch({selection:{anchor:t.from,head:t.to},scrollIntoView:!0,effects:Nv.of(t)})}static open(t){return new e1(t)}}function r1(t,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(t)}</svg>')`}function i1(t){return r1(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${t}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}var vv=E.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:i1("#d11")},".cm-lintRange-warning":{backgroundImage:i1("orange")},".cm-lintRange-info":{backgroundImage:i1("#999")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});class n1 extends Oh{constructor(t){super(),this.diagnostics=t,this.severity=t.reduce((t,e)=>{var e=e.severity;return"error"==e||"warning"==e&&"info"==t?e:t},"info")}toDOM(t){let e=document.createElement("div"),r=(e.className="cm-lint-marker cm-lint-marker-"+this.severity,this.diagnostics);var i=t.state.facet(v1).tooltipFilter;return(r=i?i(r):r).length&&(e.onmouseover=()=>o1(t,e,r)),e}}function s1(r,i){let n=e=>{var t=i.getBoundingClientRect();if(!(e.clientX>t.left-10&&e.clientX<t.right+10&&e.clientY>t.top-10&&e.clientY<t.bottom+10)){for(let t=e.target;t;t=t.parentNode)if(1==t.nodeType&&t.classList.contains("cm-tooltip-lint"))return;window.removeEventListener("mousemove",n),r.state.field(c1)&&r.dispatch({effects:l1.of(null)})}};window.addEventListener("mousemove",n)}function o1(r,i,n){function t(){var t=r.elementAtHeight(i.getBoundingClientRect().top+5-r.documentTop),e;r.coordsAtPos(t.from)&&r.dispatch({effects:l1.of({pos:t.from,above:!1,create(){return{dom:Wv(r,n),getCoords:()=>i.getBoundingClientRect()}}})}),i.onmouseout=i.onmousemove=null,s1(r,i)}let{hoverTime:e}=r.state.facet(v1),s=setTimeout(t,e);i.onmouseout=()=>{clearTimeout(s),i.onmouseout=i.onmousemove=null},i.onmousemove=()=>{clearTimeout(s),s=setTimeout(t,e)}}function h1(t,e){var r=Object.create(null),i;for(i of e){var n=t.lineAt(i.from);(r[n.from]||(r[n.from]=[])).push(i)}var s=[],o;for(o in r)s.push(new n1(r[o]).range(+o));return S.of(s,!0)}const a1=Rh({class:"cm-gutter-lint",markers:t=>t.state.field(u1)}),u1=M.define({create(){return S.empty},update(e,r){e=e.map(r.changes);var i=r.state.facet(v1).markerFilter,n;for(n of r.effects)if(n.is(_v)){let t=n.value;i&&(t=i(t||[])),e=h1(r.state.doc,t.slice(0))}return e}}),l1=l.define(),c1=M.define({create(){return null},update(t,e){return t&&e.docChanged&&(t=Lv(e,t)?null:Object.assign(Object.assign({},t),{pos:e.changes.mapPos(t.pos)})),e.effects.reduce((t,e)=>e.is(l1)?e.value:t,t)},provide:t=>uh.from(t)}),f1=E.baseTheme({".cm-gutter-lint":{width:"1.4em","& .cm-gutterElement":{padding:".2em"}},".cm-lint-marker":{width:"1em",height:"1em"},".cm-lint-marker-info":{content:r1('<path fill="#aaf" stroke="#77e" stroke-width="6" stroke-linejoin="round" d="M5 5L35 5L35 35L5 35Z"/>')},".cm-lint-marker-warning":{content:r1('<path fill="#fe8" stroke="#fd7" stroke-width="6" stroke-linejoin="round" d="M20 6L37 35L3 35Z"/>')},".cm-lint-marker-error":{content:r1('<circle cx="20" cy="20" r="15" fill="#f87" stroke="#f43" stroke-width="6"/>')}}),d1=[$v,E.decorations.compute([$v],t=>{var{selected:t,panel:e}=t.field($v);return t&&e&&t.from!=t.to?j.set([Uv.range(t.from,t.to)]):j.none}),ph(zv,{hideOn:Lv}),vv],v1=m.define({combine(t){return le(t,{hoverTime:300,markerFilter:null,tooltipFilter:null})}});function m1(t={}){return[v1.of(t),u1,a1,f1,c1]}function p1(t,e){var t=t.field($v,!1);if(t&&t.diagnostics.size)for(var r=S.iter([t.diagnostics]);r.value;r.next())e(r.value.spec.diagnostic,r.from,r.to)}J=Object.freeze({__proto__:null,closeLintPanel:Vv,diagnosticCount:Hv,forEachDiagnostic:p1,forceLinting:Qv,lintGutter:m1,lintKeymap:qv,linter:Kv,nextDiagnostic:dr,openLintPanel:r,setDiagnostics:Bv,setDiagnosticsEffect:_v});const g1="function"==typeof String.prototype.normalize?t=>t.normalize("NFKD"):t=>t;class w1{constructor(t,e,r=0,i=t.length,n,s){this.test=s,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=t.iterRange(r,i),this.bufferStart=r,this.normalize=n?t=>n(g1(t)):g1,this.query=this.normalize(e)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return x(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){var t=this.peek();if(t<0)return this.done=!0,this;var r=dt(t),i=this.bufferStart+this.bufferPos,n=(this.bufferPos+=vt(t),this.normalize(r));for(let t=0,e=i;;t++){var s=n.charCodeAt(t),o=this.match(s,e);if(o)return this.value=o,this;if(t==n.length-1)break;e==i&&t<r.length&&r.charCodeAt(t)==s&&e++}}}match(i,n){let s=null;for(let r=0;r<this.matches.length;r+=2){let t=this.matches[r],e=!1;this.query.charCodeAt(t)==i&&(t==this.query.length-1?s={from:this.matches[r+1],to:n+1}:(this.matches[r]++,e=!0)),e||(this.matches.splice(r,2),r-=2)}return this.query.charCodeAt(0)==i&&(1==this.query.length?s={from:n,to:n+1}:this.matches.push(1,n)),s=s&&this.test&&!this.test(s.from,s.to,this.buffer,this.bufferPos)?null:s}}"undefined"!=typeof Symbol&&(w1.prototype[Symbol.iterator]=function(){return this});const b1={from:-1,to:-1,match:/.*/.exec("")},k1="gm"+(null==/x/.unicode?"":"u");class y1{constructor(t,e,r,i=0,n=t.length){if(this.text=t,this.to=n,this.curLine="",this.done=!1,this.value=b1,/\\[sWDnr]|\n|\r|\[\^/.test(e))return new C1(t,e,r,i,n);this.re=new RegExp(e,k1+(null!=r&&r.ignoreCase?"i":"")),this.test=null==r?void 0:r.test,this.iter=t.iter();var n=t.lineAt(i);this.curLineStart=n.from,this.matchPos=P1(t,i),this.getLine(this.curLineStart)}getLine(t){this.iter.next(t),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let t=this.matchPos-this.curLineStart;;){this.re.lastIndex=t;var e=this.matchPos<=this.to&&this.re.exec(this.curLine);if(e){var r=this.curLineStart+e.index,i=r+e[0].length;if(this.matchPos=P1(this.text,i+(r==i?1:0)),r==this.curLineStart+this.curLine.length&&this.nextLine(),(r<i||r>this.value.to)&&(!this.test||this.test(r,i,e)))return this.value={from:r,to:i,match:e},this;t=this.matchPos-this.curLineStart}else{if(!(this.curLineStart+this.curLine.length<this.to))return this.done=!0,this;this.nextLine(),t=0}}}}const M1=new WeakMap;class x1{constructor(t,e){this.from=t,this.text=e}get to(){return this.from+this.text.length}static get(t,e,r){var i=M1.get(t),n;if(!i||i.from>=r||i.to<=e)return n=new x1(e,t.sliceString(e,r)),M1.set(t,n),n;if(i.from==e&&i.to==r)return i;let{text:s,from:o}=i;return o>e&&(s=t.sliceString(e,o)+s,o=e),i.to<r&&(s+=t.sliceString(i.to,r)),M1.set(t,new x1(o,s)),new x1(e,s.slice(e-o,r-o))}}class C1{constructor(t,e,r,i,n){this.text=t,this.to=n,this.done=!1,this.value=b1,this.matchPos=P1(t,i),this.re=new RegExp(e,k1+(null!=r&&r.ignoreCase?"i":"")),this.test=null==r?void 0:r.test,this.flat=x1.get(t,i,this.chunkEnd(i+5e3))}chunkEnd(t){return(t>=this.to?this:this.text.lineAt(t)).to}next(){for(;;){var e=this.re.lastIndex=this.matchPos-this.flat.from;let t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=1+e,t=this.re.exec(this.flat.text)),t){var e=this.flat.from+t.index,r=e+t[0].length;if((this.flat.to>=this.to||t.index+t[0].length<=this.flat.text.length-10)&&(!this.test||this.test(e,r,t)))return this.value={from:e,to:r,match:t},this.matchPos=P1(this.text,r+(e==r?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=x1.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+2*this.flat.text.length))}}}function S1(t){try{return new RegExp(t,k1),!0}catch(t){return!1}}function P1(r,i){if(!(i>=r.length)){let t=r.lineAt(i),e;for(;i<t.to&&56320<=(e=t.text.charCodeAt(i-t.from))&&e<57344;)i++}return i}function j1(h){let e=I("input",{class:"cm-textfield",name:"line"});var t;function r(){var r=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.value);if(r){var{state:i}=h,n=i.doc.lineAt(i.selection.main.head),[,r,t,s,o]=r,s=s?+s.slice(1):0;let e=t?+t:n.number;if(t&&o){let t=e/100;r&&(t=t*("-"==r?-1:1)+n.number/i.doc.lines),e=Math.round(i.doc.lines*t)}else t&&r&&(e=e*("-"==r?-1:1)+n.number);var o=i.doc.line(Math.max(1,Math.min(i.doc.lines,e)));h.dispatch({effects:O1.of(!1),selection:b.cursor(o.from+Math.max(0,Math.min(s,o.length))),scrollIntoView:!0}),h.focus()}}return{dom:I("form",{class:"cm-gotoLine",onkeydown:t=>{27==t.keyCode?(t.preventDefault(),h.dispatch({effects:O1.of(!1)}),h.focus()):13==t.keyCode&&(t.preventDefault(),r())},onsubmit:t=>{t.preventDefault(),r()}},I("label",h.state.phrase("Go to line"),": ",e)," ",I("button",{class:"cm-button",type:"submit"},h.state.phrase("go")))}}"undefined"!=typeof Symbol&&(y1.prototype[Symbol.iterator]=C1.prototype[Symbol.iterator]=function(){return this});const O1=l.define(),E1=M.define({create(){return!0},update(t,e){for(var r of e.effects)r.is(O1)&&(t=r.value);return t},provide:t=>jh.from(t,t=>t?j1:null)});var dv=t=>{let e=xh(t,j1);var r;return e||(r=[O1.of(!0)],null==t.state.field(E1,!1)&&r.push(l.appendConfig.of([E1,D1])),t.dispatch({effects:r}),e=xh(t,j1)),e&&e.dom.querySelector("input").focus(),!0};const D1=E.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),A1={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},R1=m.define({combine(t){return le(t,A1,{highlightWordAroundCursor:(t,e)=>t||e,minSelectionLength:Math.min,maxMatches:Math.min})}});function I1(t){var e=[N1,F1];return t&&e.push(R1.of(t)),e}const L1=j.mark({class:"cm-selectionMatch"}),T1=j.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function B1(t,e,r,i){return!(0!=r&&t(e.sliceDoc(r-1,r))==c.Word||i!=e.doc.length&&t(e.sliceDoc(i,i+1))==c.Word)}function _1(t,e,r,i){return t(e.sliceDoc(r,r+1))==c.Word&&t(e.sliceDoc(i-1,i))==c.Word}const F1=h.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.selectionSet||t.docChanged||t.viewportChanged)&&(this.decorations=this.getDeco(t.view))}getDeco(t){var e=t.state.facet(R1),{state:r}=t,i=r.selection;if(1<i.ranges.length)return j.none;let n=i.main,s,o=null;if(n.empty){if(!e.highlightWordAroundCursor)return j.none;var i=r.wordAt(n.head);if(!i)return j.none;o=r.charCategorizer(n.head),s=r.sliceDoc(i.from,i.to)}else{var i=n.to-n.from;if(i<e.minSelectionLength||200<i)return j.none;if(e.wholeWords){if(s=r.sliceDoc(n.from,n.to),!B1(o=r.charCategorizer(n.head),r,n.from,n.to)||!_1(o,r,n.from,n.to))return j.none}else if(!(s=r.sliceDoc(n.from,n.to).trim()))return j.none}var h=[],a;for(a of t.visibleRanges)for(var u=new w1(r.doc,s,a.from,a.to);!u.next().done;){var{from:l,to:c}=u.value;if((!o||B1(o,r,l,c))&&(n.empty&&l<=n.from&&c>=n.to?h.push(T1.range(l,c)):(l>=n.to||c<=n.from)&&h.push(L1.range(l,c)),h.length>e.maxMatches))return j.none}return j.set(h)}},{decorations:t=>t.decorations}),N1=E.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),$1=({state:e,dispatch:t})=>{var{selection:r}=e,i=b.create(r.ranges.map(t=>e.wordAt(t.head)||b.cursor(t.head)),r.mainIndex);return!i.eq(r)&&(t(e.update({selection:i})),!0)};function H1(r,i){var{main:t,ranges:n}=r.selection,e=r.wordAt(t.head),s=e&&e.from==t.from&&e.to==t.to;for(let t=!1,e=new w1(r.doc,i,n[n.length-1].to);;)if(e.next(),e.done){if(t)return null;e=new w1(r.doc,i,0,Math.max(0,n[n.length-1].from-1)),t=!0}else if(!t||!n.some(t=>t.from==e.value.from)){if(s){var o=r.wordAt(e.value.from);if(!o||o.from!=e.value.from||o.to!=e.value.to)continue}return e.value}}var t=({state:e,dispatch:t})=>{var{ranges:r}=e.selection,r;if(r.some(t=>t.from===t.to))return $1({state:e,dispatch:t});let i=e.sliceDoc(r[0].from,r[0].to);return!e.selection.ranges.some(t=>e.sliceDoc(t.from,t.to)!=i)&&!!(r=H1(e,i))&&(t(e.update({selection:e.selection.addRange(b.range(r.from,r.to),!1),effects:E.scrollIntoView(r.to)})),!0)};const U1=m.define({combine(t){return le(t,{top:!1,caseSensitive:!1,literal:!1,wholeWord:!1,createPanel:t=>new ym(t),scrollToMatch:t=>E.scrollIntoView(t)})}});function z1(t){return t?[U1.of(t),Pm]:Pm}class W1{constructor(t){this.search=t.search,this.caseSensitive=!!t.caseSensitive,this.literal=!!t.literal,this.regexp=!!t.regexp,this.replace=t.replace||"",this.valid=!!this.search&&(!this.regexp||S1(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!t.wholeWord}unquote(t){return this.literal?t:t.replace(/\\([nrt\\])/g,(t,e)=>"n"==e?"\n":"r"==e?"\r":"t"==e?"\t":"\\")}eq(t){return this.search==t.search&&this.replace==t.replace&&this.caseSensitive==t.caseSensitive&&this.regexp==t.regexp&&this.wholeWord==t.wholeWord}create(){return new(this.regexp?Y1:J1)(this)}getCursor(t,e=0,r){var t=t.doc?t:C.create({doc:t});return null==r&&(r=t.doc.length),(this.regexp?K1:q1)(this,t,e,r)}}class V1{constructor(t){this.spec=t}}function q1(t,e,r,i){return new w1(e.doc,t.unquoted,r,i,t.caseSensitive?void 0:t=>t.toLowerCase(),t.wholeWord?G1(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function G1(n,s){return(t,e,r,i)=>((t<i||i+r.length<e)&&(i=Math.max(0,t-2),r=n.sliceString(i,Math.min(n.length,e+2))),!(s(Q1(r,t-i))==c.Word&&s(X1(r,t-i))==c.Word||s(X1(r,e-i))==c.Word&&s(Q1(r,e-i))==c.Word))}class J1 extends V1{constructor(t){super(t)}nextMatch(t,e,r){let i=q1(this.spec,t,r,t.doc.length).nextOverlapping();return(i=i.done?q1(this.spec,t,0,e).nextOverlapping():i).done?null:i.value}prevMatchInRange(i,n,t){for(let r=t;;){var s=Math.max(n,r-1e4-this.spec.unquoted.length);let t=q1(this.spec,i,s,r),e=null;for(;!t.nextOverlapping().done;)e=t.value;if(e)return e;if(s==n)return null;r-=1e4}}prevMatch(t,e,r){return this.prevMatchInRange(t,0,e)||this.prevMatchInRange(t,r,t.doc.length)}getReplacement(t){return this.spec.unquote(this.spec.replace)}matchAll(t,e){for(var r=q1(this.spec,t,0,t.doc.length),i=[];!r.next().done;){if(e<=i.length)return null;i.push(r.value)}return i}highlight(t,e,r,i){for(var n=q1(this.spec,t,Math.max(0,e-this.spec.unquoted.length),Math.min(r+this.spec.unquoted.length,t.doc.length));!n.next().done;)i(n.value.from,n.value.to)}}function K1(t,e,r,i){return new y1(e.doc,t.search,{ignoreCase:!t.caseSensitive,test:t.wholeWord?Z1(e.charCategorizer(e.selection.main.head)):void 0},r,i)}function Q1(t,e){return t.slice(at(t,e,!1),e)}function X1(t,e){return t.slice(e,at(t,e))}function Z1(i){return(t,e,r)=>!r[0].length||(i(Q1(r.input,r.index))!=c.Word||i(X1(r.input,r.index))!=c.Word)&&(i(X1(r.input,r.index+r[0].length))!=c.Word||i(Q1(r.input,r.index+r[0].length))!=c.Word)}class Y1 extends V1{nextMatch(t,e,r){let i=K1(this.spec,t,r,t.doc.length).next();return(i=i.done?K1(this.spec,t,0,e).next():i).done?null:i.value}prevMatchInRange(i,n,s){for(let r=1;;r++){var o=Math.max(n,s-1e4*r);let t=K1(this.spec,i,o,s),e=null;for(;!t.next().done;)e=t.value;if(e&&(o==n||e.from>o+10))return e;if(o==n)return null}}prevMatch(t,e,r){return this.prevMatchInRange(t,0,e)||this.prevMatchInRange(t,r,t.doc.length)}getReplacement(r){return this.spec.unquote(this.spec.replace.replace(/\$([$&\d+])/g,(t,e)=>"$"==e?"$":"&"==e?r.match[0]:"0"!=e&&+e<r.match.length?r.match[e]:t))}matchAll(t,e){for(var r=K1(this.spec,t,0,t.doc.length),i=[];!r.next().done;){if(e<=i.length)return null;i.push(r.value)}return i}highlight(t,e,r,i){for(var n=K1(this.spec,t,Math.max(0,e-250),Math.min(r+250,t.doc.length));!n.next().done;)i(n.value.from,n.value.to)}}const tm=l.define(),em=l.define(),rm=M.define({create(t){return new sm(mm(t).create(),null)},update(t,e){for(var r of e.effects)r.is(tm)?t=new sm(r.value.create(),t.panel):r.is(em)&&(t=new sm(t.query,r.value?vm:null));return t},provide:t=>jh.from(t,t=>t.panel)});function im(t){var e=t.field(rm,!1);return e?e.query.spec:mm(t)}function nm(t){var t;return null!=(null==(t=t.field(rm,!1))?void 0:t.panel)}class sm{constructor(t,e){this.query=t,this.panel=e}}const om=j.mark({class:"cm-searchMatch"}),hm=j.mark({class:"cm-searchMatch cm-searchMatch-selected"});var i=h.fromClass(class{constructor(t){this.view=t,this.decorations=this.highlight(t.state.field(rm))}update(t){var e=t.state.field(rm);(e!=t.startState.field(rm)||t.docChanged||t.selectionSet||t.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:s,panel:t}){if(!t||!s.spec.valid)return j.none;let{view:o}=this,h=new pe;for(let r=0,i=o.visibleRanges,n=i.length;r<n;r++){let{from:t,to:e}=i[r];for(;r<n-1&&e>i[r+1].from-500;)e=i[++r].to;s.highlight(o.state,t,e,(e,r)=>{var t=o.state.selection.ranges.some(t=>t.from==e&&t.to==r);h.add(e,r,t?hm:om)})}return h.finish()}},{decorations:t=>t.decorations});function am(r){return t=>{var e=t.state.field(rm,!1);return e&&e.query.spec.valid?r(t,e):wm(t)}}const um=am((t,{query:e})=>{var{to:r}=t.state.selection.main,e=e.nextMatch(t.state,r,r),r,i;return!!e&&(r=b.single(e.from,e.to),i=t.state.facet(U1),t.dispatch({selection:r,effects:[Sm(t,e),i.scrollToMatch(r.main,t)],userEvent:"select.search"}),gm(t),!0)}),lm=am((t,{query:e})=>{var{state:r}=t,{from:i}=r.selection.main,e=e.prevMatch(r,i,i),r,i;return!!e&&(r=b.single(e.from,e.to),i=t.state.facet(U1),t.dispatch({selection:r,effects:[Sm(t,e),i.scrollToMatch(r.main,t)],userEvent:"select.search"}),gm(t),!0)}),cm=am((t,{query:e})=>{var e=e.matchAll(t.state,1e3);return!(!e||!e.length||(t.dispatch({selection:b.create(e.map(t=>b.range(t.from,t.to))),userEvent:"select.search.matches"}),0))});var Ud=({state:t,dispatch:e})=>{var r=t.selection;if(1<r.ranges.length||r.main.empty)return!1;var{from:i,to:r}=r.main;let n=[],s=0;for(var o=new w1(t.doc,t.sliceDoc(i,r));!o.next().done;){if(1e3<n.length)return!1;o.value.from==i&&(s=n.length),n.push(b.range(o.value.from,o.value.to))}return e(t.update({selection:b.create(n,s),userEvent:"select.search.matches"})),!0};const fm=am((t,{query:e})=>{var{state:r}=t,{from:i,to:n}=r.selection.main;if(r.readOnly)return!1;let s=e.nextMatch(r,i,i);if(!s)return!1;let o=[],h,a;var u=[],n;return s.from==i&&s.to==n&&(a=r.toText(e.getReplacement(s)),o.push({from:s.from,to:s.to,insert:a}),s=e.nextMatch(r,s.from,s.to),u.push(E.announce.of(r.phrase("replaced match on line $",r.doc.lineAt(i).number)+"."))),s&&(n=0==o.length||o[0].from>=s.to?0:s.to-s.from-a.length,h=b.single(s.from-n,s.to-n),u.push(Sm(t,s)),u.push(r.facet(U1).scrollToMatch(h.main,t))),t.dispatch({changes:o,selection:h,effects:u,userEvent:"input.replace"}),!0}),dm=am((t,{query:i})=>{var e,r;return!t.state.readOnly&&!!(e=i.matchAll(t.state,1e9).map(t=>{var{from:e,to:r}=t;return{from:e,to:r,insert:i.getReplacement(t)}})).length&&(r=t.state.phrase("replaced $ matches",e.length)+".",t.dispatch({changes:e,effects:E.announce.of(r),userEvent:"input.replace.all"}),!0)});function vm(t){return t.state.facet(U1).createPanel(t)}function mm(t,e){var r,r,i,r,i=t.selection.main,i=i.empty||i.to>i.from+100?"":t.sliceDoc(i.from,i.to),t;return e&&!i?e:(t=t.facet(U1),new W1({search:(null!=(r=null==e?void 0:e.literal)?r:t.literal)?i:i.replace(/\n/g,"\\n"),caseSensitive:null!=(r=null==e?void 0:e.caseSensitive)?r:t.caseSensitive,literal:null!=(i=null==e?void 0:e.literal)?i:t.literal,wholeWord:null!=(r=null==e?void 0:e.wholeWord)?r:t.wholeWord}))}function pm(t){var t=xh(t,vm);return t&&t.dom.querySelector("[main-field]")}function gm(t){var e=pm(t);e&&e==t.root.activeElement&&e.select()}const wm=t=>{var e=t.state.field(rm,!1),r,i;return e&&e.panel?(r=pm(t))&&r!=t.root.activeElement&&((i=mm(t.state,e.query.spec)).valid&&t.dispatch({effects:tm.of(i)}),r.focus(),r.select()):t.dispatch({effects:[em.of(!0),e?tm.of(mm(t.state,e.query.spec)):l.appendConfig.of(Pm)]}),!0},bm=t=>{var e=t.state.field(rm,!1),e;return!(!e||!e.panel||((e=xh(t,vm))&&e.dom.contains(t.root.activeElement)&&t.focus(),t.dispatch({effects:em.of(!1)}),0))},km=[{key:"Mod-f",run:wm,scope:"editor search-panel"},{key:"F3",run:um,shift:lm,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:um,shift:lm,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:bm,scope:"editor search-panel"},{key:"Mod-Shift-l",run:Ud},{key:"Alt-g",run:dv},{key:"Mod-d",run:t,preventDefault:!0}];class ym{constructor(t){this.view=t;var e=this.query=t.state.field(rm).query.spec;function r(t,e,r){return I("button",{class:"cm-button",name:t,onclick:e,type:"button"},r)}this.commit=this.commit.bind(this),this.searchField=I("input",{value:e.search,placeholder:Mm(t,"Find"),"aria-label":Mm(t,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=I("input",{value:e.replace,placeholder:Mm(t,"Replace"),"aria-label":Mm(t,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=I("input",{type:"checkbox",name:"case",form:"",checked:e.caseSensitive,onchange:this.commit}),this.reField=I("input",{type:"checkbox",name:"re",form:"",checked:e.regexp,onchange:this.commit}),this.wordField=I("input",{type:"checkbox",name:"word",form:"",checked:e.wholeWord,onchange:this.commit}),this.dom=I("div",{onkeydown:t=>this.keydown(t),class:"cm-search"},[this.searchField,r("next",()=>um(t),[Mm(t,"next")]),r("prev",()=>lm(t),[Mm(t,"previous")]),r("select",()=>cm(t),[Mm(t,"all")]),I("label",null,[this.caseField,Mm(t,"match case")]),I("label",null,[this.reField,Mm(t,"regexp")]),I("label",null,[this.wordField,Mm(t,"by word")]),...t.state.readOnly?[]:[I("br"),this.replaceField,r("replace",()=>fm(t),[Mm(t,"replace")]),r("replaceAll",()=>dm(t),[Mm(t,"replace all")])],I("button",{name:"close",onclick:()=>bm(t),"aria-label":Mm(t,"close"),type:"button"},["\xd7"])])}commit(){var t=new W1({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});t.eq(this.query)||(this.query=t,this.view.dispatch({effects:tm.of(t)}))}keydown(t){Qs(this.view,t,"search-panel")?t.preventDefault():13==t.keyCode&&t.target==this.searchField?(t.preventDefault(),(t.shiftKey?lm:um)(this.view)):13==t.keyCode&&t.target==this.replaceField&&(t.preventDefault(),fm(this.view))}update(t){for(var e of t.transactions)for(var r of e.effects)r.is(tm)&&!r.value.eq(this.query)&&this.setQuery(r.value)}setQuery(t){this.query=t,this.searchField.value=t.search,this.replaceField.value=t.replace,this.caseField.checked=t.caseSensitive,this.reField.checked=t.regexp,this.wordField.checked=t.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(U1).top}}function Mm(t,e){return t.state.phrase(e)}const xm=30,Cm=/[\s\.,:;?!]/;function Sm(t,{from:e,to:r}){var i=t.state.doc.lineAt(e),n=t.state.doc.lineAt(r).to,e=Math.max(i.from,e-xm),r=Math.min(n,r+xm);let s=t.state.sliceDoc(e,r);if(e!=i.from)for(let t=0;t<xm;t++)if(!Cm.test(s[t+1])&&Cm.test(s[t])){s=s.slice(t);break}if(r!=n)for(let t=s.length-1;t>s.length-xm;t--)if(!Cm.test(s[t-1])&&Cm.test(s[t])){s=s.slice(0,t);break}return E.announce.of(`${t.state.phrase("current match")}. ${s} ${t.state.phrase("on line")} ${i.number}.`)}var Hd=E.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}});const Pm=[rm,Lt.lowest(i),Hd],jm=(K=Object.freeze({__proto__:null,RegExpCursor:y1,SearchCursor:w1,SearchQuery:W1,closeSearchPanel:bm,findNext:um,findPrevious:lm,getSearchQuery:im,gotoLine:dv,highlightSelectionMatches:I1,openSearchPanel:wm,replaceAll:dm,replaceNext:fm,search:z1,searchKeymap:km,searchPanelOpen:nm,selectMatches:cm,selectNextOccurrence:t,selectSelectionMatches:Ud,setSearchQuery:tm}),(()=>[Gh(),Qh,Ro(),f0(),al(),fo(),Mo(),C.allowMultipleSelections.of(!0),_u(),vl(wl,{fallback:!0}),El(),Sf(),Uf(),Xo(),th(),zo,I1(),Gs.of([...Af,...Ov,...km,...D0,...el,...zf,...qv])])())},"./dist/plugins/formulaPanel/editor/common/calcUtil.js":function(B,t,e){var a,s,u,l,c;function r(t,e,r,i,n){var s,o,h,a;void 0===n&&(n=!0),s=r.ignoreError,o=r.Hve,h=r.Jde,r.ignoreError=i,r.Hve=n,r.Jde=!0;try{a=e.parse(r,t)}catch(t){}return r.ignoreError=s,r.Hve=o,r.Jde=h,a}function i(t,e,r){if(t){var i;try{i=e.unparse(r,t)}catch(t){}return i}}function n(t,e,r,i,n){var s,o,s,t,h,s=new a.Parser,o=!0,s=e.Mf?(0,u.Vgt)(s,t,e.Mf,r,i,!0):(s.setParserOption(!0),n.ignoreError=!0,t=t.split(""),h=s.parseToTokens(n,t,!1),h=(0,u.fillBlankToTokens)(h,t),(0,u.getExpressTokenImp)(s,e,n,null,h,t,r,i));return $(s,e)}function o(t,e){var r,i,n,s,o;for(t=t.filter(function(t){return t.endIndex<e}),r=[],i=[],n="",s=0;s<t.length;s++)w(o=t[s])?n=o.text:b(o)?(r.push(n),i.push(0)):k(o)&&(n="",r.pop(),i.pop()),0<r.length&&g(o)&&i[i.length-1]++;if(0<r.length)return{functionName:r.pop(),activeParameter:i.pop()}}function h(t,e){for(var r,e,i,n,s,o,h,r=e.parameters||[],e=r.length||0,s=0;s<r.length;s++)if(r[s].repeatable)void 0===i&&(i=s);else if(void 0!==i){n=s-1;break}return t=void 0!==i&&(void 0===n&&(n=r.length-1),i<=t)?n+(h=(t-i)%(o=n-i+1))+1<e?n+h+1:i+h:t}function f(t,e){t=h(t,e);var e=e.parameters?e.parameters.length:0;return Math.min(t,e-1)}function d(t,e,r,i){return void 0===r&&(r=!0),void 0===i&&(i=!1),t.find(function(t){return v(t,e,r,i)})}function v(t,e,r,i){return void 0===i&&(i=!1),((r=void 0===r?!0:r)?e>=t.index:e>t.index)&&(i?e<=t.endIndex+1:e<t.endIndex+1)}function m(t,e,r){return e<=t.index&&r>=t.endIndex+1}function p(t,e){var r,i,n,s,o,o,h,a,u;for(t=t.filter(function(t){return t.endIndex<e}),r=[],i=[],n=[],s=0;s<t.length;s++)w(o=t[s])?(r.push(o.text.toUpperCase()),i.push([]),n.push(0)):k(o)?(r.pop(),i.pop(),n.pop()):g(o)&&(o=(0,c.lastItem)(r),h=(0,c.lastItem)(n),a=(0,c.lastItem)(i),u=t[s-1],("LAMBDA"===o||"LET"===o&&h%2==0)&&E(u)&&a.push(u.text),n[n.length-1]=h+1);return i.filter(function(t){return 0<t.length}).reduce(function(t,e){return t.concat(e)},[])}function g(t){return t.type===l.TokenType.FunctionArgumentSeparator}function w(t){return t.type===l.TokenType.FunctionName}function b(t){return t.type===l.TokenType.FunctionCallStart}function k(t){return t.type===l.TokenType.FunctionCallEnd}function y(t){return t.type===l.TokenType.SubExpressionStart}function M(t){return t.type===l.TokenType.SubExpressionEnd}function x(t){return t.type===l.TokenType.FormulaStart}function C(t){return t.type===l.TokenType.Unknown}function S(t){return C(t)&&L(t.text)===c.LEFT_PARENTHESES}function P(t){return C(t)&&L(t.text)===c.RIGHT_PARENTHESES}function j(t){return E(t)||A(t)}function O(t){return t.type===l.TokenType.OperatorInfix}function _(t){return t.type===l.TokenType.OperatorPrefix}function F(t){return t.type===l.TokenType.Whitespace}function E(t){return t.type===l.TokenType.Name}function D(t){return t.type===l.TokenType.OperatorPostfix&&"#"===t.text}function A(t){return t.type===l.TokenType.CellReference}function R(t){return j(t)&&t.ranges&&0<t.ranges.length}function I(t){for(var e,r,e=0,r=0;r<t.length&&t[r]===c.WHITESPACE;r++)e++;return e}function N(t,e,r){var t,i,n,s,o,h;for(void 0===r&&(r=4),t=I(t),i=[],n=function(){return 0===i.length},s=function(){return i[i.length-1]},o=0;o<e.length;o++)b(h=e[o])||y(h)?i.push(h):k(h)?!n()&&b(s())&&i.pop():M(h)&&!n()&&y(s())&&i.pop();return 0<i.length&&(t+=r),t}function L(t){return t.replace(/\s+/g,"")}function $(t,e){for(var r,i,n,s,o,h,r=[],i=[],n=!1,s=0;s<t.length;s++)(h=H(o=t[s],n))===l.TokenType.ArrayConstStart?(i.push(h),n=!0):h===l.TokenType.FunctionCallStart?(i.push(h),n=!1):h!==l.TokenType.FunctionCallEnd&&h!==l.TokenType.ArrayConstEnd||(i.pop(),n=(0,c.lastItem)(i)===l.TokenType.ArrayConstStart),r.push({type:h,index:o.index,endIndex:o.endIndex,text:o.text,ranges:o.ranges,canDrag:o.canDrag,colorIndex:o.colorIndex});return U(z(r),e)}function H(t,e){var r,i,n,r=t.type,i=t.subType,n=t.text.trim();return 1===r?1===i?"ARRAY"===n?l.TokenType.ArrayConstStart:"@"===n||n===c.LEFT_PARENTHESES?l.TokenType.FunctionCallStart:l.TokenType.FunctionName:2===i?n!==c.RIGHT_PARENTHESES&&e?l.TokenType.ArrayConstEnd:l.TokenType.FunctionCallEnd:(0,s.Df)(n)?l.TokenType.FormulaStart:void 0:3!==r?4===r?l.TokenType.OperatorPrefix:5===r?l.TokenType.OperatorInfix:6===r?l.TokenType.OperatorPostfix:0===r?5===i?l.TokenType.LogicalConst:4===i?l.TokenType.NumberConst:3===i?l.TokenType.StringConst:6===i?l.TokenType.ErrorConst:7===i||12===i?t.isName?l.TokenType.Name:l.TokenType.CellReference:l.TokenType.StringConst:2===r?1===i?l.TokenType.SubExpressionStart:2===i?l.TokenType.SubExpressionEnd:void 0:7===r?l.TokenType.Whitespace:l.TokenType.Unknown:0===i?e&&n===c.COMMA?l.TokenType.ArrayConstItemSeparator:e&&n===c.SEMICOLON?l.TokenType.ArrayConstRowSeparator:l.TokenType.FunctionArgumentSeparator:void 0}function U(t,e){for(var r,i,n,s,r=t.length-2;0<r;r--)i=t[r],D(n=t[r+1])&&A(i)&&R(i)&&(s=new a.CalcReference(e,i.ranges).getSpillRef())&&s.$gt&&(i.text+=n.text,i.endIndex=n.endIndex,i.ranges=s.$gt,t.splice(r+1,1));return t}function z(t){for(var e,r,i,n,s,o,h,n,e=[],r=0;r<t.length;r++)W((i=t[r]).type)&&(n=i.text.match(/^(\s*)(\S+)(\s*)$/))&&4===n.length&&(s=n[0],o=n[1],h=n[2],n=n[3],o||n)?(o&&(i.index+=o.length,i.text=i.text.substring(o.length),e.push(T(i.index,o))),e.push(i),n&&(i.endIndex-=n.length,i.text=i.text.substring(0,h.length),e.push(T(i.endIndex+1,n)))):e.push(i);return e}function W(t){return t===l.TokenType.FunctionCallStart||t===l.TokenType.FunctionCallEnd||t===l.TokenType.ArrayConstStart||t===l.TokenType.ArrayConstEnd}function T(t,e){return{type:l.TokenType.Whitespace,index:t,endIndex:t+e.length-1,text:e}}function V(){return a.Functions.findGlobalFunctions()}Object.defineProperty(t,"__esModule",{value:!0}),t.getGlobalFunctions=t.removeWhiteSpace=t.getIndentByPreviousText=t.getLineIndent=t.hasReferenceRanges=t.isReferenceToken=t.isAnchorOperatorToken=t.isNameToken=t.isWhitespaceToken=t.isPrefixOperatorToken=t.isInfixOperatorToken=t.isReferenceOrNameToken=t.isRightParenthesesToken=t.isLeftParenthesesToken=t.isNothingOperandToken=t.isFormulaStartToken=t.isSubExpressionEndToken=t.isSubExpressionStartToken=t.isFunctionCallEndToken=t.isFunctionCallStartToken=t.isFunctionCallToken=t.isFunctionArgumentSeparator=t.getLocalSymbol=t.includeToken=t.isInToken=t.getTokenByPos=t.getActiveParameterInSignatureTip=t.getActiveParameterInParameterResources=t.getSignatureStatus=t.parseToTokens=t.unparse=t.parse=void 0,a=e("CalcEngine"),s=e("Core"),u=e("SheetsCalc"),l=e("./dist/plugins/formulaPanel/editor/interface.js"),c=e("./dist/plugins/formulaPanel/editor/common/util.js"),t.parse=r,t.unparse=i,t.parseToTokens=n,t.getSignatureStatus=o,t.getActiveParameterInParameterResources=h,t.getActiveParameterInSignatureTip=f,t.getTokenByPos=d,t.isInToken=v,t.includeToken=m,t.getLocalSymbol=p,t.isFunctionArgumentSeparator=g,t.isFunctionCallToken=w,t.isFunctionCallStartToken=b,t.isFunctionCallEndToken=k,t.isSubExpressionStartToken=y,t.isSubExpressionEndToken=M,t.isFormulaStartToken=x,t.isNothingOperandToken=C,t.isLeftParenthesesToken=S,t.isRightParenthesesToken=P,t.isReferenceOrNameToken=j,t.isInfixOperatorToken=O,t.isPrefixOperatorToken=_,t.isWhitespaceToken=F,t.isNameToken=E,t.isAnchorOperatorToken=D,t.isReferenceToken=A,t.hasReferenceRanges=R,t.getLineIndent=I,t.getIndentByPreviousText=N,t.removeWhiteSpace=L,t.getGlobalFunctions=V},"./dist/plugins/formulaPanel/editor/common/codeMirrorUtil.js":function(T,t,e){var r,n,i,s,o,h,a,u,l,c;function f(t){return t.field(s.tokenField)}function d(t){return t.doc.toJSON().join("\n")}function v(t){return t.field(s.providerField).getFunctions()}function m(t,e){return(0,o.findFunction)(v(t),e)}function p(t){return v(t).map(o.convertToFunctionResource)}function g(t,e){return(0,o.findFunctionResource)(p(t),e)}function w(t){return t.field(s.customNamesField)}function b(t,e){return e=e.toUpperCase(),w(t).find(function(t){return t.getName().toUpperCase()===e})}function k(t){var e,t,t,e,t=t.field(s.themeField).rules.find(function(t){return t.token===i.SyntaxHighlightingTokenType.reference}),t=t?t.color:"black";return Array.isArray(t)?t:[t]}function y(t,e,r){return t.find(function(t){return(0,h.isInToken)(t,e,!0,!0)&&M(t,r)})}function M(t,e){var t=S(t.text,e);return t&&t.type===n.ExpressionType.reference}function x(t){var e,r,t,e,e=t.field(s.calcServiceField),r=t.field(s.calcSourceField),t=t.field(s.activeCellField),e=e.getParserContext(r);return e.row=t.row,e.column=t.col,e}function C(t,e){var r,i,n,i;return t.field(s.isFormulaField)?(r=t.field(s.calcSourceField),n=(i=t.field(s.activeCellField)).row,i=i.col,(0,h.parseToTokens)(e,r,n,i,x(t))):[]}function S(t,e,r){void 0===r&&(r=!1);var e=x(e);return(0,h.parse)(t,new n.Parser,e,!r)}function P(t,e){var e=x(e);return(0,h.unparse)(t,new n.Parser,e)}function j(t){return t.field(s.optionsField)}function O(t){var t=j(t);return c(t.tabSize)?l.DEFAULT_TAB_SIZE:t.tabSize}function E(t){var t=j(t);return c(t.formatWidthLimit)?l.DEFAULT_FORMAT_WIDTH_LIMIT:t.formatWidthLimit}function D(t){return o.WHITESPACE.repeat(O(t))}function A(t){var t=t.field(s.calcSourceField).Mf;if(t)return(0,a.Kde)(t.parent)||t}function R(t){return t.selection.main}function I(t){return t.field(s.providerField).getStructReferences()}function L(t,e,r){var i,t,e,r;return e===r||!!((0,u.kf)(e)&&(0,u.kf)(r)&&(i=new n.Parser,t=x(t),e=(0,h.unparse)((0,h.parse)(e,i,t,!1,!1),i,t),r=(0,h.unparse)((0,h.parse)(r,i,t,!1,!1),i,t),e)&&r&&e===r)}Object.defineProperty(t,"__esModule",{value:!0}),t.isSameFormula=t.getStructReferencesByState=t.getSelection=t.getActiveSheetByState=t.getOneIndentSpaceByState=t.getFormatWidthLimitByState=t.getTabSizeByState=t.getOptionsByState=t.unparseToText=t.parseToExpressionTree=t.parseToTokens=t.getParseContextByState=t.isValidReferenceToken=t.getValidReferenceTokenByPos=t.getReferenceTokenColors=t.getCustomNameByState=t.getCustomNamesByState=t.getFunctionResourceByState=t.getFunctionResourcesByState=t.getFunctionByState=t.getFunctionsByState=t.getTextByState=t.getTokensByState=void 0,r=e("Common"),n=e("CalcEngine"),i=e("./dist/plugins/formulaPanel/editor/interface.js"),s=e("./dist/plugins/formulaPanel/editor/featureProvider/customField.js"),o=e("./dist/plugins/formulaPanel/editor/common/util.js"),h=e("./dist/plugins/formulaPanel/editor/common/calcUtil.js"),a=e("./dist/plugins/formulaPanel/editor/common/spreadUtil.js"),u=e("Core"),l=e("./dist/plugins/formulaPanel/editor/common/const.js"),c=r.Common.lt.ht,t.getTokensByState=f,t.getTextByState=d,t.getFunctionsByState=v,t.getFunctionByState=m,t.getFunctionResourcesByState=p,t.getFunctionResourceByState=g,t.getCustomNamesByState=w,t.getCustomNameByState=b,t.getReferenceTokenColors=k,t.getValidReferenceTokenByPos=y,t.isValidReferenceToken=M,t.getParseContextByState=x,t.parseToTokens=C,t.parseToExpressionTree=S,t.unparseToText=P,t.getOptionsByState=j,t.getTabSizeByState=O,t.getFormatWidthLimitByState=E,t.getOneIndentSpaceByState=D,t.getActiveSheetByState=A,t.getSelection=R,t.getStructReferencesByState=I,t.isSameFormula=L},"./dist/plugins/formulaPanel/editor/common/const.js":function(t,e,r){var i,n,s,r;function o(){var t=new i.CalcService;return t.addResolver(new n.SheetReferenceResolver(null)),t.addResolver(new n.StructureReferenceResolver(null)),t}Object.defineProperty(e,"__esModule",{value:!0}),e.defaultTheme=e.defaultSyntaxHighlighRules=e.DEFAULT_ACTIVE_CELL_INFO=e.DEFAULT_FORMULA_EDITOR_OPTIONS=e.defaultCalcSource=e.defaultCalcService=e.DEFAULT_PROVIDER=e.DEFAULT_FORMAT_WIDTH_LIMIT=e.DEFAULT_TAB_SIZE=void 0,i=r("CalcEngine"),n=r("SheetsCalc"),s=r("./dist/plugins/formulaPanel/editor/interface.js"),r=r("./dist/plugins/formulaPanel/editor/common/calcUtil.js"),e.DEFAULT_TAB_SIZE=4,e.DEFAULT_FORMAT_WIDTH_LIMIT="auto",e.DEFAULT_PROVIDER={getStructReferences:function(){return[]},getFunctions:r.getGlobalFunctions},e.defaultCalcService=o(),e.defaultCalcSource=new i.CalcSource(e.defaultCalcService),e.DEFAULT_FORMULA_EDITOR_OPTIONS={formatWidthLimit:e.DEFAULT_FORMAT_WIDTH_LIMIT,tabSize:e.DEFAULT_TAB_SIZE},e.DEFAULT_ACTIVE_CELL_INFO={row:0,col:0},e.defaultSyntaxHighlighRules=[{token:s.SyntaxHighlightingTokenType.stringConst,color:"#CC1C1C"},{token:s.SyntaxHighlightingTokenType.errorConst,color:"#CC1C1C"},{token:s.SyntaxHighlightingTokenType.numberConst,color:"#088000"},{token:s.SyntaxHighlightingTokenType.booleanConst,color:"#088000"},{token:s.SyntaxHighlightingTokenType.function,color:"#1C1CFF"},{token:s.SyntaxHighlightingTokenType.argumentSeparator,color:"#FF0000"},{token:s.SyntaxHighlightingTokenType.operatorPrefix,color:"#FF0000"},{token:s.SyntaxHighlightingTokenType.operatorInfix,color:"#FF0000"},{token:s.SyntaxHighlightingTokenType.operatorPostfix,color:"#FF0000"},{token:s.SyntaxHighlightingTokenType.reference,color:["#0000ff","#008000","#9900cc","#800000","#00cc33","#cc6600","#cc0099"]}],e.defaultTheme={rules:e.defaultSyntaxHighlighRules}},"./dist/plugins/formulaPanel/editor/common/formatter.js":function(t,e,r){var n,d,s,v,m,p;function i(t,e){var r,i,t,i,r=new d.Parser,i=e.parseContext,t=(0,s.parse)(t,r,i,!1,!1);if(t)return i=n(n({parser:r,oneIndentTab:v.WHITESPACE.repeat(e.tabSize)},e),o()),v.EQUAL+g(t,0,i,v.EQUAL)}function o(){return{arrayListSeparator:d.Parser.arrayListSeparator||v.COMMA,arrayGroupSeparator:d.Parser.arrayGroupSeparator||v.SEMICOLON,listSeparator:d.Parser.listSeparator||v.COMMA,numberDecimalSeparator:d.Parser.numberDecimalSeparator||v.FULL_STOP}}function g(t,e,r,i,n,s){var o,o,h;return void 0===i&&(i=""),void 0===n&&(n=""),void 0===s&&(s=!0),t?(o=l(t,r),S(o=C(e,r,s)+o,r,i,n)&&((h=t.type)===d.ExpressionType.operator?o=a(t,e,r,i,n,s):h===d.ExpressionType.function?o=f(t,e,r,i,n,s):h===d.ExpressionType.parentheses?o=y(t,e,r,s):h===d.ExpressionType.array&&(o=b(t,e,r,s))),o):""}function l(t,e){var r,i;return t?(r=t.type)===d.ExpressionType.operator?h(t,e):r===d.ExpressionType.function?w(t,e):r===d.ExpressionType.parentheses?v.LEFT_PARENTHESES+l(t.value,e)+v.RIGHT_PARENTHESES:(r===d.ExpressionType.array?k:M)(t,e):""}function a(t,e,r,i,n,s){var o,h,o,a,s,u,o=t.operatorType,h=D(o),o=O(o)?C(e,r,s)+h+g(t.value,e,r,i,n,!1):2===o?g(t.value,e,r,i,h+n,s)+h:18===o?c(t,e,r,s):A(o)?(s=i+(a=g(t.value,e,r,i,v.WHITESPACE+h+p+n))+v.WHITESPACE+h,S(u=l(t.value2,r),r,s+v.WHITESPACE,n)?(u=g(t.value2,e+1,r,s+p,n),a+v.WHITESPACE+h+p+u):a+v.WHITESPACE+h+v.WHITESPACE+u):(a=g(t.value,e,r,i,n))+h+(u=g(t.value2,e,r,i+a+h,n,!1));return o}function h(t,e){var r,i,t,n,s,r=t.operatorType,i=D(r),t=O(r)?i+l(t.value,e):2===r?l(t.value,e)+i:(n=l(t.value,e),s=l(t.value2,e),18===r?u(t,e):A(r)?n+v.WHITESPACE+i+v.WHITESPACE+s:n+i+s);return t}function c(t,e,r,i){return C(e,r,i)+M(t,r)}function u(t,e){return M(t,e)}function f(t,e,r,i,n,s){var o,h,a,u,l,c,f,o=C(e,r,s),h=(0,d.isFunction)(t.function)&&t.function.name||t.functionName;if(h===m)return g(t.arguments[0],e,r,i,"#"+n,s)+"#";if("@"===h)return o+"@"+g(t.arguments[0],e,r,i+o+"@",n,!1);if(a=!h&&t.function instanceof d.Expression?g(t.function,e,r,i,n,s)+v.LEFT_PARENTHESES:o+h+v.LEFT_PARENTHESES,0===(l=(u=t.arguments||[]).length))return a+v.RIGHT_PARENTHESES;for(a+=p,c=0;c<l;c++)a+=g(f=u[c],e+1,r),c!==l-1&&(a+=r.listSeparator),a+=p;return a+C(e,r)+v.RIGHT_PARENTHESES}function w(t,e){var r,i,n,s,o,h,r=(0,d.isFunction)(t.function)&&t.function.name||t.functionName;if(r===m)return l(t.arguments[0],e)+"#";if("@"===r)return"@"+l(t.arguments[0],e);for(i=!r&&t.function instanceof d.Expression?l(t.function,e)+v.LEFT_PARENTHESES:R(r)+v.LEFT_PARENTHESES,s=(n=t.arguments||[]).length,o=0;o<s;o++)i+=l(h=n[o],e),o!==s-1&&(i+=e.listSeparator+v.WHITESPACE);return i+v.RIGHT_PARENTHESES}function b(t,e,r,i){for(var n,s,o,t,h,a,u,l,n=t.value,s=n.getRowCount(),o=n.getColumnCount(),t=C(e,r,i),h=C(e+1,r),a=t+v.LEFT_CURLY_BRACKETS+p,u=0;u<s;u++){for(a+=h,l=0;l<o;l++)a+=x(n.getValue(u,l),r),l!==o-1&&(a+=r.arrayListSeparator+v.WHITESPACE);u!==s-1&&(a+=r.arrayGroupSeparator),a+=p}return a+C(e,r)+v.RIGHT_CURLY_BRACKETS}function k(t,e){for(var r,i,n,s,o,h,r=t.value,i=r.getRowCount(),n=r.getColumnCount(),s=v.LEFT_CURLY_BRACKETS,o=0;o<i;o++){for(h=0;h<n;h++)s+=x(r.getValue(o,h),e),h!==n-1&&(s+=e.arrayListSeparator+v.WHITESPACE);o!==i-1&&(s+=e.arrayGroupSeparator+v.WHITESPACE)}return s+v.RIGHT_CURLY_BRACKETS}function y(t,e,r,i){var t,n,t=g(t.value,e+1,r),n;return C(e,r,i)+v.LEFT_PARENTHESES+p+t+p+C(e,r)+v.RIGHT_PARENTHESES}function M(t,e){var r=[];return e.parser.unparse(e.parseContext,t,r),r.join("")}function x(t,e){var r,r;return"string"==typeof t?r=d.ExpressionType.string:"boolean"==typeof t?r=d.ExpressionType.boolean:"number"==typeof t&&(r=d.ExpressionType.number),void 0===r?t.toString():((r=new d.Expression(r)).value=t,M(r,e))}function C(t,e,r){return(r=void 0===r?!0:r)?e.oneIndentTab.repeat(t):""}function S(t,e,r,i){var r;return t.trim().length>e.widthLimit||(r=P(r)+t+j(i),e.measureTextFunc(r)>e.lineWidthLimit)}function P(t){var e=t.lastIndexOf(p);return-1===e?t:t.substring(e+1)}function j(t){var e=t.indexOf(p);return-1===e?t:t.substring(0,e)}function O(t){return 0===t||1===t}function E(t){return 2===t}function D(t){return d.Z9t[t]}function A(t){return 15!==t&&16!==t&&17!==t&&18!==t}function R(t){var e,e,e=(0,d.getMapping)()&&(0,d.getMapping)().builtInFunctionsMapping,e=e&&e[t];return t=e&&e.alias?e.alias:t}n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,r,i,n,r=1,i=arguments.length;r<i;r++)for(n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},Object.defineProperty(e,"__esModule",{value:!0}),e.format=void 0,d=r("CalcEngine"),s=r("./dist/plugins/formulaPanel/editor/common/calcUtil.js"),v=r("./dist/plugins/formulaPanel/editor/common/util.js"),m="ANCHORARRAY",p="\n",e.format=i},"./dist/plugins/formulaPanel/editor/common/spreadUtil.js":function(t,e,r){var i,n;function s(t){if(t)return(0,i.jf)(t)}function o(t){var r,e,i,r=(0,n.getGlobalFunctions)(),e=function(e){Object.keys(e).forEach(function(t){r.push(e[t])})};return t&&(e(t.Amt),(i=s(t))&&e(i.Amt),t.options.allowDynamicArray||(r=r.filter(function(t){return!t.isDynamicArrayFunction}))),r}Object.defineProperty(e,"__esModule",{value:!0}),e.getFunctionsByWorkbook=e.Kde=void 0,i=r("Core"),n=r("./dist/plugins/formulaPanel/editor/common/calcUtil.js"),e.Kde=s,e.getFunctionsByWorkbook=o},"./dist/plugins/formulaPanel/editor/common/util.js":function(t,e,r){var o,i,r,i,n;function s(t){var e,e=(e=t.description())&&h(e);return{name:t.name,description:null==e?void 0:e.description,parameters:null==e?void 0:e.parameters}}function h(t){for(var e,r,i,n,s,e=[],r=t.parameters||[],i=0;i<r.length;i++)(s=2<(n=o({},r[i])).name.length&&n.name.startsWith("[")&&n.name.endsWith("]"))&&(n.optional=!0,n.name=n.name.substring(1,n.name.length-1)),n.repeatable&&(n.optional=!0),e.push(n);return o(o({},t),{parameters:e})}function a(t,e){return e=e.toUpperCase(),(t||[]).find(function(t){return t.name.toUpperCase()===e})}function u(t,e){return e=e.toUpperCase(),(t||[]).find(function(t){return t.name.toUpperCase()===e})}function l(t){return t&&0!==t.length?t.map(c).join(", "):""}function c(t){var e=t.name;return t.optional&&(e="["+e+"]"),e=t.repeatable?"..."+e:e}function f(t){var e=t.name;return t.repeatable&&(e+=", ..."),e=t.optional?"["+e+"]":e}function d(t){return"".concat(t.name,"(").concat(l(t.parameters),")")}function v(t){return"(".concat(n().FORMULA," ").concat(d(t))}function m(t){return t[t.length-1]}function p(t){return"gc-formula-editor-tooltip-help-function-"+t}function g(t,e){var i,r,n,s,o,h,i=document.createElement("p");for(i.className=p("title"),(r=function(t,e){var r=document.createElement("span");return r.className=e,r.textContent=t,i.appendChild(r),r})(t.name,(n=function(t){return p("title-"+t)})("function-name")),r("(",n("parentheses")),s=t.parameters||[],o=0;o<s.length;o++)h=n("parameter"),void 0!==e&&e===o&&(h+=" "+n("active-parameter")),r(f(s[o]),h),o!==s.length-1&&r(",",n("parameter-separator"));return r(")",n("parentheses")),i}function w(t){var e=document.createElement("p");return e.textContent=t,e.className=p("description"),e}o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var e,r,i,n,r=1,i=arguments.length;r<i;r++)for(n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},Object.defineProperty(e,"__esModule",{value:!0}),e.createHelpFunctionDescriptionDom=e.createHelpFunctionTitleDom=e.lastItem=e.getFunctionHoverTitle=e.getFunctionSignatureString=e.getParameterString=e.getParameterListString=e.findFunctionResource=e.findFunction=e.normalizeFunctionDescription=e.convertToFunctionResource=e.END_OF_LINE=e.WHITESPACE=e.RIGHT_CURLY_BRACKETS=e.LEFT_CURLY_BRACKETS=e.RIGHT_PARENTHESES=e.LEFT_PARENTHESES=e.SEMICOLON=e.COMMA=e.FULL_STOP=e.EQUAL=void 0,i=r("Common"),r=r("./dist/plugins/formulaPanel/editor/editor.ns.js"),i=new i.Common.ResourceManager(r.SR,"formulaEditor"),n=i.getResource.bind(i),e.EQUAL="=",e.FULL_STOP=".",e.COMMA=",",e.SEMICOLON=";",e.LEFT_PARENTHESES="(",e.RIGHT_PARENTHESES=")",e.LEFT_CURLY_BRACKETS="{",e.RIGHT_CURLY_BRACKETS="}",e.WHITESPACE=" ",e.END_OF_LINE="\r\n",e.convertToFunctionResource=s,e.normalizeFunctionDescription=h,e.findFunction=a,e.findFunctionResource=u,e.getParameterListString=l,e.getParameterString=c,e.getFunctionSignatureString=d,e.getFunctionHoverTitle=v,e.lastItem=m,e.createHelpFunctionTitleDom=g,e.createHelpFunctionDescriptionDom=w},"./dist/plugins/formulaPanel/editor/editor.ns.js":function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.SR=void 0;var r=r("./dist/plugins/formulaPanel/editor/editor.res.en.js");e.SR={en:r}},"./dist/plugins/formulaPanel/editor/editor.res.en.js":function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.FORMULA=e.INVALID_FORMULA=e.INVALID_EXPRESSION=e.DUPLICATE_IDENTIFIER=e.INVALID_IDENTIFIER_ARGUMENT=e.NO_MATCHED_ARGUMENTS=e.UNKNOWN_SHEET=e.UNKNOWN_NAME=e.MISS_LET_FUNCTION_BODY=e.MISS_RIGHT_PARENTHESES=e.NO_MATH_PARENTHESES=void 0,e.NO_MATH_PARENTHESES="No match parentheses",e.MISS_RIGHT_PARENTHESES="')' is expected.",e.MISS_LET_FUNCTION_BODY="Missing body of LET expression.",e.UNKNOWN_NAME="Unknown name",e.UNKNOWN_SHEET='Unknown sheet "$1"',e.NO_MATCHED_ARGUMENTS="Expected $1 arguments, but got $2",e.INVALID_IDENTIFIER_ARGUMENT="This argument must be an identifier to bind.",e.DUPLICATE_IDENTIFIER="Duplicate identifier $1",e.INVALID_EXPRESSION="Invalid EXPRESSION",e.INVALID_FORMULA="Invalid Formula",e.FORMULA="Formula"},"./dist/plugins/formulaPanel/editor/featureProvider/completion.js":function(t,e,r){var l,c,n,s,f,o,h,r;function a(e,t){var r,t,r,t,r=(0,n.getSignatureStatus)((0,s.getTokensByState)(t.state),t.pos);r&&(t=(0,s.getFunctionResourceByState)(t.state,r.functionName))&&(r=(0,n.getActiveParameterInSignatureTip)(r.activeParameter,t),t=t.parameters&&t.parameters[r])&&t.enum&&t.enum.forEach(function(t){e.push({label:t.value,detail:t.description,type:"enum",apply:t.value})})}function u(e,t){var r,t,i,r=t.state,t=t.pos,i;(0,n.getLocalSymbol)((0,s.getTokensByState)(r),t).forEach(function(t){e.push({label:t,type:"variable",apply:t})})}function d(e,t){var r;(0,s.getCustomNamesByState)(t.state).forEach(function(t){e.push({label:t.getName(),detail:t.getComment()||"",type:"constant",apply:t.getName()})})}function v(e,t){var r;(0,s.getFunctionResourcesByState)(t.state).forEach(function(t){e.push({label:t.name,detail:t.description,type:"function",apply:i})})}function i(t,e,i,n){var s,o,h,a,u,e,s=t.state,o=s.selection.main,h=i-o.from,a=n-o.from,u=e.label,e=s.changeByRange(function(t){var e,r,e=t.from+h,r=t.from+a;return t!==o&&i!==n&&s.sliceDoc(e,r)!==s.sliceDoc(i,n)?{range:t}:{changes:{from:e,to:n===o.from?t.to:r,insert:u+"()"},range:c.State.EditorSelection.cursor(e+u.length+1)}});t.dispatch(l(l({},e),{userEvent:"input.complete",effects:f.triggerSignatureTooltip.of(null)}))}function m(t){return(0,s.getStructReferencesByState)(t.state).map(g)}function p(t,e){var r,r,i,e,r=t.selection.main.head,r=e.text.substring(0,r-e.index);return r&&"["===r[r.length-1]&&(i=r.substring(0,r.length-1),e=(0,s.getStructReferencesByState)(t).find(function(t){return t.name===i}))?e.getColumns().map(g):[]}function g(t){return{label:t.name,detail:t.description,type:"variable"}}function w(t){var e,t,e=t.state.selection.main.head,t=(0,s.getTokensByState)(t.state);return(0,n.getTokenByPos)(t,e,!1,!0)}function b(t){var e,r,i,n,e;return!t.state.field(o.isFormulaField)||(r=w(t))&&r.type===h.TokenType.StringConst?null:(i=t.matchBefore(/\w*/),(n=[]).push.apply(n,p(t.state,r)),a(n,t),i&&i.from===i.to||(u(n,t),v(n,t),d(n,t),n.push.apply(n,m(t))),{from:i?i.from:t.pos,options:n})}l=this&&this.__assign||function(){return(l=Object.assign||function(t){for(var e,r,i,n,r=1,i=arguments.length;r<i;r++)for(n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},Object.defineProperty(e,"__esModule",{value:!0}),e.autoCompletionExtensions=void 0,c=r("./dist/plugins/formulaPanel/editor/codemirror/index.js"),n=r("./dist/plugins/formulaPanel/editor/common/calcUtil.js"),s=r("./dist/plugins/formulaPanel/editor/common/codeMirrorUtil.js"),f=r("./dist/plugins/formulaPanel/editor/featureProvider/signatureTooltips.js"),o=r("./dist/plugins/formulaPanel/editor/featureProvider/customField.js"),h=r("./dist/plugins/formulaPanel/editor/interface.js"),r=c.Autocomplete.autocompletion,e.autoCompletionExtensions=r({override:[b]})},"./dist/plugins/formulaPanel/editor/featureProvider/customField.js":function(t,e,r){var i,n,s,o,h,a,r;function u(t,s){return a.define({create:t,update:function(t,e){for(var r,i,n,r=0,i=e.effects;r<i.length;r++)if((n=i[r]).is(s))return n.value;return t}})}function l(t){return!!t.docChanged||t.effects.some(function(t){return t.is(e.setCalcServiceField)||t.is(e.setCalcSourceField)||t.is(e.setCustomNamesField)||t.is(e.setProviderField)||t.is(e.setActiveCellField)||t.is(e.rebuildFormulaEffect)})}Object.defineProperty(e,"__esModule",{value:!0}),e.needRebuildToken=e.customFields=e.isFormattedFormulaField=e.isFormulaField=e.themeField=e.setThemeField=e.optionsField=e.setOptionsField=e.tokenField=e.rebuildFormulaEffect=e.providerField=e.setProviderField=e.customNamesField=e.setCustomNamesField=e.activeCellField=e.setActiveCellField=e.calcSourceField=e.setCalcSourceField=e.calcServiceField=e.setCalcServiceField=void 0,i=r("Core"),n=r("./dist/plugins/formulaPanel/editor/codemirror/index.js"),s=r("./dist/plugins/formulaPanel/editor/common/codeMirrorUtil.js"),o=r("./dist/plugins/formulaPanel/editor/common/const.js"),h=r("./dist/plugins/formulaPanel/editor/featureProvider/formatter.js"),a=n.State.StateField,r=n.State.StateEffect,e.setCalcServiceField=r.define(),e.calcServiceField=u(function(){return o.defaultCalcService},e.setCalcServiceField),e.setCalcSourceField=r.define(),e.calcSourceField=u(function(){return o.defaultCalcSource},e.setCalcSourceField),e.setActiveCellField=r.define(),e.activeCellField=u(function(){return o.DEFAULT_ACTIVE_CELL_INFO},e.setActiveCellField),e.setCustomNamesField=r.define(),e.customNamesField=u(function(){return[]},e.setCustomNamesField),e.setProviderField=r.define(),e.providerField=u(function(){return o.DEFAULT_PROVIDER},e.setProviderField),e.rebuildFormulaEffect=r.define(),e.tokenField=a.define({create:function(t){return(0,s.parseToTokens)(t,(0,s.getTextByState)(t))},update:function(t,e){return l(e)?(0,s.parseToTokens)(e.state,(0,s.getTextByState)(e.state)):t}}),e.setOptionsField=r.define(),e.optionsField=u(function(){return o.DEFAULT_FORMULA_EDITOR_OPTIONS},e.setOptionsField),e.setThemeField=r.define(),e.themeField=u(function(){return o.defaultTheme},e.setThemeField),e.isFormulaField=a.define({create:function(t){return(0,i.kf)((0,s.getTextByState)(t))},update:function(t,e){return e.docChanged?(0,i.kf)((0,s.getTextByState)(e.state)):t}}),e.isFormattedFormulaField=a.define({create:function(){return!0},update:function(t,e){return e.docChanged?!!e.annotation(h.formatDocumentAnnotation):t}}),e.customFields=[e.optionsField,e.themeField,e.isFormulaField,e.isFormattedFormulaField,e.activeCellField,e.calcServiceField,e.calcSourceField,e.customNamesField,e.providerField,e.tokenField],e.needRebuildToken=l},"./dist/plugins/formulaPanel/editor/featureProvider/dbClickRangeSelector.js":function(t,e,r){var i,s,o,h,a;Object.defineProperty(e,"__esModule",{value:!0}),e.doubleClickSelectRangeExtension=void 0,i=r("./dist/plugins/formulaPanel/editor/codemirror/index.js"),s=r("./dist/plugins/formulaPanel/editor/common/calcUtil.js"),o=r("./dist/plugins/formulaPanel/editor/common/codeMirrorUtil.js"),h=r("./dist/plugins/formulaPanel/editor/featureProvider/customField.js"),a=i.State.EditorSelection,e.doubleClickSelectRangeExtension=i.View.EditorView.mouseSelectionStyle.of(function(i,t){var e,r,n,e;return!i.state.field(h.isFormulaField)||2!==t.detail||0!==t.button||null===(r=i.posAtCoords(t))?null:(n=i.state.selection,{get:function(t,e,r){var t,t,t,t=i.posAtCoords(t);return null!==t&&(t=(0,s.getTokenByPos)((0,o.getTokensByState)(i.state),t))?(t=a.range(t.index,t.endIndex+1),r?n.addRange(t):a.create([t])):n},update:function(t){r=t.changes.mapPos(r),n=n.map(t.changes)}})})},"./dist/plugins/formulaPanel/editor/featureProvider/folding.js":function(t,e,r){var i,l;Object.defineProperty(e,"__esModule",{value:!0}),e.foldExtension=void 0,i=r("./dist/plugins/formulaPanel/editor/codemirror/index.js"),l=r("./dist/plugins/formulaPanel/editor/common/calcUtil.js"),e.foldExtension=i.Language.foldService.of(function(t,e,r){for(var i,n,s,e,o,h,a,u,i=t.doc.lineAt(e),n=t.doc.lines,s=(0,l.getLineIndent)(i.text),e=e,o=r,h=i.number+1;h<n&&(a=t.doc.line(h),s<(u=(0,l.getLineIndent)(a.text)));h++)o=a.to;return t.doc.lineAt(e).number===t.doc.lineAt(o).number?null:{from:e=i.to,to:o}})},"./dist/plugins/formulaPanel/editor/featureProvider/formatter.js":function(t,a,e){var r,u,l,c,f,d,i;function v(t,e,r,i){var n,s,o,t,n=h(t),s=h(e),o=e.length,t=function(t,e){var r,i;for(t-=n[t],r=0;r<s.length;r++){if((i=r-s[r])===t&&!e){t=r;break}if(t<i){t=r-1;break}}return t<=o&&0<=t?t:0};return r===i?r=i=t(i,!1):(r=t(r,!0),i=t(i,!1)),[r,i]}function h(t){for(var e,r,i,n,e=function(t){return" "===t||"\n"===t},r=[0],i=1;i<=t.length;i++)n=r[i-1],r.push(n+(e(t[i-1])?1:0));return r}function m(t){var e,r,i,t,t,e,r,i=n(t.scrollDOM.getBoundingClientRect(),t.contentDOM.getBoundingClientRect()),t=t.contentDOM.querySelector(".cm-line");return t&&(t=window.getComputedStyle(t),i-=parseInt(t.paddingLeft,10)+parseInt(t.paddingRight,10)),i}function n(t,e){var r,i,t,r=Math.max(t.left,e.left),i,t=Math.min(t.right,e.right)-r;return 0<=t?t:0}function p(t){var e,t,r,i,e,t=window.getComputedStyle(t.contentDOM).font,r,i=document.createElement("canvas").getContext("2d");return i.font=t,function(t){return i.measureText(t).width}}Object.defineProperty(a,"__esModule",{value:!0}),a.formatDocumentCommand=a.formatDocumentAnnotation=void 0,r=e("./dist/plugins/formulaPanel/editor/codemirror/index.js"),u=e("./dist/plugins/formulaPanel/editor/common/codeMirrorUtil.js"),l=e("./dist/plugins/formulaPanel/editor/common/formatter.js"),c=e("./dist/plugins/formulaPanel/editor/featureProvider/customField.js"),f=e("./dist/plugins/formulaPanel/editor/featureProvider/signatureTooltips.js"),d=Number.MAX_SAFE_INTEGER,a.formatDocumentAnnotation=r.State.Annotation.define(),a.formatDocumentCommand=i=function(t){var e,r,i,n,s,o,h,r,i,n,s,e;return!!t.state.field(c.isFormulaField)&&(r=(0,u.getTabSizeByState)(t.state),i=(0,u.getFormatWidthLimitByState)(t.state),n=d,s=function(t){return 0},"auto"===i&&(n=m(t),i=d,s=p(t)),o=t.state.selection.main,r={absoluteReference:!1,parseContext:h=(0,u.getParseContextByState)(t.state),tabSize:r,widthLimit:i,lineWidthLimit:n,measureTextFunc:s},i=(0,u.getTextByState)(t.state),void 0!==(n=(0,l.format)(i,r)))&&(i!==n&&(s=v(i,n,o.from,o.to),t.dispatch({changes:{from:0,to:t.state.doc.length,insert:n},selection:{anchor:s[0],head:s[1]},annotations:[f.notTriggerSignatureTooltip.of(!0),a.formatDocumentAnnotation.of(!0)]})),!0)}},"./dist/plugins/formulaPanel/editor/featureProvider/hoverTooltips.js":function(t,e,r){var i,s,o,h,a;Object.defineProperty(e,"__esModule",{value:!0}),e.hoverTooltipExtension=void 0,i=r("./dist/plugins/formulaPanel/editor/codemirror/index.js"),s=r("./dist/plugins/formulaPanel/editor/common/calcUtil.js"),o=r("./dist/plugins/formulaPanel/editor/common/util.js"),h=r("./dist/plugins/formulaPanel/editor/common/codeMirrorUtil.js"),a=r("./dist/plugins/formulaPanel/editor/featureProvider/customField.js"),e.hoverTooltipExtension=i.View.hoverTooltip(function(t,e){var r,i,i,e,n,r;return!t.state.field(a.isFormulaField)||(i=(0,h.getTokensByState)(t.state),!(i=(0,s.getTokenByPos)(i,e)))||(e=[],n=(0,h.getFunctionResourceByState)(t.state,i.text),(0,s.isFunctionCallToken)(i)&&n&&(e.push((0,o.getFunctionHoverTitle)(n)),n.description)&&e.push(n.description),0===e.length)?null:{pos:i.index,end:i.endIndex+1,above:!0,create:function(){var t=document.createElement("div");return t.className="gc-formula-editor-tooltip-help-function",t.appendChild((0,o.createHelpFunctionTitleDom)(n)),n.description&&t.appendChild((0,o.createHelpFunctionDescriptionDom)(n.description)),{dom:t}}}})},"./dist/plugins/formulaPanel/editor/featureProvider/indent.js":function(t,e,r){var i,n,s;Object.defineProperty(e,"__esModule",{value:!0}),e.indentExtension=void 0,i=r("./dist/plugins/formulaPanel/editor/codemirror/index.js"),n=r("./dist/plugins/formulaPanel/editor/common/calcUtil.js"),s=r("./dist/plugins/formulaPanel/editor/common/codeMirrorUtil.js"),e.indentExtension=i.Language.indentService.of(function(t,e){var e;return!(e<=0)&&(e=t.lineAt(e-1))&&e.text?(0,n.getIndentByPreviousText)(e.text,(0,s.getTokensByState)(t.state)):0})},"./dist/plugins/formulaPanel/editor/featureProvider/lint.js":function(t,e,r){var i,n,s,h,l,c,a,o,u,r,f;function d(t,e){return f().NO_MATCHED_ARGUMENTS.replace("$1",t+"").replace("$2",e+"")}function v(t){return f().UNKNOWN_SHEET.replace("$1",t)}function m(t){return f().DUPLICATE_IDENTIFIER.replace("$1",t)}function p(t){var e,r,i,n,s,e=[],r;return t.field(u.isFormulaField)?(i=(0,a.getTextByState)(t),j(e,n=(0,a.getTokensByState)(t),t,i),D(e)||((s=(0,a.parseToExpressionTree)(i,t))?k(e,s,t):O(e,n,t,i),(0,a.parseToExpressionTree)(i,t,!0))||D(e)||g(e,0,i.length,f().INVALID_FORMULA),e):[]}function g(t,e,r,i,n){t.push({from:e,to:r,message:i,severity:n=void 0===n?"error":n})}function w(t,e,r,i){g(t,e.index,e.endIndex+1,r,i=void 0===i?"error":i)}function b(t,e,r,i){g(t,e.lit,e.ywt,r,i=void 0===i?"error":i)}function k(t,e,r){if(e){for(;e.type===h.ExpressionType.parentheses;){if(!e.value)return void b(t,e,f().INVALID_EXPRESSION);e=e.value}var i=e.type;i===h.ExpressionType.name?(0,a.getCustomNameByState)(r,e.value)||b(t,e,f().UNKNOWN_NAME,"warning"):i===h.ExpressionType.operator?(e.value&&k(t,e.value,r),e.value2&&k(t,e.value2,r)):i===h.ExpressionType.function?y(t,e,r):i===h.ExpressionType.reference&&P(t,e)}}function y(t,e,r){var i,n,s,o,i=e.functionName;if("LET"===i)M(t,e,r);else if("LAMBDA"===i)x(t,e,r);else for((0,h.isExpression)(e.function)?k(t,e.function,r):(n=(0,a.getFunctionByState)(r,i))?C(t,e,n):(0,a.getCustomNameByState)(r,i)||g(t,e.lit,e.lit+i.length,f().UNKNOWN_NAME,"warning"),s=e.arguments||[],o=0;o<s.length;o++)k(t,s[o],r)}function M(t,e,r){var i,n,s,o,h,i=e.lit,n=e.ywt,s=e.arguments||[];for(s.length<3&&g(t,i,n,d(3,s.length)),3<=s.length&&s.length%2==0&&g(t,i,n,f().MISS_LET_FUNCTION_BODY),o=[],h=0;h<s.length-1;h++)h%2==0?(S(t,s[h],o),o.push(s[h].value)):k(t,s[h],r);k(t,s[s.length-1],r)}function x(t,e,r){var i,n,s,o,h,i=e.lit,n=e.ywt,s=e.arguments||[];for(s.length<1&&g(t,i,n,d(1,s.length)),o=[],h=0;h<s.length-1;h++)S(t,s[h],o),o.push(s[h].value);k(t,s[s.length-1],r)}function C(t,e,r){var i,n,s,r,e,i=e.lit,n=e.ywt,s=r.minArgs||0,r=r.maxArgs!==o?r.maxArgs:Number.MAX_SAFE_INTEGER,e=e.arguments||[];e.length<s?g(t,i,n,d(s,e.length)):e.length>r&&g(t,i,n,d(r,e.length))}function S(t,e,r){var i,n,i=e.lit,n=e.ywt;!e||8!==e.type&&100!==e.type||-1<e.value.indexOf(".")?g(t,i,n,f().INVALID_IDENTIFIER_ARGUMENT):-1!==r.indexOf(e.value)&&g(t,i,n,m(e.value))}function P(t,e){var r,i,r=e.source,i=r&&r.getName();r instanceof h.ErrorSource&&i&&g(t,e.lit,e.lit+i.length,v(i),"warning")}function j(t,e,r,i){for(var n,s,o,h,a,n=[],s=function(t){return(0,l.isFunctionCallStartToken)(t)||(0,l.isSubExpressionStartToken)(t)||(0,l.isLeftParenthesesToken)(t)},o=function(t){return(0,l.isFunctionCallEndToken)(t)||(0,l.isSubExpressionEndToken)(t)||(0,l.isRightParenthesesToken)(t)},h=0;h<e.length;h++)s(a=e[h])?n.push(a):o(a)&&(0<n.length?n.pop():w(t,a,f().NO_MATH_PARENTHESES));0<n.length&&g(t,i.length,i.length,f().MISS_RIGHT_PARENTHESES)}function O(t,e,r,i){for(var n,s,o,h,a,u,u,n=[],s=[],o=[],h=0;h<e.length;h++)a=e[h],(0,l.isFunctionCallToken)(a)?(n.push({token:a}),o.push([])):(0,l.isSubExpressionStartToken)(a)?s.push({token:a}):(0,l.isFunctionCallEndToken)(a)?0===n.length?w(t,a,f().NO_MATH_PARENTHESES):(u=(0,c.lastItem)(n),n.pop(),o.pop(),u.hasError||(u=E(r,i,u.token,a),t.push.apply(t,u),D(u)&&(n.forEach(function(t){t.hasError=!0}),s.forEach(function(t){t.hasError=!0})))):(0,l.isSubExpressionEndToken)(a)?0===s.length?w(t,a,f().NO_MATH_PARENTHESES):s.pop():(0,l.isFunctionArgumentSeparator)(a)?0!==n.length&&(0,c.lastItem)(o).push(a):(0,l.isRightParenthesesToken)(a)&&w(t,a,f().NO_MATH_PARENTHESES);(0<n.length||0<s.length)&&g(t,i.length,i.length,f().MISS_RIGHT_PARENTHESES)}function E(t,e,r,i){var n,s,r,i,e,n=[],s=r.index,r=i.endIndex+1,i=e.substring(s,r),e=(0,a.parseToExpressionTree)(i,t);return e?(y(n,e,t),n.forEach(function(t){t.from+=s,t.to+=s}),(0,a.parseToExpressionTree)(i,t,!0)||D(n)||g(n,s,r,f().INVALID_EXPRESSION)):g(n,s,r,f().INVALID_EXPRESSION),n}function D(t){return t.some(function(t){return"error"===t.severity})}Object.defineProperty(e,"__esModule",{value:!0}),e.getDiagnostic=e.linterExtension=void 0,i=r("./dist/plugins/formulaPanel/editor/codemirror/index.js"),n=r("Common"),s=r("./dist/plugins/formulaPanel/editor/editor.ns.js"),h=r("CalcEngine"),l=r("./dist/plugins/formulaPanel/editor/common/calcUtil.js"),c=r("./dist/plugins/formulaPanel/editor/common/util.js"),a=r("./dist/plugins/formulaPanel/editor/common/codeMirrorUtil.js"),o=void 0,u=r("./dist/plugins/formulaPanel/editor/featureProvider/customField.js"),r=new n.Common.ResourceManager(s.SR,"formulaEditor"),f=r.getResource.bind(r),e.linterExtension=i.Lint.linter(function(t){return p(t.state)},{needsRefresh:function(t){return t.transactions.some(u.needRebuildToken)}}),e.getDiagnostic=p},"./dist/plugins/formulaPanel/editor/featureProvider/readOnly.js":function(t,e,r){var i,n;function s(t,e){t.dispatch({effects:n.reconfigure(i.State.EditorState.readOnly.of(e))})}Object.defineProperty(e,"__esModule",{value:!0}),e.reconfigureReadOnly=e.readOnlyExtension=void 0,i=r("./dist/plugins/formulaPanel/editor/codemirror/index.js"),n=new i.State.Compartment,e.readOnlyExtension=n.of(i.State.EditorState.readOnly.of(!1)),e.reconfigureReadOnly=s},"./dist/plugins/formulaPanel/editor/featureProvider/signatureTooltips.js":function(t,h,e){var r,s,o,a,u,e,i,n,l,c,e;function f(t){var e,e,r,t,i,n,e=t.selection.main;return e&&e.from===e.to&&(e=e.from,r=(0,s.getSignatureStatus)((0,o.getTokensByState)(t),e))&&(t=(0,o.getFunctionResourceByState)(t,r.functionName))?(n=(0,s.getActiveParameterInSignatureTip)(r.activeParameter,i=t),[{pos:e,above:!0,arrow:!0,create:function(){var t=document.createElement("div");return t.className="gc-formula-editor-tooltip-help-function",t.appendChild((0,u.createHelpFunctionTitleDom)(i,n)),i.description&&t.appendChild((0,u.createHelpFunctionDescriptionDom)(i.description)),{dom:t,overlap:!0}}}]):[]}Object.defineProperty(h,"__esModule",{value:!0}),h.signatureTooltipsExtensions=h.closeParameterHintsCommand=h.triggerParameterHintsCommand=h.hasParameterHints=h.notTriggerSignatureTooltip=h.closeSignatureTooltip=h.triggerSignatureTooltip=void 0,r=e("./dist/plugins/formulaPanel/editor/codemirror/index.js"),s=e("./dist/plugins/formulaPanel/editor/common/calcUtil.js"),o=e("./dist/plugins/formulaPanel/editor/common/codeMirrorUtil.js"),a=e("./dist/plugins/formulaPanel/editor/featureProvider/customField.js"),u=e("./dist/plugins/formulaPanel/editor/common/util.js"),e=r.State.StateField,h.triggerSignatureTooltip=r.State.StateEffect.define(),h.closeSignatureTooltip=r.State.StateEffect.define(),h.notTriggerSignatureTooltip=r.State.Annotation.define(),i=e.define({create:function(){return[]},update:function(t,e){var r,i,n,s,o,r;if(!e.state.field(a.isFormulaField))return[];if(i=t&&0<t.length,e.annotation(h.notTriggerSignatureTooltip)&&!i)return[];for(n=0,s=e.effects;n<s.length;n++){if((o=s[n]).is(h.closeSignatureTooltip))return[];if(o.is(h.triggerSignatureTooltip))return f(e.state)}return e.docChanged?f(e.state):i?e.selection?f(e.state):t:[]},provide:function(e){return r.View.showTooltip.computeN([e],function(t){return t.field(e)})}}),h.hasParameterHints=n=function(t){return 0<t.state.field(i).length},h.triggerParameterHintsCommand=l=function(t){return t.dispatch({effects:h.triggerSignatureTooltip.of(null)}),!0},h.closeParameterHintsCommand=c=function(t){return!!(0,h.hasParameterHints)(t)&&(t.dispatch({effects:h.closeSignatureTooltip.of(null)}),!0)},e=r.View.EditorView.updateListener.of(function(t){t.focusChanged&&!t.view.hasFocus&&(0,h.closeParameterHintsCommand)(t.view)}),h.signatureTooltipsExtensions=[i,e]},"./dist/plugins/formulaPanel/editor/featureProvider/syntaxHighlighting.js":function(t,i,e){var r,n,s,o,h,e,a;function u(t){return"gc-formula-editor-token_"+n.SyntaxHighlightingTokenType[t]}function l(t){var e;return t.field(o.isFormulaField)?a.of(f(t)):a.of([])}function c(t,e){var r={};return isNaN(e)||(r[i.TOKEN_INDEX_ATTRIBUTE_NAME]=e),{class:u(t),attributes:r}}function f(t){var e=(0,s.getTokensByState)(t);return d(e,t),e.map(function(t){var e=p(t);return r.View.Decoration.mark(c(e,t.colorIndex)).range(t.index,t.endIndex+1)})}function d(t,e){var r,i,r=[];t.forEach(function(e){var t;((0,h.isReferenceToken)(e)||(0,h.isNameToken)(e)&&(0,h.hasReferenceRanges)(e))&&(t=r.find(function(t){return v(t,e)}),e.colorIndex=t?t.colorIndex:m(r),r.push(e))}),i=(0,s.getReferenceTokenColors)(e).length,r.forEach(function(t){t.colorIndex=t.colorIndex%i})}function v(t,e){return(0,h.removeWhiteSpace)(t.text).toUpperCase()===(0,h.removeWhiteSpace)(e.text).toUpperCase()}function m(t){return t&&0!==t.length?Math.max.apply(Math,t.map(function(t){return t.colorIndex}))+1:0}function p(t){var e,r,e=t.type,r=n.SyntaxHighlightingTokenType.unknown;return e===n.TokenType.NumberConst?r=n.SyntaxHighlightingTokenType.numberConst:e===n.TokenType.StringConst?r=n.SyntaxHighlightingTokenType.stringConst:e===n.TokenType.LogicalConst?r=n.SyntaxHighlightingTokenType.booleanConst:e===n.TokenType.ErrorConst?r=n.SyntaxHighlightingTokenType.errorConst:e===n.TokenType.CellReference?r=n.SyntaxHighlightingTokenType.reference:e===n.TokenType.Name?r=(0,h.hasReferenceRanges)(t)?n.SyntaxHighlightingTokenType.reference:n.SyntaxHighlightingTokenType.name:e===n.TokenType.OperatorPrefix?r=n.SyntaxHighlightingTokenType.operatorPrefix:e===n.TokenType.OperatorInfix?r=n.SyntaxHighlightingTokenType.operatorInfix:e===n.TokenType.OperatorPostfix?r=n.SyntaxHighlightingTokenType.operatorPostfix:e===n.TokenType.Whitespace?r=n.SyntaxHighlightingTokenType.whitespace:e===n.TokenType.FunctionName||e===n.TokenType.FunctionCallStart||e===n.TokenType.FunctionCallEnd?r=n.SyntaxHighlightingTokenType.function:e===n.TokenType.FunctionArgumentSeparator||e===n.TokenType.ArrayConstRowSeparator||e===n.TokenType.ArrayConstItemSeparator?r=n.SyntaxHighlightingTokenType.argumentSeparator:e!==n.TokenType.SubExpressionStart&&e!==n.TokenType.SubExpressionEnd||(r=n.SyntaxHighlightingTokenType.subExpression),r}Object.defineProperty(i,"__esModule",{value:!0}),i.markReferenceTokenColorIndex=i.syntaxHighlightingTokenClassName=i.syntaxHighlightingField=i.TOKEN_INDEX_ATTRIBUTE_NAME=void 0,r=e("./dist/plugins/formulaPanel/editor/codemirror/index.js"),n=e("./dist/plugins/formulaPanel/editor/interface.js"),s=e("./dist/plugins/formulaPanel/editor/common/codeMirrorUtil.js"),o=e("./dist/plugins/formulaPanel/editor/featureProvider/customField.js"),h=e("./dist/plugins/formulaPanel/editor/common/calcUtil.js"),e=r.State.StateField,a=r.State.RangeSet,i.TOKEN_INDEX_ATTRIBUTE_NAME="data-token-index",i.syntaxHighlightingField=e.define({create:l,update:function(t,e){return l(e.state)},provide:function(t){return r.View.EditorView.decorations.from(t)}}),i.syntaxHighlightingTokenClassName=u,i.markReferenceTokenColorIndex=d},"./dist/plugins/formulaPanel/editor/featureProvider/tab.js":function(t,e,r){var i,n;Object.defineProperty(e,"__esModule",{value:!0}),e.insertTab=void 0,i=r("./dist/plugins/formulaPanel/editor/common/codeMirrorUtil.js"),e.insertTab=n=function(t){var e;return!t.state.readOnly&&!t.state.selection.ranges.some(function(t){return!t.empty})&&(e=(0,i.getOneIndentSpaceByState)(t.state),t.dispatch(t.state.update(t.state.replaceSelection(e),{scrollIntoView:!0,userEvent:"input"})),!0)}},"./dist/plugins/formulaPanel/editor/featureProvider/theme.js":function(t,e,r){var i,n,s,o,h;function a(t){var e=t.autocompletionStyle,t=t.errorStyle;return o.theme({"& .cm-tooltip-autocomplete":{color:e.color,font:e.font,background:e.backgroundColor,border:e.border,"margin-left":"1em"},"& .cm-tooltip-autocomplete ul li":{padding:"5px"},"& .cm-tooltip-autocomplete ul li .cm-completionIcon-function":{color:e.function_icon.color,font:e.function_icon.font},"& .cm-tooltip-autocomplete ul li .cm-completionLabel":{color:e.function_name.color,font:e.function_name.font},"& .cm-tooltip-autocomplete ul li .cm-completionDetail":{color:e.function_name.color,font:e.function_name.font},"& .cm-tooltip-autocomplete ul li[aria-selected] .cm-completionIcon-function":{color:e.activeItem.color,background:e.activeItem.backgroundColor},"& .cm-tooltip-autocomplete ul li[aria-selected] .cm-completionLabel":{color:e.activeItem.color,background:e.activeItem.backgroundColor},"& .cm-tooltip-autocomplete ul li[aria-selected] .cm-completionDetail":{color:e.activeItem.color,background:e.activeItem.backgroundColor},"& .cm-tooltip-autocomplete ul li[aria-selected]":{color:e.activeItem.color,background:e.activeItem.backgroundColor},"& .cm-tooltip .cm-tooltip-lint .cm-diagnostic ":{color:t.color,font:t.font,background:t.backgroundColor}})}function u(t){var i,n,i={},n=function(t,e,r){var t,r,t=(0,s.syntaxHighlightingTokenClassName)(t),r=isNaN(r)?"":"[".concat(s.TOKEN_INDEX_ATTRIBUTE_NAME,'="').concat(r,'"]');i["& .".concat(t).concat(r)]=e};return t.forEach(function(r){Array.isArray(r.color)?(n(r.token,{color:r.color[0]}),r.color.forEach(function(t,e){n(r.token,{color:t},e)})):n(r.token,{color:r.color})}),o.theme(i)}function l(t,e){return o.theme({"& .cm-scroller":{"background-color":t.backgroundColor,color:t.color,font:t.font},".cm-cursor, .cm-dropCursor":{borderLeftColor:t.caretColor},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:t.selectionBackColor},"& .cm-activeLine":{"background-color":t.activeLineBackColor},"& .cm-gutters":{"background-color":e.backgroundColor,color:e.color,font:e.font,"user-select":"none"},"& .cm-lineNumbers ":{width:"30px"},'& .cm-foldGutter span[title="Fold line"] ':{"padding-bottom":"8px"},"& .cm-gutterElement":{display:"flex","align-items":"center","justify-content":"flex-end"},"& .cm-activeLineGutter":{"background-color":t.activeLineBackColor},"& .cm-tooltip":{border:"none"}})}function c(t){var e,r,t,i,e=t.rules,r=t.editorContentStyle,t=t.editorGuttersStyle,i=[h];return r&&t&&(i=i.concat([l(r,t),a(r)])),i=e?i.concat(u(e)):i}Object.defineProperty(e,"__esModule",{value:!0}),e.themeExtension=e.createThemeExtension=e.themeCompartment=e.createSyntaxHighlightingTheme=void 0,i=r("./dist/plugins/formulaPanel/editor/codemirror/index.js"),n=r("./dist/plugins/formulaPanel/editor/common/const.js"),s=r("./dist/plugins/formulaPanel/editor/featureProvider/syntaxHighlighting.js"),o=i.View.EditorView,h=o.theme({"&":{height:"100%"},"&.cm-editor.cm-focused":{outline:"none"},"& .cm-line":{"line-height":1.35}}),e.createSyntaxHighlightingTheme=u,e.themeCompartment=new i.State.Compartment,e.createThemeExtension=c,e.themeExtension=e.themeCompartment.of(c(n.defaultTheme))},"./dist/plugins/formulaPanel/editor/featureProvider/toggleAbsoluteRelativeReferences.js":function(t,e,r){var o,i,g,n,s;function w(t,e,r,i,n,s){var t=(0,g.parseToExpressionTree)(t,e);return t.isFullColumn||t.isFullRow?(0,o.lmt)(t,r,i,!0,!0):t.hmt()?(0,o.dmt)(t,r,i):(0,o.lmt)(t,r,i,n,s),(0,g.unparseToText)(t,e)}function b(t,e,r){return(0,i.includeToken)(t,e,r)||(0,i.isInToken)(t,e,!0,!0)||(0,i.isInToken)(t,r,!0,!0)}Object.defineProperty(e,"__esModule",{value:!0}),e.toggleAbsoluteRelativeReferencesCommand=void 0,o=r("FormulaTextBox"),i=r("./dist/plugins/formulaPanel/editor/common/calcUtil.js"),g=r("./dist/plugins/formulaPanel/editor/common/codeMirrorUtil.js"),n=r("./dist/plugins/formulaPanel/editor/featureProvider/customField.js"),e.toggleAbsoluteRelativeReferencesCommand=s=function(h){var t,a,e,r,u,l,r,c,f,d,v,m,p,i,t;return!!h.state.field(n.isFormulaField)&&(a=h.state,e=(0,g.getTokensByState)(a),r=a.selection.main,u=r.from,l=r.to,r=a.field(n.activeCellField),c=r.row,f=r.col,d=!1,v=0,m=u,p=l,(i=e.filter(function(t){return b(t,u,l)&&(0,g.isValidReferenceToken)(t,a)})).forEach(function(t){var e,r,i,n,s,s,o,e=t.text.indexOf(":"),r=-1!==e,i=!r||u<=t.index+e,n=!r||l>t.index+e,s=w(t.text,a,c,f,i,n);s&&(h.dispatch({changes:{from:t.index+v,to:t.endIndex+1+v,insert:s}}),v+=s.length-t.text.length,s=t.index,o=t.endIndex+1,!r||i&&n||(i?o=t.index+e:n&&(s=t.index+e+1)),m=Math.min(m,s),p=Math.max(p,o),h.dispatch({selection:{anchor:m,head:p+v}}),d=!0)}),d)}},"./dist/plugins/formulaPanel/editor/formulaEditor-action.js":function(t,n,e){var s,o,h,r,i,a,u,l,c,f,d,v,m,p,e,g;function w(t,e){return{canUndo:e=void 0===e?!1:e,execute:t}}function b(e,t){return w(function(t){return e(t.li.getView())},t=void 0===t?!1:t)}function k(t){var e=s.mt.Qf(),r=!e,e=e;t.register(m,n.Commands[m],27),t.register(l,n.Commands[l],32,r,!0,!1,e),t.register(c,n.Commands[c],27),t.register(f,n.Commands[f],115),t.register(d,n.Commands[d],70,!1,!0,!0),t.register(v,n.Commands[v],83,r,!1,!1,e)}Object.defineProperty(n,"__esModule",{value:!0}),n.registerDefaultCommands=n.Commands=n.executeCommitContextToCellCommand=void 0,s=e("Core"),o=e("FormulaTextBox"),h=e("./dist/plugins/formulaPanel/editor/common/spreadUtil.js"),r=e("./dist/plugins/formulaPanel/editor/featureProvider/formatter.js"),i=e("./dist/plugins/formulaPanel/editor/featureProvider/signatureTooltips.js"),a=e("./dist/plugins/formulaPanel/editor/featureProvider/toggleAbsoluteRelativeReferences.js"),u=e("./dist/plugins/formulaPanel/editor/spreadFeatureProvider/formulaReferencedRangesContext.js"),l="showHints",c="closeHints",f="toggleAbsoluteRelativeReferences",d="formatDocument",v="commitContentToActiveCell",m="exitEdit",n.executeCommitContextToCellCommand=p=function(t,e,r,i,n){var i,e;void 0===n&&(n=s.SheetArea.viewport),i=0<i.length?i:null,e={cmd:"editCell",sheetName:t.name(),row:e,col:r,sheetArea:n,newValue:i},t.Qy().execute(e)},e=w(function(t){var e,r,r,t,i,e=(0,h.Kde)(t.Vv);return!!e&&(r=o.Ode.Ede(),(0,u.isFormulaEditorReferencedRangesAcrossSheetContext)(r)?r.Rde(e):(r=t.text(),t=e.getActiveRowIndex(),i=e.getActiveColumnIndex(),(0,n.executeCommitContextToCellCommand)(e,t,i,r)),!0)}),g=w(function(t){var e,r,e=t.workbook();return!(!t.Qde()||!e||((r=t.li.getView()).contentDOM.blur(),(0,u.closeFormulaReferencedRanges)(r.state),e.focus(!1),e.focus(),t.Xde(),0))}),n.Commands={},n.Commands[l]=b(i.triggerParameterHintsCommand),n.Commands[c]=b(i.closeParameterHintsCommand),n.Commands[d]=b(r.formatDocumentCommand),n.Commands[f]=b(a.toggleAbsoluteRelativeReferencesCommand),n.Commands[v]=e,n.Commands[m]=g,n.registerDefaultCommands=k},"./dist/plugins/formulaPanel/editor/formulaEditor-spreadjs.js":function(t,e,r){var i,n,h,s,r,o;function a(t){t.Dn.kde()}function u(t){var t=t.Nde;return!(!(0,s.isFormulaEditorReferencedRangesContext)(t)||!t.zQt.hasFocus)}function l(t,e,r){var i,n,n,s,s,o,i="";if(t)if(n=(n=t.parent)&&n.options,(s=t.getFormulaInformation(e,r,3))&&s.hasFormula){if(i="="+s.formulaWithCulture,s.isDynamicArray)return"";s.isArrayFormula&&(i="{"+i+"}")}else s=t.getActualStyle(e,r),i="string"==typeof(o=t.getValue(e,r))&&(s.quotePrefix||1<o.length&&"="===o[0]&&n&&n.allowUserEditFormula&&!n.allowInvalidFormula)?"'"+o:h.mt.mi(s,o,t,{sheet:t,row:e,col:r,sheetArea:3})||"";return i}Object.defineProperty(e,"__esModule",{value:!0}),e.getEditText=e.paintFormulaReferencedRanges=void 0,i=r("Common"),n=r("./dist/plugins/formulaPanel/editor/editor.ns.js"),h=r("Core"),s=r("./dist/plugins/formulaPanel/editor/spreadFeatureProvider/formulaReferencedRangesContext.js"),e.paintFormulaReferencedRanges=a,r=new i.Common.ResourceManager(n.SR,"formulaEditor"),o=r.getResource.bind(r),h.Worksheet.ch("formulaEditor",{preProcessKeyDown:function(t){u(this)&&(t.r=!0)},processCompositionStart:function(t){u(this)&&(t.r=!0)}}),e.getEditText=l,h.Workbook.ch("formulaEditor",{onCultureChanged:function(){o()}})},"./dist/plugins/formulaPanel/editor/formulaEditor.js":function(t,i,e){var n,o,s,h,a,u,l,c,f,r,d,v,m,p,g,w,b;function k(t,e){"string"==typeof t&&(t=document.getElementById(t));var r=this;r.Wc=t,r.li=new s.FormulaEditorCore(t,w),r.li.initTheme(),r.Qy=new n.Commands.CommandManager(r),r.tve=r.tve.bind(r),r.tpe=r.tpe.bind(r),r.eve=r.eve.bind(r),r.$ve=r.$ve.bind(r),r.ave=r.ave.bind(r),r.rve=r.rve.bind(r),r.Pve=r.Pve.bind(r),r.rme=r.rme.bind(r),r.Wve=r.Wve.bind(r),r.lme=r.lme.bind(r),r.hme=r.hme.bind(r),r.LEt=m(h.DEFAULT_FORMULA_EDITOR_OPTIONS,r.hme),r.Zp(e),r.sme(),t.addEventListener("keydown",r.tve),(0,a.registerDefaultCommands)(r.Qy),(0,o.GC$)(t).data(i.CONST_FORMULA_EDITOR,r)}function y(t,e,r){return t.options.isProtected&&!1!==t.l0(e,r,"locked")}Object.defineProperty(i,"__esModule",{value:!0}),i.FormulaEditor=i.CONST_FORMULA_EDITOR=void 0,n=e("Common"),o=e("Core"),s=e("./dist/plugins/formulaPanel/editor/formulaEditorCore.js"),h=e("./dist/plugins/formulaPanel/editor/common/const.js"),a=e("./dist/plugins/formulaPanel/editor/formulaEditor-action.js"),u=e("./dist/plugins/formulaPanel/editor/spreadFeatureProvider/formulaReferencedRangesExtension.js"),l=e("./dist/plugins/formulaPanel/editor/formulaEditor-spreadjs.js"),c=e("./dist/plugins/formulaPanel/editor/common/spreadUtil.js"),f=e("./dist/plugins/formulaPanel/editor/common/codeMirrorUtil.js"),r=e("./dist/plugins/formulaPanel/editor/spreadFeatureProvider/structReferences.js"),i.CONST_FORMULA_EDITOR="formula-editor",d=void 0,v=null,m=o.mt.b0,p=o.GC$.extend,g=o.GC$.each,w=[u.formulaReferencedRangesExtension],Object.defineProperty(k.prototype,"options",{get:function(){return this.LEt},set:function(t){if(t&&"object"==typeof t)for(var e in t)t.hasOwnProperty(e)&&(this.LEt[e]=t[e])},enumerable:!1,configurable:!0}),k.prototype.text=function(t){if(0===arguments.length)return this.li.getText();this.li.setText(t+"")},k.prototype.workbook=function(){return this.Vv},k.prototype.attach=function(t){var e=this;e.Vv!==t&&(e.detach(),e.Vv=t,e._6(),e.Vv.D3(o.Events.EnterCellInternal,e.tpe),e.Vv.D3(o.Events.CellChanged,e.eve),e.Vv.D3(o.Events.RangeChangedInternal,e.$ve),e.Vv.D3(o.Events.RangeFiltered,e.lme),e.Vv.D3(o.Events.RangeFilterCleared,e.lme),e.Vv.D3(o.Events.ActiveSheetChangingInternal,e.ave),e.Vv.D3(o.Events.ActiveSheetChangedInternal,e.rve),e.Vv.D3(o.Events.SheetOptionsChangedInternal,e.Pve),e.Vv.D3(o.Events.WorkbookOptionsChangedInternal,e.rme),e.Vv.D3(o.Events.CustomNameChangedInternal,e.Wve))},k.prototype.detach=function(){var t=this,e=t.Vv;e&&(e._3(o.Events.EnterCellInternal,t.tpe),e._3(o.Events.CellChanged,t.eve),e._3(o.Events.RangeChangedInternal,t.$ve),e._3(o.Events.RangeFiltered,t.lme),e._3(o.Events.RangeFilterCleared,t.lme),e._3(o.Events.ActiveSheetChangingInternal,t.ave),e._3(o.Events.ActiveSheetChangedInternal,t.rve),e._3(o.Events.SheetOptionsChangedInternal,t.Pve),e._3(o.Events.WorkbookOptionsChangedInternal,t.rme),e._3(o.Events.CustomNameChangedInternal,t.Wve),t.Vv=d,t._6())},k.prototype.format=function(){this.li.format()},k.prototype.commandManager=function(){return this.Qy},k.prototype.destroy=function(){var t=this;t.detach(),t.li.destroy(),t.Wc.removeEventListener("keydown",t.tve),(0,o.GC$)(t.Wc).data(i.CONST_FORMULA_EDITOR,v)},k.prototype.refresh=function(){this.li.initTheme()},k.prototype.getActiveCellInfo=function(){var t,e,t,r,t=this.li.getActiveCellInfo(),e=t.row,t=t.col,r;return{sheet:this.li.getCalcSource().Mf,row:e,col:t}},k.prototype.isFormattedFormula=function(){return this.li.isFormattedFormula()},k.prototype.Qde=function(){return this.li.getView().hasFocus},k.prototype.Xde=function(){var t,e,r,t,i,e,t=this.getActiveCellInfo(),e=t.sheet,r=t.row,t=t.col;e&&(i=this.li,e=(0,l.getEditText)(e,r,t),(0,f.isSameFormula)(i.getView().state,i.getText(),e)||i.setText(e),i.format())},k.prototype.Zp=function(t){var r,t,r=this.LEt,t=t||{};t=p(!0,{},h.DEFAULT_FORMULA_EDITOR_OPTIONS,t),g(t,function(t,e){r.hasOwnProperty(t)&&(r[t]=e)}),this.li.setOptions(r)},k.prototype.sme=function(){var t=this;t.li.setProvider({getStructReferences:function(){return(0,r.getStructReferencesByWorkbook)(t.Vv)},getFunctions:function(){return(0,c.getFunctionsByWorkbook)(t.Vv)}})},k.prototype.tve=function(t){this.uve(t)},k.prototype.tpe=function(){var t=this;t.$me()?t.epe():(t.Xde(),t.Ove())},k.prototype.eve=function(t,e){var r=this.getActiveCellInfo(),i=r.sheet,n=r.row,r=r.col;i===e.sheet&&n===e.row&&r===e.col&&this.Xde()},k.prototype.$ve=function(t,e){var r,i,n,r;e&&(i=(r=this.getActiveCellInfo()).sheet,n=r.row,r=r.col,i===e.sheet)&&new o.Range(e.row,e.col,e.rowCount,e.colCount).contains(n,r)&&this.Xde()},k.prototype.ave=function(t,e){(0,u.lve)(t,e)},k.prototype.rve=function(t,e){var r;(0,u.cve)(t,e)||this._6()},k.prototype.Pve=function(t,e){var r;"isProtected"===e.propertyName&&this.Ove()},k.prototype.rme=function(t,e){var r;"allowDynamicArray"===e.propertyName&&this.li.rebuildFormula()},k.prototype.Wve=function(){this.hve()},k.prototype.lme=function(t,e){var r,r,e,r=null==(r=this.Vv)?void 0:r.getSheetTab(e.sheetName),e=this.li.getCalcSource().Mf;r&&r.Mf===e&&this.Xde()},k.prototype.hme=function(t,e,r){var i;e!==r&&this.li.setOptions(this.LEt)},k.prototype._6=function(){var t=this;t.ive(),t.nve(),t.hve(),t.epe()},k.prototype.ive=function(){var t,t,t=(null==(t=this.Vv)?void 0:t.getCalcService())||h.defaultCalcService;this.li.setCalcService(t)},k.prototype.nve=function(){var t=(0,c.Kde)(this.Vv);t?this.li.setCalcSource(t.Uw()):this.li.setCalcSource(h.defaultCalcSource),this.qme()},k.prototype.hve=function(){var t,e,e,t=[],e=this.Vv;e&&(t.push.apply(t,e.getCustomNames()),e=(0,c.Kde)(e))&&t.push.apply(t,e.getCustomNames()),this.li.setCustomNames(t)},k.prototype.epe=function(){var t,e,t=this,e=t.Jme();t.li.setActiveCellInfo(e),t.Xde(),t.Ove(),t.li.clearHistory(),t.qme()},k.prototype.Ove=function(){var t=(0,c.Kde)(this.Vv);t?this.li.setReadOnly(y(t,t.getActiveRowIndex(),t.getActiveColumnIndex())):this.li.setReadOnly(!1)},k.prototype.$me=function(){var t,e,t=this.li.getActiveCellInfo(),e=this.Jme();return t.row!==e.row||t.col!==e.col},k.prototype.Jme=function(){var t,e,r,t=(0,c.Kde)(this.Vv);return t?{row:e=t.getActiveRowIndex(),col:r=t.getActiveColumnIndex()}:h.DEFAULT_ACTIVE_CELL_INFO},k.prototype.qme=function(){this.options.onActiveCellChanged&&this.options.onActiveCellChanged()},k.prototype.uve=function(t){var e,r,i,n,s,e=this,r=e.Qy.getShortcutKey(t.keyCode,t.ctrlKey,t.shiftKey,t.altKey,t.metaKey),i=e.Qy.getCommands(r);if(i)for(n=0;n<i.length;n++)if(s=i[n].execute(e,{}))return s.ignoreCancelDefault||o.mt.vi(t),!0},i.FormulaEditor=k},"./dist/plugins/formulaPanel/editor/formulaEditorCore.js":function(B,t,e){var r,i,n,s,o,h,a,u,l,c,f,d,v,m,p,g,w,b,k,y,M,x,C,S,_,F,N,$,H,U,z,W,V,q,P,j,G,J,K,O,E,D,A,R,I,L,Q,e,r,X,Z,Y;function tt(){return[i.basicSetup,Z,s.customFields,g.readOnlyExtension,m.themeExtension,l.foldExtension,c.indentExtension,o.syntaxHighlightingField,h.autoCompletionExtensions,a.hoverTooltipExtension,u.signatureTooltipsExtensions,d.doubleClickSelectRangeExtension,v.linterExtension]}function T(t,e){this.Kme=e,this.zQt=new Q({state:this.Qme(""),parent:t})}Object.defineProperty(t,"__esModule",{value:!0}),t.FormulaEditorCore=void 0,r=e("Core"),i=e("./dist/plugins/formulaPanel/editor/codemirror/index.js"),n=e("./dist/plugins/formulaPanel/editor/interface.js"),s=e("./dist/plugins/formulaPanel/editor/featureProvider/customField.js"),o=e("./dist/plugins/formulaPanel/editor/featureProvider/syntaxHighlighting.js"),h=e("./dist/plugins/formulaPanel/editor/featureProvider/completion.js"),a=e("./dist/plugins/formulaPanel/editor/featureProvider/hoverTooltips.js"),u=e("./dist/plugins/formulaPanel/editor/featureProvider/signatureTooltips.js"),l=e("./dist/plugins/formulaPanel/editor/featureProvider/folding.js"),c=e("./dist/plugins/formulaPanel/editor/featureProvider/indent.js"),f=e("./dist/plugins/formulaPanel/editor/featureProvider/tab.js"),d=e("./dist/plugins/formulaPanel/editor/featureProvider/dbClickRangeSelector.js"),v=e("./dist/plugins/formulaPanel/editor/featureProvider/lint.js"),m=e("./dist/plugins/formulaPanel/editor/featureProvider/theme.js"),p=e("./dist/plugins/formulaPanel/editor/featureProvider/formatter.js"),g=e("./dist/plugins/formulaPanel/editor/featureProvider/readOnly.js"),w=e("./dist/plugins/formulaPanel/editor/common/codeMirrorUtil.js"),b="gc-formula-editor-token-const-string",k="gc-formula-editor-token-const-number",y="gc-formula-editor-token-const-boolean",M="gc-formula-editor-token-const-error",x="gc-formula-editor-token-operator-prefix",C="gc-formula-editor-token-operator-infix",S="gc-formula-editor-token-operator-postfix",_="gc-formula-editor-token-function",F="gc-formula-editor-token-name",N="gc-formula-editor-token-reference-1",$="gc-formula-editor-token-reference-2",H="gc-formula-editor-token-reference-3",U="gc-formula-editor-token-reference-4",z="gc-formula-editor-token-reference-5",W="gc-formula-editor-token-reference-6",V="gc-formula-editor-token-reference-7",q="gc-formula-editor-token-argument-separator",P="gc-formula-editor-content",j="gc-formula-editor-gutters",G="gc-formula-editor-caret",J="gc-formula-editor-active-line",K="gc-formula-editor-selection",O="gc-formula-editor-tooltip-autocompletion-function",E="gc-formula-editor-tooltip-autocompletion-function-active-item",D="gc-formula-editor-tooltip-autocompletion-function-icon",A="gc-formula-editor-tooltip-autocompletion-function-name",R="gc-formula-editor-tooltip-autocompletion-function-description",I="gc-formula-editor-tooltip-error-message",L=r.I.fl,Q=i.View.EditorView,e=i.View.keymap,r=i.Commands.indentWithTab,X=i.Autocomplete.acceptCompletion,Z=e.of([{key:"Tab",run:X},{key:"Tab",run:f.insertTab},r]),T.prototype.getView=function(){return this.zQt},T.prototype.getText=function(){return this.zQt.state.doc.toJSON().join("\n")},T.prototype.setText=function(t){this.zQt.dispatch({changes:{from:0,to:this.zQt.state.doc.length,insert:t}})},T.prototype.getFunctions=function(){return(0,w.getFunctionsByState)(this.zQt.state)},T.prototype.getCustomNames=function(){return this.zQt.state.field(s.customNamesField)},T.prototype.setCustomNames=function(t){this.zQt.dispatch({effects:s.setCustomNamesField.of(t)})},T.prototype.getOptions=function(){return this.zQt.state.field(s.optionsField)},T.prototype.setOptions=function(t){this.zQt.dispatch({effects:s.setOptionsField.of(t)})},T.prototype.getReadOnly=function(){return this.zQt.state.readOnly},T.prototype.setReadOnly=function(t){t!==this.getReadOnly()&&(0,g.reconfigureReadOnly)(this.zQt,t)},T.prototype.getTheme=function(){return this.zQt.state.field(s.themeField)},T.prototype.setTheme=function(t){this.zQt.dispatch({effects:s.setThemeField.of(t)}),this.zQt.dispatch({effects:m.themeCompartment.reconfigure((0,m.createThemeExtension)(t))})},T.prototype.getCalcSource=function(){return this.zQt.state.field(s.calcSourceField)},T.prototype.setCalcSource=function(t){this.zQt.dispatch({effects:s.setCalcSourceField.of(t)})},T.prototype.getCalcService=function(){return this.zQt.state.field(s.calcServiceField)},T.prototype.setCalcService=function(t){this.zQt.dispatch({effects:s.setCalcServiceField.of(t)})},T.prototype.getActiveCellInfo=function(){return this.zQt.state.field(s.activeCellField)},T.prototype.setActiveCellInfo=function(t){this.zQt.dispatch({effects:s.setActiveCellField.of(t)})},T.prototype.getProvider=function(){return this.zQt.state.field(s.providerField)},T.prototype.setProvider=function(t){this.zQt.dispatch({effects:s.setProviderField.of(t)})},T.prototype.format=function(){(0,p.formatDocumentCommand)(this.zQt)},T.prototype.hasFocus=function(){return this.zQt.hasFocus},T.prototype.destroy=function(){this.zQt.destroy()},T.prototype.rebuildFormula=function(){this.zQt.dispatch({effects:s.rebuildFormulaEffect.of(!0)})},T.prototype.clearHistory=function(){var t,e,r,i,n,s,o,h,a,u,e,t=this,e=t.getText(),r=t.getTheme(),i=t.getOptions(),n=t.getCalcService(),s=t.getCalcSource(),o=t.getCustomNames(),h=t.getActiveCellInfo(),a=t.getProvider(),u=t.getReadOnly(),e=t.Qme(e);t.zQt.setState(e),t.setTheme(r),t.setOptions(i),t.setCalcService(n),t.setCalcSource(s),t.setActiveCellInfo(h),t.setCustomNames(o),t.setProvider(a),t.setReadOnly(u)},T.prototype.initTheme=function(){var t,e,r,t=[{token:n.SyntaxHighlightingTokenType.stringConst,color:L(b).color},{token:n.SyntaxHighlightingTokenType.numberConst,color:L(k).color},{token:n.SyntaxHighlightingTokenType.booleanConst,color:L(y).color},{token:n.SyntaxHighlightingTokenType.errorConst,color:L(M).color},{token:n.SyntaxHighlightingTokenType.operatorPrefix,color:L(x).color},{token:n.SyntaxHighlightingTokenType.operatorInfix,color:L(C).color},{token:n.SyntaxHighlightingTokenType.operatorPostfix,color:L(S).color},{token:n.SyntaxHighlightingTokenType.function,color:L(_).color},{token:n.SyntaxHighlightingTokenType.name,color:L(F).color},{token:n.SyntaxHighlightingTokenType.argumentSeparator,color:L(q).color},{token:n.SyntaxHighlightingTokenType.reference,color:[L(N).color,L($).color,L(H).color,L(U).color,L(z).color,L(W).color,L(V).color]}],e={backgroundColor:L(P).backgroundColor,font:L(P).font,color:L(P).color,caretColor:L(G).color,selectionBackColor:L(K).backgroundColor,activeLineBackColor:L(J).backgroundColor,autocompletionStyle:{backgroundColor:L(O).backgroundColor,font:L(O).font,color:L(O).color,border:L(O).border,activeItem:{backgroundColor:L(E).backgroundColor,color:L(E).color},function_icon:{color:L(D).color,font:L(D).font},function_name:{color:L(A).color,font:L(A).font},function_description:{color:L(R).color,font:L(R).font}},errorStyle:{backgroundColor:L(I).backgroundColor,font:L(I).font,color:L(I).color}},r={backgroundColor:L(j).backgroundColor,font:L(j).font,color:L(j).color};this.setTheme({rules:t,editorContentStyle:e,editorGuttersStyle:r})},T.prototype.isFormattedFormula=function(){return this.zQt.state.field(s.isFormattedFormulaField)},T.prototype.Qme=function(t){var e=tt().concat(this.Kme);return i.State.EditorState.create({extensions:e,doc:t})},t.FormulaEditorCore=T},"./dist/plugins/formulaPanel/editor/interface.js":function(t,e){var r,i,n,n;Object.defineProperty(e,"__esModule",{value:!0}),e.TokenType=e.SyntaxHighlightingTokenType=void 0,(n=r=e.SyntaxHighlightingTokenType||(e.SyntaxHighlightingTokenType={}))[n.subExpression=0]="subExpression",n[n.function=1]="function",n[n.argumentSeparator=2]="argumentSeparator",n[n.operatorPrefix=3]="operatorPrefix",n[n.operatorInfix=4]="operatorInfix",n[n.operatorPostfix=5]="operatorPostfix",n[n.stringConst=6]="stringConst",n[n.errorConst=7]="errorConst",n[n.numberConst=8]="numberConst",n[n.booleanConst=9]="booleanConst",n[n.name=10]="name",n[n.reference=11]="reference",n[n.whitespace=12]="whitespace",n[n.unknown=13]="unknown",(n=i=e.TokenType||(e.TokenType={}))[n.ErrorConst=0]="ErrorConst",n[n.LogicalConst=1]="LogicalConst",n[n.NumberConst=2]="NumberConst",n[n.StringConst=3]="StringConst",n[n.ArrayConstStart=4]="ArrayConstStart",n[n.ArrayConstEnd=5]="ArrayConstEnd",n[n.ArrayConstRowSeparator=6]="ArrayConstRowSeparator",n[n.ArrayConstItemSeparator=7]="ArrayConstItemSeparator",n[n.OperatorPrefix=8]="OperatorPrefix",n[n.OperatorInfix=9]="OperatorInfix",n[n.OperatorPostfix=10]="OperatorPostfix",n[n.FunctionName=11]="FunctionName",n[n.FunctionCallStart=12]="FunctionCallStart",n[n.FunctionCallEnd=13]="FunctionCallEnd",n[n.FunctionArgumentSeparator=14]="FunctionArgumentSeparator",n[n.SubExpressionStart=15]="SubExpressionStart",n[n.SubExpressionEnd=16]="SubExpressionEnd",n[n.CellReference=17]="CellReference",n[n.Name=18]="Name",n[n.FormulaStart=19]="FormulaStart",n[n.Whitespace=20]="Whitespace",n[n.Unknown=21]="Unknown"},"./dist/plugins/formulaPanel/editor/spreadFeatureProvider/formulaReferencedRangesContext.js":function(t,c,e){var r,f,i,n,s,d,o,h,v,a,u,l,m,p;function g(t){this.cmt=!0,this.rl=!1,this.Xvt=f.SelectionUnit.cell,this.Ivt=!1,this.xmt=!0,this.qMi=!1,this.XD=!1,this.umt=-1,this.zQt=t}function w(t){this.fve=t}function b(t){var e,r,r,e=(0,d.getActiveSheetByState)(t);e&&(y(r=i.Ode.Ede())&&(r.Rde(e),e=(0,d.getActiveSheetByState)(t)),k(r=e.Nde))&&(r.dispose(),e.Nde=l,M(e.parent,!1))}function k(t){return t instanceof m}function y(t){return t instanceof p}function M(t,e){var r=function(t){t&&(t.rt.X6=e)};t.sheets.forEach(r),t.mp.forEach(function(t){r(t.Mf)})}function x(t,e){t.parent.e3(t,e=void 0===e?!0:e)}Object.defineProperty(c,"__esModule",{value:!0}),c.setWorkbookFocusStatus=c.isFormulaEditorReferencedRangesAcrossSheetContext=c.isFormulaEditorReferencedRangesContext=c.closeFormulaReferencedRanges=c.FormulaEditorReferencedRangesAcrossSheetContext=c.FormulaEditorReferencedRangesContext=c.appendingRangeAnnotation=void 0,r=e("Common"),f=e("Core"),i=e("FormulaTextBox"),n=e("./dist/plugins/formulaPanel/editor/codemirror/index.js"),s=e("./dist/plugins/formulaPanel/editor/common/calcUtil.js"),d=e("./dist/plugins/formulaPanel/editor/common/codeMirrorUtil.js"),o=e("./dist/plugins/formulaPanel/editor/common/util.js"),h=e("./dist/plugins/formulaPanel/editor/featureProvider/customField.js"),v=e("./dist/plugins/formulaPanel/editor/featureProvider/signatureTooltips.js"),a=e("./dist/plugins/formulaPanel/editor/featureProvider/syntaxHighlighting.js"),u=e("./dist/plugins/formulaPanel/editor/formulaEditor-action.js"),l=void 0,c.appendingRangeAnnotation=n.State.Annotation.define(),g.prototype.smt=function(){var t,e,r,i,n,t;if(!this.isFormula())return[];for(t=this.zQt.state,e=(0,d.getTokensByState)(t),(0,a.markReferenceTokenColorIndex)(e,t),r=[],i=0;i<e.length;i++)n=e[i],((0,s.isReferenceToken)(n)||(0,s.isNameToken)(n)&&(0,s.hasReferenceRanges)(n))&&r.push({index:r.length,textOffset:n.index,text:n.text,ranges:n.ranges,allowDrag:n.canDrag,sheetArea:f.SheetArea.viewport,tag:{colorIndex:n.colorIndex}});return(t=this.Fvt)&&r.push({textOffset:-1,text:"",ranges:[t],index:r.length,allowDrag:!1,isPivotClickCell:!0,tag:{colorIndex:0}}),r},g.prototype.pmt=function(t){var e,e,t,e=(0,d.getReferenceTokenColors)(this.zQt.state),t=this.smt()[t];return e[(null==(e=null==t?void 0:t.tag)?void 0:e.colorIndex)||0]},g.prototype.ymt=function(t){var e=this.zQt.state.selection.main.head;return t.textOffset<=e&&t.textOffset+t.text.length>=e},g.prototype.bmt=function(t){var e,r;return!!this.XD&&(e=this.zQt.state.selection.main.head,r=this.umt,t.textOffset>=r)&&t.textOffset+t.text.length<=e},g.prototype.Qvt=function(){return f.SheetArea.viewport},g.prototype.Dvt=function(){var t,t,t=this.zQt.state;return!t.readOnly&&(!(!this.XD&&!(0,f.Df)(this.text()))||!!this.isFormula()&&!!(t=(0,s.getTokenByPos)((0,d.getTokensByState)(t),(0,d.getSelection)(t).from-1))&&((0,s.isFormulaStartToken)(t)||(0,s.isFunctionCallStartToken)(t)||(0,s.isSubExpressionStartToken)(t)||(0,s.isFunctionArgumentSeparator)(t)||(0,s.isLeftParenthesesToken)(t)||(0,s.isInfixOperatorToken)(t)||(0,s.isPrefixOperatorToken)(t)||(0,s.isWhitespaceToken)(t)))},g.prototype.text=function(){return(0,d.getTextByState)(this.zQt.state)},g.prototype.caret=function(){return this.zQt.state.selection.main.head},g.prototype.close=function(){},g.prototype.mmt=function(){},g.prototype.Lde=function(t,e){var r,i,t,n,t,s;e&&(r=this.zQt,t=(i=this.smt())[t])&&(t=(n=t.textOffset)+t.text.length,s=n+e.length,r.dispatch({changes:{from:n,to:t,insert:e},selection:{anchor:s,head:s},annotations:v.notTriggerSignatureTooltip.of(!0)}))},g.prototype.Gvt=function(t,e,r,i,n){var n,s,o,h,a,u,u,l;if(void 0===n&&(n=f.SheetArea.viewport),t){if(o=(s=(n=this).zQt).state,!n.XD){if(!n.Dvt())return;n.XD=!(e=!1),n.umt=(0,d.getSelection)(o).from}h=n.umt,a=(0,d.getSelection)(o).to,u=(0,d.getTokensByState)(o),u=(0,d.getValidReferenceTokenByPos)(u,a,o),r?(l=h+t.length,s.dispatch({changes:{from:h,to:a,insert:t},selection:{anchor:l,head:l},annotations:[c.appendingRangeAnnotation.of(!0),v.notTriggerSignatureTooltip.of(!0)]})):e?u&&u.index>=h&&a>=u.index&&(l=u.index+t.length,s.dispatch({changes:{from:u.index,to:a,insert:t},selection:{anchor:l,head:l},annotations:[c.appendingRangeAnnotation.of(!0),v.notTriggerSignatureTooltip.of(!0)]})):(l=a+(t=h<a?n.fgt()+t:t).length,s.dispatch({changes:{from:a,to:a,insert:t},selection:{anchor:l,head:l},annotations:[c.appendingRangeAnnotation.of(!0),v.notTriggerSignatureTooltip.of(!0)]}))}},g.prototype.qD=function(){var t=this;t.XD&&(t.XD=!1,t.umt=-1)},g.prototype.onRangeMoved=function(){},g.prototype.onRangeResized=function(){},g.prototype.onRangeAppend=function(){},g.prototype.fgt=function(){var t=r.Common.CultureManager.Fe().NumberFormat;return t&&t.listSeparator||o.COMMA},g.prototype.dve=function(){return this.zQt.state.field(h.calcSourceField).Mf},g.prototype.vve=function(){return this.zQt.state.field(h.activeCellField)},g.prototype.isFormula=function(){return this.zQt.state.field(h.isFormulaField)},g.prototype.Ak=function(t){t&&(this.Dmt=[t])},g.prototype.Hce=function(){this.Dmt=l},g.prototype.Ymt=function(){return this.Dmt},g.prototype.dispose=function(){this.zQt=l},g.prototype.mve=function(){var t=this.zQt;t&&(b(t.state),t.hasFocus&&t.contentDOM.blur(),this.dispose())},m=g,c.FormulaEditorReferencedRangesContext=m,Object.defineProperty(w.prototype,"Ivt",{get:function(){return this.fve.Ivt},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"Mf",{get:function(){return this.fve.dve()},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"_text",{get:function(){return this.fve.text()},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"bZ",{get:function(){return this.fve.vve().row},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"mvt",{get:function(){return this.fve.vve().col},enumerable:!1,configurable:!0}),w.prototype.Rde=function(t){var e,r,i,n,s,e=!1,r=this.Mf,i=this.bZ,n=this.mvt,s=this._text;return r!==t&&(x(r),e=!0),(0,u.executeCommitContextToCellCommand)(r,i,n,s),this.d5(),e},w.prototype.d5=function(){this.fve=l,i.Ode.DJ=l},p=w,c.FormulaEditorReferencedRangesAcrossSheetContext=p,c.closeFormulaReferencedRanges=b,c.isFormulaEditorReferencedRangesContext=k,c.isFormulaEditorReferencedRangesAcrossSheetContext=y,c.setWorkbookFocusStatus=M},"./dist/plugins/formulaPanel/editor/spreadFeatureProvider/formulaReferencedRangesExtension.js":function(t,e,r){var s,i,o,h,a,u,r,i;function l(t,e,r){var i=r.parent;t&&t.zQt===e||(r.Nde=new a.FormulaEditorReferencedRangesContext(e),(0,a.setWorkbookFocusStatus)(i,r.Nde.Dvt()))}function c(t,e,r){var r;(0,a.isFormulaEditorReferencedRangesContext)(t)&&(r=r.parent,n(t,e,r)?(0,a.closeFormulaReferencedRanges)(e.state):document.activeElement!==e.contentDOM&&setTimeout(function(){e.focus()},10))}function n(t,e,r){var i=document.activeElement;return i!==e.contentDOM&&!(i.hasAttribute("data-gc-formula-editor-additional-element")||t.Dvt()&&r&&r.Ti&&r.Ti.contains(i))}function f(t,e){var e,r;d(t.keyCode)&&(r=(e=(0,o.getActiveSheetByState)(e.state))&&e.Nde,(0,a.isFormulaEditorReferencedRangesContext)(r))&&e.rt.yk(t)}function d(t){return 16===t||17===t||18===t}function v(t,e){var r,i,n,r=e.oldSheet,i=e.newSheet;r&&i&&r!==i&&(n=r.Nde,(0,a.isFormulaEditorReferencedRangesContext)(n))&&(n.Dvt()||s.Ode.DJ)&&(e.needTriggerSheetChange=!1,i.Nde=n,r.Nde=u)}function m(t,e){var r,e,r,r,r=e.oldSheet,e=e.newSheet;if(e&&!e.xT&&r!==e&&(r=e.Nde,(0,a.isFormulaEditorReferencedRangesContext)(r))&&(r.Dvt()||s.Ode.DJ))return r.dve()!==e?s.Ode.DJ=new a.FormulaEditorReferencedRangesAcrossSheetContext(r):(r=s.Ode.DJ,(0,a.isFormulaEditorReferencedRangesAcrossSheetContext)(r)&&(r.d5(),s.Ode.DJ=u)),(0,h.paintFormulaReferencedRanges)(e),!0}Object.defineProperty(e,"__esModule",{value:!0}),e.cve=e.lve=e.isMetaKeyForAppendingRange=e.formulaReferencedRangesExtension=void 0,s=r("FormulaTextBox"),i=r("./dist/plugins/formulaPanel/editor/codemirror/index.js"),o=r("./dist/plugins/formulaPanel/editor/common/codeMirrorUtil.js"),h=r("./dist/plugins/formulaPanel/editor/formulaEditor-spreadjs.js"),a=r("./dist/plugins/formulaPanel/editor/spreadFeatureProvider/formulaReferencedRangesContext.js"),u=void 0,r=i.View.EditorView.updateListener.of(function(t){var e,r,i,n,e=(0,o.getActiveSheetByState)(t.state);e&&(r=e.parent,i=e.Nde,n=s.Ode.Ede(),!i&&(0,a.isFormulaEditorReferencedRangesAcrossSheetContext)(n)&&(i=n.fve),t.focusChanged?((t.view.hasFocus?l:c)(i,t.view,e),(0,h.paintFormulaReferencedRanges)(e)):(t.selectionSet||t.docChanged)&&i&&(t.transactions.some(function(t){return!t.annotation(a.appendingRangeAnnotation)})&&i.qD(),(0,a.setWorkbookFocusStatus)(r,i.Dvt()),(0,h.paintFormulaReferencedRanges)(e)))}),i=i.View.ViewPlugin.define(function(){return null},{eventHandlers:{keydown:f,keyup:f}}),e.formulaReferencedRangesExtension=[r,i],e.isMetaKeyForAppendingRange=d,e.lve=v,e.cve=m},"./dist/plugins/formulaPanel/editor/spreadFeatureProvider/structReferences.js":function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.getStructReferencesByWorkbook=void 0;var o=r("CalcEngine");function i(t){return t?n(t).concat(h(t)):[]}function n(t){var r=[];return t.sheets.forEach(function(t){var e;(t.tables&&t.tables.all()||[]).forEach(function(t){r.push({name:t.name(),description:(0,o.sR)().Fbx_TableName_Description+t.name(),getColumns:function(){return s(t)}})})}),r}function s(t){for(var r,e,i,n,s,r=[],e=0,i="";null!==i;)i=t.getColumnName(e),e++,null!==i&&r.push({name:i,description:""});return n=(0,o.sR)().d2t,s=(0,o.getMapping)()&&(0,o.getMapping)().tableFunctionsMapping,Object.keys(n).forEach(function(t){var t=n[t],e=t.name,t=t.description,e=s&&s[e]||e;r.push({name:e,description:t})}),r}function h(t){var e=[];return t.mp.forEach(function(t){e.push({name:t.name(),description:(0,o.sR)().Fbx_TableSheetName_Description+t.name(),getColumns:function(){return a(t)}})}),e}function a(t){for(var e,r,i,e=[],r=t.getColumnCount(),i=0;i<r;i++)e.push({name:t.getColumnName(i),description:""});return e}e.getStructReferencesByWorkbook=i},"./dist/plugins/formulaPanel/formulaPanel.entry.js":function(t,e,r){var i,n,s,o,h,a,u,l,c,i=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&("get"in n?e.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){t[i=void 0===i?r:i]=e[r]}),n=this&&this.__exportStar||function(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||i(e,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),e.findControl=e.pve=e.Commands=e.FormulaEditor=void 0,s=r("Core"),r("./dist/plugins/formulaPanel/editor/formulaEditor-spreadjs.js"),r("./dist/plugins/formulaPanel/editor/formulaEditor-action.js"),o=r("./dist/plugins/formulaPanel/editor/formulaEditor.js"),h=r("./dist/plugins/formulaPanel/editor/featureProvider/lint.js"),a=r("./dist/plugins/formulaPanel/editor/common/formatter.js"),u=r("./dist/plugins/formulaPanel/editor/formulaEditor.js"),Object.defineProperty(e,"FormulaEditor",{enumerable:!0,get:function(){return u.FormulaEditor}}),l=r("./dist/plugins/formulaPanel/editor/formulaEditor-action.js"),Object.defineProperty(e,"Commands",{enumerable:!0,get:function(){return l.Commands}}),e.pve={gve:h.getDiagnostic,I5:a.format},n(r("./dist/plugins/formulaPanel/editor/editor.ns.js"),e),e.findControl=c=function(t){return"string"==typeof t&&(t=document.getElementById(t)),(0,s.GC$)(t).data(o.CONST_FORMULA_EDITOR)}},Common:function(t){t.exports=e.Spread},CalcEngine:function(t){t.exports=e.Spread.CalcEngine},Core:function(t){t.exports=e.Spread.Sheets},SheetsCalc:function(t){t.exports=e.Spread.Sheets.CalcEngine},FormulaTextBox:function(t){t.exports=e.Spread.Sheets.FormulaTextBox}},i={},n.d=function(t,e){for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},t=n("./dist/plugins/formulaPanel/formulaPanel.entry.js"),(((e=void 0===e?{}:e).Spread=e.Spread||{}).Sheets=e.Spread.Sheets||{}).FormulaPanel=t}()});